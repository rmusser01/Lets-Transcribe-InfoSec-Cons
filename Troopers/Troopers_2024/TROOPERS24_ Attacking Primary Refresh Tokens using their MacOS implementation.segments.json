{
  "metadata": {
    "webpage_url": "https://www.youtube.com/watch?v=wFhe0-RRkFA",
    "title": "TROOPERS24: Attacking Primary Refresh Tokens using their MacOS implementation",
    "description": "Talk by Olaf Hartong and Dirk-jan Mollema - June 27th, 2024 at TROOPERS24 IT security conference in Heidelberg, Germany hosted by @ERNW_ITSec\n\n#TROOPERS24 #ITsecurity \nhttps://troopers.de/troopers24/talks/3vlccy/\n\nMore impressions:\n  / wearetroopers  \n  / ernw_itsec  \nhttps://infosec.exchange/@WEareTROOPERS\nhttps://infosec.exchange/@ERNW https://ernw.de",
    "channel_url": "https://www.youtube.com/channel/UCPY5aUREHmbDO4PtR6AYLfQ",
    "duration": 3327,
    "channel": "TROOPERS IT Security Conference",
    "uploader": "TROOPERS IT Security Conference",
    "upload_date": "20240909"
  },
  "segments": {
    "metadata": {
      "webpage_url": "https://www.youtube.com/watch?v=wFhe0-RRkFA",
      "title": "TROOPERS24: Attacking Primary Refresh Tokens using their MacOS implementation",
      "description": "Talk by Olaf Hartong and Dirk-jan Mollema - June 27th, 2024 at TROOPERS24 IT security conference in Heidelberg, Germany hosted by @ERNW_ITSec\n\n#TROOPERS24 #ITsecurity \nhttps://troopers.de/troopers24/talks/3vlccy/\n\nMore impressions:\n  / wearetroopers  \n  / ernw_itsec  \nhttps://infosec.exchange/@WEareTROOPERS\nhttps://infosec.exchange/@ERNW https://ernw.de",
      "channel_url": "https://www.youtube.com/channel/UCPY5aUREHmbDO4PtR6AYLfQ",
      "duration": 3327,
      "channel": "TROOPERS IT Security Conference",
      "uploader": "TROOPERS IT Security Conference",
      "upload_date": "20240909"
    },
    "segments": [
      {
        "Time_Start": 0.0,
        "Time_End": 19.080000000000002,
        "Text": "This text was transcribed using whisper model: large-v2\n\n Hello everyone, welcome to our nice storybook, probably the most over-engineered slides I"
      },
      {
        "Time_Start": 19.080000000000002,
        "Time_End": 22.52,
        "Text": " ever created, but I hope you enjoy them."
      },
      {
        "Time_Start": 22.52,
        "Time_End": 27.76,
        "Text": " So we're going to talk about Prima Refis tokens, primarily what we found on Mac, we might say"
      },
      {
        "Time_Start": 27.76,
        "Time_End": 33.28,
        "Text": " some stuff about the Windows implementation, but the focus will be Mac, maybe."
      },
      {
        "Time_Start": 33.28,
        "Time_End": 35.800000000000004,
        "Text": " So a couple of things that we're going to talk about today, right?"
      },
      {
        "Time_Start": 35.800000000000004,
        "Time_End": 40.760000000000005,
        "Text": " So we're going to start with explaining a little bit about Prima Refis tokens, it has"
      },
      {
        "Time_Start": 40.760000000000005,
        "Time_End": 44.400000000000006,
        "Text": " been announced a couple of times over the last two days, but you may have been somewhere"
      },
      {
        "Time_Start": 44.400000000000006,
        "Time_End": 48.160000000000004,
        "Text": " else, so we're going to talk about it regardless."
      },
      {
        "Time_Start": 48.160000000000004,
        "Time_End": 53.72,
        "Text": " Then we found during our research that there are actually multiple versions of the protocol,"
      },
      {
        "Time_Start": 53.72,
        "Time_End": 58.04,
        "Text": " and this is very important because maybe the Microsoft documentation is not very accurate"
      },
      {
        "Time_Start": 58.04,
        "Time_End": 60.44,
        "Text": " on that side."
      },
      {
        "Time_Start": 60.44,
        "Time_End": 65.4,
        "Text": " We'll briefly talk about the Secure Enclave on Mac, which is their implementation of the"
      },
      {
        "Time_Start": 65.4,
        "Time_End": 71.08,
        "Text": " TPM, which Microsoft mostly uses, and quite well actually."
      },
      {
        "Time_Start": 71.08,
        "Time_End": 74.8,
        "Text": " So there won't be a lot of zero days sadly today."
      },
      {
        "Time_Start": 74.8,
        "Time_End": 80.92,
        "Text": " We did report our findings to Microsoft and then they wanted to call with us, so you can"
      },
      {
        "Time_Start": 81.04,
        "Time_End": 83.56,
        "Text": " sort of figure out what it was."
      },
      {
        "Time_Start": 83.56,
        "Time_End": 87.84,
        "Text": " So we thought it was like a benign thing and out of courtesy we would report it."
      },
      {
        "Time_Start": 87.84,
        "Time_End": 92.08,
        "Text": " Turned out it was a critical vulnerability and they wanted six months to fix it."
      },
      {
        "Time_Start": 92.08,
        "Time_End": 94.2,
        "Text": " So we can't do all the demos."
      },
      {
        "Time_Start": 94.2,
        "Time_End": 98.56,
        "Text": " So we might allude to some things, but not too much since we promised not to talk about"
      },
      {
        "Time_Start": 98.56,
        "Time_End": 99.56,
        "Text": " it."
      },
      {
        "Time_Start": 99.56,
        "Time_End": 101.12,
        "Text": " But there's still a lot of interesting stuff."
      },
      {
        "Time_Start": 101.12,
        "Time_End": 103.08,
        "Text": " There will be interesting things, for sure."
      },
      {
        "Time_Start": 103.08,
        "Time_End": 108.12,
        "Text": " So for the people that don't know me, I am Olaf, I like warm hugs, I'm a detection engineer"
      },
      {
        "Time_Start": 108.12,
        "Time_End": 114.72,
        "Text": " and security researcher at FalconForce, a Dutch-based company where we do a lot of cool"
      },
      {
        "Time_Start": 114.72,
        "Time_End": 118.2,
        "Text": " detection engineering, but also red teaming work."
      },
      {
        "Time_Start": 118.2,
        "Time_End": 122.68,
        "Text": " And if you want to still listen to me afterwards, you can follow me on Twitter and reach out."
      },
      {
        "Time_Start": 122.68,
        "Time_End": 129.0,
        "Text": " Yes, I'm Dirk Jum, I think this is my fourth time at Troopers, so I always love being there,"
      },
      {
        "Time_Start": 129.0,
        "Time_End": 133.6,
        "Text": " so thanks again for having me, always a pleasure to be here."
      },
      {
        "Time_Start": 133.6,
        "Time_End": 138.6,
        "Text": " I do research and pen testing and training, mostly on Microsoft products, started with"
      },
      {
        "Time_Start": 138.6,
        "Time_End": 144.2,
        "Text": " Active Directory, moved to Entra because that's where all the fun stuff is at, and as Sean"
      },
      {
        "Time_Start": 144.2,
        "Time_End": 148.92,
        "Text": " described, there's already like 20 years of history in researching Active Directory, but"
      },
      {
        "Time_Start": 148.92,
        "Time_End": 154.24,
        "Text": " with Entra it sometimes felt like I was the first one that was looking at it together"
      },
      {
        "Time_Start": 154.24,
        "Time_End": 155.24,
        "Text": " with Nest 3."
      },
      {
        "Time_Start": 155.24,
        "Time_End": 159.32,
        "Text": " So there's a lot of stuff to explore, there's a lot of new stuff, there's new stuff coming"
      },
      {
        "Time_Start": 159.32,
        "Time_End": 160.32,
        "Text": " out every month."
      },
      {
        "Time_Start": 160.92,
        "Time_End": 164.92,
        "Text": " That is also why we're going to talk about something that I don't think anyone really"
      },
      {
        "Time_Start": 164.92,
        "Time_End": 167.76,
        "Text": " covered so far."
      },
      {
        "Time_Start": 167.76,
        "Time_End": 173.4,
        "Text": " And this actually goes back a little bit, because we already started with this research,"
      },
      {
        "Time_Start": 173.4,
        "Time_End": 177.92,
        "Text": " or I think it started when Olaf sent me a message like, hey, you talked about Prime"
      },
      {
        "Time_Start": 177.92,
        "Time_End": 181.68,
        "Text": " Refresh Tokens, why not have a look at how it works on Mac?"
      },
      {
        "Time_Start": 181.68,
        "Time_End": 187.76,
        "Text": " And that was in 2022, and then we did a bit of research in December 2022, and then we"
      },
      {
        "Time_Start": 187.76,
        "Time_End": 190.76,
        "Text": " were like, oh, yeah, it's pretty fun, maybe we should submit it for Troopers, but then"
      },
      {
        "Time_Start": 190.76,
        "Time_End": 199.32,
        "Text": " the last year Troopers deadline was already gone, so we kind of kept it and it was there."
      },
      {
        "Time_Start": 199.32,
        "Time_End": 202.6,
        "Text": " And then this year we were like, okay, well, let's submit it to Troopers, that way we for"
      },
      {
        "Time_Start": 202.6,
        "Time_End": 210.32,
        "Text": " sure have to finish the research, and then we actually finished it in the last few months."
      },
      {
        "Time_Start": 210.32,
        "Time_End": 214.79999999999998,
        "Text": " We also find some time to actually send the report to MSRC, so even though we already"
      },
      {
        "Time_Start": 214.8,
        "Time_End": 220.08,
        "Text": " knew the details, like in 2022, we only really worked it out, fleshed it out, written all"
      },
      {
        "Time_Start": 220.08,
        "Time_End": 227.08,
        "Text": " the proof of concepts, submitted it to Microsoft last few months, and then we also found out"
      },
      {
        "Time_Start": 227.08,
        "Time_End": 231.44,
        "Text": " that all the research that we did was already outdated, because Microsoft had a completely"
      },
      {
        "Time_Start": 231.44,
        "Time_End": 232.92000000000002,
        "Text": " new implementation."
      },
      {
        "Time_Start": 232.92000000000002,
        "Time_End": 237.52,
        "Text": " So that was, of course, more fun for this talk, so now we'll also cover the latest and"
      },
      {
        "Time_Start": 237.52,
        "Time_End": 240.92000000000002,
        "Text": " greatest implementation."
      },
      {
        "Time_Start": 240.92000000000002,
        "Time_End": 243.32000000000002,
        "Text": " And the story, we have a few characters."
      },
      {
        "Time_Start": 243.84,
        "Time_End": 247.68,
        "Text": " Yeah, this is just to sort of indicate what we're talking about, right?"
      },
      {
        "Time_Start": 247.68,
        "Time_End": 253.28,
        "Text": " So we have our little squirrel, who's implementing code, maybe not always in the most secure"
      },
      {
        "Time_Start": 253.28,
        "Time_End": 257.0,
        "Text": " way, sometimes actually it is, so you have sort of a highlight."
      },
      {
        "Time_Start": 257.0,
        "Time_End": 262.84,
        "Text": " We have our little bear, who's trying to find a tech path during our whole exploratory thing"
      },
      {
        "Time_Start": 262.84,
        "Time_End": 265.08,
        "Text": " through EnterID."
      },
      {
        "Time_Start": 265.08,
        "Time_End": 269.76,
        "Text": " We have our little beaver that's trying to build dams and trying to build security, and"
      },
      {
        "Time_Start": 269.76,
        "Time_End": 274.15999999999997,
        "Text": " then we have our little kingfisher, who, of course, likes fishing."
      },
      {
        "Time_Start": 274.15999999999997,
        "Time_End": 278.15999999999997,
        "Text": " So there's a lot of weird puns in there, dad jokes as well."
      },
      {
        "Time_Start": 278.15999999999997,
        "Time_End": 284.64,
        "Text": " And we weren't the first to look into this, actually Thomas Naunheim from Glukanya already"
      },
      {
        "Time_Start": 284.64,
        "Time_End": 290.12,
        "Text": " looked a little bit into using the primary refresh token implementation on Mac, and he"
      },
      {
        "Time_Start": 290.12,
        "Time_End": 291.44,
        "Text": " played with it a bit."
      },
      {
        "Time_Start": 291.44,
        "Time_End": 298.71999999999997,
        "Text": " At that time, Dirk-Jan's roadtools and roadtx wasn't compatible with it yet, so he figured"
      },
      {
        "Time_Start": 298.72,
        "Time_End": 301.20000000000005,
        "Text": " out some things, but not everything."
      },
      {
        "Time_Start": 301.20000000000005,
        "Time_End": 305.56,
        "Text": " But definitely his research, when we were looking into it, helped us a little bit or"
      },
      {
        "Time_Start": 305.56,
        "Time_End": 307.40000000000003,
        "Text": " clarified some bits."
      },
      {
        "Time_Start": 307.40000000000003,
        "Time_End": 314.12,
        "Text": " So we want to thank him, at least for writing this blog, because this predates our research."
      },
      {
        "Time_Start": 314.12,
        "Time_End": 319.84000000000003,
        "Text": " And as promised, we're going to dive a little bit into PRTs, and we're going to go very"
      },
      {
        "Time_Start": 319.84000000000003,
        "Time_End": 326.0,
        "Text": " deep into them afterwards with a lot of crypto fun, so I hope you are very awake after lunch."
      },
      {
        "Time_Start": 326.4,
        "Time_End": 329.4,
        "Text": " Otherwise, good luck."
      },
      {
        "Time_Start": 329.4,
        "Time_End": 331.32,
        "Text": " And it starts in the simplest way, right?"
      },
      {
        "Time_Start": 331.32,
        "Time_End": 340.52,
        "Text": " So a user might want to log into Teams, so they do, they sign in, Teams talks to EnterID,"
      },
      {
        "Time_Start": 340.52,
        "Time_End": 346.56,
        "Text": " it gets some tokens, it requests tokens, it gets tokens, and then with that, it will actually"
      },
      {
        "Time_Start": 346.56,
        "Time_End": 354.12,
        "Text": " use the refresh token to get an access token to the Teams backend, but also to Exchange"
      },
      {
        "Time_Start": 354.12,
        "Time_End": 358.04,
        "Text": " or SharePoint, all these kinds of resources."
      },
      {
        "Time_Start": 358.04,
        "Time_End": 363.16,
        "Text": " And it's kind of important where the application and resources are scope-based, right?"
      },
      {
        "Time_Start": 363.16,
        "Time_End": 369.56,
        "Text": " So they can only be used for certain types of activities."
      },
      {
        "Time_Start": 369.56,
        "Time_End": 374.12,
        "Text": " And from there, we can move on to how the implementation is on Windows."
      },
      {
        "Time_Start": 374.12,
        "Time_End": 378.48,
        "Text": " Yeah, because this is the simple case, this is just basic OAuth, access tokens, refresh"
      },
      {
        "Time_Start": 378.48,
        "Time_End": 379.48,
        "Text": " tokens."
      },
      {
        "Time_Start": 379.48,
        "Time_End": 383.44,
        "Text": " But the problem with this is that every app kind of has to manage its own tokens, which"
      },
      {
        "Time_Start": 383.44,
        "Time_End": 388.56,
        "Text": " is of course a bit of a, well, it's not ideal, it's much better if you have one source of"
      },
      {
        "Time_Start": 388.56,
        "Time_End": 392.56,
        "Text": " all these tokens, and on Windows, that is the primary refresh token."
      },
      {
        "Time_Start": 392.56,
        "Time_End": 396.64,
        "Text": " And if you have a primary refresh token, then this flow of this little bear trying to sign"
      },
      {
        "Time_Start": 396.64,
        "Time_End": 401.15999999999997,
        "Text": " into Teams, it's a little different, because in this case, this bear actually doesn't sign"
      },
      {
        "Time_Start": 401.15999999999997,
        "Time_End": 404.0,
        "Text": " into Teams, but they sign into Windows."
      },
      {
        "Time_Start": 404.0,
        "Time_End": 408.04,
        "Text": " So you can do that with any of the authentication methods, you can do that with Windows Hello,"
      },
      {
        "Time_Start": 408.04,
        "Time_End": 412.68,
        "Text": " you can do that with a username and password, with a Fido key, but essentially you're passing"
      },
      {
        "Time_Start": 412.68,
        "Time_End": 418.6,
        "Text": " your credentials to this LSS service, the Local Security Authority subsystem on Windows,"
      },
      {
        "Time_Start": 418.6,
        "Time_End": 422.08,
        "Text": " and LSS is going to talk to Entra and ask for this primary refresh token."
      },
      {
        "Time_Start": 422.08,
        "Time_End": 426.96000000000004,
        "Text": " And this primary refresh token acts as a single sign-on token in your session, so any app"
      },
      {
        "Time_Start": 426.96000000000004,
        "Time_End": 431.92,
        "Text": " that runs in your session is going to use that, but it's not going to directly talk"
      },
      {
        "Time_Start": 431.92,
        "Time_End": 435.68,
        "Text": " to LSS, but instead it's going to use a broker."
      },
      {
        "Time_Start": 435.68,
        "Time_End": 441.2,
        "Text": " So on Windows, this is the WAM, or Web Account Manager, and a client like Teams, it can talk"
      },
      {
        "Time_Start": 441.2,
        "Time_End": 444.56,
        "Text": " to this broker and ask for some tokens."
      },
      {
        "Time_Start": 444.56,
        "Time_End": 448.84,
        "Text": " If the broker already has tokens, it can directly pass them to Teams, and if it doesn't have"
      },
      {
        "Time_Start": 448.84,
        "Time_End": 453.03999999999996,
        "Text": " tokens, then it can ask LSS to actually use the primary refresh token."
      },
      {
        "Time_Start": 453.03999999999996,
        "Time_End": 457.64,
        "Text": " So LSS has access to all the key material, all the secrets, which are most likely in"
      },
      {
        "Time_Start": 457.64,
        "Time_End": 464.48,
        "Text": " a trusted platform module, so actually hardware-backed, and LSS is going to give the right details"
      },
      {
        "Time_Start": 464.48,
        "Time_End": 468.56,
        "Text": " to the token broker, the token broker talks to Entra, receives the tokens, gives them"
      },
      {
        "Time_Start": 468.6,
        "Time_End": 473.2,
        "Text": " to Teams, and Teams can send these to all the backend services."
      },
      {
        "Time_Start": 473.2,
        "Time_End": 476.08,
        "Text": " So this is how it works on Windows, but actually the implementations we're going to look at"
      },
      {
        "Time_Start": 476.08,
        "Time_End": 478.32,
        "Text": " today are quite similar."
      },
      {
        "Time_Start": 478.32,
        "Time_End": 482.68,
        "Text": " Of course there's different processes involved, but it all works with the broker that is basically"
      },
      {
        "Time_Start": 482.68,
        "Time_End": 487.52,
        "Text": " responsible for doing the authentication flows, using the PRT, and then passing the tokens"
      },
      {
        "Time_Start": 487.52,
        "Time_End": 491.16,
        "Text": " to the clients."
      },
      {
        "Time_Start": 491.16,
        "Time_End": 495.56,
        "Text": " So just a little bit more details on primary refresh tokens, I'm assuming most of you are"
      },
      {
        "Time_Start": 495.56,
        "Time_End": 500.36,
        "Text": " familiar with them, because we have been talking about them already quite a bit."
      },
      {
        "Time_Start": 500.36,
        "Time_End": 504.76,
        "Text": " So they are single sign-on tokens in your session, you can not only use them for web"
      },
      {
        "Time_Start": 504.76,
        "Time_End": 509.44,
        "Text": " apps, not only for native apps, but also for web apps in the browser, so it really can"
      },
      {
        "Time_Start": 509.44,
        "Time_End": 511.96,
        "Text": " sign in your account to everything."
      },
      {
        "Time_Start": 511.96,
        "Time_End": 516.52,
        "Text": " And they are also what links your user identity to the device that you're on, so if you're"
      },
      {
        "Time_Start": 516.52,
        "Time_End": 521.4,
        "Text": " working with conditional access policies and you require compliant devices, how does Entra"
      },
      {
        "Time_Start": 521.4,
        "Time_End": 523.12,
        "Text": " know that I'm on that device?"
      },
      {
        "Time_Start": 523.12,
        "Time_End": 525.28,
        "Text": " It knows that via the primary refresh token."
      },
      {
        "Time_Start": 525.28,
        "Time_End": 531.68,
        "Text": " So the primary refresh token contains the device, and that will be sent whenever I authenticate."
      },
      {
        "Time_Start": 531.68,
        "Time_End": 535.64,
        "Text": " And this primary refresh token, it has a lot of cryptography involved, and one of the keys"
      },
      {
        "Time_Start": 535.64,
        "Time_End": 539.92,
        "Text": " it needs is the session key, and on Windows this session key will be protected by a trusted"
      },
      {
        "Time_Start": 539.92,
        "Time_End": 545.24,
        "Text": " platform module if you have one, and that means that the PRT is also always bound to"
      },
      {
        "Time_Start": 545.24,
        "Time_End": 551.28,
        "Text": " a device, so you cannot have a PRT without first having a device."
      },
      {
        "Time_Start": 551.28,
        "Time_End": 555.4,
        "Text": " So if you look at like how many of these tokens are present, usually there's only a"
      },
      {
        "Time_Start": 555.4,
        "Time_End": 560.12,
        "Text": " few PRTs on Windows, but of course at any time there can be many refresh tokens which"
      },
      {
        "Time_Start": 560.12,
        "Time_End": 564.4,
        "Text": " are more scoped, because they're scoped with a specific app, and a lot of access tokens"
      },
      {
        "Time_Start": 564.4,
        "Time_End": 571.36,
        "Text": " because you need a specific access token depending on the service that you're talking to."
      },
      {
        "Time_Start": 571.36,
        "Time_End": 577.04,
        "Text": " So this is basically the stuff on Windows, and Windows has a set of APIs that it uses"
      },
      {
        "Time_Start": 577.04,
        "Time_End": 581.68,
        "Text": " to request these tokens, and then we started looking at macOS, and there it was a little"
      },
      {
        "Time_Start": 581.68,
        "Time_End": 582.68,
        "Text": " bit different."
      },
      {
        "Time_Start": 582.68,
        "Time_End": 589.8399999999999,
        "Text": " So on Windows it's basically the API version 2, and macOS has API version 3, and what also"
      },
      {
        "Time_Start": 589.8399999999999,
        "Time_End": 595.16,
        "Text": " surprised us is that a primary refresh token is not always tied to a device, but you also"
      },
      {
        "Time_Start": 595.16,
        "Time_End": 600.28,
        "Text": " have device-less primary refresh tokens, but to look at that we first have to look a little"
      },
      {
        "Time_Start": 600.28,
        "Time_End": 605.3199999999999,
        "Text": " bit back and look at all the cryptographic keys, because there are a lot of keys, different"
      },
      {
        "Time_Start": 605.32,
        "Time_End": 610.84,
        "Text": " keys used for different platforms, and we have two important keys slash certificates."
      },
      {
        "Time_Start": 610.84,
        "Time_End": 617.12,
        "Text": " So on Windows what it's using is the device certificate, so whenever you register the"
      },
      {
        "Time_Start": 617.12,
        "Time_End": 623.32,
        "Text": " device it asks for a certificate, and it has a private RSA key, and it also has a transport"
      },
      {
        "Time_Start": 623.32,
        "Time_End": 628.9200000000001,
        "Text": " key that it uses to basically encrypt data whenever it's talking to enter."
      },
      {
        "Time_Start": 628.9200000000001,
        "Time_End": 634.08,
        "Text": " On macOS, at least with PRT version 3, it's quite similar, there's a little bit difference"
      },
      {
        "Time_Start": 634.08,
        "Time_End": 639.88,
        "Text": " in details, because Windows has these internal Windows structures that it uses to send these"
      },
      {
        "Time_Start": 639.88,
        "Time_End": 646.36,
        "Text": " keys, and on macOS it's using the JSON web key specification to actually transfer these"
      },
      {
        "Time_Start": 646.36,
        "Time_End": 652.36,
        "Text": " RSA keys, or at least the formatted ones, and all these specifications are open source,"
      },
      {
        "Time_Start": 652.36,
        "Time_End": 658.12,
        "Text": " they are based on RFCs, and most of the RFCs are written by this guy Michael Jones who"
      },
      {
        "Time_Start": 658.12,
        "Time_End": 663.1600000000001,
        "Text": " works at Microsoft, and most of this research was basically figuring out what Michael Jones"
      },
      {
        "Time_Start": 663.24,
        "Time_End": 668.0,
        "Text": " came up with, and how the rest of Microsoft butchered his implementation in very weird"
      },
      {
        "Time_Start": 668.0,
        "Time_End": 673.3199999999999,
        "Text": " ways, so the RFCs are already difficult enough to implement, but if you also need to figure"
      },
      {
        "Time_Start": 673.3199999999999,
        "Time_End": 680.0799999999999,
        "Text": " out what ways Microsoft deviated from that, then it's a whole different headache."
      },
      {
        "Time_Start": 680.0799999999999,
        "Time_End": 683.36,
        "Text": " So we'll see this name a few more times."
      },
      {
        "Time_Start": 683.36,
        "Time_End": 687.3199999999999,
        "Text": " So how does this work to actually ask for a PRT on Windows?"
      },
      {
        "Time_Start": 687.3199999999999,
        "Time_End": 691.24,
        "Text": " So this should mostly be familiar, because we've already talked about this previously"
      },
      {
        "Time_Start": 691.24,
        "Time_End": 693.12,
        "Text": " as well."
      },
      {
        "Time_Start": 693.12,
        "Time_End": 698.72,
        "Text": " Basically you start with some authentication material, and that is sent basically to Entra,"
      },
      {
        "Time_Start": 698.72,
        "Time_End": 702.92,
        "Text": " and that's sent with a payload that's actually signed with your device key, so it proves"
      },
      {
        "Time_Start": 702.92,
        "Time_End": 708.96,
        "Text": " that this device is the one actually requesting that primary refresh token."
      },
      {
        "Time_Start": 708.96,
        "Time_End": 713.2,
        "Text": " So Entra will then send us back a primary refresh token, and it will also send us the"
      },
      {
        "Time_Start": 713.2,
        "Time_End": 716.76,
        "Text": " session key, so the session key is the most important part here, because that is needed"
      },
      {
        "Time_Start": 716.76,
        "Time_End": 719.84,
        "Text": " to use the primary refresh token."
      },
      {
        "Time_Start": 719.84,
        "Time_End": 723.6,
        "Text": " The session key is encrypted with a transport key, that was the second key that we just"
      },
      {
        "Time_Start": 723.6,
        "Time_End": 728.6,
        "Text": " talked about, so the device can decrypt the session key and then it can use that to actually"
      },
      {
        "Time_Start": 728.6,
        "Time_End": 730.6,
        "Text": " request tokens."
      },
      {
        "Time_Start": 730.6,
        "Time_End": 736.5600000000001,
        "Text": " When it does that, it creates a payload containing the PRT, it signs the payload with the session"
      },
      {
        "Time_Start": 736.5600000000001,
        "Time_End": 742.9200000000001,
        "Text": " key, it sends that to Entra, Entra sends it back some tokens, which are again encrypted,"
      },
      {
        "Time_Start": 742.9200000000001,
        "Time_End": 749.52,
        "Text": " so there's a lot of encryption involved here, but this last part it uses the session key"
      },
      {
        "Time_Start": 749.72,
        "Time_End": 755.16,
        "Text": " with a protocol called JSON web encryption, there's RFC for that, written by Michael Jones,"
      },
      {
        "Time_Start": 755.16,
        "Time_End": 757.0799999999999,
        "Text": " et cetera, et cetera."
      },
      {
        "Time_Start": 757.0799999999999,
        "Time_End": 762.16,
        "Text": " So there's a lot of different layers of encryption, and the device can decrypt these tokens and"
      },
      {
        "Time_Start": 762.16,
        "Time_End": 764.3199999999999,
        "Text": " then use them."
      },
      {
        "Time_Start": 764.3199999999999,
        "Time_End": 771.48,
        "Text": " So this transport key is used during the initial step, and then the session key is also used."
      },
      {
        "Time_Start": 771.48,
        "Time_End": 774.16,
        "Text": " So this is the Windows flow."
      },
      {
        "Time_Start": 774.1999999999999,
        "Time_End": 779.64,
        "Text": " Now when we looked at macOS, it was a little bit more complicated, and when I say a little"
      },
      {
        "Time_Start": 779.64,
        "Time_End": 784.9599999999999,
        "Text": " bit, I mean quite a bit, because I work with tokens every day, I understand most of the"
      },
      {
        "Time_Start": 784.9599999999999,
        "Time_End": 789.16,
        "Text": " flows, but even for me all these different flows and all the different parts and the"
      },
      {
        "Time_Start": 789.16,
        "Time_End": 794.24,
        "Text": " different protocols, it's mind boggling a little bit."
      },
      {
        "Time_Start": 794.24,
        "Time_End": 800.64,
        "Text": " So I tried to summarize it, but it's not the only way, and not the only way to do this."
      },
      {
        "Time_Start": 800.72,
        "Time_End": 805.96,
        "Text": " Basically if you want to do this on macOS, then you first need to sign in."
      },
      {
        "Time_Start": 805.96,
        "Time_End": 810.64,
        "Text": " So this actually follows a OAuth flow, which is the authorization code flow, so it's the"
      },
      {
        "Time_Start": 810.64,
        "Time_End": 815.36,
        "Text": " same flow you would use if you log into a website."
      },
      {
        "Time_Start": 815.36,
        "Time_End": 820.24,
        "Text": " And the components running on your device, it receives an authorization code."
      },
      {
        "Time_Start": 820.24,
        "Time_End": 825.2,
        "Text": " And then it's actually going to create a transport key, like on the fly, because at this point"
      },
      {
        "Time_Start": 825.2,
        "Time_End": 830.2,
        "Text": " we don't have a device yet, so there is no device certificate, there is no registered"
      },
      {
        "Time_Start": 830.2,
        "Time_End": 833.5600000000001,
        "Text": " transport key, so it just creates one."
      },
      {
        "Time_Start": 833.5600000000001,
        "Time_End": 836.0400000000001,
        "Text": " And then it gets back a primary refresh token."
      },
      {
        "Time_Start": 836.0400000000001,
        "Time_End": 839.32,
        "Text": " But this primary refresh token is not actually linked to a device."
      },
      {
        "Time_Start": 839.32,
        "Time_End": 844.84,
        "Text": " It's basically a device-less primary refresh token that we can use for single sign-on."
      },
      {
        "Time_Start": 844.84,
        "Time_End": 848.4000000000001,
        "Text": " We also get a session key, the session key is encrypted with this transport key that"
      },
      {
        "Time_Start": 848.4000000000001,
        "Time_End": 854.6800000000001,
        "Text": " we made up over here, and then we can use that to maybe register the device, so it first"
      },
      {
        "Time_Start": 854.6800000000001,
        "Time_End": 859.8000000000001,
        "Text": " has a device-less PRT, we can already use this for single sign-on."
      },
      {
        "Time_Start": 859.8000000000001,
        "Time_End": 867.6,
        "Text": " Or we can basically use this to upgrade it to a PRT that is tied to a device."
      },
      {
        "Time_Start": 867.6,
        "Time_End": 873.48,
        "Text": " So with this single sign-on PRT, we can ask tokens, we can register a device, we can also"
      },
      {
        "Time_Start": 873.48,
        "Time_End": 877.24,
        "Text": " do single sign-on directly, so this part is not always needed."
      },
      {
        "Time_Start": 877.24,
        "Time_End": 882.86,
        "Text": " But if we want to upgrade this to a full PRT that is linked to a device, then we can actually"
      },
      {
        "Time_Start": 882.86,
        "Time_End": 888.74,
        "Text": " register the device and then send this PRT plus the signature that is based on the device"
      },
      {
        "Time_Start": 888.74,
        "Time_End": 893.34,
        "Text": " certificate and the device key to Entra, and then we get back a full PRT."
      },
      {
        "Time_Start": 893.34,
        "Time_End": 898.54,
        "Text": " So this is similar again to Windows, it's just these extra steps in between that we"
      },
      {
        "Time_Start": 898.54,
        "Time_End": 901.58,
        "Text": " don't see on Windows."
      },
      {
        "Time_Start": 901.58,
        "Time_End": 906.26,
        "Text": " So once we have this PRT, then we can use it again, so we can use the session key that"
      },
      {
        "Time_Start": 906.26,
        "Time_End": 911.58,
        "Text": " we got that is now encrypted with the actual transport key, we can send that to Entra,"
      },
      {
        "Time_Start": 911.58,
        "Time_End": 913.22,
        "Text": " and then we can receive back the token."
      },
      {
        "Time_Start": 913.22,
        "Time_End": 915.46,
        "Text": " So again, it's similar to Windows."
      },
      {
        "Time_Start": 915.46,
        "Time_End": 921.7,
        "Text": " But the big difference is that there is basically two PRTs here, one that is not linked to any"
      },
      {
        "Time_Start": 921.7,
        "Time_End": 926.5,
        "Text": " device because at this point there was no device yet, and one that is actually linked"
      },
      {
        "Time_Start": 926.5,
        "Time_End": 932.26,
        "Text": " to a device, to your Mac in this case, that register itself somewhere here in between."
      },
      {
        "Time_Start": 932.26,
        "Time_End": 936.86,
        "Text": " So don't ask us why it works this way, because it's just some observations we made."
      },
      {
        "Time_Start": 936.86,
        "Time_End": 941.66,
        "Text": " There's also a slight variance on this, but this is basically the flow that we observed."
      },
      {
        "Time_Start": 941.66,
        "Time_End": 946.1,
        "Text": " Yeah, that's also one of the things that you should take away."
      },
      {
        "Time_Start": 946.1,
        "Time_End": 951.46,
        "Text": " There was a nice little orange sun, or whatever it's called, so there's a couple of slides"
      },
      {
        "Time_Start": 951.46,
        "Time_End": 952.74,
        "Text": " that are the most important ones."
      },
      {
        "Time_Start": 952.74,
        "Time_End": 956.38,
        "Text": " So when you download the deck, make sure to look at this and then also understand that"
      },
      {
        "Time_Start": 956.38,
        "Time_End": 962.5,
        "Text": " this bit is a little bit optional, so you can be creative with that, maybe."
      },
      {
        "Time_Start": 962.5,
        "Time_End": 963.7,
        "Text": " And there's probably more, right?"
      },
      {
        "Time_Start": 963.7,
        "Time_End": 969.1800000000001,
        "Text": " So we have some caveats, because we only looked at the implementation for Edge."
      },
      {
        "Time_Start": 969.1800000000001,
        "Time_End": 971.82,
        "Text": " This is how we discovered the device-less PRT."
      },
      {
        "Time_Start": 971.82,
        "Time_End": 978.0600000000001,
        "Text": " So if you log on to Edge on Mac, it will ask you, hey, do you want SSO within Edge?"
      },
      {
        "Time_Start": 978.0600000000001,
        "Time_End": 984.1800000000001,
        "Text": " And that's basically where it generates only that device-less PRT that will use the same"
      },
      {
        "Time_Start": 984.1800000000001,
        "Time_End": 989.4200000000001,
        "Text": " flow as before, but without the device-bound registration to actually log on to all the"
      },
      {
        "Time_Start": 989.4200000000001,
        "Time_End": 993.8600000000001,
        "Text": " services that you are accessing with Edge at that moment."
      },
      {
        "Time_Start": 993.8600000000001,
        "Time_End": 998.0600000000001,
        "Text": " So that's one of the ways why we discovered this in the first place."
      },
      {
        "Time_Start": 998.0600000000001,
        "Time_End": 1003.6600000000001,
        "Text": " The other implementation for PRT3 is if you enroll your device into Intune, which has"
      },
      {
        "Time_Start": 1003.6600000000001,
        "Time_End": 1009.58,
        "Text": " been possible for quite a while on Mac, and Microsoft built their own little SSO extension,"
      },
      {
        "Time_Start": 1009.58,
        "Time_End": 1014.6200000000001,
        "Text": " which is basically being pushed once you enroll, and that will actually generate a device-bound"
      },
      {
        "Time_Start": 1014.6200000000001,
        "Time_End": 1015.6200000000001,
        "Text": " PRT."
      },
      {
        "Time_Start": 1015.62,
        "Time_End": 1020.0600000000001,
        "Text": " So that full flow that Dirk-Jan showed you earlier will be applicable."
      },
      {
        "Time_Start": 1020.0600000000001,
        "Time_End": 1024.38,
        "Text": " In the meantime, you might have two PRTs on your system, so you can still, as an attacker,"
      },
      {
        "Time_Start": 1024.38,
        "Time_End": 1026.42,
        "Text": " play with that if you would want to."
      },
      {
        "Time_Start": 1026.42,
        "Time_End": 1027.78,
        "Text": " Depends a little bit on what you want to do, right?"
      },
      {
        "Time_Start": 1027.78,
        "Time_End": 1032.22,
        "Text": " But during our conversations with Microsoft, we also learned that this was not the only"
      },
      {
        "Time_Start": 1032.22,
        "Time_End": 1033.42,
        "Text": " implementation of this."
      },
      {
        "Time_Start": 1033.42,
        "Time_End": 1038.86,
        "Text": " So there are also examples on Android, iOS, and we didn't see them on Windows, but maybe"
      },
      {
        "Time_Start": 1038.86,
        "Time_End": 1040.86,
        "Text": " there is an Edge case there as well."
      },
      {
        "Time_Start": 1040.8600000000001,
        "Time_End": 1046.18,
        "Text": " So there's way more implementations than we are probably aware of."
      },
      {
        "Time_Start": 1046.18,
        "Time_End": 1048.94,
        "Text": " And on Mac, it looks a little bit like this."
      },
      {
        "Time_Start": 1048.94,
        "Time_End": 1053.14,
        "Text": " So this is probably not very legible, but this is just a normal logon request where"
      },
      {
        "Time_Start": 1053.14,
        "Time_End": 1056.5800000000002,
        "Text": " I put my password in, which you shouldn't be able to read, even though if you could"
      },
      {
        "Time_Start": 1056.5800000000002,
        "Time_End": 1063.5400000000002,
        "Text": " read the slides, and it will basically do a POST request to the normal login.microsoftonline.com"
      },
      {
        "Time_Start": 1063.5400000000002,
        "Time_End": 1064.5400000000002,
        "Text": " website."
      },
      {
        "Time_Start": 1064.54,
        "Time_End": 1071.02,
        "Text": " Where we'll send is the special authorisation code that Dirk-Jan mentioned earlier, and"
      },
      {
        "Time_Start": 1071.02,
        "Time_End": 1076.98,
        "Text": " that on-the-fly generated RSA key, which is in memory at that moment, and it will receive"
      },
      {
        "Time_Start": 1076.98,
        "Time_End": 1080.22,
        "Text": " its initial primary refresh token by then, right?"
      },
      {
        "Time_Start": 1080.22,
        "Time_End": 1089.82,
        "Text": " So this is just in that JWK protocol, there is this blob where there is a 64 encoded RSA"
      },
      {
        "Time_Start": 1089.82,
        "Time_End": 1094.82,
        "Text": " key that will be used as the public key for that exchange."
      },
      {
        "Time_Start": 1094.82,
        "Time_End": 1099.82,
        "Text": " And then, if that's successful, you get the normal stuff back, just a Fokey token and"
      },
      {
        "Time_Start": 1099.82,
        "Time_End": 1103.5,
        "Text": " some refresh tokens where you can play with."
      },
      {
        "Time_Start": 1103.5,
        "Time_End": 1105.62,
        "Text": " And this is then our primary refresh token."
      },
      {
        "Time_Start": 1105.62,
        "Time_End": 1110.9399999999998,
        "Text": " So what we see here is the refresh token, and the way that we know it's a primary refresh"
      },
      {
        "Time_Start": 1110.9399999999998,
        "Time_End": 1115.1399999999999,
        "Text": " token is because there's this session key on the bottom which is encrypted, so we can"
      },
      {
        "Time_Start": 1115.1399999999999,
        "Time_End": 1119.1799999999998,
        "Text": " use the private key of this public RSA key that we just sent to decrypt all that stuff,"
      },
      {
        "Time_Start": 1119.54,
        "Time_End": 1124.26,
        "Text": " and then we have our device-less PRT, because the key, the transport key, was not coming"
      },
      {
        "Time_Start": 1124.26,
        "Time_End": 1127.3,
        "Text": " from a device, it was just like generated on the fly."
      },
      {
        "Time_Start": 1127.3,
        "Time_End": 1130.0600000000002,
        "Text": " Thank you."
      },
      {
        "Time_Start": 1130.0600000000002,
        "Time_End": 1136.18,
        "Text": " And that's also basically when we get our full PRT, if we start to upgrade it for a"
      },
      {
        "Time_Start": 1136.18,
        "Time_End": 1139.5800000000002,
        "Text": " PRT, we'll actually get a encrypted PRT back, right?"
      },
      {
        "Time_Start": 1139.58,
        "Time_End": 1153.8999999999999,
        "Text": " So this is the request which has the whole, it posts that signed refresh token, and from"
      },
      {
        "Time_Start": 1153.8999999999999,
        "Time_End": 1158.8999999999999,
        "Text": " there we will actually get an encrypted PRT back which is encrypted with the transport"
      },
      {
        "Time_Start": 1158.8999999999999,
        "Time_End": 1162.82,
        "Text": " key and the session key."
      },
      {
        "Time_Start": 1162.82,
        "Time_End": 1167.06,
        "Text": " And basically what happens then is it will be saved in our keychain, and the keychain"
      },
      {
        "Time_Start": 1167.06,
        "Time_End": 1177.58,
        "Text": " is sort of the secured storage for passwords and other key material on Mac, and it basically"
      },
      {
        "Time_Start": 1177.58,
        "Time_End": 1185.7,
        "Text": " stores everything in the password field over here, which you need user passwords to actually"
      },
      {
        "Time_Start": 1185.7,
        "Time_End": 1186.7,
        "Text": " access it, right?"
      },
      {
        "Time_Start": 1186.7,
        "Time_End": 1189.5,
        "Text": " So it is a bit protected, or it's quite protected in a way."
      },
      {
        "Time_Start": 1189.5,
        "Time_End": 1193.34,
        "Text": " There's also all kinds of access control on it which I'll show you later which has entitlements"
      },
      {
        "Time_Start": 1193.34,
        "Time_End": 1197.1399999999999,
        "Text": " only for the Microsoft programs that have access to it."
      },
      {
        "Time_Start": 1197.1399999999999,
        "Time_End": 1202.1399999999999,
        "Text": " So the item itself is quite well protected, but if you know the user's password, for whatever"
      },
      {
        "Time_Start": 1202.1399999999999,
        "Time_End": 1206.8999999999999,
        "Text": " reason, you can actually just copy this whole blob, and if we would look at it a little"
      },
      {
        "Time_Start": 1206.8999999999999,
        "Time_End": 1215.1799999999998,
        "Text": " bit more, you see as well that we see a secret, that it is a PRT, and we also see the session"
      },
      {
        "Time_Start": 1215.1799999999998,
        "Time_End": 1217.4199999999998,
        "Text": " key next to it."
      },
      {
        "Time_Start": 1217.4199999999998,
        "Time_End": 1222.8999999999999,
        "Text": " And if we've ever played with PRTs in the past, we know that we can just use RhoTX to"
      },
      {
        "Time_Start": 1222.9,
        "Time_End": 1228.5800000000002,
        "Text": " actually exchange these for all kinds of very nice access tokens that we want, right?"
      },
      {
        "Time_Start": 1228.5800000000002,
        "Time_End": 1232.26,
        "Text": " So that's maybe not the biggest hacking technique."
      },
      {
        "Time_Start": 1232.26,
        "Time_End": 1237.74,
        "Text": " No, no, no, this is a very big technique, so we held off from releasing these very difficult"
      },
      {
        "Time_Start": 1237.74,
        "Time_End": 1243.8200000000002,
        "Text": " steps, because obviously Command-C, Command-V is way too difficult."
      },
      {
        "Time_Start": 1243.8200000000002,
        "Time_End": 1248.22,
        "Text": " We're joking a little bit, but on Windows, there's like a lot of layers, and if you have"
      },
      {
        "Time_Start": 1248.26,
        "Time_End": 1253.7,
        "Text": " a TPM, it's like in a TPM, and the user, even if their system cannot reach it, and on macOS,"
      },
      {
        "Time_Start": 1253.7,
        "Time_End": 1257.34,
        "Text": " it's like, well, if I go to this keychain app, I type my password, and I copy-paste"
      },
      {
        "Time_Start": 1257.34,
        "Time_End": 1261.7,
        "Text": " it to wherever in the world, then you can use it, because it's not bound to a device,"
      },
      {
        "Time_Start": 1261.7,
        "Time_End": 1265.58,
        "Text": " it's just like if you have a PRT and a session key, you can use it, and that's it."
      },
      {
        "Time_Start": 1265.58,
        "Time_End": 1271.34,
        "Text": " So if you have a macOS device that's managed by a company, and you want to, I don't know,"
      },
      {
        "Time_Start": 1271.34,
        "Time_End": 1275.82,
        "Text": " access some resources, exfiltrate some data, you just Control-C, Control-V, or Command-C,"
      },
      {
        "Time_Start": 1275.82,
        "Time_End": 1280.86,
        "Text": " Command-V on macOS, and then you can use your compliant device state from anywhere"
      },
      {
        "Time_Start": 1280.86,
        "Time_End": 1282.86,
        "Text": " in the world via this PRT."
      },
      {
        "Time_Start": 1282.86,
        "Time_End": 1284.9399999999998,
        "Text": " Yeah, so this is not great, right?"
      },
      {
        "Time_Start": 1284.9399999999998,
        "Time_End": 1289.74,
        "Text": " And this is probably still the more commonly used implementation, because recently they"
      },
      {
        "Time_Start": 1289.74,
        "Time_End": 1294.7,
        "Text": " actually improved the whole stack, where we're going to go after this slide, but if you would"
      },
      {
        "Time_Start": 1294.7,
        "Time_End": 1299.78,
        "Text": " run into a Mac during an engagement right now, most likely that you would find this,"
      },
      {
        "Time_Start": 1299.78,
        "Time_End": 1305.3,
        "Text": " or maybe even worse, the device-less version, where you can just have the same and upgrade"
      },
      {
        "Time_Start": 1305.3,
        "Time_End": 1310.1,
        "Text": " it and register your own device, potentially."
      },
      {
        "Time_Start": 1310.1,
        "Time_End": 1312.54,
        "Text": " So I also talked a little bit about the PRT4, right?"
      },
      {
        "Time_Start": 1312.54,
        "Time_End": 1314.54,
        "Text": " We alluded to it a little bit."
      },
      {
        "Time_Start": 1314.54,
        "Time_End": 1319.1,
        "Text": " Intune now added support, I think a couple of months ago, where they are actually supporting"
      },
      {
        "Time_Start": 1319.1,
        "Time_End": 1325.54,
        "Text": " the Apple-based platform SSO module, and the big difference there is that that module is"
      },
      {
        "Time_Start": 1325.54,
        "Time_End": 1331.3799999999999,
        "Text": " designed by Apple with different standards, maybe sometimes also better documentation,"
      },
      {
        "Time_Start": 1331.38,
        "Time_End": 1335.38,
        "Text": " which is not common for Apple, to be honest."
      },
      {
        "Time_Start": 1335.38,
        "Time_End": 1340.22,
        "Text": " And they also use the secure enclave, which is the TPM implementation on Apple."
      },
      {
        "Time_Start": 1340.22,
        "Time_End": 1347.74,
        "Text": " So the big difference there is that due to this implementation, Apple actually brokers"
      },
      {
        "Time_Start": 1347.74,
        "Time_End": 1354.14,
        "Text": " for the whole authentication flow, which Microsoft describes as similar to Windows Hello for"
      },
      {
        "Time_Start": 1354.14,
        "Time_End": 1355.9,
        "Text": " Business."
      },
      {
        "Time_Start": 1355.9,
        "Time_End": 1359.14,
        "Text": " We've all seen Dirk-Jan's talk on those kind of things, so that still doesn't mean it's"
      },
      {
        "Time_Start": 1359.14,
        "Time_End": 1365.1000000000001,
        "Text": " fully perfect, but it is definitely better than the previously alluded-to slides."
      },
      {
        "Time_Start": 1365.1000000000001,
        "Time_End": 1370.8200000000002,
        "Text": " And it's also very different than the Microsoft self-built SSO plugin that they had."
      },
      {
        "Time_Start": 1370.8200000000002,
        "Time_End": 1374.46,
        "Text": " You can still use that, I wouldn't recommend it, though."
      },
      {
        "Time_Start": 1374.46,
        "Time_End": 1379.74,
        "Text": " So the secure enclave is similar to a TPM, I'm very terrible with crypto, I at least"
      },
      {
        "Time_Start": 1379.74,
        "Time_End": 1384.38,
        "Text": " understand that it's an isolated compute node where it actually deals with the key material"
      },
      {
        "Time_Start": 1384.38,
        "Time_End": 1388.74,
        "Text": " in a very secure way and not very easy to access it."
      },
      {
        "Time_Start": 1388.74,
        "Time_End": 1393.54,
        "Text": " So if you would want to run this, these are a bunch of screenshots from Intune."
      },
      {
        "Time_Start": 1393.54,
        "Time_End": 1398.22,
        "Text": " So basically if you build your own Intune policies, how you onboard devices, you can"
      },
      {
        "Time_Start": 1398.22,
        "Time_End": 1400.74,
        "Text": " select the authentication method."
      },
      {
        "Time_Start": 1400.74,
        "Time_End": 1405.14,
        "Text": " So this is fairly new, it's like two, three months old in general availability, it's been"
      },
      {
        "Time_Start": 1405.14,
        "Time_End": 1410.42,
        "Text": " in preview for quite a while, seems quite stable, so if you can, try to convert towards"
      },
      {
        "Time_Start": 1410.42,
        "Time_End": 1411.42,
        "Text": " it."
      },
      {
        "Time_Start": 1411.42,
        "Time_End": 1414.82,
        "Text": " And here you can select the user secure enclave key."
      },
      {
        "Time_Start": 1414.8999999999999,
        "Time_End": 1420.7,
        "Text": " So that basically enforces the use of the whole TPM implementation on Mac."
      },
      {
        "Time_Start": 1420.7,
        "Time_End": 1427.1399999999999,
        "Text": " And if you would enroll a device, it will also register it in Entra.id, and if you have"
      },
      {
        "Time_Start": 1427.1399999999999,
        "Time_End": 1431.3799999999999,
        "Text": " the right policies, it will also be compliant, of course."
      },
      {
        "Time_Start": 1431.3799999999999,
        "Time_End": 1437.3,
        "Text": " And after that, you need to reboot, so that the platform SSO module on Apple can actually"
      },
      {
        "Time_Start": 1437.3,
        "Time_End": 1444.22,
        "Text": " ask you for your credentials, again, you also need to do MFA, again."
      },
      {
        "Time_Start": 1444.42,
        "Time_End": 1450.58,
        "Text": " And with that key, it will actually start building a PRTv4 that will also be used as"
      },
      {
        "Time_Start": 1450.58,
        "Time_End": 1451.58,
        "Text": " a passkey."
      },
      {
        "Time_Start": 1451.58,
        "Time_End": 1454.66,
        "Text": " So it's just actually kind of neat."
      },
      {
        "Time_Start": 1454.66,
        "Time_End": 1459.34,
        "Text": " From that perspective, we have a couple of very nice flows that Dirk-Jan will allude"
      },
      {
        "Time_Start": 1459.34,
        "Time_End": 1460.34,
        "Text": " to."
      },
      {
        "Time_Start": 1460.34,
        "Time_End": 1461.34,
        "Text": " Yes."
      },
      {
        "Time_Start": 1461.34,
        "Time_End": 1467.22,
        "Text": " So we're going to look at how PRTv4 basically differs from the other PRT flavors."
      },
      {
        "Time_Start": 1467.22,
        "Time_End": 1474.18,
        "Text": " So if you have PRTv3 or the Windows implementation, which is v2, then it starts with the device"
      },
      {
        "Time_Start": 1474.18,
        "Time_End": 1479.78,
        "Text": " registration, and for v4, you also need to have a device that is registered with Entra."
      },
      {
        "Time_Start": 1479.78,
        "Time_End": 1482.7,
        "Text": " And the differences, they kind of start with this request."
      },
      {
        "Time_Start": 1482.7,
        "Time_End": 1488.42,
        "Text": " So this is also very similar to how a Windows Entra registration looks, but the difference"
      },
      {
        "Time_Start": 1488.42,
        "Time_End": 1494.3,
        "Text": " here for v4 is that the key type is actually based on elliptic curve cryptography."
      },
      {
        "Time_Start": 1494.3,
        "Time_End": 1497.98,
        "Text": " It also says key security secure enclave."
      },
      {
        "Time_Start": 1497.98,
        "Time_End": 1501.22,
        "Text": " This adds a lot of value because, of course, you can just write that string there, it's"
      },
      {
        "Time_Start": 1501.22,
        "Time_End": 1504.54,
        "Text": " not going to make a lot of difference."
      },
      {
        "Time_Start": 1504.54,
        "Time_End": 1506.1000000000001,
        "Text": " But it is using different key types."
      },
      {
        "Time_Start": 1506.1000000000001,
        "Time_End": 1511.18,
        "Text": " So PRTv4 is not backwards compatible with the other versions because it uses a completely"
      },
      {
        "Time_Start": 1511.18,
        "Time_End": 1514.38,
        "Text": " different way of doing cryptography."
      },
      {
        "Time_Start": 1514.38,
        "Time_End": 1518.34,
        "Text": " I don't think that it was Microsoft's idea to do this because Microsoft is just using"
      },
      {
        "Time_Start": 1518.34,
        "Time_End": 1522.7,
        "Text": " the platform SSO module and using whatever Apple provides, and Apple decided to go with"
      },
      {
        "Time_Start": 1522.7,
        "Time_End": 1525.26,
        "Text": " this is my assumption."
      },
      {
        "Time_Start": 1525.26,
        "Time_End": 1529.38,
        "Text": " Transport key is also an elliptic curve key."
      },
      {
        "Time_Start": 1529.38,
        "Time_End": 1534.0200000000002,
        "Text": " Basically what they call this with Apple is basically the signing key and the encryption"
      },
      {
        "Time_Start": 1534.0200000000002,
        "Time_End": 1542.8600000000001,
        "Text": " key, but that's kind of analogous to the transport key and the device key that we see on Windows."
      },
      {
        "Time_Start": 1542.8600000000001,
        "Time_End": 1544.3000000000002,
        "Text": " All right."
      },
      {
        "Time_Start": 1544.3000000000002,
        "Time_End": 1545.94,
        "Text": " So this is the request that we sent."
      },
      {
        "Time_Start": 1545.94,
        "Time_End": 1550.1000000000001,
        "Text": " We get back our device certificate from Entra."
      },
      {
        "Time_Start": 1550.1000000000001,
        "Time_End": 1552.5400000000002,
        "Text": " So again, this is the same on all the platforms."
      },
      {
        "Time_Start": 1552.5400000000002,
        "Time_End": 1557.14,
        "Text": " Essentially you register your device and you get back a device key, just different cryptography"
      },
      {
        "Time_Start": 1557.14,
        "Time_End": 1559.0600000000002,
        "Text": " involved."
      },
      {
        "Time_Start": 1559.74,
        "Time_End": 1561.78,
        "Text": " It's also different from the v3."
      },
      {
        "Time_Start": 1561.78,
        "Time_End": 1566.54,
        "Text": " So if you have PRTv3 on macOS, then you have your device certificate, which is backed by"
      },
      {
        "Time_Start": 1566.54,
        "Time_End": 1567.54,
        "Text": " an RSA key."
      },
      {
        "Time_Start": 1567.54,
        "Time_End": 1572.34,
        "Text": " You have your transport key, which is an RSA key sent as a JSON web key."
      },
      {
        "Time_Start": 1572.34,
        "Time_End": 1577.4199999999998,
        "Text": " But if you have v4, then actually both keys are elliptic curve keys."
      },
      {
        "Time_Start": 1577.4199999999998,
        "Time_End": 1580.58,
        "Text": " And in this case, the keys are also in the secure enclave."
      },
      {
        "Time_Start": 1580.58,
        "Time_End": 1585.1,
        "Text": " So all the encryption is kind of tied to the secure enclave."
      },
      {
        "Time_Start": 1585.1000000000001,
        "Time_End": 1590.0200000000002,
        "Text": " So you cannot just access these session keys or copy them from somewhere, because they're"
      },
      {
        "Time_Start": 1590.0200000000002,
        "Time_End": 1594.66,
        "Text": " all bound to the secure enclave."
      },
      {
        "Time_Start": 1594.66,
        "Time_End": 1596.94,
        "Text": " So how does it actually work with PRTv4?"
      },
      {
        "Time_Start": 1596.94,
        "Time_End": 1598.38,
        "Text": " And again, you'll notice this little sun."
      },
      {
        "Time_Start": 1598.38,
        "Time_End": 1602.22,
        "Text": " So this is an important slide that if you do remember a few slides, this should be one"
      },
      {
        "Time_Start": 1602.22,
        "Time_End": 1603.22,
        "Text": " of them."
      },
      {
        "Time_Start": 1603.22,
        "Time_End": 1606.42,
        "Text": " And actually the mechanics here are slightly easier."
      },
      {
        "Time_Start": 1606.42,
        "Time_End": 1609.42,
        "Text": " The actual implementation is definitely not easier."
      },
      {
        "Time_Start": 1609.42,
        "Time_End": 1611.5800000000002,
        "Text": " But again, we start by authenticating."
      },
      {
        "Time_Start": 1611.58,
        "Time_End": 1616.54,
        "Text": " So you log in to your device or to the Intune company portal app."
      },
      {
        "Time_Start": 1616.54,
        "Time_End": 1619.58,
        "Text": " And then it's actually going to register your device."
      },
      {
        "Time_Start": 1619.58,
        "Time_End": 1626.98,
        "Text": " And then for the PRT request, it's going to send a payload that is signed with ECDSA,"
      },
      {
        "Time_Start": 1626.98,
        "Time_End": 1629.5,
        "Text": " or elliptic curve digital signature algorithm."
      },
      {
        "Time_Start": 1629.5,
        "Time_End": 1634.82,
        "Text": " So it's just using basically the equivalent of a RSA signature on the payload, but now"
      },
      {
        "Time_Start": 1634.82,
        "Time_End": 1638.78,
        "Text": " with elliptic curve keys."
      },
      {
        "Time_Start": 1638.78,
        "Time_End": 1641.06,
        "Text": " And then it gets back a primary refresh token."
      },
      {
        "Time_Start": 1641.54,
        "Time_End": 1644.06,
        "Text": " So this is already a device-bound primary refresh token."
      },
      {
        "Time_Start": 1644.06,
        "Time_End": 1647.86,
        "Text": " There's no device-less implementation in v4."
      },
      {
        "Time_Start": 1647.86,
        "Time_End": 1648.86,
        "Text": " It's all device-based."
      },
      {
        "Time_Start": 1648.86,
        "Time_End": 1653.26,
        "Text": " But the biggest difference is that here there is no session key."
      },
      {
        "Time_Start": 1653.26,
        "Time_End": 1656.3799999999999,
        "Text": " So PRTv4 does not work with session keys."
      },
      {
        "Time_Start": 1656.3799999999999,
        "Time_End": 1659.98,
        "Text": " It only works with PRTs directly."
      },
      {
        "Time_Start": 1659.98,
        "Time_End": 1665.58,
        "Text": " And all the usage security is basically tied back to the device certificate."
      },
      {
        "Time_Start": 1665.58,
        "Time_End": 1667.46,
        "Text": " So how does it do that?"
      },
      {
        "Time_Start": 1667.46,
        "Time_End": 1671.54,
        "Text": " Basically whenever we try to use the PRT, we sign the payload."
      },
      {
        "Time_Start": 1671.54,
        "Time_End": 1676.14,
        "Text": " In this case, we don't sign the payload with the session key, but we use the device certificate"
      },
      {
        "Time_Start": 1676.14,
        "Time_End": 1678.46,
        "Text": " again to sign this payload."
      },
      {
        "Time_Start": 1678.46,
        "Time_End": 1688.5,
        "Text": " And it's actually going to request like ECDHES, which is basically doing elliptic curve Diffie-Hellman"
      },
      {
        "Time_Start": 1688.5,
        "Time_End": 1690.7,
        "Text": " with ethereal static keys."
      },
      {
        "Time_Start": 1690.7,
        "Time_End": 1695.58,
        "Text": " If I say that correctly, we'll look at the actual implementation later."
      },
      {
        "Time_Start": 1695.86,
        "Time_End": 1698.62,
        "Text": " What it's essentially doing is a Diffie-Hellman key exchange."
      },
      {
        "Time_Start": 1698.62,
        "Time_End": 1704.3799999999999,
        "Text": " And every time it tries to use the PRT, it's going to kind of negotiate a temporary session"
      },
      {
        "Time_Start": 1704.3799999999999,
        "Time_End": 1707.4199999999998,
        "Text": " key that is only valid for this specific response."
      },
      {
        "Time_Start": 1707.4199999999998,
        "Time_End": 1709.26,
        "Text": " So I use my PRT."
      },
      {
        "Time_Start": 1709.26,
        "Time_End": 1710.98,
        "Text": " I send it to Entra."
      },
      {
        "Time_Start": 1710.98,
        "Time_End": 1713.6599999999999,
        "Text": " Entra sends me back this encrypted response."
      },
      {
        "Time_Start": 1713.6599999999999,
        "Time_End": 1719.74,
        "Text": " And this response can only be decrypted by completing the Diffie-Hellman key exchange."
      },
      {
        "Time_Start": 1719.74,
        "Time_End": 1723.3799999999999,
        "Text": " Then I can derive my key that is actually used for encryption."
      },
      {
        "Time_Start": 1723.38,
        "Time_End": 1725.7,
        "Text": " And then I can decrypt this response and the token."
      },
      {
        "Time_Start": 1725.7,
        "Time_End": 1728.7,
        "Text": " And of course, this key is in the secure enclave."
      },
      {
        "Time_Start": 1728.7,
        "Time_End": 1733.7800000000002,
        "Text": " So even if we can intercept all of this without access to the secure enclave, we cannot access"
      },
      {
        "Time_Start": 1733.7800000000002,
        "Time_End": 1736.98,
        "Text": " these tokens."
      },
      {
        "Time_Start": 1736.98,
        "Time_End": 1740.22,
        "Text": " So how does this look on the wire?"
      },
      {
        "Time_Start": 1740.22,
        "Time_End": 1743.8600000000001,
        "Text": " So we do see the PRT protocol version 4 being used now."
      },
      {
        "Time_Start": 1743.8600000000001,
        "Time_End": 1746.2600000000002,
        "Text": " That was a lot of fun when we first saw this."
      },
      {
        "Time_Start": 1746.2600000000002,
        "Time_End": 1749.6200000000001,
        "Text": " We were like, oh, yeah, we're just going to take a look at PRTV3 and how it works with"
      },
      {
        "Time_Start": 1749.6200000000001,
        "Time_End": 1751.3000000000002,
        "Text": " the new SSO extension."
      },
      {
        "Time_Start": 1751.3,
        "Time_End": 1752.3,
        "Text": " And then it was suddenly V4."
      },
      {
        "Time_Start": 1752.3,
        "Time_End": 1754.3,
        "Text": " And we're like, what?"
      },
      {
        "Time_Start": 1754.3,
        "Time_End": 1755.3,
        "Text": " Anyway."
      },
      {
        "Time_Start": 1755.3,
        "Time_End": 1757.5,
        "Text": " So it's sending a signed request."
      },
      {
        "Time_Start": 1757.5,
        "Time_End": 1760.7,
        "Text": " And it is embedding this device certificate."
      },
      {
        "Time_Start": 1760.7,
        "Time_End": 1763.76,
        "Text": " So this was a certificate that was issued to our device earlier."
      },
      {
        "Time_Start": 1763.76,
        "Time_End": 1765.7,
        "Text": " So we're saying, like, this is our device."
      },
      {
        "Time_Start": 1765.7,
        "Time_End": 1767.3,
        "Text": " We are presenting our certificate."
      },
      {
        "Time_Start": 1767.3,
        "Time_End": 1771.54,
        "Text": " We are signing this request with our private key."
      },
      {
        "Time_Start": 1771.54,
        "Time_End": 1775.74,
        "Text": " The signature algorithm here is based on elliptic curve cryptography again."
      },
      {
        "Time_Start": 1775.74,
        "Time_End": 1780.6599999999999,
        "Text": " So we're using ECDSA to actually sign this whole request."
      },
      {
        "Time_Start": 1780.66,
        "Time_End": 1781.94,
        "Text": " And then we get a PRT."
      },
      {
        "Time_Start": 1781.94,
        "Time_End": 1786.3400000000001,
        "Text": " So normally, if you request a PRT, you get the PRT and you get the encrypted session"
      },
      {
        "Time_Start": 1786.3400000000001,
        "Time_End": 1787.3400000000001,
        "Text": " key."
      },
      {
        "Time_Start": 1787.3400000000001,
        "Time_End": 1788.64,
        "Text": " But in this case, there is no session key."
      },
      {
        "Time_Start": 1788.64,
        "Time_End": 1791.78,
        "Text": " So we get the PRT basically in plain."
      },
      {
        "Time_Start": 1791.78,
        "Time_End": 1793.5800000000002,
        "Text": " There's no encryption involved."
      },
      {
        "Time_Start": 1793.5800000000002,
        "Time_End": 1796.7,
        "Text": " And it doesn't really matter, because the PRT is bound to our device."
      },
      {
        "Time_Start": 1796.7,
        "Time_End": 1802.94,
        "Text": " And we can only use it by sending, again, something that is signed with the device key."
      },
      {
        "Time_Start": 1802.94,
        "Time_End": 1806.5800000000002,
        "Text": " So if we want to use the PRT, we send a very similar request."
      },
      {
        "Time_Start": 1806.5800000000002,
        "Time_End": 1809.46,
        "Text": " Again, we sign it with our device key."
      },
      {
        "Time_Start": 1809.46,
        "Time_End": 1811.66,
        "Text": " We prove who we are."
      },
      {
        "Time_Start": 1811.66,
        "Time_End": 1815.58,
        "Text": " And then when we get back, this is a little complicated."
      },
      {
        "Time_Start": 1815.58,
        "Time_End": 1820.74,
        "Text": " So this is essentially the part where Entra generated, like, a temporary private key or"
      },
      {
        "Time_Start": 1820.74,
        "Time_End": 1823.08,
        "Text": " an ethereal key."
      },
      {
        "Time_Start": 1823.08,
        "Time_End": 1829.1000000000001,
        "Text": " And we need our private key in the secure enclave to then calculate the session key"
      },
      {
        "Time_Start": 1829.1000000000001,
        "Time_End": 1830.8600000000001,
        "Text": " that's used on the fly."
      },
      {
        "Time_Start": 1830.8600000000001,
        "Time_End": 1836.74,
        "Text": " And with this algorithm, we can then calculate the AES key that is used to decrypt this whole"
      },
      {
        "Time_Start": 1836.74,
        "Time_End": 1837.74,
        "Text": " blob."
      },
      {
        "Time_Start": 1837.74,
        "Time_End": 1840.42,
        "Text": " So it's just using AES GCM."
      },
      {
        "Time_Start": 1840.42,
        "Time_End": 1841.54,
        "Text": " And we can decrypt it."
      },
      {
        "Time_Start": 1841.54,
        "Time_End": 1845.14,
        "Text": " And then we actually get the tokens."
      },
      {
        "Time_Start": 1845.14,
        "Time_End": 1849.54,
        "Text": " So this is, of course, a little complicated."
      },
      {
        "Time_Start": 1849.54,
        "Time_End": 1852.98,
        "Text": " It's nicely described in this RFC."
      },
      {
        "Time_Start": 1852.98,
        "Time_End": 1858.82,
        "Text": " Or I say nicely, but it's not that\ufffd maybe they should use a language that actual humans"
      },
      {
        "Time_Start": 1858.82,
        "Time_End": 1859.82,
        "Text": " can understand."
      },
      {
        "Time_Start": 1859.82,
        "Time_End": 1866.54,
        "Text": " But essentially, it is using elliptic curve Diffie-Hellman static keys in combination"
      },
      {
        "Time_Start": 1866.54,
        "Time_End": 1873.54,
        "Text": " with the concat key derivation function in this section 581 from NIST something document."
      },
      {
        "Time_Start": 1873.54,
        "Time_End": 1877.54,
        "Text": " Luckily for me, there's already libraries that implement this."
      },
      {
        "Time_Start": 1877.54,
        "Time_End": 1882.18,
        "Text": " Because I tried some cryptography, and that didn't work out very well."
      },
      {
        "Time_Start": 1882.18,
        "Time_End": 1891.18,
        "Text": " But basically, we can use all of this stuff and kind of create our own implementation."
      },
      {
        "Time_Start": 1891.18,
        "Time_End": 1895.18,
        "Text": " And I'll let you guess who wrote this document."
      },
      {
        "Time_Start": 1895.8200000000002,
        "Time_End": 1899.8600000000001,
        "Text": " All right."
      },
      {
        "Time_Start": 1899.8600000000001,
        "Time_End": 1904.46,
        "Text": " So if you implement all of this, and we did."
      },
      {
        "Time_Start": 1904.46,
        "Time_End": 1907.74,
        "Text": " And actually, the helpful thing here was, again, the Apple documentation."
      },
      {
        "Time_Start": 1907.74,
        "Time_End": 1911.14,
        "Text": " Because Apple also realized that this is maybe a bit complicated."
      },
      {
        "Time_Start": 1911.14,
        "Time_End": 1916.02,
        "Text": " So they did give you an example of what all these inputs at different steps would be and"
      },
      {
        "Time_Start": 1916.02,
        "Time_End": 1918.26,
        "Text": " what the resulting cryptographic key would be."
      },
      {
        "Time_Start": 1918.26,
        "Time_End": 1922.94,
        "Text": " So then you can kind of write your own implementation and at least make sure that it's working for"
      },
      {
        "Time_Start": 1922.98,
        "Time_End": 1924.98,
        "Text": " this sample request."
      },
      {
        "Time_Start": 1924.98,
        "Time_End": 1925.98,
        "Text": " Yeah."
      },
      {
        "Time_Start": 1925.98,
        "Time_End": 1930.26,
        "Text": " And it was kind of funny during the research."
      },
      {
        "Time_Start": 1930.26,
        "Time_End": 1932.1000000000001,
        "Text": " I didn't understand this bit at all."
      },
      {
        "Time_Start": 1932.1000000000001,
        "Time_End": 1936.1000000000001,
        "Text": " So Dirk-Jan was going through it, and I was like, damn, this is complicated."
      },
      {
        "Time_Start": 1936.1000000000001,
        "Time_End": 1938.66,
        "Text": " And then he started pushing in some code."
      },
      {
        "Time_Start": 1938.66,
        "Time_End": 1942.46,
        "Text": " He did a test and completely dumbfounded that it worked."
      },
      {
        "Time_Start": 1942.46,
        "Time_End": 1943.46,
        "Text": " First time ever."
      },
      {
        "Time_Start": 1943.46,
        "Time_End": 1944.46,
        "Text": " That was really cool."
      },
      {
        "Time_Start": 1944.46,
        "Time_End": 1945.46,
        "Text": " Super impressive to see."
      },
      {
        "Time_Start": 1945.46,
        "Time_End": 1947.6200000000001,
        "Text": " Still don't understand fully how it worked."
      },
      {
        "Time_Start": 1947.6200000000001,
        "Time_End": 1948.6200000000001,
        "Text": " But it's pretty impressive."
      },
      {
        "Time_Start": 1948.6200000000001,
        "Time_End": 1949.6200000000001,
        "Text": " Me neither."
      },
      {
        "Time_Start": 1949.6200000000001,
        "Time_End": 1950.6200000000001,
        "Text": " But I do have a working implementation."
      },
      {
        "Time_Start": 1950.6200000000001,
        "Time_End": 1952.5800000000002,
        "Text": " He mostly got it to work."
      },
      {
        "Time_Start": 1952.86,
        "Time_End": 1957.8999999999999,
        "Text": " So many layers of like layered and stacked cryptography in there that it's probably even"
      },
      {
        "Time_Start": 1957.8999999999999,
        "Time_End": 1964.22,
        "Text": " Mr. Jones doesn't fully comprehend it anymore since it is 2015 that he wrote this."
      },
      {
        "Time_Start": 1964.22,
        "Time_End": 1966.74,
        "Text": " Again, back to the keychain."
      },
      {
        "Time_Start": 1966.74,
        "Time_End": 1969.4199999999998,
        "Text": " We get a similar item."
      },
      {
        "Time_Start": 1969.4199999999998,
        "Time_End": 1972.74,
        "Text": " Maybe if you recall, the previous one was only like called dash one."
      },
      {
        "Time_Start": 1972.74,
        "Time_End": 1975.02,
        "Text": " It doesn't increment, but it's always called dash one."
      },
      {
        "Time_Start": 1975.02,
        "Time_End": 1981.78,
        "Text": " And here it's actually sort of named with the device and the tenant name in it."
      },
      {
        "Time_Start": 1981.78,
        "Time_End": 1982.78,
        "Text": " Similar information."
      },
      {
        "Time_Start": 1982.78,
        "Time_End": 1984.06,
        "Text": " We still see this, right?"
      },
      {
        "Time_Start": 1984.06,
        "Time_End": 1991.1399999999999,
        "Text": " If we click the button and we enter our passwords, we'll get information there."
      },
      {
        "Time_Start": 1991.1399999999999,
        "Time_End": 1994.1,
        "Text": " That information is still protected like the previous one."
      },
      {
        "Time_Start": 1994.1,
        "Time_End": 1995.78,
        "Text": " So there's all kinds of entitlements on it."
      },
      {
        "Time_Start": 1995.78,
        "Time_End": 1997.74,
        "Text": " It's pretty difficult to change this."
      },
      {
        "Time_Start": 1997.74,
        "Time_End": 2000.1,
        "Text": " So it's relatively secure."
      },
      {
        "Time_Start": 2000.1,
        "Time_End": 2002.76,
        "Text": " And in this case, it doesn't really matter."
      },
      {
        "Time_Start": 2002.76,
        "Time_End": 2006.34,
        "Text": " Because if we look at the same blob, we see secrets."
      },
      {
        "Time_Start": 2006.34,
        "Time_End": 2008.96,
        "Text": " We see that it is PRT version 4."
      },
      {
        "Time_Start": 2008.96,
        "Time_End": 2011.1200000000001,
        "Text": " But we don't see that session key anymore."
      },
      {
        "Time_Start": 2011.1200000000001,
        "Time_End": 2017.64,
        "Text": " As explained, we can't really use this directly."
      },
      {
        "Time_Start": 2017.64,
        "Time_End": 2022.28,
        "Text": " And maybe some refresher on the refresher."
      },
      {
        "Time_Start": 2022.28,
        "Time_End": 2029.0,
        "Text": " According to the Microsoft documentation, PRT always contains a device ID and a session"
      },
      {
        "Time_Start": 2029.0,
        "Time_End": 2030.0,
        "Text": " ID."
      },
      {
        "Time_Start": 2030.0,
        "Time_End": 2031.76,
        "Text": " We just learned it doesn't."
      },
      {
        "Time_Start": 2031.76,
        "Time_End": 2034.52,
        "Text": " It doesn't need either or."
      },
      {
        "Time_Start": 2034.52,
        "Time_End": 2036.2,
        "Text": " So there's multiple implementations of this."
      },
      {
        "Time_Start": 2036.2,
        "Time_End": 2042.0,
        "Text": " And this is, of course, the last really memorable slide that you should have in your brain."
      },
      {
        "Time_Start": 2042.0,
        "Time_End": 2046.68,
        "Text": " Is where we have the different versions with their different implementations, right?"
      },
      {
        "Time_Start": 2046.68,
        "Time_End": 2051.76,
        "Text": " So we have a device bound one, which is fairly similar to the Windows implementation."
      },
      {
        "Time_Start": 2051.76,
        "Time_End": 2057.68,
        "Text": " With the exception that it's slightly different cryptography."
      },
      {
        "Time_Start": 2057.68,
        "Time_End": 2060.48,
        "Text": " And it's, of course, all of them are stored in the keychain."
      },
      {
        "Time_Start": 2060.48,
        "Time_End": 2061.48,
        "Text": " Version 2 isn't."
      },
      {
        "Time_Start": 2061.48,
        "Time_End": 2063.08,
        "Text": " Because it's a Windows thing."
      },
      {
        "Time_Start": 2063.08,
        "Time_End": 2065.24,
        "Text": " The device one doesn't have a device ID."
      },
      {
        "Time_Start": 2065.24,
        "Time_End": 2068.12,
        "Text": " Because it's not bound to a device."
      },
      {
        "Time_Start": 2068.12,
        "Time_End": 2070.48,
        "Text": " And version 4 doesn't have a session key."
      },
      {
        "Time_Start": 2070.48,
        "Time_End": 2074.0,
        "Text": " Because that's handled with the secure enclave."
      },
      {
        "Time_Start": 2074.0,
        "Time_End": 2076.7599999999998,
        "Text": " And of course the crypto is completely different."
      },
      {
        "Time_Start": 2076.7599999999998,
        "Time_End": 2082.34,
        "Text": " The use by is with the caveat that this is the stuff we looked at and we are aware of."
      },
      {
        "Time_Start": 2082.34,
        "Time_End": 2088.04,
        "Text": " We also are aware of that the device bound V3 is also used on different operating systems."
      },
      {
        "Time_Start": 2088.04,
        "Time_End": 2092.12,
        "Text": " So have fun researching that if you want."
      },
      {
        "Time_Start": 2092.16,
        "Time_End": 2097.48,
        "Text": " So still interesting to remark, even though the PRT itself says 14 days, that's still"
      },
      {
        "Time_Start": 2097.48,
        "Time_End": 2098.96,
        "Text": " a lie."
      },
      {
        "Time_Start": 2098.96,
        "Time_End": 2101.68,
        "Text": " People make wrong assumptions sometimes."
      },
      {
        "Time_Start": 2101.68,
        "Time_End": 2103.08,
        "Text": " It's actually valid for 90 days, right?"
      },
      {
        "Time_Start": 2103.08,
        "Time_End": 2108.04,
        "Text": " So if you manage to capture this, then you will actually have fun for 90 days."
      },
      {
        "Time_Start": 2108.04,
        "Time_End": 2110.56,
        "Text": " And maybe you can do some other things with it."
      },
      {
        "Time_Start": 2110.56,
        "Time_End": 2113.7599999999998,
        "Text": " So one of the things is that we can fish for this."
      },
      {
        "Time_Start": 2113.7599999999998,
        "Time_End": 2115.68,
        "Text": " And Dirk-Jan has a demo for that."
      },
      {
        "Time_Start": 2115.68,
        "Time_End": 2120.9199999999996,
        "Text": " And of course, except from the first line, none of that is documented anywhere whatsoever."
      },
      {
        "Time_Start": 2120.9199999999996,
        "Time_End": 2121.9199999999996,
        "Text": " Yes."
      },
      {
        "Time_Start": 2121.9199999999996,
        "Time_End": 2123.6,
        "Text": " All right."
      },
      {
        "Time_Start": 2123.6,
        "Time_End": 2126.52,
        "Text": " So what can we actually do with this?"
      },
      {
        "Time_Start": 2126.52,
        "Time_End": 2128.64,
        "Text": " Because we can do a lot of attacks."
      },
      {
        "Time_Start": 2128.64,
        "Time_End": 2129.64,
        "Text": " We can do phishing attacks."
      },
      {
        "Time_Start": 2129.64,
        "Time_End": 2131.3999999999996,
        "Text": " We can do token stealing attacks."
      },
      {
        "Time_Start": 2131.3999999999996,
        "Time_End": 2138.2,
        "Text": " But one of the downsides often of phishing people, that is that we often need a device"
      },
      {
        "Time_Start": 2138.2,
        "Time_End": 2139.2,
        "Text": " to get a PRT."
      },
      {
        "Time_Start": 2139.2,
        "Time_End": 2142.9199999999996,
        "Text": " So there are ways around that to register your own device on the fly."
      },
      {
        "Time_Start": 2142.92,
        "Time_End": 2146.08,
        "Text": " But most of the time, you see people phishing for, like, cookies."
      },
      {
        "Time_Start": 2146.08,
        "Time_End": 2147.64,
        "Text": " And cookies, they're all right."
      },
      {
        "Time_Start": 2147.64,
        "Time_End": 2150.08,
        "Text": " But I don't like cookies."
      },
      {
        "Time_Start": 2150.08,
        "Time_End": 2154.56,
        "Text": " Because Microsoft treats cookies as, like, basically a black box."
      },
      {
        "Time_Start": 2154.56,
        "Time_End": 2157.48,
        "Text": " And I can send a cookie at one point, and then it will be fine."
      },
      {
        "Time_Start": 2157.48,
        "Time_End": 2161.04,
        "Text": " And if I send it five minutes later, then suddenly my cookie is revoked without any"
      },
      {
        "Time_Start": 2161.04,
        "Time_End": 2162.16,
        "Text": " clear error message."
      },
      {
        "Time_Start": 2162.16,
        "Time_End": 2166.28,
        "Text": " So I don't like things that I cannot explain."
      },
      {
        "Time_Start": 2166.28,
        "Time_End": 2171.04,
        "Text": " So if I phish someone with, like, evil jinx, and then I have a cookie that may or may not"
      },
      {
        "Time_Start": 2171.04,
        "Time_End": 2174.46,
        "Text": " work for X amount of time."
      },
      {
        "Time_Start": 2174.46,
        "Time_End": 2178.68,
        "Text": " But what we can also do is we can phish people and ask for a deviceless PRT."
      },
      {
        "Time_Start": 2178.68,
        "Time_End": 2184.16,
        "Text": " Because we saw the deviceless PRT flow just starts with the OAuth authorization code flow."
      },
      {
        "Time_Start": 2184.16,
        "Time_End": 2187.84,
        "Text": " And we can just use the correct client ID, for example, emulating edge."
      },
      {
        "Time_Start": 2187.84,
        "Time_End": 2193.92,
        "Text": " And then we get this special authorization code that we can use to request a single sign"
      },
      {
        "Time_Start": 2193.92,
        "Time_End": 2195.8,
        "Text": " on a PRT."
      },
      {
        "Time_Start": 2195.8,
        "Time_End": 2197.36,
        "Text": " And that is a lot more solid."
      },
      {
        "Time_Start": 2197.36,
        "Time_End": 2199.04,
        "Text": " Because PRTs are normally not revoked."
      },
      {
        "Time_Start": 2199.04,
        "Time_End": 2201.0,
        "Text": " At least there's no magic to revoke them."
      },
      {
        "Time_Start": 2201.0,
        "Time_End": 2204.84,
        "Text": " Unless, of course, you hit that revoke tokens button in the admin panel."
      },
      {
        "Time_Start": 2204.84,
        "Time_End": 2205.84,
        "Text": " Or do that via PowerShell."
      },
      {
        "Time_Start": 2205.84,
        "Time_End": 2210.92,
        "Text": " But it's not like Microsoft has some magic when it will not accept a PRT."
      },
      {
        "Time_Start": 2210.92,
        "Time_End": 2214.2,
        "Text": " Unlike with cookies, which they often just refuse for no reason."
      },
      {
        "Time_Start": 2214.2,
        "Time_End": 2216.2,
        "Text": " All right."
      },
      {
        "Time_Start": 2216.2,
        "Time_End": 2222.44,
        "Text": " So I'm gonna do a small demo of actually phishing that deviceless PRT."
      },
      {
        "Time_Start": 2222.44,
        "Time_End": 2228.08,
        "Text": " I don't know if some of you saw my video I posted, like, earlier this week."
      },
      {
        "Time_Start": 2228.08,
        "Time_End": 2229.36,
        "Text": " For phishing for a full PRT."
      },
      {
        "Time_Start": 2229.36,
        "Time_End": 2230.96,
        "Text": " There were a lot of steps involved."
      },
      {
        "Time_Start": 2230.96,
        "Time_End": 2233.6,
        "Text": " But this one is a lot simpler."
      },
      {
        "Time_Start": 2233.6,
        "Time_End": 2237.64,
        "Text": " So in this case, I'm using Evil Jinx."
      },
      {
        "Time_Start": 2237.64,
        "Time_End": 2241.12,
        "Text": " And I am getting a URL for this."
      },
      {
        "Time_Start": 2241.12,
        "Time_End": 2243.04,
        "Text": " So I'm just using it locally."
      },
      {
        "Time_Start": 2243.04,
        "Time_End": 2244.56,
        "Text": " I don't actually own this domain."
      },
      {
        "Time_Start": 2244.56,
        "Time_End": 2250.08,
        "Text": " But it's basically a phishing domain that will ask me to follow the authorization code"
      },
      {
        "Time_Start": 2250.08,
        "Time_End": 2251.6,
        "Text": " flow."
      },
      {
        "Time_Start": 2251.6,
        "Time_End": 2252.6,
        "Text": " And I've already..."
      },
      {
        "Time_Start": 2252.6,
        "Time_End": 2253.6,
        "Text": " Sorry."
      },
      {
        "Time_Start": 2253.6,
        "Time_End": 2254.6,
        "Text": " Videos."
      },
      {
        "Time_Start": 2254.6,
        "Time_End": 2263.44,
        "Text": " And I've already, like, prefilled the client ID there."
      },
      {
        "Time_Start": 2263.44,
        "Time_End": 2265.44,
        "Text": " Oh, come on."
      },
      {
        "Time_Start": 2265.44,
        "Time_End": 2267.36,
        "Text": " Well, we'll do that from scratch."
      },
      {
        "Time_Start": 2267.36,
        "Time_End": 2268.36,
        "Text": " I'm not gonna touch it."
      },
      {
        "Time_Start": 2268.36,
        "Time_End": 2270.3199999999997,
        "Text": " So I've already filled in all the parameters."
      },
      {
        "Time_Start": 2270.3199999999997,
        "Time_End": 2272.44,
        "Text": " Or made Evil Jinx do that."
      },
      {
        "Time_Start": 2272.44,
        "Time_End": 2278.08,
        "Text": " So it is gonna ask for an authorization code for the right client with the right scope."
      },
      {
        "Time_Start": 2278.08,
        "Time_End": 2280.52,
        "Text": " And that are basically hidden over there."
      },
      {
        "Time_Start": 2280.52,
        "Time_End": 2283.56,
        "Text": " So I'm gonna enter the credentials for my victim."
      },
      {
        "Time_Start": 2283.56,
        "Time_End": 2285.24,
        "Text": " I'm gonna enter the password for my victim."
      },
      {
        "Time_Start": 2285.24,
        "Time_End": 2288.68,
        "Text": " I'm gonna enter the MFA for my victim."
      },
      {
        "Time_Start": 2288.68,
        "Time_End": 2291.2,
        "Text": " And then it is gonna give me a blank screen."
      },
      {
        "Time_Start": 2291.2,
        "Time_End": 2292.56,
        "Text": " Just because I'm lazy."
      },
      {
        "Time_Start": 2292.56,
        "Time_End": 2294.36,
        "Text": " I didn't want to make a whole page."
      },
      {
        "Time_Start": 2294.36,
        "Time_End": 2297.2799999999997,
        "Text": " But I did receive this authorization code."
      },
      {
        "Time_Start": 2297.2799999999997,
        "Time_End": 2299.6,
        "Text": " And this authorization code is normally used by Edge."
      },
      {
        "Time_Start": 2299.6,
        "Time_End": 2302.16,
        "Text": " But I can also use that with RoadTX."
      },
      {
        "Time_Start": 2302.16,
        "Time_End": 2305.2,
        "Text": " So I just throw this in the devices PRT command."
      },
      {
        "Time_Start": 2305.2,
        "Time_End": 2308.72,
        "Text": " And you see that we get a primary phish token."
      },
      {
        "Time_Start": 2308.72,
        "Time_End": 2312.12,
        "Text": " And with this primary phish token, I can also authenticate."
      },
      {
        "Time_Start": 2312.12,
        "Time_End": 2314.0,
        "Text": " So I can log into any website."
      },
      {
        "Time_Start": 2314.0,
        "Time_End": 2315.8399999999997,
        "Text": " I can log into any app."
      },
      {
        "Time_Start": 2315.8399999999997,
        "Time_End": 2317.72,
        "Text": " I can get tokens on behalf of teams."
      },
      {
        "Time_Start": 2317.72,
        "Time_End": 2319.3599999999997,
        "Text": " On behalf of Outlook."
      },
      {
        "Time_Start": 2319.3599999999997,
        "Time_End": 2321.44,
        "Text": " And this will just work for 90 days."
      },
      {
        "Time_Start": 2321.44,
        "Time_End": 2323.56,
        "Text": " Because it's a single sign-on token."
      },
      {
        "Time_Start": 2323.56,
        "Time_End": 2326.08,
        "Text": " I didn't need to go to the whole device flow."
      },
      {
        "Time_Start": 2326.08,
        "Time_End": 2331.08,
        "Text": " I could just use this whenever I liked."
      },
      {
        "Time_Start": 2331.08,
        "Time_End": 2335.2,
        "Text": " If we want to have some more fun with this, of course, we can also follow the rest of"
      },
      {
        "Time_Start": 2335.2,
        "Time_End": 2337.7999999999997,
        "Text": " the flow that Mac normally does."
      },
      {
        "Time_Start": 2337.8,
        "Time_End": 2340.44,
        "Text": " And we can actually use this to register our device."
      },
      {
        "Time_Start": 2340.44,
        "Time_End": 2343.2000000000003,
        "Text": " And then upgrade to a full PRT."
      },
      {
        "Time_Start": 2343.2000000000003,
        "Time_End": 2347.1200000000003,
        "Text": " So I am using this with the PRT off and the v3 version."
      },
      {
        "Time_Start": 2347.1200000000003,
        "Time_End": 2353.52,
        "Text": " The funny thing about PRT v3 is that there's no big difference between version 2 and version"
      },
      {
        "Time_Start": 2353.52,
        "Time_End": 2354.6000000000004,
        "Text": " 3 in how they're used."
      },
      {
        "Time_Start": 2354.6000000000004,
        "Time_End": 2358.1800000000003,
        "Text": " So you can send macOS PRTs to the Windows API."
      },
      {
        "Time_Start": 2358.1800000000003,
        "Time_End": 2362.2400000000002,
        "Text": " You can send the Windows PRTs to the macOS API version 3."
      },
      {
        "Time_Start": 2362.2400000000002,
        "Time_End": 2363.2400000000002,
        "Text": " Version 2 doesn't really matter."
      },
      {
        "Time_Start": 2363.2400000000002,
        "Time_End": 2366.0800000000004,
        "Text": " It's only version 4 that's really different."
      },
      {
        "Time_Start": 2366.08,
        "Time_End": 2372.7599999999998,
        "Text": " So just for fun, I'm gonna register a device using the new secure enclave flow."
      },
      {
        "Time_Start": 2372.7599999999998,
        "Time_End": 2375.24,
        "Text": " And I'm gonna follow this device command."
      },
      {
        "Time_Start": 2375.24,
        "Time_End": 2376.7599999999998,
        "Text": " So I'm gonna register it."
      },
      {
        "Time_Start": 2376.7599999999998,
        "Time_End": 2379.3199999999997,
        "Text": " And in this case, the device type is macOS 14."
      },
      {
        "Time_Start": 2379.3199999999997,
        "Time_End": 2384.6,
        "Text": " So this will trigger my script to use elliptic curve keys."
      },
      {
        "Time_Start": 2384.6,
        "Time_End": 2387.7599999999998,
        "Text": " And of course, these are not actually in a secure enclave."
      },
      {
        "Time_Start": 2387.7599999999998,
        "Time_End": 2390.88,
        "Text": " They're just on disk here."
      },
      {
        "Time_Start": 2390.88,
        "Time_End": 2393.44,
        "Text": " And with this, I can request a PRT."
      },
      {
        "Time_Start": 2393.44,
        "Time_End": 2398.32,
        "Text": " So I'm using basically the device list PRT."
      },
      {
        "Time_Start": 2398.32,
        "Time_End": 2400.56,
        "Text": " And I'm gonna upgrade that to a full PRT."
      },
      {
        "Time_Start": 2400.56,
        "Time_End": 2405.48,
        "Text": " So I'm just gonna add my device certificate and signature to that."
      },
      {
        "Time_Start": 2405.48,
        "Time_End": 2409.28,
        "Text": " And you see that I get back now this full PRT that is bound to a device."
      },
      {
        "Time_Start": 2409.28,
        "Time_End": 2411.44,
        "Text": " And you see that the session key is empty."
      },
      {
        "Time_Start": 2411.44,
        "Time_End": 2415.4,
        "Text": " So normally, if you do this with the Windows protocol, you will see the session key here."
      },
      {
        "Time_Start": 2415.4,
        "Time_End": 2418.6,
        "Text": " And that is the one you actually need to use this PRT."
      },
      {
        "Time_Start": 2418.6,
        "Time_End": 2423.0,
        "Text": " But in this case, session key is empty because there is no session key in PRT v4."
      },
      {
        "Time_Start": 2423.0,
        "Time_End": 2429.12,
        "Text": " And I can only use this if I actually wrap that with a elliptic curve signed body with"
      },
      {
        "Time_Start": 2429.12,
        "Time_End": 2435.2,
        "Text": " my certificate, which we can do with the PRT off, also with version 4."
      },
      {
        "Time_Start": 2435.2,
        "Time_End": 2436.68,
        "Text": " We can provide the scope that we want."
      },
      {
        "Time_Start": 2436.68,
        "Time_End": 2440.76,
        "Text": " So in this case, we're doing the authentication on behalf of Teams."
      },
      {
        "Time_Start": 2440.76,
        "Time_End": 2444.32,
        "Text": " We're getting a token for Microsoft Graph."
      },
      {
        "Time_Start": 2444.32,
        "Time_End": 2448.72,
        "Text": " And the only extra thing is that now I have to provide my device certificate because I"
      },
      {
        "Time_Start": 2448.72,
        "Time_End": 2450.56,
        "Text": " need to sign this request."
      },
      {
        "Time_Start": 2450.56,
        "Time_End": 2453.2799999999997,
        "Text": " And I also need to provide my private key."
      },
      {
        "Time_Start": 2453.2799999999997,
        "Time_End": 2454.96,
        "Text": " Because the response..."
      },
      {
        "Time_Start": 2454.96,
        "Time_End": 2456.6,
        "Text": " There's no session key there."
      },
      {
        "Time_Start": 2456.6,
        "Time_End": 2458.36,
        "Text": " So we don't need to use a session key."
      },
      {
        "Time_Start": 2458.36,
        "Time_End": 2460.6,
        "Text": " But the response will be encrypted."
      },
      {
        "Time_Start": 2460.6,
        "Time_End": 2466.04,
        "Text": " And we need to use this Diffie-Hellman key exchange with the temporary key."
      },
      {
        "Time_Start": 2466.04,
        "Time_End": 2467.04,
        "Text": " Which..."
      },
      {
        "Time_Start": 2467.04,
        "Time_End": 2469.7599999999998,
        "Text": " Well, there was an implementation for it in cryptography."
      },
      {
        "Time_Start": 2469.7599999999998,
        "Time_End": 2470.7599999999998,
        "Text": " The Python library."
      },
      {
        "Time_Start": 2470.7599999999998,
        "Time_End": 2472.68,
        "Text": " So that saved a lot of time, I think."
      },
      {
        "Time_Start": 2472.68,
        "Time_End": 2474.92,
        "Text": " Because I didn't want to do that by myself."
      },
      {
        "Time_Start": 2474.92,
        "Time_End": 2475.92,
        "Text": " But it did work."
      },
      {
        "Time_Start": 2475.92,
        "Time_End": 2476.92,
        "Text": " So that's great."
      },
      {
        "Time_Start": 2476.92,
        "Time_End": 2481.0,
        "Text": " So we can decrypt it with the whole cryptode Diffie-Hellman difficult."
      },
      {
        "Time_Start": 2481.0,
        "Time_End": 2482.0,
        "Text": " But it works."
      },
      {
        "Time_Start": 2482.0,
        "Time_End": 2483.96,
        "Text": " And then we get some tokens out of it."
      },
      {
        "Time_Start": 2483.96,
        "Time_End": 2487.6,
        "Text": " So we used the PRT device list that we got via phishing."
      },
      {
        "Time_Start": 2487.6,
        "Time_End": 2489.64,
        "Text": " We upgraded that to PRTV4."
      },
      {
        "Time_Start": 2489.64,
        "Time_End": 2492.7200000000003,
        "Text": " We got a device that's PRTV4 capable."
      },
      {
        "Time_Start": 2492.7200000000003,
        "Time_End": 2497.0,
        "Text": " And now we have PRTV4 token."
      },
      {
        "Time_Start": 2497.0,
        "Time_End": 2499.6,
        "Text": " It is really significant, different."
      },
      {
        "Time_Start": 2499.6,
        "Time_End": 2501.28,
        "Text": " I mean, it's mostly just fun."
      },
      {
        "Time_Start": 2501.28,
        "Time_End": 2507.8,
        "Text": " It's not like that having a PRTV4 token suddenly allows us to do a lot of things."
      },
      {
        "Time_Start": 2507.8,
        "Time_End": 2511.4,
        "Text": " There is one thing that we are not allowed to mention."
      },
      {
        "Time_Start": 2511.4,
        "Time_End": 2516.2200000000003,
        "Text": " So there are a few shenanigans in all this flow."
      },
      {
        "Time_Start": 2516.2200000000003,
        "Time_End": 2522.0800000000004,
        "Text": " Some tricks you can do, actually, if you combine the Windows PRT with the macOS Flow or some"
      },
      {
        "Time_Start": 2522.0800000000004,
        "Time_End": 2523.0800000000004,
        "Text": " other stuff."
      },
      {
        "Time_Start": 2523.0800000000004,
        "Time_End": 2525.0800000000004,
        "Text": " Can't give too many details."
      },
      {
        "Time_Start": 2525.08,
        "Time_End": 2532.12,
        "Text": " Because we did post this talk, of course, on Twitter or X when we were gonna speak here."
      },
      {
        "Time_Start": 2532.12,
        "Time_End": 2534.2799999999997,
        "Text": " And then some people at Microsoft reached out."
      },
      {
        "Time_Start": 2534.2799999999997,
        "Time_End": 2535.2799999999997,
        "Text": " Two, three separately."
      },
      {
        "Time_Start": 2535.2799999999997,
        "Time_End": 2538.44,
        "Text": " Yeah, they were very eager to talk to us."
      },
      {
        "Time_Start": 2538.44,
        "Time_End": 2540.92,
        "Text": " We were like, okay, this is very complicated."
      },
      {
        "Time_Start": 2540.92,
        "Time_End": 2543.64,
        "Text": " We don't even understand fully how it works."
      },
      {
        "Time_Start": 2543.64,
        "Time_End": 2546.16,
        "Text": " It's probably not a big thing."
      },
      {
        "Time_Start": 2546.16,
        "Time_End": 2548.12,
        "Text": " But they did consider it a big thing."
      },
      {
        "Time_Start": 2548.12,
        "Time_End": 2552.96,
        "Text": " So they are gonna patch not this, because this is all intended that we talked about."
      },
      {
        "Time_Start": 2552.96,
        "Time_End": 2557.44,
        "Text": " But some other shenanigans that were not quite intended."
      },
      {
        "Time_Start": 2557.44,
        "Time_End": 2561.84,
        "Text": " But of course these protocols are so complicated that also nobody at Microsoft understands"
      },
      {
        "Time_Start": 2561.84,
        "Time_End": 2562.84,
        "Text": " them."
      },
      {
        "Time_Start": 2562.84,
        "Time_End": 2566.76,
        "Text": " So they found out that across all of the platforms, all the platform teams made some different"
      },
      {
        "Time_Start": 2566.76,
        "Time_End": 2570.2400000000002,
        "Text": " implementations that weren't exactly compliant to this flow always."
      },
      {
        "Time_Start": 2570.2400000000002,
        "Time_End": 2573.54,
        "Text": " So we thought, well, if you just do this, then it's fixed."
      },
      {
        "Time_Start": 2573.54,
        "Time_End": 2574.54,
        "Text": " And they were like, yes."
      },
      {
        "Time_Start": 2574.54,
        "Time_End": 2575.54,
        "Text": " But then everything breaks."
      },
      {
        "Time_Start": 2575.54,
        "Time_End": 2578.76,
        "Text": " And I said, okay, that's fair enough."
      },
      {
        "Time_Start": 2578.76,
        "Time_End": 2580.0,
        "Text": " So we cannot talk about that."
      },
      {
        "Time_Start": 2580.04,
        "Time_End": 2583.04,
        "Text": " But we will probably talk about it at some future point."
      },
      {
        "Time_Start": 2583.04,
        "Time_End": 2588.72,
        "Text": " Yeah, I think they gave us a deadline of three months for a certain implementation and six"
      },
      {
        "Time_Start": 2588.72,
        "Time_End": 2594.44,
        "Text": " months for the other one, which most likely will be slightly more, given the experience"
      },
      {
        "Time_Start": 2594.44,
        "Time_End": 2595.44,
        "Text": " that we have with them."
      },
      {
        "Time_Start": 2595.44,
        "Time_End": 2600.64,
        "Text": " So at some point we'll release a blog and talk about the full flow, which could be very"
      },
      {
        "Time_Start": 2600.64,
        "Time_End": 2604.88,
        "Text": " interesting to play with if you find it out yourself, if you're very creative, look at"
      },
      {
        "Time_Start": 2604.88,
        "Time_End": 2609.36,
        "Text": " our slides very well, and maybe interpret it in certain ways."
      },
      {
        "Time_Start": 2609.7200000000003,
        "Time_End": 2611.92,
        "Text": " So there shouldn't be that much directions anyway."
      },
      {
        "Time_Start": 2611.92,
        "Time_End": 2616.96,
        "Text": " But of course, we also want to do something against this in general, right?"
      },
      {
        "Time_Start": 2616.96,
        "Time_End": 2620.84,
        "Text": " Not only the flow we're not talking about, but also some of the other ones."
      },
      {
        "Time_Start": 2620.84,
        "Time_End": 2622.48,
        "Text": " And that's going to be difficult."
      },
      {
        "Time_Start": 2622.48,
        "Time_End": 2625.44,
        "Text": " I think there's options to consider."
      },
      {
        "Time_Start": 2625.44,
        "Time_End": 2630.32,
        "Text": " None of them would fully protect you, because this is also a sort of by design flow."
      },
      {
        "Time_Start": 2630.32,
        "Time_End": 2637.08,
        "Text": " And as we know, most organizations have a very broad user base, which they want to support"
      },
      {
        "Time_Start": 2637.08,
        "Time_End": 2640.16,
        "Text": " and all kinds of weird side steps that they want to do."
      },
      {
        "Time_Start": 2640.16,
        "Time_End": 2644.92,
        "Text": " But of course, we can build some conditional access policies to mitigate some of the actions"
      },
      {
        "Time_Start": 2644.92,
        "Time_End": 2647.16,
        "Text": " that we showed."
      },
      {
        "Time_Start": 2647.16,
        "Time_End": 2652.3199999999997,
        "Text": " On top of that, we can try, and I hear some organizations actually manage to do this,"
      },
      {
        "Time_Start": 2652.3199999999997,
        "Time_End": 2657.84,
        "Text": " but we can require only compliant devices, which will make it harder to actually do some"
      },
      {
        "Time_Start": 2657.84,
        "Time_End": 2658.84,
        "Text": " of these steps."
      },
      {
        "Time_Start": 2658.84,
        "Time_End": 2662.3199999999997,
        "Text": " I mean, you can still do it, but then the attackers do quite a lot of research into"
      },
      {
        "Time_Start": 2662.32,
        "Time_End": 2667.8,
        "Text": " finding out what these policies are, how to create a machine that is actually compliant"
      },
      {
        "Time_Start": 2667.8,
        "Time_End": 2671.8,
        "Text": " with all the rubbish that is required, which might actually restrict him from doing other"
      },
      {
        "Time_Start": 2671.8,
        "Time_End": 2672.8,
        "Text": " stuff."
      },
      {
        "Time_Start": 2672.8,
        "Time_End": 2677.36,
        "Text": " So very powerful, but also pretty difficult to do well."
      },
      {
        "Time_Start": 2677.36,
        "Time_End": 2682.1200000000003,
        "Text": " One of the somewhat simpler things, which might not always work, is restrict device"
      },
      {
        "Time_Start": 2682.1200000000003,
        "Time_End": 2683.1200000000003,
        "Text": " registration."
      },
      {
        "Time_Start": 2683.1200000000003,
        "Time_End": 2685.0800000000004,
        "Text": " By design, you have way more than one."
      },
      {
        "Time_Start": 2685.0800000000004,
        "Time_End": 2687.52,
        "Text": " I think you have five or 10."
      },
      {
        "Time_Start": 2687.52,
        "Time_End": 2689.1200000000003,
        "Text": " And you can restrict that to one, right?"
      },
      {
        "Time_Start": 2689.12,
        "Time_End": 2692.12,
        "Text": " So usually, a user only onboards one device."
      },
      {
        "Time_Start": 2692.12,
        "Time_End": 2695.24,
        "Text": " But if you also want to bring in your mobile, you already have two, and then you can leave"
      },
      {
        "Time_Start": 2695.24,
        "Time_End": 2696.24,
        "Text": " gaps, right?"
      },
      {
        "Time_Start": 2696.24,
        "Time_End": 2700.48,
        "Text": " So it's brittle, but it is a thing you could do."
      },
      {
        "Time_Start": 2700.48,
        "Time_End": 2708.3199999999997,
        "Text": " The same with limited token lifetime on non-corporate devices or non-managed devices."
      },
      {
        "Time_Start": 2708.3199999999997,
        "Time_End": 2714.7599999999998,
        "Text": " So for instance, in our own tenants, we have certain tokens that only live for eight hours."
      },
      {
        "Time_Start": 2714.7599999999998,
        "Time_End": 2717.88,
        "Text": " So every day, I log on to DevOps or other stuff."
      },
      {
        "Time_Start": 2717.88,
        "Time_End": 2719.88,
        "Text": " In order to sort of protect it a little bit more."
      },
      {
        "Time_Start": 2719.88,
        "Time_End": 2724.4,
        "Text": " It's a bit of a nuisance, but for the very protective environments, you want to do this."
      },
      {
        "Time_Start": 2724.4,
        "Time_End": 2726.8,
        "Text": " And maybe some of the other ones, a little bit less."
      },
      {
        "Time_Start": 2726.8,
        "Time_End": 2729.7400000000002,
        "Text": " But that will mitigate bits of it."
      },
      {
        "Time_Start": 2729.7400000000002,
        "Time_End": 2733.48,
        "Text": " And of course, we can also start building some detections on some of the behaviors."
      },
      {
        "Time_Start": 2733.48,
        "Time_End": 2737.56,
        "Text": " So one in particular that will be interesting is to look for new device registrations from"
      },
      {
        "Time_Start": 2737.56,
        "Time_End": 2741.8,
        "Text": " an already registered device, because that should never happen."
      },
      {
        "Time_Start": 2741.8,
        "Time_End": 2742.8,
        "Text": " That's kind of weird."
      },
      {
        "Time_Start": 2742.8,
        "Time_End": 2746.76,
        "Text": " And there might be some other detections that you should be looking at."
      },
      {
        "Time_Start": 2746.76,
        "Time_End": 2751.36,
        "Text": " And Microsoft, of course, as we mentioned earlier, is working on patching the vulnerable"
      },
      {
        "Time_Start": 2751.36,
        "Time_End": 2754.6800000000003,
        "Text": " flows that we didn't discuss."
      },
      {
        "Time_Start": 2754.6800000000003,
        "Time_End": 2760.28,
        "Text": " And they're also exploring ways or mechanisms to actually disallow reuse of certain tokens"
      },
      {
        "Time_Start": 2760.28,
        "Time_End": 2765.32,
        "Text": " for device registration, which will also mitigate part of this attack."
      },
      {
        "Time_Start": 2765.32,
        "Time_End": 2768.96,
        "Text": " So of course, we're not done here."
      },
      {
        "Time_Start": 2768.96,
        "Time_End": 2774.5600000000004,
        "Text": " Michael has a couple of RFCs, so maybe there's some additional things that we can start looking"
      },
      {
        "Time_Start": 2774.56,
        "Time_End": 2775.56,
        "Text": " into."
      },
      {
        "Time_Start": 2775.56,
        "Time_End": 2780.32,
        "Text": " Or primarily Dirk-Jan, because I don't understand half of it."
      },
      {
        "Time_Start": 2780.32,
        "Time_End": 2792.44,
        "Text": " And with that, I think we are at the end, and we are ready for questions."
      },
      {
        "Time_Start": 2792.44,
        "Time_End": 2796.72,
        "Text": " Thank you very much for your great talk."
      },
      {
        "Time_Start": 2796.72,
        "Time_End": 2799.24,
        "Text": " Questions?"
      },
      {
        "Time_Start": 2799.24,
        "Time_End": 2800.24,
        "Text": " Great talk."
      },
      {
        "Time_Start": 2800.24,
        "Time_End": 2804.0,
        "Text": " Can you go back to the PRT v3 flow diagram?"
      },
      {
        "Time_Start": 2804.0,
        "Time_End": 2821.84,
        "Text": " I think you answered this question, but I want to confirm that I understand."
      },
      {
        "Time_Start": 2821.84,
        "Time_End": 2822.84,
        "Text": " So..."
      },
      {
        "Time_Start": 2822.84,
        "Time_End": 2823.84,
        "Text": " Yeah."
      },
      {
        "Time_Start": 2823.84,
        "Time_End": 2824.84,
        "Text": " Yeah."
      },
      {
        "Time_Start": 2824.84,
        "Time_End": 2825.84,
        "Text": " I think."
      },
      {
        "Time_Start": 2825.84,
        "Time_End": 2826.84,
        "Text": " Yeah."
      },
      {
        "Time_Start": 2826.84,
        "Time_End": 2831.04,
        "Text": " So you first get a device list PRT, and you exchange that for a device bound PRT."
      },
      {
        "Time_Start": 2831.04,
        "Time_End": 2836.96,
        "Text": " And I think the table you mentioned later said that the device list PRT is still valid,"
      },
      {
        "Time_Start": 2836.96,
        "Time_End": 2837.96,
        "Text": " even after that exchange."
      },
      {
        "Time_Start": 2837.96,
        "Time_End": 2838.96,
        "Text": " Yeah."
      },
      {
        "Time_Start": 2838.96,
        "Time_End": 2839.96,
        "Text": " Yeah."
      },
      {
        "Time_Start": 2839.96,
        "Time_End": 2843.88,
        "Text": " So the thing with PRTs, like access tokens, they're all stateless."
      },
      {
        "Time_Start": 2843.88,
        "Time_End": 2847.64,
        "Text": " So unless you revoke a refresh token or a primary refresh token, they're all going to"
      },
      {
        "Time_Start": 2847.64,
        "Time_End": 2849.6,
        "Text": " stay valid forever."
      },
      {
        "Time_Start": 2849.6,
        "Time_End": 2853.0,
        "Text": " It's just that the device list PRT is not bound to a specific device."
      },
      {
        "Time_Start": 2853.0,
        "Time_End": 2856.84,
        "Text": " So if there is a policy that requires your device to be in a certain state, then the"
      },
      {
        "Time_Start": 2856.84,
        "Time_End": 2858.56,
        "Text": " device list PRT is not going to work."
      },
      {
        "Time_Start": 2858.56,
        "Time_End": 2862.12,
        "Text": " But apart from that, yeah, both PRTs are still valid."
      },
      {
        "Time_Start": 2862.12,
        "Time_End": 2868.24,
        "Text": " And I think even if you have, like, macOS with single sign-on, there might be some devices"
      },
      {
        "Time_Start": 2868.24,
        "Time_End": 2873.0,
        "Text": " PRTs left in the edge cache, depending on which order you set it up."
      },
      {
        "Time_Start": 2873.0,
        "Time_End": 2876.12,
        "Text": " But there's so many different ways to actually do this."
      },
      {
        "Time_Start": 2876.12,
        "Time_End": 2879.12,
        "Text": " We also didn't look into all of them and what, like, artifacts are left behind."
      },
      {
        "Time_Start": 2879.12,
        "Time_End": 2880.12,
        "Text": " Right."
      },
      {
        "Time_Start": 2880.12,
        "Time_End": 2881.12,
        "Text": " Because you don't have..."
      },
      {
        "Time_Start": 2881.12,
        "Time_End": 2882.12,
        "Text": " You can't block a device."
      },
      {
        "Time_Start": 2882.12,
        "Time_End": 2883.12,
        "Text": " So you need to block the user, which usually, in the PRT mindset of a defender, they block"
      },
      {
        "Time_Start": 2883.12,
        "Time_End": 2884.12,
        "Text": " the device."
      },
      {
        "Time_Start": 2884.12,
        "Time_End": 2885.12,
        "Text": " And then we're all right."
      },
      {
        "Time_Start": 2885.12,
        "Time_End": 2886.12,
        "Text": " But in this case, the attacker might still have some persistence."
      },
      {
        "Time_Start": 2886.12,
        "Time_End": 2887.12,
        "Text": " Yeah."
      },
      {
        "Time_Start": 2887.12,
        "Time_End": 2888.12,
        "Text": " Something to be aware of."
      },
      {
        "Time_Start": 2888.12,
        "Time_End": 2889.12,
        "Text": " That if you do some mitigation on a device, always, always block the user and disable"
      },
      {
        "Time_Start": 2889.12,
        "Time_End": 2898.12,
        "Text": " the user at least temporarily so that you know that all the tokens are in one place."
      },
      {
        "Time_Start": 2898.12,
        "Time_End": 2899.12,
        "Text": " Okay."
      },
      {
        "Time_Start": 2899.12,
        "Time_End": 2900.12,
        "Text": " Second question."
      },
      {
        "Time_Start": 2900.12,
        "Time_End": 2901.12,
        "Text": " In the keychain screenshot that you had, there was a PRT that was stored and that had a GUID"
      },
      {
        "Time_Start": 2901.12,
        "Time_End": 2902.12,
        "Text": " and display name."
      },
      {
        "Time_Start": 2902.12,
        "Time_End": 2913.12,
        "Text": " I think you said it was the tenant GUID?"
      },
      {
        "Time_Start": 2913.12,
        "Time_End": 2916.12,
        "Text": " I think it was the broker client ID, the first one."
      },
      {
        "Time_Start": 2916.12,
        "Time_End": 2917.12,
        "Text": " I see."
      },
      {
        "Time_Start": 2917.12,
        "Time_End": 2918.12,
        "Text": " Okay."
      },
      {
        "Time_Start": 2918.12,
        "Time_End": 2922.12,
        "Text": " So in the V3, it's just like this one thing."
      },
      {
        "Time_Start": 2922.12,
        "Time_End": 2923.12,
        "Text": " Oh."
      },
      {
        "Time_Start": 2923.12,
        "Time_End": 2928.12,
        "Text": " And in PRT V4, but they usually put, like, some client ID or a user ID in there."
      },
      {
        "Time_Start": 2928.12,
        "Time_End": 2929.12,
        "Text": " So I think here it was..."
      },
      {
        "Time_Start": 2929.12,
        "Time_End": 2930.12,
        "Text": " There it was."
      },
      {
        "Time_Start": 2930.12,
        "Time_End": 2931.12,
        "Text": " Two IDs."
      },
      {
        "Time_Start": 2931.12,
        "Time_End": 2932.12,
        "Text": " Yeah."
      },
      {
        "Time_Start": 2932.12,
        "Time_End": 2933.12,
        "Text": " The object ID of the enter object."
      },
      {
        "Time_Start": 2933.12,
        "Time_End": 2934.12,
        "Text": " And then there's a lot of stuff behind it."
      },
      {
        "Time_Start": 2934.12,
        "Time_End": 2935.12,
        "Text": " I think this is the tenant ID."
      },
      {
        "Time_Start": 2935.12,
        "Time_End": 2936.12,
        "Text": " Yeah."
      },
      {
        "Time_Start": 2936.12,
        "Time_End": 2937.12,
        "Text": " And this is basically where it comes from."
      },
      {
        "Time_Start": 2938.12,
        "Time_End": 2944.12,
        "Text": " And the 29 looks like the token broker client ID."
      },
      {
        "Time_Start": 2944.12,
        "Time_End": 2945.12,
        "Text": " Okay."
      },
      {
        "Time_Start": 2945.12,
        "Time_End": 2950.12,
        "Text": " Do you know what rights are necessary to enumerate that name?"
      },
      {
        "Time_Start": 2950.12,
        "Time_End": 2953.12,
        "Text": " Not the content of the secret, but that name."
      },
      {
        "Time_Start": 2953.12,
        "Time_End": 2956.12,
        "Text": " The name in the keychain?"
      },
      {
        "Time_Start": 2956.12,
        "Time_End": 2957.12,
        "Text": " I think..."
      },
      {
        "Time_Start": 2957.12,
        "Time_End": 2958.12,
        "Text": " The rights to enumerate?"
      },
      {
        "Time_Start": 2958.12,
        "Time_End": 2959.12,
        "Text": " It's not there."
      },
      {
        "Time_Start": 2959.12,
        "Time_End": 2965.12,
        "Text": " So you can use Cody, your colleague's tool, and Locksmith, and you can just dump the whole"
      },
      {
        "Time_Start": 2966.12,
        "Time_End": 2971.12,
        "Text": " keychain item list with their entitlements, the generic description, all the stuff apart"
      },
      {
        "Time_Start": 2971.12,
        "Time_End": 2972.12,
        "Text": " from the key material."
      },
      {
        "Time_Start": 2972.12,
        "Time_End": 2975.12,
        "Text": " And that will throw pop-ups."
      },
      {
        "Time_Start": 2975.12,
        "Time_End": 2979.12,
        "Text": " You don't want to do that in a red team, because there's going to be, like, hundreds of pop-ups."
      },
      {
        "Time_Start": 2979.12,
        "Time_End": 2982.12,
        "Text": " But you can enumerate everything."
      },
      {
        "Time_Start": 2982.12,
        "Time_End": 2985.12,
        "Text": " We had some bonus slides, which I can't show now."
      },
      {
        "Time_Start": 2985.12,
        "Time_End": 2990.12,
        "Text": " But there's also some implementations on other Microsoft products that actually have key"
      },
      {
        "Time_Start": 2991.12,
        "Time_End": 2996.12,
        "Text": " material in other parts than the key."
      },
      {
        "Time_Start": 2996.12,
        "Time_End": 2998.12,
        "Text": " Nice capture, huh?"
      },
      {
        "Time_Start": 2998.12,
        "Time_End": 2999.12,
        "Text": " Okay."
      },
      {
        "Time_Start": 2999.12,
        "Time_End": 3001.12,
        "Text": " Thank you for this super interesting talk."
      },
      {
        "Time_Start": 3001.12,
        "Time_End": 3002.12,
        "Text": " I've got two questions."
      },
      {
        "Time_Start": 3002.12,
        "Time_End": 3003.12,
        "Text": " The first is..."
      },
      {
        "Time_Start": 3003.12,
        "Time_End": 3009.12,
        "Text": " If I do condition access control and require a registered device, is PAT version 3, MacFlow,"
      },
      {
        "Time_Start": 3009.12,
        "Time_End": 3014.12,
        "Text": " authentication flow going to work?"
      },
      {
        "Time_Start": 3014.12,
        "Time_End": 3019.12,
        "Text": " So if you require a certain device state, there's still, like, exceptions to that."
      },
      {
        "Time_Start": 3019.12,
        "Time_End": 3023.12,
        "Text": " So we didn't test this with all the different compliancy policies."
      },
      {
        "Time_Start": 3023.12,
        "Time_End": 3029.12,
        "Text": " But in general, there's, like, exclusions to these policies, like, that still allow you"
      },
      {
        "Time_Start": 3029.12,
        "Time_End": 3031.12,
        "Text": " to do the device registration."
      },
      {
        "Time_Start": 3031.12,
        "Time_End": 3035.12,
        "Text": " Because, of course, at device registration, you cannot yet have such a device."
      },
      {
        "Time_Start": 3035.12,
        "Time_End": 3039.12,
        "Text": " But I do believe that if you require, like, a registered or joined device, then the device-less"
      },
      {
        "Time_Start": 3039.12,
        "Time_End": 3041.12,
        "Text": " part is not going to work."
      },
      {
        "Time_Start": 3041.12,
        "Time_End": 3042.12,
        "Text": " Okay."
      },
      {
        "Time_Start": 3042.12,
        "Time_End": 3043.12,
        "Text": " Thank you."
      },
      {
        "Time_Start": 3043.12,
        "Time_End": 3047.12,
        "Text": " And if I don't have bring your own device, can I just prevent my users from registering"
      },
      {
        "Time_Start": 3048.12,
        "Time_End": 3051.12,
        "Text": " any devices at all?"
      },
      {
        "Time_Start": 3051.12,
        "Time_End": 3052.12,
        "Text": " Yes."
      },
      {
        "Time_Start": 3052.12,
        "Time_End": 3056.12,
        "Text": " But many Intune scenarios, also for corporate devices, are also user-driven."
      },
      {
        "Time_Start": 3056.12,
        "Time_End": 3062.12,
        "Text": " So usually you do need to allow a subset of users to register or join."
      },
      {
        "Time_Start": 3062.12,
        "Time_End": 3065.12,
        "Text": " And then you can restrict in Intune which devices can be joined."
      },
      {
        "Time_Start": 3065.12,
        "Time_End": 3068.12,
        "Text": " So then you can, like, only allow certain..."
      },
      {
        "Time_Start": 3068.12,
        "Time_End": 3072.12,
        "Text": " Or only allow corporate devices, which, depending on the platform, might be based on, like,"
      },
      {
        "Time_Start": 3072.12,
        "Time_End": 3078.12,
        "Text": " autopilot or on the serial number or on the state that it gets from, like, the Apple MDM."
      },
      {
        "Time_Start": 3078.12,
        "Time_End": 3082.12,
        "Text": " So sometimes you have to allow people to register or join devices."
      },
      {
        "Time_Start": 3082.12,
        "Time_End": 3084.12,
        "Text": " And then anyone can do this."
      },
      {
        "Time_Start": 3084.12,
        "Time_End": 3088.12,
        "Text": " But then the required compliant device, and the compliancy always comes from Intune, is"
      },
      {
        "Time_Start": 3088.12,
        "Time_End": 3090.12,
        "Text": " what can save you in that case."
      },
      {
        "Time_Start": 3090.12,
        "Time_End": 3094.12,
        "Text": " Because then you also need to prevent people from getting devices into Intune and getting"
      },
      {
        "Time_Start": 3094.12,
        "Time_End": 3095.12,
        "Text": " them compliant."
      },
      {
        "Time_Start": 3095.12,
        "Time_End": 3098.12,
        "Text": " And that is then usually where the attacker is blocked."
      },
      {
        "Time_Start": 3099.12,
        "Time_End": 3102.12,
        "Text": " Because if you don't allow personal devices in Intune..."
      },
      {
        "Time_Start": 3102.12,
        "Time_End": 3103.12,
        "Text": " Except..."
      },
      {
        "Time_Start": 3103.12,
        "Time_End": 3105.12,
        "Text": " Well, maybe some ways to wiggle around that."
      },
      {
        "Time_Start": 3105.12,
        "Time_End": 3109.12,
        "Text": " But most of the cases, that will block the attacker from getting such a rogue device"
      },
      {
        "Time_Start": 3109.12,
        "Time_End": 3110.12,
        "Text": " into Intune."
      },
      {
        "Time_Start": 3118.12,
        "Time_End": 3123.12,
        "Text": " Do you know if the v4 is limited to the platform SSO?"
      },
      {
        "Time_Start": 3123.12,
        "Time_End": 3127.12,
        "Text": " Or will it make its way into the current implementation?"
      },
      {
        "Time_Start": 3128.12,
        "Time_End": 3132.12,
        "Text": " Because if not, you have, like, a huge attack surface."
      },
      {
        "Time_Start": 3132.12,
        "Time_End": 3135.12,
        "Text": " Because the current state is v3, I think."
      },
      {
        "Time_Start": 3135.12,
        "Time_End": 3137.12,
        "Text": " With the SSO extension."
      },
      {
        "Time_Start": 3138.12,
        "Time_End": 3142.12,
        "Text": " Yeah, I don't know if they will backport or that they will upgrade the normal extension"
      },
      {
        "Time_Start": 3142.12,
        "Time_End": 3144.12,
        "Text": " also to v4."
      },
      {
        "Time_Start": 3144.12,
        "Time_End": 3146.12,
        "Text": " It might, but..."
      },
      {
        "Time_Start": 3146.12,
        "Time_End": 3149.12,
        "Text": " I mean, v3 is also used on other platforms, like on Android."
      },
      {
        "Time_Start": 3149.12,
        "Time_End": 3154.12,
        "Text": " And I don't know if Microsoft wants to switch to, like, elliptic curve keys also on Android."
      },
      {
        "Time_Start": 3154.12,
        "Time_End": 3156.12,
        "Text": " I don't even know how easy it is to do that on Android."
      },
      {
        "Time_Start": 3156.12,
        "Time_End": 3161.12,
        "Text": " So it's just because Apple likes EC keys a lot more, apparently."
      },
      {
        "Time_Start": 3161.12,
        "Time_End": 3165.12,
        "Text": " That they use this in their platform SSO implementation with a secure enclave."
      },
      {
        "Time_Start": 3165.12,
        "Time_End": 3168.12,
        "Text": " But I don't know if Microsoft wants to go that same way."
      },
      {
        "Time_Start": 3168.12,
        "Time_End": 3170.12,
        "Text": " And if this..."
      },
      {
        "Time_Start": 3170.12,
        "Time_End": 3175.12,
        "Text": " I also don't know if this peer-to-peer v4 was just a way to wiggle around the Apple requirements."
      },
      {
        "Time_Start": 3175.12,
        "Time_End": 3179.12,
        "Text": " Or if they actually thought, like, okay, elliptic curve with Diffie-Hellman key exchange"
      },
      {
        "Time_Start": 3179.12,
        "Time_End": 3182.12,
        "Text": " and binding it to the device instead of the session key"
      },
      {
        "Time_Start": 3182.12,
        "Time_End": 3184.12,
        "Text": " is the way that we want to have for our product."
      },
      {
        "Time_Start": 3184.12,
        "Time_End": 3186.12,
        "Text": " So I don't know."
      },
      {
        "Time_Start": 3186.12,
        "Time_End": 3188.12,
        "Text": " Okay. And last question."
      },
      {
        "Time_Start": 3188.12,
        "Time_End": 3192.12,
        "Text": " You said the PRTs are valid 90 days."
      },
      {
        "Time_Start": 3192.12,
        "Time_End": 3195.12,
        "Text": " And the fastest way to revoke is disable the user?"
      },
      {
        "Time_Start": 3195.12,
        "Time_End": 3197.12,
        "Text": " No, so there's this..."
      },
      {
        "Time_Start": 3197.12,
        "Time_End": 3200.12,
        "Text": " So if you disable the user, then they cannot use the PRT."
      },
      {
        "Time_Start": 3200.12,
        "Time_End": 3203.12,
        "Text": " But if you then enable them again, they can still use it again."
      },
      {
        "Time_Start": 3203.12,
        "Time_End": 3206.12,
        "Text": " So the best way is to revoke tokens."
      },
      {
        "Time_Start": 3206.12,
        "Time_End": 3209.12,
        "Text": " So it's like the block you have in the portal or the..."
      },
      {
        "Time_Start": 3209.12,
        "Time_End": 3211.12,
        "Text": " There's also PowerShell command for it."
      },
      {
        "Time_Start": 3211.12,
        "Time_End": 3214.12,
        "Text": " And that will revoke all refresh tokens, all primary refresh tokens."
      },
      {
        "Time_Start": 3214.12,
        "Time_End": 3218.12,
        "Text": " And then they only have, like, the access tokens left, which you cannot revoke."
      },
      {
        "Time_Start": 3218.12,
        "Time_End": 3221.12,
        "Text": " Unless they're, like, continuous access evaluation access tokens."
      },
      {
        "Time_Start": 3221.12,
        "Time_End": 3223.12,
        "Text": " Okay. Thank you."
      },
      {
        "Time_Start": 3226.12,
        "Time_End": 3228.12,
        "Text": " More questions?"
      },
      {
        "Time_Start": 3233.12,
        "Time_End": 3234.12,
        "Text": " Thanks."
      },
      {
        "Time_Start": 3234.12,
        "Time_End": 3238.12,
        "Text": " I just wonder whether you've seen any key attestation"
      },
      {
        "Time_Start": 3238.12,
        "Time_End": 3241.12,
        "Text": " or application attestation being done."
      },
      {
        "Time_Start": 3241.12,
        "Time_End": 3246.12,
        "Text": " Probably not, if you were able to implement the version 4 protocol by yourselves."
      },
      {
        "Time_Start": 3246.12,
        "Time_End": 3250.12,
        "Text": " But it's something I would have expected, honestly."
      },
      {
        "Time_Start": 3251.12,
        "Time_End": 3254.12,
        "Text": " So I think in the device registration flow,"
      },
      {
        "Time_Start": 3254.12,
        "Time_End": 3259.12,
        "Text": " there is, like, the AIK fields, at least on PRT v3."
      },
      {
        "Time_Start": 3259.12,
        "Time_End": 3261.12,
        "Text": " But they're empty."
      },
      {
        "Time_Start": 3261.12,
        "Time_End": 3265.12,
        "Text": " The only way that Microsoft currently does, like, attestation is via Intune."
      },
      {
        "Time_Start": 3265.12,
        "Time_End": 3268.12,
        "Text": " And there it's also very limited."
      },
      {
        "Time_Start": 3268.12,
        "Time_End": 3270.12,
        "Text": " And they're just adding right now."
      },
      {
        "Time_Start": 3270.12,
        "Time_End": 3273.12,
        "Text": " I believe it went, like, in preview last week or something."
      },
      {
        "Time_Start": 3273.12,
        "Time_End": 3277.12,
        "Text": " That you can actually require TPM attestation at enrollment."
      },
      {
        "Time_Start": 3277.12,
        "Time_End": 3279.12,
        "Text": " But it's only Intune. It's not..."
      },
      {
        "Time_Start": 3279.12,
        "Time_End": 3281.12,
        "Text": " Android doesn't do anything with attestation."
      },
      {
        "Time_Start": 3281.12,
        "Time_End": 3284.12,
        "Text": " Like, you cannot even differentiate and let you know,"
      },
      {
        "Time_Start": 3284.12,
        "Time_End": 3287.12,
        "Text": " do some real hacking between a PRT that's actually in the TPM"
      },
      {
        "Time_Start": 3287.12,
        "Time_End": 3289.12,
        "Text": " versus one that's software only."
      },
      {
        "Time_Start": 3289.12,
        "Time_End": 3290.12,
        "Text": " Okay. Thanks."
      },
      {
        "Time_Start": 3295.12,
        "Time_End": 3296.12,
        "Text": " No more..."
      },
      {
        "Time_Start": 3300.12,
        "Time_End": 3301.12,
        "Text": " Okay."
      },
      {
        "Time_Start": 3302.12,
        "Time_End": 3304.12,
        "Text": " So we are done with this talk."
      },
      {
        "Time_Start": 3306.12,
        "Time_End": 3307.12,
        "Text": " Heinrich?"
      },
      {
        "Time_Start": 3312.12,
        "Time_End": 3313.12,
        "Text": " Thank you very much."
      },
      {
        "Time_Start": 3320.12,
        "Time_End": 3323.12,
        "Text": " Microsoft Mechanics www.microsoft.com"
      },
      {
        "Time_Start": 3323.12,
        "Time_End": 3326.12,
        "Text": " www.microsoft.com"
      }
    ]
  }
}