{
  "metadata": {
    "webpage_url": "https://www.youtube.com/watch?v=2s6l0IkK52E",
    "title": "TROOPERS24: Analyzing and Executing ADCS Attack Paths with BloodHound",
    "description": "Talk by Andy Robbins, Jonas B\u00fclow Knudsen - June 26th, 2024 at TROOPERS24 IT security conference in Heidelberg, Germany hosted by @ERNW_ITSec\n\n#TROOPERS24 #ITsecurity \nhttps://troopers.de/troopers24/talks/kzymd8/\n\nMore impressions:\nhttps://twitter.com/WEareTROOPERS\nhttps://twitter.com/ERNW_ITSec\nhttps://infosec.exchange/@WEareTROOPERS\nhttps://infosec.exchange/@ERNW https://ernw.de",
    "channel_url": "https://www.youtube.com/channel/UCPY5aUREHmbDO4PtR6AYLfQ",
    "duration": 4133,
    "channel": "TROOPERS IT Security Conference",
    "uploader": "TROOPERS IT Security Conference",
    "upload_date": "20240902"
  },
  "segments": {
    "metadata": {
      "webpage_url": "https://www.youtube.com/watch?v=2s6l0IkK52E",
      "title": "TROOPERS24: Analyzing and Executing ADCS Attack Paths with BloodHound",
      "description": "Talk by Andy Robbins, Jonas B\u00fclow Knudsen - June 26th, 2024 at TROOPERS24 IT security conference in Heidelberg, Germany hosted by @ERNW_ITSec\n\n#TROOPERS24 #ITsecurity \nhttps://troopers.de/troopers24/talks/kzymd8/\n\nMore impressions:\nhttps://twitter.com/WEareTROOPERS\nhttps://twitter.com/ERNW_ITSec\nhttps://infosec.exchange/@WEareTROOPERS\nhttps://infosec.exchange/@ERNW https://ernw.de",
      "channel_url": "https://www.youtube.com/channel/UCPY5aUREHmbDO4PtR6AYLfQ",
      "duration": 4133,
      "channel": "TROOPERS IT Security Conference",
      "uploader": "TROOPERS IT Security Conference",
      "upload_date": "20240902"
    },
    "segments": [
      {
        "Time_Start": 0.0,
        "Time_End": 25.0,
        "Text": "This text was transcribed using whisper model: large-v2\n\n It's 5.53, I think we have maybe a little less than an hour to get through our content,"
      },
      {
        "Time_Start": 25.0,
        "Time_End": 28.92,
        "Text": " but I understand that we are keeping you from more beer."
      },
      {
        "Time_Start": 28.92,
        "Time_End": 36.480000000000004,
        "Text": " So we will make progress."
      },
      {
        "Time_Start": 36.480000000000004,
        "Time_End": 48.2,
        "Text": " So this presentation has a lot of links, it has a lot of small text, it has a lot of references."
      },
      {
        "Time_Start": 48.2,
        "Time_End": 52.6,
        "Text": " So I recommend taking a picture of this so that you don't have to wait for the deck to"
      },
      {
        "Time_Start": 52.6,
        "Time_End": 56.760000000000005,
        "Text": " be available by the conference organizers."
      },
      {
        "Time_Start": 56.76,
        "Time_End": 60.599999999999994,
        "Text": " This link will take you directly to the deck, so if you would like to follow along now,"
      },
      {
        "Time_Start": 60.599999999999994,
        "Time_End": 64.67999999999999,
        "Text": " you can, or if you just want to check it out later on your own time, you can as well."
      },
      {
        "Time_Start": 64.67999999999999,
        "Time_End": 70.84,
        "Text": " So we'll give just a couple more seconds to let people take a picture of that."
      },
      {
        "Time_Start": 70.84,
        "Time_End": 74.28,
        "Text": " Perfect."
      },
      {
        "Time_Start": 74.28,
        "Time_End": 77.36,
        "Text": " Okay."
      },
      {
        "Time_Start": 77.36,
        "Time_End": 82.84,
        "Text": " So, this is who we are."
      },
      {
        "Time_Start": 82.84,
        "Time_End": 87.8,
        "Text": " I think one thing I'm disappointed by is that there are no, there aren't more PowerShell"
      },
      {
        "Time_Start": 87.8,
        "Time_End": 93.56,
        "Text": " jokes in the presentations, but maybe PowerShell is falling a little bit out of favor."
      },
      {
        "Time_Start": 93.56,
        "Time_End": 95.12,
        "Text": " But I'll introduce myself first."
      },
      {
        "Time_Start": 95.12,
        "Time_End": 96.48,
        "Text": " My name is Andy Robbins."
      },
      {
        "Time_Start": 96.48,
        "Time_End": 99.4,
        "Text": " My title is I'm principal product architect at Spector Ops."
      },
      {
        "Time_Start": 99.4,
        "Time_End": 105.84,
        "Text": " I'm one of the co-creators of Bloodhound, along with Will Schroeder and Rohan Vazirkar."
      },
      {
        "Time_Start": 105.84,
        "Time_End": 110.60000000000001,
        "Text": " That's my handle on Twitter is underscore Waldo with a zero."
      },
      {
        "Time_Start": 110.60000000000001,
        "Time_End": 115.80000000000001,
        "Text": " My name is Jonas, and I work as a product architect at Spector Ops, so, yeah, I try"
      },
      {
        "Time_Start": 115.80000000000001,
        "Time_End": 123.66000000000001,
        "Text": " to help out Andy with introducing new attack paths into Bloodhound, and, yeah, trying to"
      },
      {
        "Time_Start": 123.66000000000001,
        "Time_End": 130.60000000000002,
        "Text": " make it easier for defenders as well to identify, yeah, risks in Active Directory and Azure."
      },
      {
        "Time_Start": 130.60000000000002,
        "Time_End": 133.56,
        "Text": " Yeah."
      },
      {
        "Time_Start": 133.56,
        "Time_End": 134.56,
        "Text": " Here's our agenda."
      },
      {
        "Time_Start": 134.56,
        "Time_End": 139.16000000000003,
        "Text": " So, first, we're going to talk about ADCS attack path identification analysis and execution"
      },
      {
        "Time_Start": 139.56,
        "Time_End": 140.56,
        "Text": " using Bloodhound."
      },
      {
        "Time_Start": 140.56,
        "Time_End": 147.07999999999998,
        "Text": " And along the way, we will explain how some of those attack primitives emerge and how"
      },
      {
        "Time_Start": 147.07999999999998,
        "Time_End": 150.51999999999998,
        "Text": " an attacker can execute them."
      },
      {
        "Time_Start": 150.51999999999998,
        "Time_End": 157.76,
        "Text": " And then I'll talk about visualizing and auditing the ADCS LDAP hierarchy and the PKI hierarchy"
      },
      {
        "Time_Start": 157.76,
        "Time_End": 165.24,
        "Text": " and going beyond what the tool does for you, but kind of relying on some of the basic functionality"
      },
      {
        "Time_Start": 165.24,
        "Time_End": 171.0,
        "Text": " the tool does as far as visualizing group memberships and things like this to go deeper"
      },
      {
        "Time_Start": 171.0,
        "Time_End": 175.32000000000002,
        "Text": " into auditing than what the tool does for you out of the box."
      },
      {
        "Time_Start": 175.32000000000002,
        "Time_End": 181.36,
        "Text": " And finally, Jonas will share with you some practical remediation strategies and examples"
      },
      {
        "Time_Start": 181.36,
        "Time_End": 187.60000000000002,
        "Text": " based on how we are trying to help our customers mitigate and manage these risks in the real"
      },
      {
        "Time_Start": 187.60000000000002,
        "Time_End": 189.12,
        "Text": " world."
      },
      {
        "Time_Start": 189.12,
        "Time_End": 191.04000000000002,
        "Text": " Okay."
      },
      {
        "Time_Start": 191.04000000000002,
        "Time_End": 192.04000000000002,
        "Text": " Escalation one."
      },
      {
        "Time_Start": 192.28,
        "Time_End": 196.51999999999998,
        "Text": " So before we get into escalation one, here's what I want to do."
      },
      {
        "Time_Start": 196.51999999999998,
        "Time_End": 199.48,
        "Text": " It's 5.56, so I want everybody to stand up."
      },
      {
        "Time_Start": 199.48,
        "Time_End": 206.04,
        "Text": " Because I feel like we all might be kind of like in a food coma or maybe club mate coma"
      },
      {
        "Time_Start": 206.04,
        "Time_End": 207.95999999999998,
        "Text": " or some other kind of coma."
      },
      {
        "Time_Start": 207.95999999999998,
        "Time_End": 210.2,
        "Text": " So stretch a little bit."
      },
      {
        "Time_Start": 210.2,
        "Time_End": 213.6,
        "Text": " Help your neighbor stretch."
      },
      {
        "Time_Start": 213.6,
        "Time_End": 214.6,
        "Text": " Ask permission first."
      },
      {
        "Time_Start": 214.6,
        "Time_End": 215.6,
        "Text": " Okay."
      },
      {
        "Time_Start": 215.6,
        "Time_End": 216.6,
        "Text": " Is that better?"
      },
      {
        "Time_Start": 216.6,
        "Time_End": 217.6,
        "Text": " Is that good?"
      },
      {
        "Time_Start": 217.6,
        "Time_End": 218.6,
        "Text": " Okay."
      },
      {
        "Time_Start": 218.6,
        "Time_End": 219.6,
        "Text": " All right."
      },
      {
        "Time_Start": 219.6,
        "Time_End": 220.6,
        "Text": " Go ahead and sit down."
      },
      {
        "Time_Start": 220.6,
        "Time_End": 221.6,
        "Text": " Yeah."
      },
      {
        "Time_Start": 222.16,
        "Time_End": 223.16,
        "Text": " Great."
      },
      {
        "Time_Start": 223.16,
        "Time_End": 224.16,
        "Text": " Thank you."
      },
      {
        "Time_Start": 224.16,
        "Time_End": 225.16,
        "Text": " Okay."
      },
      {
        "Time_Start": 225.16,
        "Time_End": 228.76,
        "Text": " So who knows what escalation one is?"
      },
      {
        "Time_Start": 228.76,
        "Time_End": 229.76,
        "Text": " Okay."
      },
      {
        "Time_Start": 229.76,
        "Time_End": 230.76,
        "Text": " Okay."
      },
      {
        "Time_Start": 230.76,
        "Time_End": 238.68,
        "Text": " So we've got some refreshers and some people to tell about this for the first time."
      },
      {
        "Time_Start": 238.68,
        "Time_End": 243.78,
        "Text": " Our colleagues, Will Schroeder and Lee Chigola-Christensen, they put out a white paper several years ago"
      },
      {
        "Time_Start": 243.78,
        "Time_End": 245.68,
        "Text": " called certified preowned."
      },
      {
        "Time_Start": 245.68,
        "Time_End": 248.28,
        "Text": " I think it's the best pun of all time."
      },
      {
        "Time_Start": 248.28,
        "Time_End": 253.24,
        "Text": " But by a show of hands, who is familiar with that kind of seminal research and documentation?"
      },
      {
        "Time_Start": 253.24,
        "Time_End": 254.24,
        "Text": " Okay."
      },
      {
        "Time_Start": 254.24,
        "Time_End": 257.2,
        "Text": " So we've got a good mix here."
      },
      {
        "Time_Start": 257.2,
        "Time_End": 264.28,
        "Text": " So escalation one is an abuse primitive that allows a principle in Active Directory to"
      },
      {
        "Time_Start": 264.28,
        "Time_End": 269.36,
        "Text": " impersonate any other principle in Active Directory."
      },
      {
        "Time_Start": 269.36,
        "Time_End": 274.06,
        "Text": " And without getting into talking about enrollment agent restrictions, there is no protection"
      },
      {
        "Time_Start": 274.06,
        "Time_End": 275.16,
        "Text": " against this."
      },
      {
        "Time_Start": 275.16,
        "Time_End": 278.86,
        "Text": " So this is just as powerful as, like, DC sync."
      },
      {
        "Time_Start": 278.86,
        "Time_End": 282.64000000000004,
        "Text": " It's just as powerful as being, like, domain admin."
      },
      {
        "Time_Start": 282.64000000000004,
        "Time_End": 284.96000000000004,
        "Text": " Escalation one works like this."
      },
      {
        "Time_Start": 284.96000000000004,
        "Time_End": 287.46000000000004,
        "Text": " So we have Alice and Bob."
      },
      {
        "Time_Start": 287.46000000000004,
        "Time_End": 290.6,
        "Text": " We have a cert template."
      },
      {
        "Time_Start": 290.6,
        "Time_End": 296.40000000000003,
        "Text": " And enterprise CA, which could also be called an enrollment service."
      },
      {
        "Time_Start": 296.40000000000003,
        "Time_End": 298.44000000000005,
        "Text": " And a domain controller."
      },
      {
        "Time_Start": 298.44000000000005,
        "Time_End": 303.44000000000005,
        "Text": " So Alice has the ability to do escalation one."
      },
      {
        "Time_Start": 303.44,
        "Time_End": 310.56,
        "Text": " The way that she would do this is she asks the enterprise CA to issue a certificate back"
      },
      {
        "Time_Start": 310.56,
        "Time_End": 317.4,
        "Text": " that is valid for authentication, where a particular field in the certificate called"
      },
      {
        "Time_Start": 317.4,
        "Time_End": 323.92,
        "Text": " subject alternative name will be populated by the user principle name of some other user."
      },
      {
        "Time_Start": 323.92,
        "Time_End": 326.46,
        "Text": " So maybe Bob is a domain admin."
      },
      {
        "Time_Start": 326.46,
        "Time_End": 332.44,
        "Text": " And so we can say my SAN is Bob at Contoso.local."
      },
      {
        "Time_Start": 332.44,
        "Time_End": 340.71999999999997,
        "Text": " The security reference monitor on the host that hosts the CA service will check several"
      },
      {
        "Time_Start": 340.71999999999997,
        "Time_End": 345.8,
        "Text": " different security descriptors to see whether Alice can do this."
      },
      {
        "Time_Start": 345.8,
        "Time_End": 351.92,
        "Text": " And then if the user Alice can do that, the CA will issue back this certificate valid"
      },
      {
        "Time_Start": 351.92,
        "Time_End": 354.6,
        "Text": " for authentication back to Alice."
      },
      {
        "Time_Start": 354.6,
        "Time_End": 359.44,
        "Text": " Critically, this certificate that comes back, it needs to have an EKU that is valid for"
      },
      {
        "Time_Start": 359.44,
        "Time_End": 361.2,
        "Text": " NT authentication."
      },
      {
        "Time_Start": 361.2,
        "Time_End": 364.47999999999996,
        "Text": " There are several of those that are valid."
      },
      {
        "Time_Start": 364.47999999999996,
        "Time_End": 368.4,
        "Text": " One example is client authentication."
      },
      {
        "Time_Start": 368.4,
        "Time_End": 374.96,
        "Text": " Then with that certificate, Alice will then present that to the domain controller and"
      },
      {
        "Time_Start": 374.96,
        "Time_End": 379.96,
        "Text": " say, I want a TGT as Bob."
      },
      {
        "Time_Start": 379.96,
        "Time_End": 387.14,
        "Text": " And this certificate serves as my credential, as my proof that I am allowed to authenticate"
      },
      {
        "Time_Start": 387.14,
        "Time_End": 390.65999999999997,
        "Text": " in the domain as Bob."
      },
      {
        "Time_Start": 390.65999999999997,
        "Time_End": 393.18,
        "Text": " Yeah."
      },
      {
        "Time_Start": 393.18,
        "Time_End": 399.58,
        "Text": " So at that point, then the domain controller will return a TGT, which then can be used"
      },
      {
        "Time_Start": 399.58,
        "Time_End": 406.41999999999996,
        "Text": " to get TGSs, and Alice effectively has become Bob and is impersonating Bob in the domain."
      },
      {
        "Time_Start": 406.41999999999996,
        "Time_End": 414.06,
        "Text": " This is an extraordinarily reliable and effective and common privilege escalation primitive"
      },
      {
        "Time_Start": 414.06,
        "Time_End": 421.94,
        "Text": " in every Active Directory environment, like 98% of them probably."
      },
      {
        "Time_Start": 421.94,
        "Time_End": 425.82,
        "Text": " But finding it by hand can be tricky."
      },
      {
        "Time_Start": 425.82,
        "Time_End": 426.82,
        "Text": " It can be very labor-intensive."
      },
      {
        "Time_Start": 426.82,
        "Time_End": 428.9,
        "Text": " It can be confusing."
      },
      {
        "Time_Start": 428.9,
        "Time_End": 430.92,
        "Text": " It can be error-prone."
      },
      {
        "Time_Start": 430.92,
        "Time_End": 436.96,
        "Text": " You could wind up leaving findings on the table just because the number of configurations"
      },
      {
        "Time_Start": 436.96000000000004,
        "Time_End": 444.24,
        "Text": " and the number of security descriptors that you have to analyze in order to determine"
      },
      {
        "Time_Start": 444.24,
        "Time_End": 447.12000000000006,
        "Text": " who can do escalation one."
      },
      {
        "Time_Start": 447.12000000000006,
        "Time_End": 448.12000000000006,
        "Text": " It's a lot."
      },
      {
        "Time_Start": 448.12000000000006,
        "Time_End": 451.84000000000003,
        "Text": " Anybody who's done that by hand knows how difficult it is to actually identify these"
      },
      {
        "Time_Start": 451.84000000000003,
        "Time_End": 453.8,
        "Text": " things manually."
      },
      {
        "Time_Start": 453.8,
        "Time_End": 461.52000000000004,
        "Text": " If only there was a piece of software that could do that for us."
      },
      {
        "Time_Start": 461.52,
        "Time_End": 469.24,
        "Text": " So we have a video demo here where we are using Bloodhound to find a path."
      },
      {
        "Time_Start": 469.24,
        "Time_End": 476.79999999999995,
        "Text": " And so we are starting from the Garcia in escalation one user, and we want to become"
      },
      {
        "Time_Start": 476.79999999999995,
        "Time_End": 477.79999999999995,
        "Text": " domain admins."
      },
      {
        "Time_Start": 477.79999999999995,
        "Time_End": 483.08,
        "Text": " So we path find from Garcia to domain admins."
      },
      {
        "Time_Start": 483.08,
        "Time_End": 486.56,
        "Text": " This attack path, you can see it starts at Garcia."
      },
      {
        "Time_Start": 486.56,
        "Time_End": 491.64,
        "Text": " It goes via this edge called ADCS escalation one."
      },
      {
        "Time_Start": 491.64,
        "Time_End": 495.84,
        "Text": " And that edge is directed at the domain head."
      },
      {
        "Time_Start": 495.84,
        "Time_End": 500.32,
        "Text": " Why do you think it's directed at the domain head?"
      },
      {
        "Time_Start": 500.32,
        "Time_End": 504.44,
        "Text": " It's the same reason why DC sync is directed at the domain head."
      },
      {
        "Time_Start": 504.44,
        "Time_End": 508.44,
        "Text": " It's because every principle descends down from this object."
      },
      {
        "Time_Start": 508.44,
        "Time_End": 513.52,
        "Text": " So if we control the domain head, and we're doing like Dijkstra's algorithm or A star,"
      },
      {
        "Time_Start": 513.52,
        "Time_End": 519.64,
        "Text": " same kind of depth first search, traversing this node, we are guaranteed to traverse to"
      },
      {
        "Time_Start": 519.64,
        "Time_End": 523.76,
        "Text": " every other principle under that domain."
      },
      {
        "Time_Start": 523.76,
        "Time_End": 528.56,
        "Text": " Not only that, but we can also traverse across domain trust edges as well, and we'll talk"
      },
      {
        "Time_Start": 528.56,
        "Time_End": 531.36,
        "Text": " more about that later."
      },
      {
        "Time_Start": 531.36,
        "Time_End": 536.12,
        "Text": " So that edge is basically telling us Garcia can do escalation one against the domain and"
      },
      {
        "Time_Start": 536.12,
        "Time_End": 541.68,
        "Text": " become whatever principle they want to become."
      },
      {
        "Time_Start": 541.84,
        "Time_End": 548.6400000000001,
        "Text": " Now, if you're on the red team side, you are then going to need to understand what is the"
      },
      {
        "Time_Start": 548.6400000000001,
        "Time_End": 553.1200000000001,
        "Text": " template that I'm going to enroll into, what is the CA that I'm going to target."
      },
      {
        "Time_Start": 553.1200000000001,
        "Time_End": 558.1,
        "Text": " So just knowing that Garcia can do escalation one is not enough as a red team operator."
      },
      {
        "Time_Start": 558.1,
        "Time_End": 560.5600000000001,
        "Text": " It's also not enough for a defender."
      },
      {
        "Time_Start": 560.5600000000001,
        "Time_End": 565.6,
        "Text": " So we have this new feature in Bloodhound called composition."
      },
      {
        "Time_Start": 565.6,
        "Time_End": 570.24,
        "Text": " So there's a lot that goes into creating this edge."
      },
      {
        "Time_Start": 570.4,
        "Time_End": 574.12,
        "Text": " If you want to know exactly how that works, look at our presentation from ZeefCon two"
      },
      {
        "Time_Start": 574.12,
        "Time_End": 580.16,
        "Text": " weeks ago, where we go into the internals of the data model and how the data model is"
      },
      {
        "Time_Start": 580.16,
        "Time_End": 584.92,
        "Text": " used to create these post-processed edges like this."
      },
      {
        "Time_Start": 584.92,
        "Time_End": 588.4,
        "Text": " So it's done all the calculation for the user to determine that Garcia can do escalation"
      },
      {
        "Time_Start": 588.4,
        "Time_End": 591.24,
        "Text": " one."
      },
      {
        "Time_Start": 591.24,
        "Time_End": 597.48,
        "Text": " To find out how to see what has gone into the creation of that edge, we can click on"
      },
      {
        "Time_Start": 597.48,
        "Time_End": 599.96,
        "Text": " this composition accordion item."
      },
      {
        "Time_Start": 600.6800000000001,
        "Time_End": 606.32,
        "Text": " And that will unfurl everything that has gone into creating that edge."
      },
      {
        "Time_Start": 606.32,
        "Time_End": 611.1600000000001,
        "Text": " So we click on composition, and then we'll rearrange things here a little bit to make"
      },
      {
        "Time_Start": 611.1600000000001,
        "Time_End": 613.6800000000001,
        "Text": " it a little more legible."
      },
      {
        "Time_Start": 613.6800000000001,
        "Time_End": 615.44,
        "Text": " And this is our answer."
      },
      {
        "Time_Start": 615.44,
        "Time_End": 621.12,
        "Text": " So Garcia is a member of this group, group one, that has the enroll ace against two different"
      },
      {
        "Time_Start": 621.12,
        "Time_End": 624.2,
        "Text": " cert templates."
      },
      {
        "Time_Start": 624.2,
        "Time_End": 631.88,
        "Text": " The user also has enroll rights against the enterprise CA to which these templates have"
      },
      {
        "Time_Start": 631.88,
        "Time_End": 634.72,
        "Text": " been published."
      },
      {
        "Time_Start": 634.72,
        "Time_End": 639.9200000000001,
        "Text": " So the user needs enroll rights on both the template and the CA."
      },
      {
        "Time_Start": 639.9200000000001,
        "Time_End": 642.6,
        "Text": " Just one is not enough."
      },
      {
        "Time_Start": 642.6,
        "Time_End": 649.0400000000001,
        "Text": " This CA is the enterprise CA for a root CA for the domain, which is a root CA for the"
      },
      {
        "Time_Start": 649.0400000000001,
        "Time_End": 650.0400000000001,
        "Text": " domain."
      },
      {
        "Time_Start": 650.16,
        "Time_End": 655.68,
        "Text": " The CA is also trusted for NT authentication against the domain."
      },
      {
        "Time_Start": 655.68,
        "Time_End": 661.24,
        "Text": " So all of that combined, plus certain properties about these templates, certain properties"
      },
      {
        "Time_Start": 661.24,
        "Time_End": 666.48,
        "Text": " about this object, and for other things, certain properties about the host hosting the CA service,"
      },
      {
        "Time_Start": 666.48,
        "Time_End": 671.9599999999999,
        "Text": " which Jonas will talk about, have all gone into answering the question, how does Garcia"
      },
      {
        "Time_Start": 671.9599999999999,
        "Time_End": 674.5999999999999,
        "Text": " have the ability to do escalation one?"
      },
      {
        "Time_Start": 674.6,
        "Time_End": 680.84,
        "Text": " There's your answer right there."
      },
      {
        "Time_Start": 680.84,
        "Time_End": 687.08,
        "Text": " So first, we will demonstrate that we are not domain admin by trying to enumerate the"
      },
      {
        "Time_Start": 687.08,
        "Time_End": 689.48,
        "Text": " C dollar share on the domain controller."
      },
      {
        "Time_Start": 689.48,
        "Time_End": 691.36,
        "Text": " We get access is denied."
      },
      {
        "Time_Start": 691.36,
        "Time_End": 698.0400000000001,
        "Text": " Then we will use CertiPy to enroll in that particular certificate, and we're specifying"
      },
      {
        "Time_Start": 698.04,
        "Time_End": 705.64,
        "Text": " the researcher at escalation one as our SAN, and that researcher is a domain admin user."
      },
      {
        "Time_Start": 705.64,
        "Time_End": 716.0799999999999,
        "Text": " And then we will use CertiPy again to retrieve the NTLM hash for that user, and at that point,"
      },
      {
        "Time_Start": 716.0799999999999,
        "Time_End": 720.0,
        "Text": " the NTLM hash is just as good as a clear text password."
      },
      {
        "Time_Start": 720.0,
        "Time_End": 721.66,
        "Text": " There's a lot of nodding heads."
      },
      {
        "Time_Start": 721.66,
        "Time_End": 725.88,
        "Text": " If you're not sure exactly why that is, I'd be happy to explain it, but I'll do that after"
      },
      {
        "Time_Start": 725.88,
        "Time_End": 727.64,
        "Text": " the talk is over."
      },
      {
        "Time_Start": 727.64,
        "Time_End": 732.28,
        "Text": " But the NTLM hash is just as good as the clear text password."
      },
      {
        "Time_Start": 732.28,
        "Time_End": 734.28,
        "Text": " Okay."
      },
      {
        "Time_Start": 734.28,
        "Time_End": 736.28,
        "Text": " Yeah."
      },
      {
        "Time_Start": 736.28,
        "Time_End": 739.84,
        "Text": " So that was escalation one."
      },
      {
        "Time_Start": 739.84,
        "Time_End": 742.76,
        "Text": " Now we're going to talk about escalation three."
      },
      {
        "Time_Start": 742.76,
        "Time_End": 747.4399999999999,
        "Text": " And escalation three is the abuse of enrollment agent permissions."
      },
      {
        "Time_Start": 747.4399999999999,
        "Time_End": 749.64,
        "Text": " So we can have Alice and Bob here."
      },
      {
        "Time_Start": 749.64,
        "Time_End": 752.52,
        "Text": " We now have two different certificate templates."
      },
      {
        "Time_Start": 752.52,
        "Time_End": 757.2,
        "Text": " We have an enrollment agent certificate template and the user template."
      },
      {
        "Time_Start": 757.2,
        "Time_End": 760.32,
        "Text": " And they're both published on the Enterprise CA."
      },
      {
        "Time_Start": 760.32,
        "Time_End": 767.2,
        "Text": " Now Alice wants to become an enrollment agent, and she does that by requesting this certificate"
      },
      {
        "Time_Start": 767.2,
        "Time_End": 771.5200000000001,
        "Text": " of the enrollment agent certificate template."
      },
      {
        "Time_Start": 771.5200000000001,
        "Time_End": 776.5200000000001,
        "Text": " Assuming that Alice has the enrollment rights to do so, she will receive this certificate"
      },
      {
        "Time_Start": 776.5200000000001,
        "Time_End": 777.6400000000001,
        "Text": " here."
      },
      {
        "Time_Start": 777.6400000000001,
        "Time_End": 783.2800000000001,
        "Text": " What's special about an enrollment agent certificate is that it has this EQU called certificate"
      },
      {
        "Time_Start": 783.2800000000001,
        "Time_End": 785.08,
        "Text": " request agent."
      },
      {
        "Time_Start": 785.08,
        "Time_End": 789.4000000000001,
        "Text": " And that is essentially what makes you an enrollment agent."
      },
      {
        "Time_Start": 789.4000000000001,
        "Time_End": 794.48,
        "Text": " What an enrollment agent can do is to enroll on behalf of other principals."
      },
      {
        "Time_Start": 794.48,
        "Time_End": 801.0400000000001,
        "Text": " So next thing Alice will do is to request a certificate on behalf of Bob in the user"
      },
      {
        "Time_Start": 801.0400000000001,
        "Time_End": 802.64,
        "Text": " template."
      },
      {
        "Time_Start": 802.64,
        "Time_End": 808.72,
        "Text": " And she will present her enrollment agent certificate in order to prove that she is"
      },
      {
        "Time_Start": 808.72,
        "Time_End": 811.4000000000001,
        "Text": " an enrollment agent."
      },
      {
        "Time_Start": 811.4,
        "Time_End": 817.28,
        "Text": " And then she gets a certificate as Bob, just as before we saw with escalation one."
      },
      {
        "Time_Start": 817.28,
        "Time_End": 823.64,
        "Text": " And from there we can again get a Kerberos ticket as Bob, but we have now impersonated"
      },
      {
        "Time_Start": 823.64,
        "Time_End": 827.9599999999999,
        "Text": " Bob in a different way."
      },
      {
        "Time_Start": 827.9599999999999,
        "Time_End": 829.8,
        "Text": " So what is an enrollment agent?"
      },
      {
        "Time_Start": 829.8,
        "Time_End": 837.28,
        "Text": " It is a principal that has this certificate here with this enrollment agent EQU."
      },
      {
        "Time_Start": 837.28,
        "Time_End": 840.64,
        "Text": " And what they can do is to enroll on behalf of other principals."
      },
      {
        "Time_Start": 840.88,
        "Time_End": 845.1999999999999,
        "Text": " There are some restrictions for the templates that you enroll in."
      },
      {
        "Time_Start": 845.1999999999999,
        "Time_End": 850.16,
        "Text": " You can enroll in all templates of schema version one."
      },
      {
        "Time_Start": 850.16,
        "Time_End": 856.76,
        "Text": " For schema version two or higher, then it's required that the template specify the certificate"
      },
      {
        "Time_Start": 856.76,
        "Time_End": 860.92,
        "Text": " request agent EQU in the certificate template."
      },
      {
        "Time_Start": 860.92,
        "Time_End": 867.76,
        "Text": " And this is what it looks like if you check Active Directory for that requirement."
      },
      {
        "Time_Start": 867.76,
        "Time_End": 869.64,
        "Text": " There's a few more details to it."
      },
      {
        "Time_Start": 869.64,
        "Time_End": 876.2,
        "Text": " And you can read about those in the link provided here."
      },
      {
        "Time_Start": 876.2,
        "Time_End": 882.48,
        "Text": " So in Budhound what we do is we create this new edge here from the enrollment agent certificate"
      },
      {
        "Time_Start": 882.48,
        "Time_End": 889.0,
        "Text": " templates towards the targeted templates that allows for enrollment agents to enroll on"
      },
      {
        "Time_Start": 889.0,
        "Time_End": 890.84,
        "Text": " behalf of other principals."
      },
      {
        "Time_Start": 890.84,
        "Time_End": 897.3199999999999,
        "Text": " So that makes it easier for us to identify when there's an abuse case."
      },
      {
        "Time_Start": 897.88,
        "Time_End": 902.48,
        "Text": " I also have a small demonstration similar to Andy's here where we're also going to search"
      },
      {
        "Time_Start": 902.48,
        "Time_End": 904.8000000000001,
        "Text": " for an attack path."
      },
      {
        "Time_Start": 904.8000000000001,
        "Time_End": 910.36,
        "Text": " This time from this victim user to domain admins."
      },
      {
        "Time_Start": 910.36,
        "Time_End": 915.6,
        "Text": " And we can see domain users has this escalation three edge towards the domain."
      },
      {
        "Time_Start": 915.6,
        "Time_End": 921.0200000000001,
        "Text": " Again we're going to check the composition graph to see the details."
      },
      {
        "Time_Start": 921.0200000000001,
        "Time_End": 925.6400000000001,
        "Text": " And here we can see that domain users has enrollment rights on these two certificate"
      },
      {
        "Time_Start": 926.64,
        "Time_End": 931.8,
        "Text": " where one of them has this enroll on behalf of the other one."
      },
      {
        "Time_Start": 931.8,
        "Time_End": 936.52,
        "Text": " Next we're going to abuse this attack path here."
      },
      {
        "Time_Start": 936.52,
        "Time_End": 942.04,
        "Text": " So we're going to copy the Windows abuse information that Budhound provides into a text editor"
      },
      {
        "Time_Start": 942.04,
        "Time_End": 945.48,
        "Text": " that we'll then copy to our attacker machine."
      },
      {
        "Time_Start": 945.48,
        "Time_End": 951.48,
        "Text": " Before we copy it to the attacker machine we need to specify the nodes of this environment"
      },
      {
        "Time_Start": 951.48,
        "Time_End": 955.48,
        "Text": " here so we get the CA name for the enterprise CA."
      },
      {
        "Time_Start": 955.48,
        "Time_End": 959.9200000000001,
        "Text": " We also need the DNS host name for the CA."
      },
      {
        "Time_Start": 959.9200000000001,
        "Time_End": 967.0,
        "Text": " And then we need to specify the certificate template that allows for enrollment agent."
      },
      {
        "Time_Start": 967.0,
        "Time_End": 970.6,
        "Text": " Then there's a bunch of text we can just delete here."
      },
      {
        "Time_Start": 970.6,
        "Time_End": 975.52,
        "Text": " And we're going to use the CA name again in the second enrollment where we enroll as the"
      },
      {
        "Time_Start": 975.52,
        "Time_End": 978.14,
        "Text": " target user."
      },
      {
        "Time_Start": 978.14,
        "Time_End": 982.76,
        "Text": " We then also need to specify this target user here."
      },
      {
        "Time_Start": 982.76,
        "Time_End": 987.56,
        "Text": " So we're going to look up what are the members of domain admins."
      },
      {
        "Time_Start": 987.56,
        "Time_End": 994.28,
        "Text": " And in domain admins we see that the researcher here is a member."
      },
      {
        "Time_Start": 994.28,
        "Time_End": 1001.6,
        "Text": " At last we also need to specify the target account when we are requesting a Kerberos"
      },
      {
        "Time_Start": 1001.6,
        "Time_End": 1004.8,
        "Text": " ticket as the researcher."
      },
      {
        "Time_Start": 1004.8,
        "Time_End": 1009.92,
        "Text": " So now we are on the attacker machine and we are logged in as the victim and we cannot"
      },
      {
        "Time_Start": 1009.9200000000001,
        "Time_End": 1014.32,
        "Text": " access C$ on the domain controller."
      },
      {
        "Time_Start": 1014.32,
        "Time_End": 1019.8000000000001,
        "Text": " Next we are going to request this enrollment agent certificate."
      },
      {
        "Time_Start": 1019.8000000000001,
        "Time_End": 1022.08,
        "Text": " And this time we are using Certify."
      },
      {
        "Time_Start": 1022.08,
        "Time_End": 1028.22,
        "Text": " Certify outputs the certificate here and we need to store that to disk."
      },
      {
        "Time_Start": 1028.22,
        "Time_End": 1033.68,
        "Text": " So we save the key as a key file."
      },
      {
        "Time_Start": 1033.68,
        "Time_End": 1038.8400000000001,
        "Text": " And we are going to use the name specified here in the abuse steps."
      },
      {
        "Time_Start": 1038.84,
        "Time_End": 1045.84,
        "Text": " And then we save the certificate."
      },
      {
        "Time_Start": 1045.84,
        "Time_End": 1051.1599999999999,
        "Text": " And then we can use the built-in Windows tool called CertUtil to create a PFX version of"
      },
      {
        "Time_Start": 1051.1599999999999,
        "Time_End": 1053.24,
        "Text": " the certificate."
      },
      {
        "Time_Start": 1053.24,
        "Time_End": 1057.28,
        "Text": " That allows us to enroll on behalf of our target user."
      },
      {
        "Time_Start": 1057.28,
        "Time_End": 1060.08,
        "Text": " And in this case here it's the researcher."
      },
      {
        "Time_Start": 1060.08,
        "Time_End": 1062.9599999999998,
        "Text": " And we get that certificate."
      },
      {
        "Time_Start": 1062.96,
        "Time_End": 1072.0,
        "Text": " And then we need to save that to disk as well."
      },
      {
        "Time_Start": 1072.0,
        "Time_End": 1076.24,
        "Text": " And we are going to save the certificate here."
      },
      {
        "Time_Start": 1076.24,
        "Time_End": 1079.08,
        "Text": " This could also be done on another machine if we wanted to."
      },
      {
        "Time_Start": 1079.08,
        "Time_End": 1085.04,
        "Text": " We just need the PFX file and then we can use Ruby to request a Kerberos ticket and"
      },
      {
        "Time_Start": 1085.04,
        "Time_End": 1088.4,
        "Text": " we have specified it to be injected into memory."
      },
      {
        "Time_Start": 1088.4,
        "Time_End": 1094.0,
        "Text": " So we run K list to verify that we now have a ticket as the researcher."
      },
      {
        "Time_Start": 1094.0,
        "Time_End": 1103.02,
        "Text": " And we can access C$ on the domain controller."
      },
      {
        "Time_Start": 1103.02,
        "Time_End": 1108.76,
        "Text": " So that's how you can use Sprouthound to identify escalation 3 and abuse it."
      },
      {
        "Time_Start": 1109.76,
        "Time_End": 1112.76,
        "Text": " Let's see if I can move on to the next slide here."
      },
      {
        "Time_Start": 1115.76,
        "Time_End": 1116.76,
        "Text": " There we go."
      },
      {
        "Time_Start": 1116.76,
        "Time_End": 1117.76,
        "Text": " Nice."
      },
      {
        "Time_Start": 1118.76,
        "Time_End": 1124.76,
        "Text": " So I think, so yeah, I think we can give Jonas a hand for that."
      },
      {
        "Time_Start": 1124.76,
        "Time_End": 1125.76,
        "Text": " Great explanation."
      },
      {
        "Time_Start": 1125.76,
        "Time_End": 1126.76,
        "Text": " Thank you."
      },
      {
        "Time_Start": 1126.76,
        "Time_End": 1127.76,
        "Text": " Great explanation."
      },
      {
        "Time_Start": 1127.76,
        "Time_End": 1128.76,
        "Text": " Great demo."
      },
      {
        "Time_Start": 1128.76,
        "Time_End": 1129.76,
        "Text": " Yeah."
      },
      {
        "Time_Start": 1129.76,
        "Time_End": 1130.76,
        "Text": " It's a really tricky one."
      },
      {
        "Time_Start": 1130.76,
        "Time_End": 1135.76,
        "Text": " I think explaining it like that concisely and effectively is a lot harder than it looks."
      },
      {
        "Time_Start": 1135.76,
        "Time_End": 1136.76,
        "Text": " So escalation 5."
      },
      {
        "Time_Start": 1136.76,
        "Time_End": 1142.76,
        "Text": " Escalation 5 may be one of the lesser-known named numbered escalation primitives from"
      },
      {
        "Time_Start": 1142.76,
        "Time_End": 1144.76,
        "Text": " the ADCS white paper."
      },
      {
        "Time_Start": 1144.76,
        "Time_End": 1150.76,
        "Text": " And you wouldn't, like I would forgive you for not really having dived into escalation"
      },
      {
        "Time_Start": 1150.76,
        "Time_End": 1154.76,
        "Text": " 5 very much because the description for it from the white paper is pretty concise."
      },
      {
        "Time_Start": 1154.76,
        "Time_End": 1160.76,
        "Text": " It basically says there are secureable objects out there that are involved in ADCS authentication."
      },
      {
        "Time_Start": 1160.76,
        "Time_End": 1162.76,
        "Text": " Control of them might be bad."
      },
      {
        "Time_Start": 1162.76,
        "Time_End": 1167.76,
        "Text": " And that's kind of where we then picked up and continued that research on."
      },
      {
        "Time_Start": 1167.76,
        "Time_End": 1174.76,
        "Text": " So escalation 5 comes down to it being kind of what I said, is LDAP object manipulation."
      },
      {
        "Time_Start": 1174.76,
        "Time_End": 1182.76,
        "Text": " So escalation 5 abuses how the system works, how ADCS and Active Directory are interconnected,"
      },
      {
        "Time_Start": 1182.76,
        "Time_End": 1189.76,
        "Text": " and how the objects that are placed into the directory in certain places are then replicated"
      },
      {
        "Time_Start": 1190.76,
        "Time_End": 1194.76,
        "Text": " elsewhere in the domain and then also elsewhere in the forest."
      },
      {
        "Time_Start": 1194.76,
        "Time_End": 1198.76,
        "Text": " Escalation 5 is extraordinarily complex."
      },
      {
        "Time_Start": 1198.76,
        "Time_End": 1201.76,
        "Text": " And there are many, many, many different variations of it."
      },
      {
        "Time_Start": 1201.76,
        "Time_End": 1208.76,
        "Text": " There are at least 40, like 40 to 50 different variations of escalation 5."
      },
      {
        "Time_Start": 1208.76,
        "Time_End": 1209.76,
        "Text": " Yeah."
      },
      {
        "Time_Start": 1209.76,
        "Time_End": 1213.76,
        "Text": " So because of that complexity, it's very hard to find."
      },
      {
        "Time_Start": 1213.76,
        "Time_End": 1217.76,
        "Text": " It's very hard to identify not just as a red teamer but also as a defender."
      },
      {
        "Time_Start": 1217.76,
        "Time_End": 1223.76,
        "Text": " That, as an attacker, makes escalation 5 a very, very attractive backdoor."
      },
      {
        "Time_Start": 1223.76,
        "Time_End": 1230.76,
        "Text": " Because the permissions that can be put into place in very surgical ways can just fly under the radar."
      },
      {
        "Time_Start": 1232.76,
        "Time_End": 1240.76,
        "Text": " And as a bonus, escalation 5 uniquely enables escalation from domain admin to enterprise admin"
      },
      {
        "Time_Start": 1240.76,
        "Time_End": 1250.76,
        "Text": " because of a certain behavior with the configuration naming context and how it replicates in the forest."
      },
      {
        "Time_Start": 1250.76,
        "Time_End": 1253.76,
        "Text": " And I'll explain more about that when we get there."
      },
      {
        "Time_Start": 1254.76,
        "Time_End": 1259.76,
        "Text": " There are basically two-ish families of escalation 5."
      },
      {
        "Time_Start": 1259.76,
        "Time_End": 1262.76,
        "Text": " One is where ADCS has already been deployed."
      },
      {
        "Time_Start": 1262.76,
        "Time_End": 1268.76,
        "Text": " And there are permissions on certain objects that already exist."
      },
      {
        "Time_Start": 1268.76,
        "Time_End": 1280.76,
        "Text": " And maybe we can execute an attack path that gets us all the way to a certain principle that has certain permissions that then enable escalation 5."
      },
      {
        "Time_Start": 1280.76,
        "Time_End": 1281.76,
        "Text": " So that's the first flavor."
      },
      {
        "Time_Start": 1281.76,
        "Time_End": 1285.76,
        "Text": " The second flavor is where ADCS doesn't exist at all."
      },
      {
        "Time_Start": 1285.76,
        "Time_End": 1287.76,
        "Text": " They've never deployed it."
      },
      {
        "Time_Start": 1288.76,
        "Time_End": 1291.76,
        "Text": " But even though the software isn't running in the enterprise,"
      },
      {
        "Time_Start": 1291.76,
        "Time_End": 1299.76,
        "Text": " because of how Active Directory respects the LDAP hierarchy that ADCS interfaces with,"
      },
      {
        "Time_Start": 1299.76,
        "Time_End": 1302.76,
        "Text": " and because that hierarchy exists by default,"
      },
      {
        "Time_Start": 1302.76,
        "Time_End": 1309.76,
        "Text": " certain privileges mean that we can do basically a full bootstrap of ADCS ourselves as the attacker."
      },
      {
        "Time_Start": 1309.76,
        "Time_End": 1316.76,
        "Text": " Also, the full ADCS bootstrap method also works if ADCS is already deployed."
      },
      {
        "Time_Start": 1318.76,
        "Time_End": 1325.76,
        "Text": " So it can be really hard to wrap your head around escalation 5."
      },
      {
        "Time_Start": 1325.76,
        "Time_End": 1329.76,
        "Text": " And I think this analogy might be kind of helpful."
      },
      {
        "Time_Start": 1329.76,
        "Time_End": 1337.76,
        "Text": " Escalation 1 emerges out of the combination of the mechanics of the system,"
      },
      {
        "Time_Start": 1337.76,
        "Time_End": 1341.76,
        "Text": " the security descriptors on different objects,"
      },
      {
        "Time_Start": 1341.76,
        "Time_End": 1345.76,
        "Text": " and the configurations on different objects."
      },
      {
        "Time_Start": 1345.76,
        "Time_End": 1349.76,
        "Text": " And as you saw with the composition graph that we were expanding out,"
      },
      {
        "Time_Start": 1349.76,
        "Time_End": 1356.76,
        "Text": " it's at least five different objects that are involved in the emergence of escalation 1."
      },
      {
        "Time_Start": 1356.76,
        "Time_End": 1358.76,
        "Text": " So you can think of those as like different puzzle pieces,"
      },
      {
        "Time_Start": 1358.76,
        "Time_End": 1362.76,
        "Text": " and they all fit together to create escalation 1."
      },
      {
        "Time_Start": 1362.76,
        "Time_End": 1366.76,
        "Text": " And with escalation 1, we are saying those configurations are already in place,"
      },
      {
        "Time_Start": 1366.76,
        "Time_End": 1369.76,
        "Text": " and escalation 1 is possible right now."
      },
      {
        "Time_Start": 1370.76,
        "Time_End": 1375.76,
        "Text": " But what if one of those configurations is removed?"
      },
      {
        "Time_Start": 1375.76,
        "Time_End": 1378.76,
        "Text": " Then escalation 1 evaporates."
      },
      {
        "Time_Start": 1378.76,
        "Time_End": 1381.76,
        "Text": " So what if the CA is not issued by a root CA?"
      },
      {
        "Time_Start": 1381.76,
        "Time_End": 1384.76,
        "Text": " It evaporates because it won't be trusted by the domain."
      },
      {
        "Time_Start": 1384.76,
        "Time_End": 1387.76,
        "Text": " What if the CA is not trusted for NT authentication?"
      },
      {
        "Time_Start": 1387.76,
        "Time_End": 1390.76,
        "Text": " Same thing, and escalation 1 evaporates."
      },
      {
        "Time_Start": 1390.76,
        "Time_End": 1400.76,
        "Text": " Where escalation 5 comes in is we can replace a missing configuration with an existing privilege."
      },
      {
        "Time_Start": 1400.76,
        "Time_End": 1407.76,
        "Text": " And that will slot in perfectly, and from that, escalation 5 emerges."
      },
      {
        "Time_Start": 1407.76,
        "Time_End": 1411.76,
        "Text": " And this is true not just for one configuration or two configurations."
      },
      {
        "Time_Start": 1411.76,
        "Time_End": 1413.76,
        "Text": " It's true for all of them."
      },
      {
        "Time_Start": 1413.76,
        "Time_End": 1417.76,
        "Text": " So no matter what the combination of missing configurations are,"
      },
      {
        "Time_Start": 1417.76,
        "Time_End": 1423.76,
        "Text": " if we can make up for them with privileges, then escalation 5 emerges."
      },
      {
        "Time_Start": 1428.76,
        "Time_End": 1431.76,
        "Text": " This is part of the data model that we use in Bloodhound"
      },
      {
        "Time_Start": 1431.76,
        "Time_End": 1437.76,
        "Text": " to calculate automatically the emergence of these different named escalation primitives."
      },
      {
        "Time_Start": 1437.76,
        "Time_End": 1440.76,
        "Text": " And so as you can see, we have a user who's a member of a group."
      },
      {
        "Time_Start": 1440.76,
        "Time_End": 1443.76,
        "Text": " They have enroll rights on the enterprise CA,"
      },
      {
        "Time_Start": 1443.76,
        "Time_End": 1446.76,
        "Text": " which is trusted for NT authentication"
      },
      {
        "Time_Start": 1446.76,
        "Time_End": 1453.76,
        "Text": " because it's listed in the CA certificates property on the NT authstore object."
      },
      {
        "Time_Start": 1453.76,
        "Time_End": 1456.76,
        "Text": " What if that configuration goes away?"
      },
      {
        "Time_Start": 1456.76,
        "Time_End": 1459.76,
        "Text": " Then the attacker is out of luck."
      },
      {
        "Time_Start": 1459.76,
        "Time_End": 1461.76,
        "Text": " Obviously not."
      },
      {
        "Time_Start": 1461.76,
        "Time_End": 1464.76,
        "Text": " What can happen is there may be a configuration in place"
      },
      {
        "Time_Start": 1464.76,
        "Time_End": 1471.76,
        "Text": " where the principal somehow has the ability to repopulate the CA certs property"
      },
      {
        "Time_Start": 1471.76,
        "Time_End": 1473.76,
        "Text": " on the NT authstore object."
      },
      {
        "Time_Start": 1473.76,
        "Time_End": 1476.76,
        "Text": " So how many different ways are there to have that privilege?"
      },
      {
        "Time_Start": 1476.76,
        "Time_End": 1480.76,
        "Text": " There's like five or six at least that I can think of off the top of my head,"
      },
      {
        "Time_Start": 1480.76,
        "Time_End": 1482.76,
        "Text": " just depending on what the ace access mask is."
      },
      {
        "Time_Start": 1482.76,
        "Time_End": 1484.76,
        "Text": " But what matters is that we can."
      },
      {
        "Time_Start": 1484.76,
        "Time_End": 1487.76,
        "Text": " We can write to that property."
      },
      {
        "Time_Start": 1487.76,
        "Time_End": 1491.76,
        "Text": " One way that we might be able to do that is the group that the user belongs to"
      },
      {
        "Time_Start": 1491.76,
        "Time_End": 1494.76,
        "Text": " may have generic all on that object."
      },
      {
        "Time_Start": 1494.76,
        "Time_End": 1498.76,
        "Text": " And so that then slots in as the missing puzzle piece."
      },
      {
        "Time_Start": 1498.76,
        "Time_End": 1503.76,
        "Text": " And now we have escalation five."
      },
      {
        "Time_Start": 1503.76,
        "Time_End": 1506.76,
        "Text": " So let me go back one step."
      },
      {
        "Time_Start": 1506.76,
        "Time_End": 1509.76,
        "Text": " This object, has anybody ever actually looked at this object?"
      },
      {
        "Time_Start": 1509.76,
        "Time_End": 1511.76,
        "Text": " Like an MMC or ADSI edit?"
      },
      {
        "Time_Start": 1511.76,
        "Time_End": 1513.76,
        "Text": " Like just a couple of hands."
      },
      {
        "Time_Start": 1513.76,
        "Time_End": 1516.76,
        "Text": " So it's a pretty obscure object, I might think."
      },
      {
        "Time_Start": 1516.76,
        "Time_End": 1519.76,
        "Text": " And I think what happens a lot of times when we're talking about these"
      },
      {
        "Time_Start": 1519.76,
        "Time_End": 1525.76,
        "Text": " like really obscure objects is you may be tempted to entertain the thought"
      },
      {
        "Time_Start": 1525.76,
        "Time_End": 1531.76,
        "Text": " in the back of your mind, which is this would never happen in real life."
      },
      {
        "Time_Start": 1531.76,
        "Time_End": 1534.76,
        "Text": " No one's ever going to put a generic all privilege on some random object"
      },
      {
        "Time_Start": 1534.76,
        "Time_End": 1536.76,
        "Text": " in Active Directory."
      },
      {
        "Time_Start": 1536.76,
        "Time_End": 1543.76,
        "Text": " But if you do professional services for customers who have, you know,"
      },
      {
        "Time_Start": 1543.76,
        "Time_End": 1546.76,
        "Text": " fucked up their environments, you've seen it all."
      },
      {
        "Time_Start": 1546.76,
        "Time_End": 1548.76,
        "Text": " And you know that this stuff can happen."
      },
      {
        "Time_Start": 1548.76,
        "Time_End": 1552.76,
        "Text": " Not only because maybe an admin does it, but I think actually more likely"
      },
      {
        "Time_Start": 1552.76,
        "Time_End": 1556.76,
        "Text": " is because some third-party vendor, their installer, wants to give itself"
      },
      {
        "Time_Start": 1556.76,
        "Time_End": 1558.76,
        "Text": " special privileges."
      },
      {
        "Time_Start": 1558.76,
        "Time_End": 1561.76,
        "Text": " Or maybe Exchange wants to give itself special privileges."
      },
      {
        "Time_Start": 1561.76,
        "Time_End": 1563.76,
        "Text": " Now the heads are nodding."
      },
      {
        "Time_Start": 1563.76,
        "Time_End": 1567.76,
        "Text": " And if you don't believe me, here's an example from real life."
      },
      {
        "Time_Start": 1567.76,
        "Time_End": 1573.76,
        "Text": " So this is a real customer environment where this group has generic all"
      },
      {
        "Time_Start": 1573.76,
        "Time_End": 1579.76,
        "Text": " on the public key services container within the configuration naming context."
      },
      {
        "Time_Start": 1579.76,
        "Time_End": 1584.76,
        "Text": " That ace has been inherited down to the cert templates container,"
      },
      {
        "Time_Start": 1584.76,
        "Time_End": 1587.76,
        "Text": " enrollment services container, the NT auth store object,"
      },
      {
        "Time_Start": 1587.76,
        "Time_End": 1593.76,
        "Text": " and the certification authorities container."
      },
      {
        "Time_Start": 1593.76,
        "Time_End": 1595.76,
        "Text": " So let's say that we're a red teamer."
      },
      {
        "Time_Start": 1595.76,
        "Time_End": 1597.76,
        "Text": " We're using Bloodhound."
      },
      {
        "Time_Start": 1597.76,
        "Time_End": 1599.76,
        "Text": " I want to find a path domain admin."
      },
      {
        "Time_Start": 1599.76,
        "Time_End": 1600.76,
        "Text": " Path not found."
      },
      {
        "Time_Start": 1600.76,
        "Time_End": 1602.76,
        "Text": " Well, that sucks."
      },
      {
        "Time_Start": 1602.76,
        "Time_End": 1603.76,
        "Text": " So maybe I give up."
      },
      {
        "Time_Start": 1603.76,
        "Time_End": 1604.76,
        "Text": " Maybe I start writing the report."
      },
      {
        "Time_Start": 1604.76,
        "Time_End": 1607.76,
        "Text": " You know, that's what I would do if I was Chris."
      },
      {
        "Time_Start": 1607.76,
        "Time_End": 1608.76,
        "Text": " Just like, I'm done."
      },
      {
        "Time_Start": 1608.76,
        "Time_End": 1610.76,
        "Text": " I'm out."
      },
      {
        "Time_Start": 1610.76,
        "Time_End": 1618.76,
        "Text": " But what if there is a path to that particular user who has control of those"
      },
      {
        "Time_Start": 1618.76,
        "Time_End": 1620.76,
        "Text": " different objects?"
      },
      {
        "Time_Start": 1620.76,
        "Time_End": 1623.76,
        "Text": " Well, why didn't the path show up before?"
      },
      {
        "Time_Start": 1623.76,
        "Time_End": 1627.76,
        "Text": " Well, it's because we haven't implemented Escalation 5 in the product yet."
      },
      {
        "Time_Start": 1627.76,
        "Time_End": 1631.76,
        "Text": " And there are good reasons for that, but that's why the path doesn't show up"
      },
      {
        "Time_Start": 1631.76,
        "Time_End": 1636.76,
        "Text": " because we don't have the edge in the database."
      },
      {
        "Time_Start": 1636.76,
        "Time_End": 1642.76,
        "Text": " That group has generic all on these objects like I mentioned."
      },
      {
        "Time_Start": 1642.76,
        "Time_End": 1649.76,
        "Text": " There are only two objects listed here that are necessary to have full control of"
      },
      {
        "Time_Start": 1649.76,
        "Time_End": 1654.76,
        "Text": " or write access to in order to fully bootstrap ADCS in a way that makes it"
      },
      {
        "Time_Start": 1654.76,
        "Time_End": 1655.76,
        "Text": " abusable."
      },
      {
        "Time_Start": 1655.76,
        "Time_End": 1668.76,
        "Text": " Can somebody tell me from this row which two objects are necessary to modify?"
      },
      {
        "Time_Start": 1668.76,
        "Time_End": 1669.76,
        "Text": " What's that?"
      },
      {
        "Time_Start": 1669.76,
        "Time_End": 1673.76,
        "Text": " The enrollment services container?"
      },
      {
        "Time_Start": 1673.76,
        "Time_End": 1674.76,
        "Text": " Okay."
      },
      {
        "Time_Start": 1674.76,
        "Time_End": 1676.76,
        "Text": " What other one?"
      },
      {
        "Time_Start": 1676.76,
        "Time_End": 1677.76,
        "Text": " That's one."
      },
      {
        "Time_Start": 1677.76,
        "Time_End": 1684.76,
        "Text": " What's two?"
      },
      {
        "Time_Start": 1684.76,
        "Time_End": 1685.76,
        "Text": " Yeah."
      },
      {
        "Time_Start": 1685.76,
        "Time_End": 1686.76,
        "Text": " Yeah."
      },
      {
        "Time_Start": 1686.76,
        "Time_End": 1687.76,
        "Text": " It's not very legible."
      },
      {
        "Time_Start": 1687.76,
        "Time_End": 1688.76,
        "Text": " Yeah."
      },
      {
        "Time_Start": 1688.76,
        "Time_End": 1694.76,
        "Text": " So it turns out that the two objects that we need to modify is this one,"
      },
      {
        "Time_Start": 1694.76,
        "Time_End": 1699.76,
        "Text": " certification authorities, and this one, ntoff certificates."
      },
      {
        "Time_Start": 1699.76,
        "Time_End": 1705.76,
        "Text": " With write access or with create child access to this container and with"
      },
      {
        "Time_Start": 1705.76,
        "Time_End": 1709.76,
        "Text": " generic write, write DACL, owner, write owner, generic all, et cetera,"
      },
      {
        "Time_Start": 1709.76,
        "Time_End": 1714.76,
        "Text": " on this object you can escalate to domain admin,"
      },
      {
        "Time_Start": 1714.76,
        "Time_End": 1717.76,
        "Text": " you can escalate to enterprise admin."
      },
      {
        "Time_Start": 1717.76,
        "Time_End": 1723.76,
        "Text": " To Olaf's point, there are definitely scenarios where full control over the"
      },
      {
        "Time_Start": 1723.76,
        "Time_End": 1728.76,
        "Text": " enrollment services container can also lead to escalation five,"
      },
      {
        "Time_Start": 1728.76,
        "Time_End": 1735.76,
        "Text": " but full control over the ntoff store and the root CA store or container"
      },
      {
        "Time_Start": 1735.76,
        "Time_End": 1739.76,
        "Text": " is a guaranteed way that you can, yeah, escalate."
      },
      {
        "Time_Start": 1739.76,
        "Time_End": 1740.76,
        "Text": " Yeah."
      },
      {
        "Time_Start": 1740.76,
        "Time_End": 1743.76,
        "Text": " In this situation, ADCS doesn't exist yet."
      },
      {
        "Time_Start": 1743.76,
        "Time_End": 1746.76,
        "Text": " So under this enrollment services container, there's nothing."
      },
      {
        "Time_Start": 1746.76,
        "Time_End": 1750.76,
        "Text": " There's just nothing there."
      },
      {
        "Time_Start": 1750.76,
        "Time_End": 1752.76,
        "Text": " Andrea, I think I saw you in the room."
      },
      {
        "Time_Start": 1752.76,
        "Time_End": 1755.76,
        "Text": " There you are."
      },
      {
        "Time_Start": 1755.76,
        "Time_End": 1761.76,
        "Text": " So Andrea made this great blog post here regarding the cert publishers group,"
      },
      {
        "Time_Start": 1761.76,
        "Time_End": 1764.76,
        "Text": " which if you look at the permissions that that group has, it has a lot,"
      },
      {
        "Time_Start": 1764.76,
        "Time_End": 1766.76,
        "Text": " and that can have an impact."
      },
      {
        "Time_Start": 1766.76,
        "Time_End": 1772.76,
        "Text": " And so Andrea's blog post here goes into some practical enumeration"
      },
      {
        "Time_Start": 1772.76,
        "Time_End": 1777.76,
        "Text": " and abuse guidelines, I would say."
      },
      {
        "Time_Start": 1777.76,
        "Time_End": 1778.76,
        "Text": " So thank you."
      },
      {
        "Time_Start": 1778.76,
        "Time_End": 1781.76,
        "Text": " Thank you for this blog post."
      },
      {
        "Time_Start": 1781.76,
        "Time_End": 1786.76,
        "Text": " And so what we're going to do is we're going to say that ADCS"
      },
      {
        "Time_Start": 1786.76,
        "Time_End": 1788.76,
        "Text": " doesn't exist at all."
      },
      {
        "Time_Start": 1788.76,
        "Time_End": 1794.76,
        "Text": " And this group here has generic all over those two different objects,"
      },
      {
        "Time_Start": 1794.76,
        "Time_End": 1799.76,
        "Text": " and we're going to turn that into domain admin."
      },
      {
        "Time_Start": 1799.76,
        "Time_End": 1802.76,
        "Text": " Now, you're going to recognize a lot of these commands because I just copy"
      },
      {
        "Time_Start": 1802.76,
        "Time_End": 1807.76,
        "Text": " and pasted them from your blog, so thank you again."
      },
      {
        "Time_Start": 1807.76,
        "Time_End": 1812.76,
        "Text": " So basically what we're doing here is we are creating a CA."
      },
      {
        "Time_Start": 1812.76,
        "Time_End": 1813.76,
        "Text": " What is a CA?"
      },
      {
        "Time_Start": 1813.76,
        "Time_End": 1815.76,
        "Text": " It is a self-signed certificate."
      },
      {
        "Time_Start": 1815.76,
        "Time_End": 1820.76,
        "Text": " We are also creating a certificate revocation list, a CRL file,"
      },
      {
        "Time_Start": 1820.76,
        "Time_End": 1824.76,
        "Text": " and then after we create these particular files,"
      },
      {
        "Time_Start": 1824.76,
        "Time_End": 1827.76,
        "Text": " we're going to transfer them over to the Windows box,"
      },
      {
        "Time_Start": 1827.76,
        "Time_End": 1831.76,
        "Text": " which is serving as like our attacker system."
      },
      {
        "Time_Start": 1831.76,
        "Time_End": 1840.76,
        "Text": " And, yeah, I thank you so much for putting these commands out there."
      },
      {
        "Time_Start": 1840.76,
        "Time_End": 1843.76,
        "Text": " Now, again, like in the other demos, we proved that we're not already"
      },
      {
        "Time_Start": 1843.76,
        "Time_End": 1847.76,
        "Text": " domain admin, so nothing up this sleeve, nothing up that sleeve."
      },
      {
        "Time_Start": 1847.76,
        "Time_End": 1851.76,
        "Text": " And we do that by trying to enumerate remotely the C dollar share"
      },
      {
        "Time_Start": 1851.76,
        "Time_End": 1855.76,
        "Text": " on the domain controller, which fails."
      },
      {
        "Time_Start": 1855.76,
        "Time_End": 1858.76,
        "Text": " So we get access denied."
      },
      {
        "Time_Start": 1858.76,
        "Time_End": 1860.76,
        "Text": " Aye, aye, aye."
      },
      {
        "Time_Start": 1860.76,
        "Time_End": 1862.76,
        "Text": " We have 30 minutes left?"
      },
      {
        "Time_Start": 1862.76,
        "Time_End": 1871.76,
        "Text": " Okay."
      },
      {
        "Time_Start": 1871.76,
        "Time_End": 1875.76,
        "Text": " Okay, so we'll copy those files over."
      },
      {
        "Time_Start": 1875.76,
        "Time_End": 1877.76,
        "Text": " We will prove that we're not domain admin,"
      },
      {
        "Time_Start": 1877.76,
        "Time_End": 1882.76,
        "Text": " and you'll see that we get access is denied."
      },
      {
        "Time_Start": 1882.76,
        "Time_End": 1886.76,
        "Text": " Now this next command, we're going to use the built-in certutil binary"
      },
      {
        "Time_Start": 1886.76,
        "Time_End": 1893.76,
        "Text": " to do DS publish for the CRT into the root CA container."
      },
      {
        "Time_Start": 1893.76,
        "Time_End": 1899.76,
        "Text": " And so what exactly is that doing?"
      },
      {
        "Time_Start": 1899.76,
        "Time_End": 1906.76,
        "Text": " So it is taking the CRT, which will be in, like, you know,"
      },
      {
        "Time_Start": 1906.76,
        "Time_End": 1908.76,
        "Text": " like the format that we were seeing before."
      },
      {
        "Time_Start": 1908.76,
        "Time_End": 1913.76,
        "Text": " It will convert it into an ASN 1 formatted certificate."
      },
      {
        "Time_Start": 1913.76,
        "Time_End": 1920.76,
        "Text": " It will then take that string, and it will try to add it to a new object"
      },
      {
        "Time_Start": 1920.76,
        "Time_End": 1923.76,
        "Text": " on that new object's CA certificate property,"
      },
      {
        "Time_Start": 1923.76,
        "Time_End": 1929.76,
        "Text": " and that new object will be a certification authority class object"
      },
      {
        "Time_Start": 1929.76,
        "Time_End": 1932.76,
        "Text": " under the certification authority's container."
      },
      {
        "Time_Start": 1932.76,
        "Time_End": 1936.76,
        "Text": " So there's a lot of actions that this command is actually doing."
      },
      {
        "Time_Start": 1936.76,
        "Time_End": 1945.76,
        "Text": " The end result is that we have a new object with this distinguished name here,"
      },
      {
        "Time_Start": 1945.76,
        "Time_End": 1950.76,
        "Text": " and I'm not going to spoil things,"
      },
      {
        "Time_Start": 1950.76,
        "Time_End": 1953.76,
        "Text": " but, like, keep in mind that that object is placed there."
      },
      {
        "Time_Start": 1953.76,
        "Time_End": 1955.76,
        "Text": " I just screwed that up again."
      },
      {
        "Time_Start": 1955.76,
        "Time_End": 1964.76,
        "Text": " Yeah, and maybe notice that the command returned access denied, which is a lie."
      },
      {
        "Time_Start": 1964.76,
        "Time_End": 1966.76,
        "Text": " Well, actually, I don't think it is because I think what it's actually doing"
      },
      {
        "Time_Start": 1966.76,
        "Time_End": 1969.76,
        "Text": " is it's trying to also write to the AIA container,"
      },
      {
        "Time_Start": 1969.76,
        "Time_End": 1975.76,
        "Text": " which our user doesn't have full control of, but we also don't need it."
      },
      {
        "Time_Start": 1975.76,
        "Time_End": 1980.76,
        "Text": " So certificate added to the directory services store."
      },
      {
        "Time_Start": 1980.76,
        "Time_End": 1985.76,
        "Text": " Then we are adding the..."
      },
      {
        "Time_Start": 1985.76,
        "Time_End": 1986.76,
        "Text": " Sorry, this is going really fast."
      },
      {
        "Time_Start": 1986.76,
        "Time_End": 1992.76,
        "Text": " So this other command that we did was adding the ASN 1 formatted certificate"
      },
      {
        "Time_Start": 1992.76,
        "Time_End": 2000.76,
        "Text": " to the ntoffstore object, and so you can see the results of that command here."
      },
      {
        "Time_Start": 2000.76,
        "Time_End": 2005.76,
        "Text": " And so that populates the list that otherwise was empty before."
      },
      {
        "Time_Start": 2009.76,
        "Time_End": 2013.76,
        "Text": " Then we're going to unprotect the PFX"
      },
      {
        "Time_Start": 2013.76,
        "Time_End": 2019.76,
        "Text": " because the tooling doesn't support prompting for a credential."
      },
      {
        "Time_Start": 2019.76,
        "Time_End": 2022.76,
        "Text": " And then what do we have now?"
      },
      {
        "Time_Start": 2022.76,
        "Time_End": 2026.76,
        "Text": " We have the private key for the root CA for the domain,"
      },
      {
        "Time_Start": 2026.76,
        "Time_End": 2030.76,
        "Text": " and we have the ability to issue certificates."
      },
      {
        "Time_Start": 2030.76,
        "Time_End": 2034.76,
        "Text": " We don't need a certificate template."
      },
      {
        "Time_Start": 2034.76,
        "Time_End": 2038.76,
        "Text": " We don't need all of the other pieces that come into play"
      },
      {
        "Time_Start": 2038.76,
        "Time_End": 2042.76,
        "Text": " when finding out if a template is susceptible to escalation 1."
      },
      {
        "Time_Start": 2042.76,
        "Time_End": 2045.76,
        "Text": " We don't need any of that because we are the CA."
      },
      {
        "Time_Start": 2045.76,
        "Time_End": 2047.76,
        "Text": " We can issue whatever certificates we want."
      },
      {
        "Time_Start": 2047.76,
        "Time_End": 2050.76,
        "Text": " And so that's exactly what Oliver LUAC's tool..."
      },
      {
        "Time_Start": 2050.76,
        "Time_End": 2053.76,
        "Text": " I don't think Oliver is here."
      },
      {
        "Time_Start": 2053.76,
        "Time_End": 2058.76,
        "Text": " Yeah, I don't see anybody saying they're Oliver, but yeah."
      },
      {
        "Time_Start": 2058.76,
        "Time_End": 2062.76,
        "Text": " Thank you to Oliver for creating and maintaining Certify."
      },
      {
        "Time_Start": 2062.76,
        "Time_End": 2065.76,
        "Text": " So the Certify forge command is..."
      },
      {
        "Time_Start": 2065.76,
        "Time_End": 2069.76,
        "Text": " We're going to get a PFX on disk now,"
      },
      {
        "Time_Start": 2069.76,
        "Time_End": 2075.76,
        "Text": " which is going to be valid for authenticating as that user in Active Directory."
      },
      {
        "Time_Start": 2075.76,
        "Time_End": 2082.76,
        "Text": " And now we're going to allow the domain controller to reach this system on port 80,"
      },
      {
        "Time_Start": 2082.76,
        "Time_End": 2087.76,
        "Text": " and then we're going to start up an HTTP server serving the CRL."
      },
      {
        "Time_Start": 2087.76,
        "Time_End": 2090.76,
        "Text": " Because as I learned from your blog post,"
      },
      {
        "Time_Start": 2090.76,
        "Time_End": 2094.76,
        "Text": " the first time the domain controller tries to validate the CA,"
      },
      {
        "Time_Start": 2094.76,
        "Time_End": 2098.76,
        "Text": " it reaches out and it tries to find a certificate replication list,"
      },
      {
        "Time_Start": 2098.76,
        "Time_End": 2101.76,
        "Text": " and if that ain't there, it's going to fail."
      },
      {
        "Time_Start": 2101.76,
        "Time_End": 2107.76,
        "Text": " So you saved me days of pulling my hair out, so thank you again."
      },
      {
        "Time_Start": 2107.76,
        "Time_End": 2114.76,
        "Text": " So our fake ADCS service Python web server is running."
      },
      {
        "Time_Start": 2114.76,
        "Time_End": 2121.76,
        "Text": " We have the command ready to go to actually get the NT hash for the researcher user."
      },
      {
        "Time_Start": 2121.76,
        "Time_End": 2127.76,
        "Text": " So let's hit play again, and let's see what happens."
      },
      {
        "Time_Start": 2127.76,
        "Time_End": 2131.76,
        "Text": " So it failed."
      },
      {
        "Time_Start": 2131.76,
        "Time_End": 2134.76,
        "Text": " Who can tell me why?"
      },
      {
        "Time_Start": 2138.76,
        "Time_End": 2141.76,
        "Text": " Who said that?"
      },
      {
        "Time_Start": 2146.76,
        "Time_End": 2151.76,
        "Text": " Yeah, so the problem has to do with replication."
      },
      {
        "Time_Start": 2151.76,
        "Time_End": 2156.76,
        "Text": " The problem is when you place a new Certification Authority object"
      },
      {
        "Time_Start": 2156.76,
        "Time_End": 2159.76,
        "Text": " in the Certification Authority's container,"
      },
      {
        "Time_Start": 2159.76,
        "Time_End": 2165.76,
        "Text": " that is then pushed out via group policy to every client in the domain"
      },
      {
        "Time_Start": 2165.76,
        "Time_End": 2167.76,
        "Text": " and every domain controller,"
      },
      {
        "Time_Start": 2167.76,
        "Time_End": 2171.76,
        "Text": " and it's added as a new trusted root Certification Authority."
      },
      {
        "Time_Start": 2171.76,
        "Time_End": 2175.76,
        "Text": " But we did all of this kind of quickly,"
      },
      {
        "Time_Start": 2175.76,
        "Time_End": 2182.76,
        "Text": " so that process of group policy running on the domain controller hasn't happened yet."
      },
      {
        "Time_Start": 2182.76,
        "Time_End": 2188.76,
        "Text": " So the DC doesn't trust the CA, even though the CA is in that container."
      },
      {
        "Time_Start": 2188.76,
        "Time_End": 2190.76,
        "Text": " So we just have to wait."
      },
      {
        "Time_Start": 2190.76,
        "Time_End": 2195.76,
        "Text": " Domain controllers by default update group policy for themselves every five minutes."
      },
      {
        "Time_Start": 2195.76,
        "Time_End": 2196.76,
        "Text": " I believe that's right."
      },
      {
        "Time_Start": 2196.76,
        "Time_End": 2200.76,
        "Text": " I see Michael nodding, that's all the proof I need."
      },
      {
        "Time_Start": 2200.76,
        "Time_End": 2209.76,
        "Text": " So up to five minutes later, if we try it again, it'll succeed."
      },
      {
        "Time_Start": 2209.76,
        "Time_End": 2213.76,
        "Text": " And so now we have the NTLM hash of the domain admin."
      },
      {
        "Time_Start": 2213.76,
        "Time_End": 2219.76,
        "Text": " So we turned generic all against two different objects into domain admin"
      },
      {
        "Time_Start": 2219.76,
        "Time_End": 2222.76,
        "Text": " but also enterprise admin."
      },
      {
        "Time_Start": 2222.76,
        "Time_End": 2228.76,
        "Text": " Let's wait for the end for a question, but remember what your question is."
      },
      {
        "Time_Start": 2228.76,
        "Time_End": 2230.76,
        "Text": " Okay."
      },
      {
        "Time_Start": 2230.76,
        "Time_End": 2235.76,
        "Text": " I wrote a blog post about this regarding escalating from domain admin to enterprise admin"
      },
      {
        "Time_Start": 2235.76,
        "Time_End": 2238.76,
        "Text": " with this abuse primitive, so you can read that there."
      },
      {
        "Time_Start": 2238.76,
        "Time_End": 2248.76,
        "Text": " The TLDR is if you have \u2013 yeah, that text is not great."
      },
      {
        "Time_Start": 2248.76,
        "Time_End": 2253.76,
        "Text": " So if you have a bidirectional trust or if you have a forest and then child domain trust,"
      },
      {
        "Time_Start": 2253.76,
        "Time_End": 2260.76,
        "Text": " you have replication that happens in certain directions with certain objects within that environment."
      },
      {
        "Time_Start": 2260.76,
        "Time_End": 2269.76,
        "Text": " The configuration naming context in each domain is actually writable by each domain."
      },
      {
        "Time_Start": 2269.76,
        "Time_End": 2275.76,
        "Text": " If you look at the security descriptor of this, it will actually not list out the domain admins."
      },
      {
        "Time_Start": 2275.76,
        "Time_End": 2279.76,
        "Text": " So it will say, like, enterprise admins has full control, but domain admins is not listed."
      },
      {
        "Time_Start": 2279.76,
        "Time_End": 2284.76,
        "Text": " So if you get on a domain controller and you try to modify this object"
      },
      {
        "Time_Start": 2284.76,
        "Time_End": 2288.76,
        "Text": " or the objects in the configuration naming context, you'll get access denied"
      },
      {
        "Time_Start": 2288.76,
        "Time_End": 2292.76,
        "Text": " unless you do it on a forest root domain controller."
      },
      {
        "Time_Start": 2292.76,
        "Time_End": 2299.76,
        "Text": " But the security descriptor on this object does have an ace for the well-known SID for system."
      },
      {
        "Time_Start": 2300.76,
        "Time_End": 2304.76,
        "Text": " And if you're a domain admin on a child domain, domain controller,"
      },
      {
        "Time_Start": 2304.76,
        "Time_End": 2309.76,
        "Text": " you can run commands as the system user."
      },
      {
        "Time_Start": 2309.76,
        "Time_End": 2313.76,
        "Text": " If you do that, you can modify the objects in that container."
      },
      {
        "Time_Start": 2313.76,
        "Time_End": 2317.76,
        "Text": " So, for example, we may modify an existing template."
      },
      {
        "Time_Start": 2317.76,
        "Time_End": 2324.76,
        "Text": " These templates are replicated around the forest, and when they're updated,"
      },
      {
        "Time_Start": 2324.76,
        "Time_End": 2329.76,
        "Text": " like, say, for example, someone in the forest root modifies a certificate template,"
      },
      {
        "Time_Start": 2329.76,
        "Time_End": 2332.76,
        "Text": " that change is replicated down to each child domain."
      },
      {
        "Time_Start": 2332.76,
        "Time_End": 2334.76,
        "Text": " But the opposite is also true."
      },
      {
        "Time_Start": 2334.76,
        "Time_End": 2338.76,
        "Text": " So the child domains, they have writable versions of these objects,"
      },
      {
        "Time_Start": 2338.76,
        "Time_End": 2341.76,
        "Text": " so we can modify this object and all the other ones,"
      },
      {
        "Time_Start": 2341.76,
        "Time_End": 2348.76,
        "Text": " and that will then replicate up to what I would call the canonical version of that object."
      },
      {
        "Time_Start": 2349.76,
        "Time_End": 2354.76,
        "Text": " And then we can become enterprise admin."
      },
      {
        "Time_Start": 2354.76,
        "Time_End": 2364.76,
        "Text": " So it's just yet another, like, proof that the domain trust boundary is not a trust boundary, I guess."
      },
      {
        "Time_Start": 2364.76,
        "Time_End": 2368.76,
        "Text": " That, like, the forest trust boundary kind of is."
      },
      {
        "Time_Start": 2368.76,
        "Time_End": 2370.76,
        "Text": " Not really. Like, depends."
      },
      {
        "Time_Start": 2370.76,
        "Time_End": 2374.76,
        "Text": " But it's just, like, breaking that trust boundary is not new."
      },
      {
        "Time_Start": 2374.76,
        "Time_End": 2378.76,
        "Text": " It's just this is yet another method of doing that."
      },
      {
        "Time_Start": 2378.76,
        "Time_End": 2382.76,
        "Text": " It's another way to prove that that statement is true."
      },
      {
        "Time_Start": 2382.76,
        "Time_End": 2384.76,
        "Text": " Escalation 5 is very complicated."
      },
      {
        "Time_Start": 2384.76,
        "Time_End": 2389.76,
        "Text": " This is one of our internal diagrams for enumerating all of the different permissions"
      },
      {
        "Time_Start": 2389.76,
        "Time_End": 2393.76,
        "Text": " against all the different objects, how they can be granted explicitly,"
      },
      {
        "Time_Start": 2393.76,
        "Time_End": 2396.76,
        "Text": " or through group membership, or nested group membership."
      },
      {
        "Time_Start": 2396.76,
        "Time_End": 2398.76,
        "Text": " So it's very, very complicated."
      },
      {
        "Time_Start": 2398.76,
        "Time_End": 2404.76,
        "Text": " This is not even all of it, because it doesn't involve, like, the Escalation 13."
      },
      {
        "Time_Start": 2404.76,
        "Time_End": 2406.76,
        "Text": " So we're working on it."
      },
      {
        "Time_Start": 2406.76,
        "Time_End": 2409.76,
        "Text": " We're going to try to have it out there as soon as we can."
      },
      {
        "Time_Start": 2411.76,
        "Time_End": 2412.76,
        "Text": " Yeah."
      },
      {
        "Time_Start": 2412.76,
        "Time_End": 2415.76,
        "Text": " Thank you, Andy."
      },
      {
        "Time_Start": 2418.76,
        "Time_End": 2422.76,
        "Text": " So Escalation 13 is an interesting case"
      },
      {
        "Time_Start": 2422.76,
        "Time_End": 2428.76,
        "Text": " where it was one of our Bloodhound Enterprise customers actually reached out"
      },
      {
        "Time_Start": 2428.76,
        "Time_End": 2432.76,
        "Text": " asking whether or not that, like, this implementation of ADCs in Bloodhound"
      },
      {
        "Time_Start": 2432.76,
        "Time_End": 2435.76,
        "Text": " will cover this specific Escalation case."
      },
      {
        "Time_Start": 2435.76,
        "Time_End": 2438.76,
        "Text": " And I immediately thought that, yeah, sure thing."
      },
      {
        "Time_Start": 2438.76,
        "Time_End": 2440.76,
        "Text": " We will cover everything."
      },
      {
        "Time_Start": 2440.76,
        "Time_End": 2444.76,
        "Text": " But then it was something that I've never heard about before."
      },
      {
        "Time_Start": 2446.76,
        "Time_End": 2450.76,
        "Text": " Escalation 13 is the abuse of OID group links."
      },
      {
        "Time_Start": 2450.76,
        "Time_End": 2452.76,
        "Text": " So we have Alice again."
      },
      {
        "Time_Start": 2452.76,
        "Time_End": 2457.76,
        "Text": " Alice is determined to become Enterprise Admin this time here."
      },
      {
        "Time_Start": 2457.76,
        "Time_End": 2461.76,
        "Text": " So Alice is not Enterprise Admin, just to make it very clear."
      },
      {
        "Time_Start": 2461.76,
        "Time_End": 2465.76,
        "Text": " But Alice has enrollment rights on this custom certificate template"
      },
      {
        "Time_Start": 2465.76,
        "Time_End": 2469.76,
        "Text": " that we have created called Enterprise Admin's Template."
      },
      {
        "Time_Start": 2469.76,
        "Time_End": 2474.76,
        "Text": " So she can ask for a certificate of this template here,"
      },
      {
        "Time_Start": 2474.76,
        "Time_End": 2477.76,
        "Text": " and she will receive the certificate."
      },
      {
        "Time_Start": 2477.76,
        "Time_End": 2480.76,
        "Text": " And what's special about this certificate here"
      },
      {
        "Time_Start": 2480.76,
        "Time_End": 2486.76,
        "Text": " is that it has this issuance policy field set to this Enterprise Admin's policy."
      },
      {
        "Time_Start": 2486.76,
        "Time_End": 2491.76,
        "Text": " So you can see there's a new node type in the upper left corner,"
      },
      {
        "Time_Start": 2491.76,
        "Time_End": 2494.76,
        "Text": " and there's an issuance policy."
      },
      {
        "Time_Start": 2494.76,
        "Time_End": 2499.76,
        "Text": " What this issuance policy has is a link, an OID group link,"
      },
      {
        "Time_Start": 2499.76,
        "Time_End": 2501.76,
        "Text": " to Enterprise Admins."
      },
      {
        "Time_Start": 2501.76,
        "Time_End": 2506.76,
        "Text": " So when Alice authenticate using this certificate,"
      },
      {
        "Time_Start": 2506.76,
        "Time_End": 2511.76,
        "Text": " she gets a Kerberos ticket with a membership of Enterprise Admins."
      },
      {
        "Time_Start": 2511.76,
        "Time_End": 2516.76,
        "Text": " So despite not being in the group, she can act as a member of the group."
      },
      {
        "Time_Start": 2516.76,
        "Time_End": 2521.76,
        "Text": " It is a cool functionality that Microsoft made to enforce"
      },
      {
        "Time_Start": 2521.76,
        "Time_End": 2525.76,
        "Text": " that you authenticate using a smart card"
      },
      {
        "Time_Start": 2525.76,
        "Time_End": 2529.76,
        "Text": " in order to act as an Enterprise Admin, for example."
      },
      {
        "Time_Start": 2530.76,
        "Time_End": 2534.76,
        "Text": " So in Bloodhound, what we do is that we create this edge here"
      },
      {
        "Time_Start": 2534.76,
        "Time_End": 2537.76,
        "Text": " called ADCS escalation 13."
      },
      {
        "Time_Start": 2537.76,
        "Time_End": 2540.76,
        "Text": " That goes from the principles that have enrollment rights"
      },
      {
        "Time_Start": 2540.76,
        "Time_End": 2547.76,
        "Text": " on certificate templates that allows for this impersonation of a given group."
      },
      {
        "Time_Start": 2547.76,
        "Time_End": 2550.76,
        "Text": " And if you click on the composition graph,"
      },
      {
        "Time_Start": 2550.76,
        "Time_End": 2553.76,
        "Text": " then you will see that there will be a certificate template"
      },
      {
        "Time_Start": 2553.76,
        "Time_End": 2557.76,
        "Text": " that has this outbound edge called extended by policy,"
      },
      {
        "Time_Start": 2557.76,
        "Time_End": 2561.76,
        "Text": " which leads to this issuance policy object"
      },
      {
        "Time_Start": 2561.76,
        "Time_End": 2564.76,
        "Text": " that will then have an OID group link edge"
      },
      {
        "Time_Start": 2564.76,
        "Time_End": 2568.76,
        "Text": " that points to the group you can obtain membership in."
      },
      {
        "Time_Start": 2568.76,
        "Time_End": 2573.76,
        "Text": " Now, in this screenshot here, it's Enterprise Key Admins that I'm using."
      },
      {
        "Time_Start": 2573.76,
        "Time_End": 2578.76,
        "Text": " There's a reason behind I used Enterprise Admins and this group here."
      },
      {
        "Time_Start": 2578.76,
        "Time_End": 2582.76,
        "Text": " There's a requirement that the group must be a universal group,"
      },
      {
        "Time_Start": 2582.76,
        "Time_End": 2586.76,
        "Text": " and by default, Enterprise Key Admins and Enterprise Admins"
      },
      {
        "Time_Start": 2586.76,
        "Time_End": 2588.76,
        "Text": " are universal groups."
      },
      {
        "Time_Start": 2588.76,
        "Time_End": 2592.76,
        "Text": " There's also a requirement that the group must be empty,"
      },
      {
        "Time_Start": 2592.76,
        "Time_End": 2596.76,
        "Text": " and yeah, of course, an admin has to set it up."
      },
      {
        "Time_Start": 2596.76,
        "Time_End": 2601.76,
        "Text": " All the details of the escalation is written out in this blog post"
      },
      {
        "Time_Start": 2601.76,
        "Time_End": 2606.76,
        "Text": " that you can find in the link in the footer."
      },
      {
        "Time_Start": 2606.76,
        "Time_End": 2609.76,
        "Text": " So, back to Andy."
      },
      {
        "Time_Start": 2609.76,
        "Time_End": 2612.76,
        "Text": " Yeah, so how much time do we have left?"
      },
      {
        "Time_Start": 2613.76,
        "Time_End": 2616.76,
        "Text": " How much time do we want to be in here?"
      },
      {
        "Time_Start": 2616.76,
        "Time_End": 2618.76,
        "Text": " You said 15 minutes?"
      },
      {
        "Time_Start": 2618.76,
        "Time_End": 2620.76,
        "Text": " 20 minutes."
      },
      {
        "Time_Start": 2620.76,
        "Time_End": 2622.76,
        "Text": " 20 minutes."
      },
      {
        "Time_Start": 2622.76,
        "Time_End": 2624.76,
        "Text": " Holy cow."
      },
      {
        "Time_Start": 2624.76,
        "Time_End": 2626.76,
        "Text": " Okay."
      },
      {
        "Time_Start": 2626.76,
        "Time_End": 2628.76,
        "Text": " All right, so this next section,"
      },
      {
        "Time_Start": 2628.76,
        "Time_End": 2631.76,
        "Text": " Visualizing and Auditing the ADCS LDAP Hierarchy."
      },
      {
        "Time_Start": 2631.76,
        "Time_End": 2635.76,
        "Text": " So for various reasons, there can be a need to more easily understand"
      },
      {
        "Time_Start": 2635.76,
        "Time_End": 2638.76,
        "Text": " the relationships between these different objects"
      },
      {
        "Time_Start": 2638.76,
        "Time_End": 2643.76,
        "Text": " starting from ADCS Escalation 13, Escalation 1."
      },
      {
        "Time_Start": 2643.76,
        "Time_End": 2646.76,
        "Text": " I want to be able to dig into the relationships"
      },
      {
        "Time_Start": 2646.76,
        "Time_End": 2648.76,
        "Text": " between these different objects"
      },
      {
        "Time_Start": 2648.76,
        "Time_End": 2652.76,
        "Text": " without having to just see the very surface-level,"
      },
      {
        "Time_Start": 2652.76,
        "Time_End": 2654.76,
        "Text": " final post-processed edges."
      },
      {
        "Time_Start": 2654.76,
        "Time_End": 2656.76,
        "Text": " So we have that capability in the software as well."
      },
      {
        "Time_Start": 2656.76,
        "Time_End": 2660.76,
        "Text": " Also, the software that we're talking about today is free and open source."
      },
      {
        "Time_Start": 2660.76,
        "Time_End": 2664.76,
        "Text": " So nothing that we're talking about here is exclusive to our commercial product."
      },
      {
        "Time_Start": 2664.76,
        "Time_End": 2667.76,
        "Text": " Everything here is free and open source."
      },
      {
        "Time_Start": 2667.76,
        "Time_End": 2671.76,
        "Text": " Okay, so why does the product..."
      },
      {
        "Time_Start": 2671.76,
        "Time_End": 2674.76,
        "Text": " How does the product provide value with doing these things?"
      },
      {
        "Time_Start": 2674.76,
        "Time_End": 2677.76,
        "Text": " One is it can help drive an intuitive understanding."
      },
      {
        "Time_Start": 2677.76,
        "Time_End": 2682.76,
        "Text": " I think most of us understand visuals very well."
      },
      {
        "Time_Start": 2682.76,
        "Time_End": 2685.76,
        "Text": " You don't have to keep track of as many things in your head,"
      },
      {
        "Time_Start": 2685.76,
        "Time_End": 2688.76,
        "Text": " and connecting the dots is very simple."
      },
      {
        "Time_Start": 2688.76,
        "Time_End": 2691.76,
        "Text": " So it can make it dramatically simpler"
      },
      {
        "Time_Start": 2691.76,
        "Time_End": 2694.76,
        "Text": " to understand and keep track of the relationships"
      },
      {
        "Time_Start": 2694.76,
        "Time_End": 2696.76,
        "Text": " between these different objects."
      },
      {
        "Time_Start": 2696.76,
        "Time_End": 2700.76,
        "Text": " It can also greatly simplify the auditing process,"
      },
      {
        "Time_Start": 2700.76,
        "Time_End": 2703.76,
        "Text": " where if you pull up ADUC,"
      },
      {
        "Time_Start": 2703.76,
        "Time_End": 2705.76,
        "Text": " and you hit Advanced Features,"
      },
      {
        "Time_Start": 2705.76,
        "Time_End": 2707.76,
        "Text": " and you right-click on something, and you hit Properties,"
      },
      {
        "Time_Start": 2707.76,
        "Time_End": 2710.76,
        "Text": " and you hit Security tab, and you hit Advanced,"
      },
      {
        "Time_Start": 2710.76,
        "Time_End": 2714.76,
        "Text": " you're presented with the list of DACLs in canonical order,"
      },
      {
        "Time_Start": 2714.76,
        "Time_End": 2717.76,
        "Text": " but which ones have precedence over others,"
      },
      {
        "Time_Start": 2717.76,
        "Time_End": 2718.76,
        "Text": " if there's a Deny Ace?"
      },
      {
        "Time_Start": 2718.76,
        "Time_End": 2720.76,
        "Text": " Which ones mean something?"
      },
      {
        "Time_Start": 2720.76,
        "Time_End": 2722.76,
        "Text": " Who has looked at that GUI"
      },
      {
        "Time_Start": 2722.76,
        "Time_End": 2726.76,
        "Text": " and seen where the access mask column is blank,"
      },
      {
        "Time_Start": 2726.76,
        "Time_End": 2729.76,
        "Text": " where it just doesn't say what the access mask is?"
      },
      {
        "Time_Start": 2729.76,
        "Time_End": 2731.76,
        "Text": " I'm the only one."
      },
      {
        "Time_Start": 2731.76,
        "Time_End": 2733.76,
        "Text": " Thank you."
      },
      {
        "Time_Start": 2733.76,
        "Time_End": 2737.76,
        "Text": " So we suffer together on effectively auditing permissions"
      },
      {
        "Time_Start": 2737.76,
        "Time_End": 2741.76,
        "Text": " against securable objects in Windows and Active Directory."
      },
      {
        "Time_Start": 2741.76,
        "Time_End": 2743.76,
        "Text": " And then if you're on the red team side, if you're a defender,"
      },
      {
        "Time_Start": 2743.76,
        "Time_End": 2746.76,
        "Text": " if your job is to create a report for somebody"
      },
      {
        "Time_Start": 2746.76,
        "Time_End": 2748.76,
        "Text": " to then action and do things with,"
      },
      {
        "Time_Start": 2748.76,
        "Time_End": 2751.76,
        "Text": " then one of our intents with the free software"
      },
      {
        "Time_Start": 2751.76,
        "Time_End": 2756.76,
        "Text": " is to help you make better reports."
      },
      {
        "Time_Start": 2756.76,
        "Time_End": 2761.76,
        "Text": " So this query here is basically just saying,"
      },
      {
        "Time_Start": 2761.76,
        "Time_End": 2764.76,
        "Text": " and this is a repeat of what you're going to show later,"
      },
      {
        "Time_Start": 2764.76,
        "Time_End": 2766.76,
        "Text": " but basically this is just saying,"
      },
      {
        "Time_Start": 2766.76,
        "Time_End": 2770.76,
        "Text": " tell me any principle that has any ADCS escalation,"
      },
      {
        "Time_Start": 2770.76,
        "Time_End": 2773.76,
        "Text": " numbered escalation primitive, in any domain,"
      },
      {
        "Time_Start": 2773.76,
        "Time_End": 2776.76,
        "Text": " and then return to me the output."
      },
      {
        "Time_Start": 2776.76,
        "Time_End": 2779.76,
        "Text": " The visual shows on the left the users,"
      },
      {
        "Time_Start": 2779.76,
        "Time_End": 2781.76,
        "Text": " on the right the domains,"
      },
      {
        "Time_Start": 2781.76,
        "Time_End": 2786.76,
        "Text": " and the named escalation primitives that connect the two."
      },
      {
        "Time_Start": 2786.76,
        "Time_End": 2789.76,
        "Text": " So that query takes less than a millisecond,"
      },
      {
        "Time_Start": 2789.76,
        "Time_End": 2792.76,
        "Text": " and if you were going to try to do all of these calculations by hand,"
      },
      {
        "Time_Start": 2792.76,
        "Time_End": 2799.76,
        "Text": " it would take you days, weeks, and yeah."
      },
      {
        "Time_Start": 2799.76,
        "Time_End": 2803.76,
        "Text": " So if we click on one of these edges where it says ADCS escalation 4,"
      },
      {
        "Time_Start": 2803.76,
        "Time_End": 2807.76,
        "Text": " then on the right-hand side we have a entity panel about that edge"
      },
      {
        "Time_Start": 2807.76,
        "Time_End": 2811.76,
        "Text": " that gives us information about what that edge actually means."
      },
      {
        "Time_Start": 2811.76,
        "Time_End": 2814.76,
        "Text": " If we click on composition, we can see exactly what the issue is."
      },
      {
        "Time_Start": 2814.76,
        "Time_End": 2817.76,
        "Text": " So the user Davis has write DACL"
      },
      {
        "Time_Start": 2817.76,
        "Time_End": 2822.76,
        "Text": " against this certificate template called domain controller authentication,"
      },
      {
        "Time_Start": 2822.76,
        "Time_End": 2826.76,
        "Text": " and then everything else helps to have escalation 4 emerge"
      },
      {
        "Time_Start": 2826.76,
        "Time_End": 2830.76,
        "Text": " out of that plus everything else."
      },
      {
        "Time_Start": 2830.76,
        "Time_End": 2832.76,
        "Text": " What does write DACL mean?"
      },
      {
        "Time_Start": 2832.76,
        "Time_End": 2835.76,
        "Text": " So if you click on any edge,"
      },
      {
        "Time_Start": 2835.76,
        "Time_End": 2837.76,
        "Text": " but in this instance we're clicking on write DACL,"
      },
      {
        "Time_Start": 2837.76,
        "Time_End": 2843.76,
        "Text": " you'll have a plain English statement about what precisely that means."
      },
      {
        "Time_Start": 2843.76,
        "Time_End": 2845.76,
        "Text": " Why does that matter?"
      },
      {
        "Time_Start": 2845.76,
        "Time_End": 2848.76,
        "Text": " So hopefully that can make things a little easier to understand."
      },
      {
        "Time_Start": 2848.76,
        "Time_End": 2852.76,
        "Text": " You don't have to go look at the Microsoft documentation or whatever."
      },
      {
        "Time_Start": 2852.76,
        "Time_End": 2856.76,
        "Text": " Also on each of those there are references."
      },
      {
        "Time_Start": 2856.76,
        "Time_End": 2860.76,
        "Text": " So DACL abuse now is kind of like old tradecraft,"
      },
      {
        "Time_Start": 2860.76,
        "Time_End": 2863.76,
        "Text": " so there are a lot of references."
      },
      {
        "Time_Start": 2863.76,
        "Time_End": 2868.76,
        "Text": " Just in case you want to dig deeper into that abuse primitive."
      },
      {
        "Time_Start": 2868.76,
        "Time_End": 2871.76,
        "Text": " There are pre-built queries in the product."
      },
      {
        "Time_Start": 2871.76,
        "Time_End": 2877.76,
        "Text": " So if you click on Cypher and then click on the folder over there,"
      },
      {
        "Time_Start": 2877.76,
        "Time_End": 2880.76,
        "Text": " that will bring up the pre-built searches, which is a scrollable list."
      },
      {
        "Time_Start": 2880.76,
        "Time_End": 2883.76,
        "Text": " We have 15 minutes left? Thank you."
      },
      {
        "Time_Start": 2883.76,
        "Time_End": 2886.76,
        "Text": " This is a scrollable list, and so one of these is"
      },
      {
        "Time_Start": 2886.76,
        "Time_End": 2889.76,
        "Text": " enrollment rights on published ESC1 certificate templates."
      },
      {
        "Time_Start": 2889.76,
        "Time_End": 2892.76,
        "Text": " So that does the calculation for you of which principles"
      },
      {
        "Time_Start": 2892.76,
        "Time_End": 2894.76,
        "Text": " have the intersection of enrollment rights on the template"
      },
      {
        "Time_Start": 2894.76,
        "Time_End": 2897.76,
        "Text": " and a CA that the template is published to,"
      },
      {
        "Time_Start": 2897.76,
        "Time_End": 2900.76,
        "Text": " because remember you need both."
      },
      {
        "Time_Start": 2900.76,
        "Time_End": 2902.76,
        "Text": " Click on that and you'll see the results."
      },
      {
        "Time_Start": 2902.76,
        "Time_End": 2907.76,
        "Text": " Super easy, and you can start to identify"
      },
      {
        "Time_Start": 2907.76,
        "Time_End": 2911.76,
        "Text": " domain controllers can do ESC1, who cares?"
      },
      {
        "Time_Start": 2911.76,
        "Time_End": 2913.76,
        "Text": " Enterprise domain controllers, who cares, right?"
      },
      {
        "Time_Start": 2913.76,
        "Time_End": 2916.76,
        "Text": " But then Jones, I don't know who that is."
      },
      {
        "Time_Start": 2916.76,
        "Time_End": 2918.76,
        "Text": " Maybe that's valid, maybe it's not."
      },
      {
        "Time_Start": 2918.76,
        "Time_End": 2920.76,
        "Text": " It's an audit opportunity."
      },
      {
        "Time_Start": 2920.76,
        "Time_End": 2927.76,
        "Text": " It's an opportunity to prevent an attack from happening in the first place."
      },
      {
        "Time_Start": 2927.76,
        "Time_End": 2932.76,
        "Text": " And I was going to say something, but I'm not going to say it."
      },
      {
        "Time_Start": 2932.76,
        "Time_End": 2938.76,
        "Text": " An ounce of prevention is worth a ton of cure, let's say."
      },
      {
        "Time_Start": 2938.76,
        "Time_End": 2943.76,
        "Text": " So why focus on detecting the attack after it has happened"
      },
      {
        "Time_Start": 2943.76,
        "Time_End": 2948.76,
        "Text": " when you can just eliminate the possibility of it happening at all?"
      },
      {
        "Time_Start": 2948.76,
        "Time_End": 2951.76,
        "Text": " So here is a real example from a real customer environment"
      },
      {
        "Time_Start": 2951.76,
        "Time_End": 2956.76,
        "Text": " where we have clicked on the PKI hierarchy view."
      },
      {
        "Time_Start": 2956.76,
        "Time_End": 2961.76,
        "Text": " And so we can see the relationships from the domain head"
      },
      {
        "Time_Start": 2961.76,
        "Time_End": 2966.76,
        "Text": " to the root CAs, then to the enterprise CAs"
      },
      {
        "Time_Start": 2966.76,
        "Time_End": 2971.76,
        "Text": " that are issued and signed by the root CAs."
      },
      {
        "Time_Start": 2971.76,
        "Time_End": 2974.76,
        "Text": " And that can also be a nested relationship."
      },
      {
        "Time_Start": 2974.76,
        "Time_End": 2981.76,
        "Text": " It's like three-tier PKI that can unfurl the NT auth store,"
      },
      {
        "Time_Start": 2981.76,
        "Time_End": 2986.76,
        "Text": " the enterprise CAs, and then also the hosts that are associated"
      },
      {
        "Time_Start": 2986.76,
        "Time_End": 2990.76,
        "Text": " with the enterprise CA based on the DNS hostname attribute here."
      },
      {
        "Time_Start": 2990.76,
        "Time_End": 2995.76,
        "Text": " So that's like 99.9% that this host is the host that's actually running"
      },
      {
        "Time_Start": 2995.76,
        "Time_End": 3000.76,
        "Text": " the ADCS service associated with that enrollment service object."
      },
      {
        "Time_Start": 3000.76,
        "Time_End": 3003.76,
        "Text": " From there, you can start to click on these one by one"
      },
      {
        "Time_Start": 3003.76,
        "Time_End": 3006.76,
        "Text": " to audit the permissions on those."
      },
      {
        "Time_Start": 3006.76,
        "Time_End": 3009.76,
        "Text": " Here's another view. This is a different organization."
      },
      {
        "Time_Start": 3009.76,
        "Time_End": 3012.76,
        "Text": " So more domains."
      },
      {
        "Time_Start": 3012.76,
        "Time_End": 3016.76,
        "Text": " It doesn't matter how many domains' worth of information is in the database."
      },
      {
        "Time_Start": 3016.76,
        "Time_End": 3022.76,
        "Text": " It will happily visualize them like this for you."
      },
      {
        "Time_Start": 3022.76,
        "Time_End": 3026.76,
        "Text": " You can also visualize the public key services container."
      },
      {
        "Time_Start": 3026.76,
        "Time_End": 3030.76,
        "Text": " At this point, you're going to have to start zooming into things"
      },
      {
        "Time_Start": 3030.76,
        "Time_End": 3034.76,
        "Text": " to understand what you're looking at."
      },
      {
        "Time_Start": 3034.76,
        "Time_End": 3039.76,
        "Text": " If we zoom in and we look at one of the objects here,"
      },
      {
        "Time_Start": 3039.76,
        "Time_End": 3042.76,
        "Text": " so we have public key services, and then we have like"
      },
      {
        "Time_Start": 3042.76,
        "Time_End": 3047.76,
        "Text": " certification authorities, AIA, enrollment services, cert templates."
      },
      {
        "Time_Start": 3047.76,
        "Time_End": 3052.76,
        "Text": " At the top there, at the very top, we have the policies container."
      },
      {
        "Time_Start": 3052.76,
        "Time_End": 3056.76,
        "Text": " And then right below it, we have the NT auth certificates object."
      },
      {
        "Time_Start": 3056.76,
        "Time_End": 3059.76,
        "Text": " When you click on that, on the right-hand side,"
      },
      {
        "Time_Start": 3059.76,
        "Time_End": 3062.76,
        "Text": " we have the entity panel, which will tell you relevant information"
      },
      {
        "Time_Start": 3062.76,
        "Time_End": 3066.76,
        "Text": " that are just like the static properties from the object."
      },
      {
        "Time_Start": 3066.76,
        "Time_End": 3070.76,
        "Text": " The DN, the FQDN of the domain, the SID of the domain."
      },
      {
        "Time_Start": 3070.76,
        "Time_End": 3073.76,
        "Text": " And then also, right here, we have an item here"
      },
      {
        "Time_Start": 3073.76,
        "Time_End": 3075.76,
        "Text": " that says inbound object control."
      },
      {
        "Time_Start": 3075.76,
        "Time_End": 3078.76,
        "Text": " And that means the number of principles"
      },
      {
        "Time_Start": 3078.76,
        "Time_End": 3083.76,
        "Text": " that have some kind of abusable privilege over this object."
      },
      {
        "Time_Start": 3083.76,
        "Time_End": 3091.76,
        "Text": " Some kind of privilege that can turn it into Escalation 5, for example."
      },
      {
        "Time_Start": 3091.76,
        "Time_End": 3094.76,
        "Text": " If we click on that accordion item, it will unfurl out,"
      },
      {
        "Time_Start": 3094.76,
        "Time_End": 3098.76,
        "Text": " and we'll be able to see how exactly those different principles"
      },
      {
        "Time_Start": 3098.76,
        "Time_End": 3101.76,
        "Text": " have that permission against that object."
      },
      {
        "Time_Start": 3101.76,
        "Time_End": 3105.76,
        "Text": " So these edges represent the ace on the security descriptor"
      },
      {
        "Time_Start": 3105.76,
        "Time_End": 3107.76,
        "Text": " for the NT auth object."
      },
      {
        "Time_Start": 3107.76,
        "Time_End": 3111.76,
        "Text": " But then if it's a group that has that privilege,"
      },
      {
        "Time_Start": 3111.76,
        "Time_End": 3114.76,
        "Text": " there are members of that group, there are members of that group,"
      },
      {
        "Time_Start": 3114.76,
        "Time_End": 3116.76,
        "Text": " members of that group, etc."
      },
      {
        "Time_Start": 3116.76,
        "Time_End": 3119.76,
        "Text": " So it will unfurl out for you all of the principles"
      },
      {
        "Time_Start": 3119.76,
        "Time_End": 3121.76,
        "Text": " that have that kind of abusable privilege."
      },
      {
        "Time_Start": 3121.76,
        "Time_End": 3123.76,
        "Text": " This is something that's been in Bloodhound since 2016,"
      },
      {
        "Time_Start": 3123.76,
        "Time_End": 3125.76,
        "Text": " so this is probably nothing new to a lot of people."
      },
      {
        "Time_Start": 3125.76,
        "Time_End": 3128.76,
        "Text": " But in case you haven't seen this, this is the difference"
      },
      {
        "Time_Start": 3128.76,
        "Time_End": 3132.76,
        "Text": " between the pain that we share and no one else"
      },
      {
        "Time_Start": 3132.76,
        "Time_End": 3137.76,
        "Text": " versus actually being able to effectively audit these things."
      },
      {
        "Time_Start": 3137.76,
        "Time_End": 3140.76,
        "Text": " In Bloodhound, the little crown glyph"
      },
      {
        "Time_Start": 3140.76,
        "Time_End": 3144.76,
        "Text": " means that it is automatically tagged as a Tier 0 asset,"
      },
      {
        "Time_Start": 3144.76,
        "Time_End": 3147.76,
        "Text": " so it's domain admin, domain controller, etc."
      },
      {
        "Time_Start": 3147.76,
        "Time_End": 3149.76,
        "Text": " But what if it's missing that glyph?"
      },
      {
        "Time_Start": 3149.76,
        "Time_End": 3152.76,
        "Text": " So that could be a principle that has no business"
      },
      {
        "Time_Start": 3152.76,
        "Time_End": 3155.76,
        "Text": " having full control of the NT auth store object."
      },
      {
        "Time_Start": 3155.76,
        "Time_End": 3160.76,
        "Text": " Or maybe it does, and the permissions on this object"
      },
      {
        "Time_Start": 3160.76,
        "Time_End": 3162.76,
        "Text": " might be wildly out of control"
      },
      {
        "Time_Start": 3162.76,
        "Time_End": 3168.76,
        "Text": " because it's not protected the same way the domain admin is."
      },
      {
        "Time_Start": 3168.76,
        "Time_End": 3169.76,
        "Text": " Here's another example."
      },
      {
        "Time_Start": 3169.76,
        "Time_End": 3174.76,
        "Text": " So enrollment rights publish on certificate templates,"
      },
      {
        "Time_Start": 3174.76,
        "Time_End": 3180.76,
        "Text": " on ESC1 templates, so we can reduce the scope of that."
      },
      {
        "Time_Start": 3180.76,
        "Time_End": 3184.76,
        "Text": " We can also look at who are the CA administrators and CA managers."
      },
      {
        "Time_Start": 3184.76,
        "Time_End": 3186.76,
        "Text": " These should all be Tier 0 users."
      },
      {
        "Time_Start": 3186.76,
        "Time_End": 3189.76,
        "Text": " Oftentimes they are not."
      },
      {
        "Time_Start": 3189.76,
        "Time_End": 3192.76,
        "Text": " So I want to make sure we get to your section quickly."
      },
      {
        "Time_Start": 3192.76,
        "Time_End": 3195.76,
        "Text": " Everything you see in the GUI is driven by an API."
      },
      {
        "Time_Start": 3195.76,
        "Time_End": 3199.76,
        "Text": " The API documentation you can find by going to the top right,"
      },
      {
        "Time_Start": 3199.76,
        "Time_End": 3201.76,
        "Text": " hit the cogwheel, hit API Explorer."
      },
      {
        "Time_Start": 3201.76,
        "Time_End": 3205.76,
        "Text": " This is all self-documented Swagger API documentation."
      },
      {
        "Time_Start": 3205.76,
        "Time_End": 3208.76,
        "Text": " If you search for CA, you'll find relevant endpoints."
      },
      {
        "Time_Start": 3208.76,
        "Time_End": 3211.76,
        "Text": " The thing here on the right, if it's red,"
      },
      {
        "Time_Start": 3211.76,
        "Time_End": 3213.76,
        "Text": " it means that it's in Bloodhound CE."
      },
      {
        "Time_Start": 3213.76,
        "Time_End": 3216.76,
        "Text": " If it's purple, it means that it's in BHE."
      },
      {
        "Time_Start": 3216.76,
        "Time_End": 3219.76,
        "Text": " Most of the endpoints are in both."
      },
      {
        "Time_Start": 3219.76,
        "Time_End": 3221.76,
        "Text": " Then you can expand one of those out,"
      },
      {
        "Time_Start": 3221.76,
        "Time_End": 3226.76,
        "Text": " and you can see exactly how to make a request to that API,"
      },
      {
        "Time_Start": 3226.76,
        "Time_End": 3229.76,
        "Text": " and you can see an example of what the output looks like as well."
      },
      {
        "Time_Start": 3229.76,
        "Time_End": 3230.76,
        "Text": " So what does that mean?"
      },
      {
        "Time_Start": 3230.76,
        "Time_End": 3233.76,
        "Text": " That means that with the free software,"
      },
      {
        "Time_Start": 3233.76,
        "Time_End": 3238.76,
        "Text": " you don't have to be clicking around and hunting for things that are interesting."
      },
      {
        "Time_Start": 3238.76,
        "Time_End": 3240.76,
        "Text": " You can automate this if you would like."
      },
      {
        "Time_Start": 3240.76,
        "Time_End": 3242.76,
        "Text": " So you can automate that if you're internal,"
      },
      {
        "Time_Start": 3242.76,
        "Time_End": 3244.76,
        "Text": " or if you are a consultant,"
      },
      {
        "Time_Start": 3244.76,
        "Time_End": 3247.76,
        "Text": " you can automate this for your customers as well."
      },
      {
        "Time_Start": 3247.76,
        "Time_End": 3250.76,
        "Text": " Because as we all know, Active Directory is not static, it's dynamic."
      },
      {
        "Time_Start": 3250.76,
        "Time_End": 3252.76,
        "Text": " Things are changing all the time."
      },
      {
        "Time_Start": 3252.76,
        "Time_End": 3256.76,
        "Text": " Admins are installing software, making configuration changes, all that."
      },
      {
        "Time_Start": 3256.76,
        "Time_End": 3259.76,
        "Text": " So, yeah."
      },
      {
        "Time_Start": 3259.76,
        "Time_End": 3264.76,
        "Text": " Yeah, so the last section, let's try to fix some stuff."
      },
      {
        "Time_Start": 3264.76,
        "Time_End": 3267.76,
        "Text": " But first, we need to identify the things that we want to fix,"
      },
      {
        "Time_Start": 3267.76,
        "Time_End": 3270.76,
        "Text": " and Andy highlighted a bunch of things that you can do"
      },
      {
        "Time_Start": 3270.76,
        "Time_End": 3272.76,
        "Text": " in order to audit an environment."
      },
      {
        "Time_Start": 3272.76,
        "Time_End": 3277.76,
        "Text": " Here's like a GT query that finds all the non-tier 0 principles"
      },
      {
        "Time_Start": 3277.76,
        "Time_End": 3280.76,
        "Text": " that has an ADCS escalation edge."
      },
      {
        "Time_Start": 3280.76,
        "Time_End": 3283.76,
        "Text": " So as Andy said, we don't really care about enterprise admins"
      },
      {
        "Time_Start": 3283.76,
        "Time_End": 3285.76,
        "Text": " being able to impersonate users."
      },
      {
        "Time_Start": 3285.76,
        "Time_End": 3287.76,
        "Text": " They can do that in so many ways,"
      },
      {
        "Time_Start": 3287.76,
        "Time_End": 3292.76,
        "Text": " but we do care about the principles that are not supposed to be enterprise admins."
      },
      {
        "Time_Start": 3292.76,
        "Time_End": 3297.76,
        "Text": " So this query will help you identify that."
      },
      {
        "Time_Start": 3297.76,
        "Time_End": 3299.76,
        "Text": " There's a second query I want to share with you guys."
      },
      {
        "Time_Start": 3299.76,
        "Time_End": 3304.76,
        "Text": " As Andy mentioned, we don't have full support for escalation 5 yet in the product."
      },
      {
        "Time_Start": 3304.76,
        "Time_End": 3306.76,
        "Text": " Same for escalation 7."
      },
      {
        "Time_Start": 3306.76,
        "Time_End": 3308.76,
        "Text": " But we do collect the underlying permissions,"
      },
      {
        "Time_Start": 3308.76,
        "Time_End": 3316.76,
        "Text": " like, for example, generic all on the ADCS objects in Active Directory."
      },
      {
        "Time_Start": 3316.76,
        "Time_End": 3318.76,
        "Text": " This query will check for these kind of permissions."
      },
      {
        "Time_Start": 3318.76,
        "Time_End": 3322.76,
        "Text": " And, yeah, it's not a guarantee that it can't be abused"
      },
      {
        "Time_Start": 3322.76,
        "Time_End": 3324.76,
        "Text": " to compromise the environment,"
      },
      {
        "Time_Start": 3324.76,
        "Time_End": 3328.76,
        "Text": " but all these permissions, like control over ADCS objects,"
      },
      {
        "Time_Start": 3328.76,
        "Time_End": 3332.76,
        "Text": " is definitely something that you shouldn't grant to non-tier 0 principles."
      },
      {
        "Time_Start": 3332.76,
        "Time_End": 3337.76,
        "Text": " There's no reason that they should have this kind of control."
      },
      {
        "Time_Start": 3337.76,
        "Time_End": 3340.76,
        "Text": " So I want to focus on escalation 1 remediation"
      },
      {
        "Time_Start": 3340.76,
        "Time_End": 3346.76,
        "Text": " because escalation 1 is the most common thing that we see in our customers in environments."
      },
      {
        "Time_Start": 3346.76,
        "Time_End": 3350.76,
        "Text": " And just to recap, escalation 1 is where the certificate template has this"
      },
      {
        "Time_Start": 3350.76,
        "Time_End": 3356.76,
        "Text": " enrollee supply subject flag, which allows you to impersonate anyone."
      },
      {
        "Time_Start": 3356.76,
        "Time_End": 3360.76,
        "Text": " So if you can, then you can simply solve it"
      },
      {
        "Time_Start": 3360.76,
        "Time_End": 3363.76,
        "Text": " by limiting the enrollment rights on the certificate templates"
      },
      {
        "Time_Start": 3363.76,
        "Time_End": 3365.76,
        "Text": " to only be tier 0 principles."
      },
      {
        "Time_Start": 3365.76,
        "Time_End": 3369.76,
        "Text": " Then it's completely fine to have this impersonation possibility."
      },
      {
        "Time_Start": 3369.76,
        "Time_End": 3372.76,
        "Text": " You could also mitigate the problem by removing EQs"
      },
      {
        "Time_Start": 3372.76,
        "Time_End": 3374.76,
        "Text": " that allows for domain authentication"
      },
      {
        "Time_Start": 3374.76,
        "Time_End": 3378.76,
        "Text": " because then the attacker can only impersonate for maybe other things,"
      },
      {
        "Time_Start": 3378.76,
        "Time_End": 3382.76,
        "Text": " such as, like, signing things, which still could be a huge problem,"
      },
      {
        "Time_Start": 3382.76,
        "Time_End": 3387.76,
        "Text": " but at least they cannot authenticate and log in to the environment."
      },
      {
        "Time_Start": 3387.76,
        "Time_End": 3393.76,
        "Text": " Unfortunately, these remediation strategies are not always possible."
      },
      {
        "Time_Start": 3393.76,
        "Time_End": 3398.76,
        "Text": " There's a common scenario that we hear about quite a lot"
      },
      {
        "Time_Start": 3398.76,
        "Time_End": 3401.76,
        "Text": " where you have, like, a help desk or maybe IT support"
      },
      {
        "Time_Start": 3401.76,
        "Time_End": 3406.76,
        "Text": " that creates smart cards for other people in the organization."
      },
      {
        "Time_Start": 3406.76,
        "Time_End": 3409.76,
        "Text": " But there's a solution to that problem,"
      },
      {
        "Time_Start": 3409.76,
        "Time_End": 3414.76,
        "Text": " and that is enrollment agents, as we talked about in escalation 3."
      },
      {
        "Time_Start": 3414.76,
        "Time_End": 3416.76,
        "Text": " The cool thing about enrollment agents"
      },
      {
        "Time_Start": 3416.76,
        "Time_End": 3420.76,
        "Text": " is that you can set up these restrictions on the enterprise CA,"
      },
      {
        "Time_Start": 3420.76,
        "Time_End": 3422.76,
        "Text": " and you can define very granularly"
      },
      {
        "Time_Start": 3422.76,
        "Time_End": 3428.76,
        "Text": " what principles enrollment agents are allowed to impersonate."
      },
      {
        "Time_Start": 3428.76,
        "Time_End": 3430.76,
        "Text": " Cool."
      },
      {
        "Time_Start": 3430.76,
        "Time_End": 3434.76,
        "Text": " You might not know exactly what principles they are allowed to impersonate,"
      },
      {
        "Time_Start": 3434.76,
        "Time_End": 3436.76,
        "Text": " but you can also create deny rules,"
      },
      {
        "Time_Start": 3436.76,
        "Time_End": 3440.76,
        "Text": " so you can basically just say that IT support is allowed to impersonate anyone"
      },
      {
        "Time_Start": 3440.76,
        "Time_End": 3442.76,
        "Text": " except for tier 0 accounts,"
      },
      {
        "Time_Start": 3442.76,
        "Time_End": 3447.76,
        "Text": " and that way you have remediated attack paths to those accounts."
      },
      {
        "Time_Start": 3447.76,
        "Time_End": 3449.76,
        "Text": " You can also specify the certificate templates"
      },
      {
        "Time_Start": 3449.76,
        "Time_End": 3452.76,
        "Text": " they are allowed to do this impersonation in."
      },
      {
        "Time_Start": 3452.76,
        "Time_End": 3457.76,
        "Text": " So definitely recommend these enrollment agents restrictions."
      },
      {
        "Time_Start": 3457.76,
        "Time_End": 3462.76,
        "Text": " Unfortunately, I don't think Microsoft has written a guide to set it up,"
      },
      {
        "Time_Start": 3462.76,
        "Time_End": 3466.76,
        "Text": " so we'll have to look for third parties that have written guidelines"
      },
      {
        "Time_Start": 3466.76,
        "Time_End": 3470.76,
        "Text": " for setting these kind of enrollment agents up."
      },
      {
        "Time_Start": 3470.76,
        "Time_End": 3476.76,
        "Text": " Ubiqroo has written a pretty good guide, and there's a link to it here."
      },
      {
        "Time_Start": 3476.76,
        "Time_End": 3479.76,
        "Text": " So when I was creating these slides here,"
      },
      {
        "Time_Start": 3479.76,
        "Time_End": 3484.76,
        "Text": " I was looking for these vendor guides for setting up enrollment agents,"
      },
      {
        "Time_Start": 3484.76,
        "Time_End": 3487.76,
        "Text": " and I found this Ubiqroo guide that was really good."
      },
      {
        "Time_Start": 3487.76,
        "Time_End": 3492.76,
        "Text": " I also found this one where the text states that"
      },
      {
        "Time_Start": 3492.76,
        "Time_End": 3495.76,
        "Text": " when you're creating the enrollment agent certificate template,"
      },
      {
        "Time_Start": 3495.76,
        "Time_End": 3499.76,
        "Text": " then you should grant permissions to the principles"
      },
      {
        "Time_Start": 3499.76,
        "Time_End": 3504.76,
        "Text": " that will set up smart cards enrollment rights."
      },
      {
        "Time_Start": 3504.76,
        "Time_End": 3506.76,
        "Text": " But then in this screenshot,"
      },
      {
        "Time_Start": 3506.76,
        "Time_End": 3511.76,
        "Text": " they're granting authenticated users enrollment rights on the template."
      },
      {
        "Time_Start": 3511.76,
        "Time_End": 3516.76,
        "Text": " And in this guide, they don't set up any enrollment agents restrictions."
      },
      {
        "Time_Start": 3516.76,
        "Time_End": 3519.76,
        "Text": " So that basically just creates an escalation-free scenario"
      },
      {
        "Time_Start": 3519.76,
        "Time_End": 3523.76,
        "Text": " for authenticated users."
      },
      {
        "Time_Start": 3523.76,
        "Time_End": 3525.76,
        "Text": " Be very careful when you're reading vendor guides"
      },
      {
        "Time_Start": 3525.76,
        "Time_End": 3529.76,
        "Text": " because it's not always that they have thought about the consequences"
      },
      {
        "Time_Start": 3529.76,
        "Time_End": 3534.76,
        "Text": " of what they are recommending."
      },
      {
        "Time_Start": 3534.76,
        "Time_End": 3540.76,
        "Text": " Cool. That summarizes everything."
      },
      {
        "Time_Start": 3540.76,
        "Time_End": 3541.76,
        "Text": " Thanks."
      },
      {
        "Time_Start": 3541.76,
        "Time_End": 3542.76,
        "Text": " Yeah, thank you."
      },
      {
        "Time_Start": 3542.76,
        "Time_End": 3552.76,
        "Text": " Thank you."
      },
      {
        "Time_Start": 3552.76,
        "Time_End": 3557.76,
        "Text": " I think I saw one question in the back earlier that I asked for the end,"
      },
      {
        "Time_Start": 3557.76,
        "Time_End": 3562.76,
        "Text": " but maybe we already answered your question, or maybe not."
      },
      {
        "Time_Start": 3562.76,
        "Time_End": 3568.76,
        "Text": " Do you want to ask your question?"
      },
      {
        "Time_Start": 3568.76,
        "Time_End": 3570.76,
        "Text": " Thanks for your super interesting talk."
      },
      {
        "Time_Start": 3570.76,
        "Time_End": 3572.76,
        "Text": " Very nice to hear."
      },
      {
        "Time_Start": 3572.76,
        "Time_End": 3577.76,
        "Text": " When you showed the example of adding a custom CA to a domain"
      },
      {
        "Time_Start": 3577.76,
        "Time_End": 3583.76,
        "Text": " that does not yet have any CA configured,"
      },
      {
        "Time_Start": 3583.76,
        "Time_End": 3589.76,
        "Text": " you then did a PKI init authentication with this newly created user certificate"
      },
      {
        "Time_Start": 3589.76,
        "Time_End": 3593.76,
        "Text": " and got back the NT hash."
      },
      {
        "Time_Start": 3593.76,
        "Time_End": 3595.76,
        "Text": " For this PKI init to complete,"
      },
      {
        "Time_Start": 3595.76,
        "Time_End": 3598.76,
        "Text": " the domain controller needs a domain controller certificate."
      },
      {
        "Time_Start": 3598.76,
        "Time_End": 3601.76,
        "Text": " And when you set up a new CA,"
      },
      {
        "Time_Start": 3601.76,
        "Time_End": 3604.76,
        "Text": " you usually run in an error from a domain controller saying,"
      },
      {
        "Time_Start": 3604.76,
        "Time_End": 3608.76,
        "Text": " I need a domain controller certificate first."
      },
      {
        "Time_Start": 3608.76,
        "Time_End": 3614.76,
        "Text": " Your client may not validate this because you want to extract the NT password hash."
      },
      {
        "Time_Start": 3614.76,
        "Time_End": 3619.76,
        "Text": " But how comes that this just completed here?"
      },
      {
        "Time_Start": 3619.76,
        "Time_End": 3624.76,
        "Text": " I don't know. Do you know?"
      },
      {
        "Time_Start": 3625.76,
        "Time_End": 3629.76,
        "Text": " In order to get it working apart,"
      },
      {
        "Time_Start": 3629.76,
        "Time_End": 3634.76,
        "Text": " the fact that the CA has to be published and pushed via group policy,"
      },
      {
        "Time_Start": 3634.76,
        "Time_End": 3638.76,
        "Text": " there is another requirement that for PKI init to work,"
      },
      {
        "Time_Start": 3638.76,
        "Time_End": 3644.76,
        "Text": " the domain controller needs to have a domain controller and Kerberos certificate."
      },
      {
        "Time_Start": 3644.76,
        "Time_End": 3647.76,
        "Text": " I don't remember exactly which one of the two,"
      },
      {
        "Time_Start": 3647.76,
        "Time_End": 3651.76,
        "Text": " but this is when you have a CA, this is by default installed."
      },
      {
        "Time_Start": 3651.76,
        "Time_End": 3656.76,
        "Text": " But sometimes you can run in a situation where some domain controller don't have it."
      },
      {
        "Time_Start": 3656.76,
        "Time_End": 3661.76,
        "Text": " And I run in this situation and just reach to another domain controller who had it and it was fine."
      },
      {
        "Time_Start": 3661.76,
        "Time_End": 3663.76,
        "Text": " So that can happen."
      },
      {
        "Time_Start": 3663.76,
        "Time_End": 3665.76,
        "Text": " Okay. That was a really good question."
      },
      {
        "Time_Start": 3665.76,
        "Time_End": 3668.76,
        "Text": " I don't know, but it sounds like Andrea knows."
      },
      {
        "Time_Start": 3668.76,
        "Time_End": 3672.76,
        "Text": " Yeah."
      },
      {
        "Time_Start": 3672.76,
        "Time_End": 3677.76,
        "Text": " Any other questions?"
      },
      {
        "Time_Start": 3678.76,
        "Time_End": 3682.76,
        "Text": " In escalation 5 scenario,"
      },
      {
        "Time_Start": 3682.76,
        "Time_End": 3687.76,
        "Text": " when you issue certificate for the domain admin,"
      },
      {
        "Time_Start": 3687.76,
        "Time_End": 3691.76,
        "Text": " by the certification authority that is not yet trusted,"
      },
      {
        "Time_Start": 3691.76,
        "Time_End": 3697.76,
        "Text": " because you had to open the port on the domain controller using the domain admin."
      },
      {
        "Time_Start": 3697.76,
        "Time_End": 3702.76,
        "Text": " No, no, no. So I opened the port on the attacker system."
      },
      {
        "Time_Start": 3702.76,
        "Time_End": 3709.76,
        "Text": " Because the DC, it needs to check the CRL for the CA when it is validating it for the very first time."
      },
      {
        "Time_Start": 3709.76,
        "Time_End": 3714.76,
        "Text": " So on the attacker machine, if you will, that's where I opened the port."
      },
      {
        "Time_Start": 3714.76,
        "Time_End": 3718.76,
        "Text": " It could be anywhere. It could be hosted anywhere."
      },
      {
        "Time_Start": 3718.76,
        "Time_End": 3726.76,
        "Text": " And so when the DC is checking the CRL, it makes a HTTP request to that host."
      },
      {
        "Time_Start": 3726.76,
        "Time_End": 3729.76,
        "Text": " And so that's where the port was opened."
      },
      {
        "Time_Start": 3729.76,
        "Time_End": 3734.76,
        "Text": " So opening port 80 on Windows, I don't know if you need admin rights."
      },
      {
        "Time_Start": 3734.76,
        "Time_End": 3736.76,
        "Text": " Like, no. Okay. Yeah."
      },
      {
        "Time_Start": 3736.76,
        "Time_End": 3737.76,
        "Text": " Did that answer your question?"
      },
      {
        "Time_Start": 3737.76,
        "Time_End": 3739.76,
        "Text": " Yeah, yeah. I just missed that part."
      },
      {
        "Time_Start": 3739.76,
        "Time_End": 3740.76,
        "Text": " Oh."
      },
      {
        "Time_Start": 3740.76,
        "Time_End": 3742.76,
        "Text": " I saw it was done on the actually."
      },
      {
        "Time_Start": 3742.76,
        "Time_End": 3744.76,
        "Text": " The video I edited, it was like super fast."
      },
      {
        "Time_Start": 3744.76,
        "Time_End": 3751.76,
        "Text": " So yeah, not your fault."
      },
      {
        "Time_Start": 3751.76,
        "Time_End": 3752.76,
        "Text": " Anything else?"
      },
      {
        "Time_Start": 3752.76,
        "Time_End": 3757.76,
        "Text": " A question over here."
      },
      {
        "Time_Start": 3758.76,
        "Time_End": 3760.76,
        "Text": " I have a question about exclusion file."
      },
      {
        "Time_Start": 3760.76,
        "Time_End": 3764.76,
        "Text": " Because it's very complicated and it's still self-working."
      },
      {
        "Time_Start": 3764.76,
        "Time_End": 3772.76,
        "Text": " Does any communication thread discussion about the exclusion file attack summary?"
      },
      {
        "Time_Start": 3772.76,
        "Time_End": 3775.76,
        "Text": " Because they have a lot of different combinations, right?"
      },
      {
        "Time_Start": 3775.76,
        "Time_End": 3776.76,
        "Text": " Yeah."
      },
      {
        "Time_Start": 3776.76,
        "Time_End": 3779.76,
        "Text": " Does any test or discussion about this?"
      },
      {
        "Time_Start": 3779.76,
        "Time_End": 3781.76,
        "Text": " Or is there already a document?"
      },
      {
        "Time_Start": 3781.76,
        "Time_End": 3784.76,
        "Text": " Like what our solution is?"
      },
      {
        "Time_Start": 3785.76,
        "Time_End": 3787.76,
        "Text": " Or like what our idea is for solving it?"
      },
      {
        "Time_Start": 3787.76,
        "Time_End": 3790.76,
        "Text": " Oh, I mean, because they are different combined."
      },
      {
        "Time_Start": 3790.76,
        "Time_End": 3791.76,
        "Text": " Permission combined."
      },
      {
        "Time_Start": 3791.76,
        "Time_End": 3792.76,
        "Text": " Yeah."
      },
      {
        "Time_Start": 3792.76,
        "Time_End": 3796.76,
        "Text": " So there's any summarized documentation."
      },
      {
        "Time_Start": 3796.76,
        "Time_End": 3797.76,
        "Text": " No, there's not."
      },
      {
        "Time_Start": 3797.76,
        "Time_End": 3801.76,
        "Text": " Because, like, remember the puzzle piece analogy?"
      },
      {
        "Time_Start": 3801.76,
        "Time_End": 3802.76,
        "Text": " Yes."
      },
      {
        "Time_Start": 3802.76,
        "Time_End": 3805.76,
        "Text": " So if you take the number of requirements for escalation one,"
      },
      {
        "Time_Start": 3805.76,
        "Time_End": 3808.76,
        "Text": " it probably numbers like 12 or 13."
      },
      {
        "Time_Start": 3809.76,
        "Time_End": 3816.76,
        "Text": " So then the number of combinations is going to be some, not the factorial of 12,"
      },
      {
        "Time_Start": 3816.76,
        "Time_End": 3822.76,
        "Text": " but like some factor of the combination that, like,"
      },
      {
        "Time_Start": 3822.76,
        "Time_End": 3824.76,
        "Text": " where those puzzle pieces can fit together."
      },
      {
        "Time_Start": 3824.76,
        "Time_End": 3833.76,
        "Text": " So the number of combinations that we have so far is 40 to 50 combinations."
      },
      {
        "Time_Start": 3833.76,
        "Time_End": 3841.76,
        "Text": " Where it just depends on maybe I have, like, generic right on this object,"
      },
      {
        "Time_Start": 3841.76,
        "Time_End": 3845.76,
        "Text": " and then maybe I have enroll rights through this other path."
      },
      {
        "Time_Start": 3845.76,
        "Time_End": 3850.76,
        "Text": " Or maybe I have generic all on the services container,"
      },
      {
        "Time_Start": 3850.76,
        "Time_End": 3853.76,
        "Text": " but that only inherits down to a certain class of object,"
      },
      {
        "Time_Start": 3853.76,
        "Time_End": 3856.76,
        "Text": " and then I have another way to make up for it somewhere else."
      },
      {
        "Time_Start": 3856.76,
        "Time_End": 3860.76,
        "Text": " So there's at least 40 to 50 different combinations."
      },
      {
        "Time_Start": 3860.76,
        "Time_End": 3863.76,
        "Text": " But, yeah."
      },
      {
        "Time_Start": 3863.76,
        "Time_End": 3870.76,
        "Text": " I think, like, that we can break it down into, like, categories."
      },
      {
        "Time_Start": 3870.76,
        "Time_End": 3875.76,
        "Text": " But the reason why it gets to, like, a lot of scenarios is that, like,"
      },
      {
        "Time_Start": 3875.76,
        "Time_End": 3880.76,
        "Text": " let's say you almost have an escalation 13 attack path,"
      },
      {
        "Time_Start": 3880.76,
        "Time_End": 3883.76,
        "Text": " but the certificate template is not published,"
      },
      {
        "Time_Start": 3883.76,
        "Time_End": 3886.76,
        "Text": " but you have the right to publish certificate templates."
      },
      {
        "Time_Start": 3886.76,
        "Time_End": 3888.76,
        "Text": " That's one case."
      },
      {
        "Time_Start": 3888.76,
        "Time_End": 3892.76,
        "Text": " But then there's also, like, the same case for escalation 1,"
      },
      {
        "Time_Start": 3892.76,
        "Time_End": 3895.76,
        "Text": " and there's the same case for escalation 3."
      },
      {
        "Time_Start": 3895.76,
        "Time_End": 3898.76,
        "Text": " And the attacker steps are all different each time"
      },
      {
        "Time_Start": 3898.76,
        "Time_End": 3902.76,
        "Text": " because there are different requirements."
      },
      {
        "Time_Start": 3902.76,
        "Time_End": 3907.76,
        "Text": " So the enabling permission will still be, like,"
      },
      {
        "Time_Start": 3907.76,
        "Time_End": 3912.76,
        "Text": " control over the enterprise CA in order to publish a certificate template."
      },
      {
        "Time_Start": 3912.76,
        "Time_End": 3915.76,
        "Text": " So in that way we can put everything into that category."
      },
      {
        "Time_Start": 3915.76,
        "Time_End": 3919.76,
        "Text": " But then there's also the combination of that thing is missing,"
      },
      {
        "Time_Start": 3919.76,
        "Time_End": 3923.76,
        "Text": " but then the enterprise CA is not trusted for NG authentication."
      },
      {
        "Time_Start": 3923.76,
        "Time_End": 3928.76,
        "Text": " So we add that as another one, and then, like, it just, yeah, it adds up."
      },
      {
        "Time_Start": 3928.76,
        "Time_End": 3930.76,
        "Text": " Yeah."
      },
      {
        "Time_Start": 3930.76,
        "Time_End": 3935.76,
        "Text": " But we have some ideas for implementing it into the product."
      },
      {
        "Time_Start": 3935.76,
        "Time_End": 3939.76,
        "Text": " Unfortunately, we haven't gotten to a full, like, agreement"
      },
      {
        "Time_Start": 3939.76,
        "Time_End": 3941.76,
        "Text": " on, like, exactly how we should do it."
      },
      {
        "Time_Start": 3941.76,
        "Time_End": 3944.76,
        "Text": " So it's, like, we want to implement it in a way"
      },
      {
        "Time_Start": 3944.76,
        "Time_End": 3948.76,
        "Text": " that it's both useful for defenders and attackers."
      },
      {
        "Time_Start": 3948.76,
        "Time_End": 3949.76,
        "Text": " Yeah."
      },
      {
        "Time_Start": 3949.76,
        "Time_End": 3951.76,
        "Text": " And also that we don't have to rebuild it later on"
      },
      {
        "Time_Start": 3951.76,
        "Time_End": 3953.76,
        "Text": " when we realize we missed some crucial element"
      },
      {
        "Time_Start": 3953.76,
        "Time_End": 3955.76,
        "Text": " and have to re-architect it."
      },
      {
        "Time_Start": 3955.76,
        "Time_End": 3959.76,
        "Text": " So the documentation we have for explaining escalation 5"
      },
      {
        "Time_Start": 3959.76,
        "Time_End": 3961.76,
        "Text": " is mostly just internal."
      },
      {
        "Time_Start": 3961.76,
        "Time_End": 3964.76,
        "Text": " It's not, like, trade secret or anything like that."
      },
      {
        "Time_Start": 3964.76,
        "Time_End": 3969.76,
        "Text": " It's just, like, it's not in a format that's, like, great for public access."
      },
      {
        "Time_Start": 3969.76,
        "Time_End": 3971.76,
        "Text": " But eventually we will put something out"
      },
      {
        "Time_Start": 3971.76,
        "Time_End": 3976.76,
        "Text": " to help organize the different classes of escalation 5 like that."
      },
      {
        "Time_Start": 3976.76,
        "Time_End": 3978.76,
        "Text": " Yeah."
      },
      {
        "Time_Start": 3978.76,
        "Time_End": 3980.76,
        "Text": " I hope that answers your question."
      },
      {
        "Time_Start": 3980.76,
        "Time_End": 3985.76,
        "Text": " Okay."
      },
      {
        "Time_Start": 3985.76,
        "Time_End": 3992.76,
        "Text": " Oh, here's a question over here."
      },
      {
        "Time_Start": 3992.76,
        "Time_End": 3996.76,
        "Text": " So regarding creating your own CA,"
      },
      {
        "Time_Start": 3996.76,
        "Time_End": 3998.76,
        "Text": " so in a pentest or a retina engagement,"
      },
      {
        "Time_Start": 3998.76,
        "Time_End": 4002.76,
        "Text": " how to can unmount all these changes?"
      },
      {
        "Time_Start": 4002.76,
        "Time_End": 4005.76,
        "Text": " Because I left the enterprise unsecure."
      },
      {
        "Time_Start": 4005.76,
        "Time_End": 4007.76,
        "Text": " Yeah."
      },
      {
        "Time_Start": 4007.76,
        "Time_End": 4008.76,
        "Text": " Yeah, that's a great question."
      },
      {
        "Time_Start": 4008.76,
        "Time_End": 4012.76,
        "Text": " Like, you don't want to leave the network"
      },
      {
        "Time_Start": 4012.76,
        "Time_End": 4017.76,
        "Text": " in a degraded security posture after the assessment is over."
      },
      {
        "Time_Start": 4017.76,
        "Time_End": 4020.76,
        "Text": " You don't want to make your customer less secure as a result of the work."
      },
      {
        "Time_Start": 4020.76,
        "Time_End": 4026.76,
        "Text": " So in my testing, the specific actions that I took here"
      },
      {
        "Time_Start": 4026.76,
        "Time_End": 4028.76,
        "Text": " can be undone pretty simply."
      },
      {
        "Time_Start": 4028.76,
        "Time_End": 4032.76,
        "Text": " So when you remove the certification authority object"
      },
      {
        "Time_Start": 4032.76,
        "Time_End": 4035.76,
        "Text": " from the certification authority container,"
      },
      {
        "Time_Start": 4035.76,
        "Time_End": 4038.76,
        "Text": " when group policy runs on the domain controller the next time,"
      },
      {
        "Time_Start": 4038.76,
        "Time_End": 4041.76,
        "Text": " it will actually then go and it will remove that CA"
      },
      {
        "Time_Start": 4041.76,
        "Time_End": 4046.76,
        "Text": " from the trosep root CA store on every domain endpoint."
      },
      {
        "Time_Start": 4047.76,
        "Time_End": 4050.76,
        "Text": " And then if you want to remove the change that you made"
      },
      {
        "Time_Start": 4050.76,
        "Time_End": 4055.76,
        "Text": " to the ntauth store object, it's like what you should do"
      },
      {
        "Time_Start": 4055.76,
        "Time_End": 4059.76,
        "Text": " is you should make a copy of what that value is first."
      },
      {
        "Time_Start": 4059.76,
        "Time_End": 4061.76,
        "Text": " Then modify it."
      },
      {
        "Time_Start": 4061.76,
        "Time_End": 4063.76,
        "Text": " And then put it back into the state that it was before."
      },
      {
        "Time_Start": 4063.76,
        "Time_End": 4067.76,
        "Text": " So that particular version of escalation 5"
      },
      {
        "Time_Start": 4067.76,
        "Time_End": 4069.76,
        "Text": " is pretty easy to clean up."
      },
      {
        "Time_Start": 4069.76,
        "Time_End": 4071.76,
        "Text": " The other ones are probably pretty similar."
      },
      {
        "Time_Start": 4071.76,
        "Time_End": 4075.76,
        "Text": " But that's also I think partly the onus is on us"
      },
      {
        "Time_Start": 4075.76,
        "Time_End": 4077.76,
        "Text": " to share that information as well"
      },
      {
        "Time_Start": 4077.76,
        "Time_End": 4080.76,
        "Text": " when we actually do finally publish this."
      },
      {
        "Time_Start": 4080.76,
        "Time_End": 4083.76,
        "Text": " Because I think I agree with what I think you're saying,"
      },
      {
        "Time_Start": 4083.76,
        "Time_End": 4088.76,
        "Text": " which is you shouldn't make your clients less secure during this work."
      },
      {
        "Time_Start": 4088.76,
        "Time_End": 4090.76,
        "Text": " Yeah."
      },
      {
        "Time_Start": 4091.76,
        "Time_End": 4093.76,
        "Text": " Thank you."
      },
      {
        "Time_Start": 4097.76,
        "Time_End": 4100.76,
        "Text": " Okay. Guys, thank you."
      },
      {
        "Time_Start": 4100.76,
        "Time_End": 4103.76,
        "Text": " If there are no more questions,"
      },
      {
        "Time_Start": 4103.76,
        "Time_End": 4107.76,
        "Text": " the reward for staying around so long"
      },
      {
        "Time_Start": 4107.76,
        "Time_End": 4111.76,
        "Text": " is hopefully a short line at the buffet and at the bar."
      },
      {
        "Time_Start": 4111.76,
        "Time_End": 4113.76,
        "Text": " So yeah."
      },
      {
        "Time_Start": 4113.76,
        "Time_End": 4115.76,
        "Text": " Let's go have dinner, guys."
      },
      {
        "Time_Start": 4115.76,
        "Time_End": 4117.76,
        "Text": " I hope you had a great day."
      },
      {
        "Time_Start": 4117.76,
        "Time_End": 4118.76,
        "Text": " Have a great evening."
      },
      {
        "Time_Start": 4118.76,
        "Time_End": 4119.76,
        "Text": " Please stick with us."
      },
      {
        "Time_Start": 4119.76,
        "Time_End": 4121.76,
        "Text": " See you guys tomorrow."
      }
    ]
  }
}