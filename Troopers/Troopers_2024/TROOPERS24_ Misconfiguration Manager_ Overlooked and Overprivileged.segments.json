{
  "metadata": {
    "webpage_url": "https://www.youtube.com/watch?v=GhT6nPes1h0",
    "title": "TROOPERS24: Misconfiguration Manager: Overlooked and Overprivileged",
    "description": "Talk by Duane Michael and Chris Thompson - June 27th, 2024 at TROOPERS24 IT security conference in Heidelberg, Germany hosted by @ERNW_ITSec\n\n#TROOPERS24 #ITsecurity \nhttps://troopers.de/troopers24/talks/nvp3zs/\n\nMore impressions:\n  / wearetroopers  \n  / ernw_itsec  \nhttps://infosec.exchange/@WEareTROOPERS\nhttps://infosec.exchange/@ERNW https://ernw.de",
    "channel_url": "https://www.youtube.com/channel/UCPY5aUREHmbDO4PtR6AYLfQ",
    "duration": 3697,
    "channel": "TROOPERS IT Security Conference",
    "uploader": "TROOPERS IT Security Conference",
    "upload_date": "20240909"
  },
  "segments": {
    "metadata": {
      "webpage_url": "https://www.youtube.com/watch?v=GhT6nPes1h0",
      "title": "TROOPERS24: Misconfiguration Manager: Overlooked and Overprivileged",
      "description": "Talk by Duane Michael and Chris Thompson - June 27th, 2024 at TROOPERS24 IT security conference in Heidelberg, Germany hosted by @ERNW_ITSec\n\n#TROOPERS24 #ITsecurity \nhttps://troopers.de/troopers24/talks/nvp3zs/\n\nMore impressions:\n  / wearetroopers  \n  / ernw_itsec  \nhttps://infosec.exchange/@WEareTROOPERS\nhttps://infosec.exchange/@ERNW https://ernw.de",
      "channel_url": "https://www.youtube.com/channel/UCPY5aUREHmbDO4PtR6AYLfQ",
      "duration": 3697,
      "channel": "TROOPERS IT Security Conference",
      "uploader": "TROOPERS IT Security Conference",
      "upload_date": "20240909"
    },
    "segments": [
      {
        "Time_Start": 0.0,
        "Time_End": 15.52,
        "Text": "This text was transcribed using whisper model: large-v2\n\n Hello, thank you."
      },
      {
        "Time_Start": 15.52,
        "Time_End": 19.04,
        "Text": " So yeah, we're going to talk about SCCM, we were actually about to ask that question,"
      },
      {
        "Time_Start": 19.04,
        "Time_End": 22.52,
        "Text": " so he got a little bit ahead of us."
      },
      {
        "Time_Start": 22.52,
        "Time_End": 27.28,
        "Text": " So we have a QR code up here with the slide deck, so if anyone wants to download that,"
      },
      {
        "Time_Start": 27.28,
        "Time_End": 31.840000000000003,
        "Text": " follow along, it's hosted on the GitHub repository that we're going to talk about, so feel free"
      },
      {
        "Time_Start": 31.840000000000003,
        "Time_End": 33.04,
        "Text": " to do that."
      },
      {
        "Time_Start": 33.04,
        "Time_End": 40.04,
        "Text": " If you don't grab it this time, it's also at the end."
      },
      {
        "Time_Start": 40.04,
        "Time_End": 44.2,
        "Text": " So my name is Dwayne Michael, I'm a managing consultant at Specter Ops on the Adversary"
      },
      {
        "Time_Start": 44.2,
        "Time_End": 51.88,
        "Text": " Simulation team, I have contributed, wrote some code for Sharp SCCM, my handle is subatomic"
      },
      {
        "Time_Start": 51.88,
        "Time_End": 54.040000000000006,
        "Text": " on all the different things."
      },
      {
        "Time_Start": 54.04,
        "Time_End": 58.92,
        "Text": " At Specter Ops, I do pentests, red teams, also teach some of our courses like red team"
      },
      {
        "Time_Start": 58.92,
        "Time_End": 59.92,
        "Text": " operations."
      },
      {
        "Time_Start": 59.92,
        "Time_End": 65.96,
        "Text": " I'm Chris Thompson, I'm a principal consultant at Specter Ops on the Adversary Simulation"
      },
      {
        "Time_Start": 65.96,
        "Time_End": 66.96,
        "Text": " team."
      },
      {
        "Time_Start": 66.96,
        "Time_End": 73.44,
        "Text": " I wrote Sharp SCCM about three years ago when we first started this research, and I also"
      },
      {
        "Time_Start": 73.44,
        "Time_End": 78.64,
        "Text": " wanted to introduce our coworker Garrett Foster, who is a co-author of the Misconfiguration"
      },
      {
        "Time_Start": 78.64,
        "Time_End": 82.36,
        "Text": " Manager project with us, couldn't be here today."
      },
      {
        "Time_Start": 82.36,
        "Time_End": 87.16,
        "Text": " If you've heard of SCCM Hunter, any of the red teamers in the room, that was Garrett's"
      },
      {
        "Time_Start": 87.16,
        "Time_End": 90.52,
        "Text": " tool."
      },
      {
        "Time_Start": 90.52,
        "Time_End": 97.64,
        "Text": " So we were going to ask a couple questions, I wanted to see who in the room is a defender?"
      },
      {
        "Time_Start": 97.64,
        "Time_End": 101.72,
        "Text": " Okay, about a third, maybe some people didn't raise their hands."
      },
      {
        "Time_Start": 101.72,
        "Time_End": 102.72,
        "Text": " How about attackers?"
      },
      {
        "Time_Start": 102.72,
        "Time_End": 106.44,
        "Text": " Okay, probably about 50-50."
      },
      {
        "Time_Start": 106.44,
        "Time_End": 107.44,
        "Text": " And both, who's both?"
      },
      {
        "Time_Start": 107.44,
        "Time_End": 108.44,
        "Text": " There we go."
      },
      {
        "Time_Start": 109.24,
        "Time_End": 110.24,
        "Text": " All right, I think that's everybody."
      },
      {
        "Time_Start": 110.24,
        "Time_End": 111.24,
        "Text": " Cool."
      },
      {
        "Time_Start": 111.24,
        "Time_End": 114.6,
        "Text": " So who's heard of SCCM?"
      },
      {
        "Time_Start": 114.6,
        "Time_End": 115.6,
        "Text": " Pretty much everybody."
      },
      {
        "Time_Start": 115.6,
        "Time_End": 116.6,
        "Text": " Okay, cool."
      },
      {
        "Time_Start": 116.6,
        "Time_End": 122.12,
        "Text": " It seemed like maybe a quarter of folks were using it, or at least knew that they were"
      },
      {
        "Time_Start": 122.12,
        "Time_End": 124.03999999999999,
        "Text": " using it."
      },
      {
        "Time_Start": 124.03999999999999,
        "Time_End": 127.03999999999999,
        "Text": " Who's not sure if they have SCCM at their organization?"
      },
      {
        "Time_Start": 127.03999999999999,
        "Time_End": 132.92,
        "Text": " All right, cool, we'll help you out."
      },
      {
        "Time_Start": 132.92000000000002,
        "Time_End": 140.64000000000001,
        "Text": " For those who do use SCCM, who has a remote site database or SMS provider, or knows if"
      },
      {
        "Time_Start": 140.64000000000001,
        "Time_End": 141.88000000000002,
        "Text": " they do?"
      },
      {
        "Time_Start": 141.88000000000002,
        "Time_End": 142.88000000000002,
        "Text": " Okay."
      },
      {
        "Time_Start": 142.88000000000002,
        "Time_End": 146.08,
        "Text": " One, this talk is definitely for you."
      },
      {
        "Time_Start": 146.08,
        "Time_End": 148.28000000000003,
        "Text": " Who's got a network access account?"
      },
      {
        "Time_Start": 148.28000000000003,
        "Time_End": 149.96,
        "Text": " Anybody?"
      },
      {
        "Time_Start": 149.96,
        "Time_End": 152.24,
        "Text": " Client push installation?"
      },
      {
        "Time_Start": 152.24,
        "Time_End": 156.76000000000002,
        "Text": " Red teamers in the house, who has compromised an Active Directory domain or forest through"
      },
      {
        "Time_Start": 156.76000000000002,
        "Time_End": 157.76000000000002,
        "Text": " SCCM?"
      },
      {
        "Time_Start": 157.76000000000002,
        "Time_End": 159.8,
        "Text": " All right, five, six hands."
      },
      {
        "Time_Start": 159.8,
        "Time_End": 160.8,
        "Text": " Cool."
      },
      {
        "Time_Start": 160.8,
        "Time_End": 164.0,
        "Text": " We're going to teach you a couple more ways to do that."
      },
      {
        "Time_Start": 164.0,
        "Time_End": 169.44,
        "Text": " All right, so we'll start off with going over the agenda."
      },
      {
        "Time_Start": 169.44,
        "Time_End": 172.04000000000002,
        "Text": " We're going to cover a lot in this talk."
      },
      {
        "Time_Start": 172.04000000000002,
        "Time_End": 175.44,
        "Text": " It's probably best to approach this talk as kind of a sampling of what is possible and"
      },
      {
        "Time_Start": 175.44,
        "Time_End": 178.92000000000002,
        "Text": " what's out there, because there's just too much."
      },
      {
        "Time_Start": 178.92000000000002,
        "Time_End": 183.34,
        "Text": " We could talk about this for probably days and still not cover all the techniques."
      },
      {
        "Time_Start": 183.34,
        "Time_End": 188.92000000000002,
        "Text": " So we're going to start off with an introduction to what SCCM is, what it can be used for,"
      },
      {
        "Time_Start": 188.92000000000002,
        "Time_End": 192.76000000000002,
        "Text": " how we can abuse it as attackers, why it might be interesting for us, and why it might"
      },
      {
        "Time_Start": 192.76000000000002,
        "Time_End": 198.02,
        "Text": " be interesting to pay attention to these things as a defender or an admin."
      },
      {
        "Time_Start": 198.02,
        "Time_End": 202.28000000000003,
        "Text": " So we'll expose you to some of the most common SCCM attack paths."
      },
      {
        "Time_Start": 202.28000000000003,
        "Time_End": 206.44000000000003,
        "Text": " We'll talk about things like some of the war stories or some of the stories from the field"
      },
      {
        "Time_Start": 206.44000000000003,
        "Time_End": 211.28000000000003,
        "Text": " that we've seen on real world engagements in real enterprises."
      },
      {
        "Time_Start": 211.28000000000003,
        "Time_End": 212.44000000000003,
        "Text": " We'll do a couple of demos."
      },
      {
        "Time_Start": 212.44000000000003,
        "Time_End": 217.96,
        "Text": " So we'll demo what it looks like to dump network access accounts."
      },
      {
        "Time_Start": 218.0,
        "Time_End": 222.84,
        "Text": " We'll do a hierarchy takeover demo, and then we'll also demo an audit script that we have"
      },
      {
        "Time_Start": 222.84,
        "Time_End": 228.48000000000002,
        "Text": " that you can use to audit these misconfigurations in your environment."
      },
      {
        "Time_Start": 228.48000000000002,
        "Time_End": 233.64000000000001,
        "Text": " And then finally, we'll introduce the actual misconfiguration manager project, which some"
      },
      {
        "Time_Start": 233.64000000000001,
        "Time_End": 238.12,
        "Text": " of you may have or may have not yet seen."
      },
      {
        "Time_Start": 238.12,
        "Time_End": 242.64000000000001,
        "Text": " What this presentation does not cover is we don't have walkthroughs for everything."
      },
      {
        "Time_Start": 242.64000000000001,
        "Time_End": 247.92000000000002,
        "Text": " We'll talk about, we'll show you all the techniques that we've documented and written about, but"
      },
      {
        "Time_Start": 247.92000000000002,
        "Time_End": 250.76000000000002,
        "Text": " like I said, we just can't cover everything here."
      },
      {
        "Time_Start": 250.76000000000002,
        "Time_End": 254.64000000000001,
        "Text": " We're not going to cover specific defensive walkthroughs in this talk, but we do have"
      },
      {
        "Time_Start": 254.64000000000001,
        "Time_End": 257.56,
        "Text": " those available online."
      },
      {
        "Time_Start": 257.56,
        "Time_End": 261.18,
        "Text": " And like I said, this is a sampling, so we're not going to give a comprehensive treatment"
      },
      {
        "Time_Start": 261.18,
        "Time_End": 262.26,
        "Text": " of everything."
      },
      {
        "Time_Start": 262.26,
        "Time_End": 268.28000000000003,
        "Text": " So we do have much more detail in the repo that we'll talk about."
      },
      {
        "Time_Start": 268.28000000000003,
        "Time_End": 269.76,
        "Text": " All right."
      },
      {
        "Time_Start": 269.76,
        "Time_End": 273.88,
        "Text": " So it seems like most people here are at least familiar with what SCCM is, but for those"
      },
      {
        "Time_Start": 273.88,
        "Time_End": 279.52,
        "Text": " that are not, we'll just kind of set the baseline and talk about what it is."
      },
      {
        "Time_Start": 279.52,
        "Time_End": 288.76,
        "Text": " So SCCM, currently known as Microsoft Configuration Manager, it's an endpoint management platform."
      },
      {
        "Time_Start": 288.76,
        "Time_End": 293.65999999999997,
        "Text": " It's used to manage all of the things in your Windows enterprise."
      },
      {
        "Time_Start": 293.65999999999997,
        "Time_End": 299.96,
        "Text": " So you can do things like deploy applications, manage software updates, install operating"
      },
      {
        "Time_Start": 299.96,
        "Time_End": 303.48,
        "Text": " systems, and manage things like compliance settings as well."
      },
      {
        "Time_Start": 304.08000000000004,
        "Time_End": 307.88,
        "Text": " So pretty much anything that you need to do on the endpoint, you can do through SCCM."
      },
      {
        "Time_Start": 307.88,
        "Time_End": 316.0,
        "Text": " Again, we're calling it SCCM, but it's currently called Microsoft Configuration Manager."
      },
      {
        "Time_Start": 316.0,
        "Time_End": 323.6,
        "Text": " So the old acronym or the old name was System Center Configuration Manager, so they're interchangeable."
      },
      {
        "Time_Start": 323.6,
        "Time_End": 328.28000000000003,
        "Text": " The subreddit is still named SCCM, so we'll change it when they do."
      },
      {
        "Time_Start": 328.28000000000003,
        "Time_End": 330.12,
        "Text": " It's official until then."
      },
      {
        "Time_Start": 330.12,
        "Time_End": 332.64000000000004,
        "Text": " All right."
      },
      {
        "Time_Start": 332.64,
        "Time_End": 337.24,
        "Text": " So as an attacker, why should you care about SCCM?"
      },
      {
        "Time_Start": 337.24,
        "Time_End": 344.84,
        "Text": " So I would say the vast majority, this is not a scientific number, but I'll say 99%"
      },
      {
        "Time_Start": 344.84,
        "Time_End": 348.64,
        "Text": " of Active Directory environments are using SCCM."
      },
      {
        "Time_Start": 348.64,
        "Time_End": 354.36,
        "Text": " So if you're a pentester or a red teamer and you're in those environments, you're probably"
      },
      {
        "Time_Start": 354.36,
        "Time_End": 359.21999999999997,
        "Text": " already operating around SCCM in some way."
      },
      {
        "Time_Start": 359.22,
        "Time_End": 364.5,
        "Text": " So you'll probably encounter it."
      },
      {
        "Time_Start": 364.5,
        "Time_End": 369.02000000000004,
        "Text": " SCCM can be used, so it's not tied to Active Directory directly."
      },
      {
        "Time_Start": 369.02000000000004,
        "Time_End": 375.14000000000004,
        "Text": " So you can use a single SCCM instance to manage multiple sites or multiple forests."
      },
      {
        "Time_Start": 375.14000000000004,
        "Time_End": 381.38000000000005,
        "Text": " So you can kind of ignore that entire AD hierarchy that you're used to in SCCM."
      },
      {
        "Time_Start": 381.38000000000005,
        "Time_End": 386.3,
        "Text": " So this could be useful if you're operating in an environment where maybe you have to"
      },
      {
        "Time_Start": 386.3,
        "Time_End": 389.5,
        "Text": " move from one forest to another."
      },
      {
        "Time_Start": 389.5,
        "Time_End": 394.22,
        "Text": " Maybe there are no trusts between them, but they're using the same SCCM site."
      },
      {
        "Time_Start": 394.22,
        "Time_End": 397.38,
        "Text": " You can hop between those forests because they might have certain things configured,"
      },
      {
        "Time_Start": 397.38,
        "Time_End": 400.1,
        "Text": " which we'll talk about."
      },
      {
        "Time_Start": 400.1,
        "Time_End": 402.04,
        "Text": " And it's commonly misconfigured."
      },
      {
        "Time_Start": 402.04,
        "Time_End": 404.42,
        "Text": " So that's what we're here to talk about."
      },
      {
        "Time_Start": 404.42,
        "Time_End": 409.42,
        "Text": " There's a lot of insecure defaults, and it's old."
      },
      {
        "Time_Start": 409.42,
        "Time_End": 410.7,
        "Text": " It's 30 years old."
      },
      {
        "Time_Start": 410.7,
        "Time_End": 415.54,
        "Text": " So over the years, there has been a lot of advice from the community, from admins that"
      },
      {
        "Time_Start": 415.54,
        "Time_End": 420.34000000000003,
        "Text": " have written about how to do things that are usually just the easiest way to do something"
      },
      {
        "Time_Start": 420.34000000000003,
        "Time_End": 425.14000000000004,
        "Text": " rather than the most secure."
      },
      {
        "Time_Start": 425.14000000000004,
        "Time_End": 428.42,
        "Text": " So as a defender or an admin, why should you care?"
      },
      {
        "Time_Start": 428.42,
        "Time_End": 432.62,
        "Text": " Well, just building onto what I just said, all those are reasons that you should care,"
      },
      {
        "Time_Start": 432.62,
        "Time_End": 433.62,
        "Text": " of course."
      },
      {
        "Time_Start": 433.62,
        "Time_End": 442.18,
        "Text": " But again, you're probably using SCCM if you're working in an enterprise that has Active Directory."
      },
      {
        "Time_Start": 442.18,
        "Time_End": 446.22,
        "Text": " And then these misconfigurations that we're going to talk about can introduce some pretty"
      },
      {
        "Time_Start": 446.22,
        "Time_End": 450.06,
        "Text": " serious vulnerabilities that, like I said, they can lead to domain compromise, forest"
      },
      {
        "Time_Start": 450.06,
        "Time_End": 454.5,
        "Text": " compromise, remote forest compromise."
      },
      {
        "Time_Start": 454.5,
        "Time_End": 458.18,
        "Text": " So it's definitely a good idea to start looking at this stuff."
      },
      {
        "Time_Start": 458.18,
        "Time_End": 459.9,
        "Text": " All right."
      },
      {
        "Time_Start": 459.9,
        "Time_End": 465.74,
        "Text": " So credit to Karsten for this diagram."
      },
      {
        "Time_Start": 465.74,
        "Time_End": 471.34000000000003,
        "Text": " So SCCM hasn't been super popular in the offensive world."
      },
      {
        "Time_Start": 471.34000000000003,
        "Time_End": 476.62,
        "Text": " But over the years, there have been a couple nuggets here and there."
      },
      {
        "Time_Start": 476.62,
        "Time_End": 480.18,
        "Text": " So SCCM is 30 years old, like I said."
      },
      {
        "Time_Start": 480.18,
        "Time_End": 482.5,
        "Text": " First released back in 1994."
      },
      {
        "Time_Start": 482.5,
        "Time_End": 488.06,
        "Text": " There have been a lot of releases and name changes over the next couple decades."
      },
      {
        "Time_Start": 488.06,
        "Time_End": 497.86,
        "Text": " And then around up here in 2012, Dave Kennedy and one of his colleagues did a talk at DEFCON"
      },
      {
        "Time_Start": 497.86,
        "Time_End": 501.54,
        "Text": " just talking about using SCCM to compromise the rest of an environment."
      },
      {
        "Time_Start": 501.54,
        "Time_End": 505.9,
        "Text": " So basically, if you could compromise SCCM, you can probably compromise other stuff."
      },
      {
        "Time_Start": 505.9,
        "Time_End": 510.38,
        "Text": " And that was really the first indication that people were looking at it offensively."
      },
      {
        "Time_Start": 510.38,
        "Time_End": 514.3,
        "Text": " And then over the next couple years, you can see there were a couple other blog posts."
      },
      {
        "Time_Start": 514.3,
        "Time_End": 519.8599999999999,
        "Text": " Some of these were more defensive focus using SCCM for incident response, things like that."
      },
      {
        "Time_Start": 519.8599999999999,
        "Time_End": 524.8599999999999,
        "Text": " And then one of our colleagues, Matt Nelson, and some of our other colleagues at Specter"
      },
      {
        "Time_Start": 524.8599999999999,
        "Time_End": 529.74,
        "Text": " Ops started looking into it back around 2015, 2016."
      },
      {
        "Time_Start": 529.74,
        "Time_End": 533.3399999999999,
        "Text": " And after that, it kind of went dormant."
      },
      {
        "Time_Start": 533.3399999999999,
        "Time_End": 538.8599999999999,
        "Text": " And back in 2021, Chris and I were on a red team operation."
      },
      {
        "Time_Start": 538.8599999999999,
        "Time_End": 543.3399999999999,
        "Text": " And we had the use case of trying to find where certain privileged users were logged"
      },
      {
        "Time_Start": 543.34,
        "Time_End": 546.82,
        "Text": " on and we were like, that should be possible with SCCM."
      },
      {
        "Time_Start": 546.82,
        "Time_End": 552.3000000000001,
        "Text": " And that kind of sparked Sharp SCCM and everything that we're going to talk about today."
      },
      {
        "Time_Start": 552.3000000000001,
        "Time_End": 559.82,
        "Text": " And so then in 22 and 23 and 24, there's been a lot of blog posts from both our colleagues"
      },
      {
        "Time_Start": 559.82,
        "Time_End": 562.74,
        "Text": " at Specter Ops, but also in the community as well."
      },
      {
        "Time_Start": 562.74,
        "Time_End": 566.3000000000001,
        "Text": " It's getting a lot of traction out there in the offensive community, which is really awesome"
      },
      {
        "Time_Start": 566.3000000000001,
        "Time_End": 567.3000000000001,
        "Text": " to see."
      },
      {
        "Time_Start": 567.3000000000001,
        "Time_End": 576.46,
        "Text": " All right, so before we dive into the attacks that are possible due to the misconfigurations"
      },
      {
        "Time_Start": 576.46,
        "Time_End": 580.5400000000001,
        "Text": " in SCCM, I want to just kind of get everybody familiar with some of the terminology."
      },
      {
        "Time_Start": 580.5400000000001,
        "Time_End": 582.5000000000001,
        "Text": " It can be somewhat confusing."
      },
      {
        "Time_Start": 582.5000000000001,
        "Time_End": 584.9000000000001,
        "Text": " A lot of things are named very similarly."
      },
      {
        "Time_Start": 584.9000000000001,
        "Time_End": 591.2600000000001,
        "Text": " So a hierarchy in SCCM is the instance, it's the full installation, it's the security boundary,"
      },
      {
        "Time_Start": 591.2600000000001,
        "Time_End": 595.3000000000001,
        "Text": " kind of like a forest and Active Directory is supposed to be the security boundary."
      },
      {
        "Time_Start": 595.3000000000001,
        "Time_End": 601.98,
        "Text": " A site is an environment that provides services to a scope of client devices and clients and"
      },
      {
        "Time_Start": 601.98,
        "Time_End": 605.7400000000001,
        "Text": " devices are two words for the same thing."
      },
      {
        "Time_Start": 605.7400000000001,
        "Time_End": 611.98,
        "Text": " It's systems that are joined to configuration manager to receive updates, policies, download"
      },
      {
        "Time_Start": 611.98,
        "Time_End": 614.82,
        "Text": " software packages, things like that."
      },
      {
        "Time_Start": 614.82,
        "Time_End": 621.58,
        "Text": " And in our offensive use case, it's kind of like having a C2 agent on every machine."
      },
      {
        "Time_Start": 621.58,
        "Time_End": 628.7800000000001,
        "Text": " The primary site, there can be multiple environments, is a site that the clients are joined to."
      },
      {
        "Time_Start": 628.7800000000001,
        "Time_End": 632.74,
        "Text": " That is where they receive policy from, that's where they download software from."
      },
      {
        "Time_Start": 632.74,
        "Time_End": 636.74,
        "Text": " And the primary sites are administered using software called the configuration manager"
      },
      {
        "Time_Start": 636.74,
        "Time_End": 637.74,
        "Text": " console."
      },
      {
        "Time_Start": 637.74,
        "Time_End": 640.46,
        "Text": " If you're an admin, that's the software that you use."
      },
      {
        "Time_Start": 640.46,
        "Time_End": 643.72,
        "Text": " That's pretty much the one stop shop."
      },
      {
        "Time_Start": 643.72,
        "Time_End": 650.5400000000001,
        "Text": " Primary site server is kind of like the controlling system for every primary site, has a site"
      },
      {
        "Time_Start": 650.54,
        "Time_End": 655.98,
        "Text": " server, all of the messages pass through this system between the different roles that"
      },
      {
        "Time_Start": 655.98,
        "Time_End": 661.9399999999999,
        "Text": " servers have in SCCM and it's also just referred to as the site server."
      },
      {
        "Time_Start": 661.9399999999999,
        "Time_End": 667.5,
        "Text": " So the site server is the controller and the site systems are the other servers that host"
      },
      {
        "Time_Start": 667.5,
        "Time_End": 668.62,
        "Text": " roles in SCCM."
      },
      {
        "Time_Start": 668.62,
        "Time_End": 673.9399999999999,
        "Text": " So kind of confusing, but if we say the site server, we're referring to primary site server."
      },
      {
        "Time_Start": 673.9399999999999,
        "Time_End": 677.8199999999999,
        "Text": " And the site database server is where the database is hosted, so that's where all of"
      },
      {
        "Time_Start": 677.82,
        "Time_End": 684.5,
        "Text": " the client configuration data is housed, policies, where software is located on other"
      },
      {
        "Time_Start": 684.5,
        "Time_End": 686.6600000000001,
        "Text": " machines, things like that."
      },
      {
        "Time_Start": 686.6600000000001,
        "Time_End": 692.1,
        "Text": " And also where administrative roles and assignments are stored."
      },
      {
        "Time_Start": 692.1,
        "Time_End": 699.22,
        "Text": " So that's where things like administrative users are defined."
      },
      {
        "Time_Start": 699.22,
        "Time_End": 704.6600000000001,
        "Text": " So there can be multiple tiers in a hierarchy, the highest tier being a central administration"
      },
      {
        "Time_Start": 704.6600000000001,
        "Time_End": 705.6600000000001,
        "Text": " site."
      },
      {
        "Time_Start": 705.66,
        "Time_End": 709.5799999999999,
        "Text": " This is optional, you don't have to use one of these unless you have more than 150,000"
      },
      {
        "Time_Start": 709.5799999999999,
        "Time_End": 711.3,
        "Text": " devices on the network."
      },
      {
        "Time_Start": 711.3,
        "Time_End": 717.3,
        "Text": " Microsoft recommends just using a primary site if you have less devices than this."
      },
      {
        "Time_Start": 717.3,
        "Time_End": 721.42,
        "Text": " But you can have a central administration site and then multiple primary sites."
      },
      {
        "Time_Start": 721.42,
        "Time_End": 728.3399999999999,
        "Text": " A lot of organizations will do this to have client devices update their software for different"
      },
      {
        "Time_Start": 728.3399999999999,
        "Time_End": 734.24,
        "Text": " time zones so that it's when people are offline for the day, things like that."
      },
      {
        "Time_Start": 734.24,
        "Time_End": 736.44,
        "Text": " So we see it pretty frequently."
      },
      {
        "Time_Start": 736.44,
        "Time_End": 742.82,
        "Text": " And each primary site and the central administration site have their own site database."
      },
      {
        "Time_Start": 742.82,
        "Time_End": 747.76,
        "Text": " Secondary sites, sometimes we see them, they contain a partial copy of the database and"
      },
      {
        "Time_Start": 747.76,
        "Time_End": 752.52,
        "Text": " they're usually at a remote office location or somewhere that has terrible bandwidth,"
      },
      {
        "Time_Start": 752.52,
        "Time_End": 757.44,
        "Text": " so that the primary site server can push software out there once and then client devices in"
      },
      {
        "Time_Start": 757.44,
        "Time_End": 763.04,
        "Text": " that location can pull that software down over a more reliable connection."
      },
      {
        "Time_Start": 763.04,
        "Time_End": 767.8,
        "Text": " This is what that type of hierarchy might look like with central administration site."
      },
      {
        "Time_Start": 767.8,
        "Time_End": 770.42,
        "Text": " At the top, two primary sites."
      },
      {
        "Time_Start": 770.42,
        "Time_End": 774.36,
        "Text": " Our client devices are going to be joined to those primary sites, but the client devices"
      },
      {
        "Time_Start": 774.36,
        "Time_End": 779.76,
        "Text": " may or may not receive policy and software from a secondary site."
      },
      {
        "Time_Start": 779.76,
        "Time_End": 786.76,
        "Text": " The takeaway here is just these environments can be pretty complex to manage."
      },
      {
        "Time_Start": 787.08,
        "Time_End": 794.08,
        "Text": " You might see a lot of these elements if you're a consultant who is looking at these environments"
      },
      {
        "Time_Start": 795.56,
        "Time_End": 799.76,
        "Text": " at different organizations."
      },
      {
        "Time_Start": 799.76,
        "Time_End": 802.76,
        "Text": " So a couple site system roles that we're going to talk about."
      },
      {
        "Time_Start": 802.76,
        "Time_End": 804.08,
        "Text": " So these are the other servers."
      },
      {
        "Time_Start": 804.08,
        "Time_End": 809.56,
        "Text": " So we've got the primary site server, that's the main controller for SCCM, and these roles"
      },
      {
        "Time_Start": 809.56,
        "Time_End": 813.8,
        "Text": " can be installed on that machine or they can be installed on a remote machine."
      },
      {
        "Time_Start": 813.8000000000001,
        "Time_End": 820.48,
        "Text": " So the SMS provider is basically an interface for that configuration manager console software,"
      },
      {
        "Time_Start": 820.48,
        "Time_End": 825.36,
        "Text": " so the admin logs into config manager console, config manager console software contacts an"
      },
      {
        "Time_Start": 825.36,
        "Time_End": 831.6800000000001,
        "Text": " SMS provider over WMI or HTTPS, and then the SMS provider is what interacts with the site"
      },
      {
        "Time_Start": 831.6800000000001,
        "Time_End": 836.2800000000001,
        "Text": " database directly."
      },
      {
        "Time_Start": 836.28,
        "Time_End": 843.28,
        "Text": " A management point is the client device's first point of contact, so clients are going"
      },
      {
        "Time_Start": 848.48,
        "Time_End": 855.48,
        "Text": " to report back to a management point periodically, they're going to send their inventory."
      },
      {
        "Time_Start": 862.36,
        "Time_End": 865.48,
        "Text": " So yeah, they're going to retrieve policy from a management point and then a distribution"
      },
      {
        "Time_Start": 865.48,
        "Time_End": 870.6800000000001,
        "Text": " point is where the software is actually housed for them to download and install from."
      },
      {
        "Time_Start": 870.6800000000001,
        "Time_End": 875.28,
        "Text": " So they'll contact a management point, say hey, checking in, management point will say"
      },
      {
        "Time_Start": 875.28,
        "Time_End": 880.24,
        "Text": " I have this task for you, download the software from the distribution point and install it"
      },
      {
        "Time_Start": 880.24,
        "Time_End": 885.0,
        "Text": " at this time."
      },
      {
        "Time_Start": 885.0,
        "Time_End": 891.28,
        "Text": " This is a diagram of the communication protocols that exist between these systems, so we have"
      },
      {
        "Time_Start": 891.28,
        "Time_End": 896.8,
        "Text": " our clients here, they report up to a management point, say hey, can I have some policy, if"
      },
      {
        "Time_Start": 896.8,
        "Time_End": 903.8,
        "Text": " you have anything new for me, that is going to be controlled by the primary site server"
      },
      {
        "Time_Start": 904.3199999999999,
        "Time_End": 908.92,
        "Text": " and then they may download some software from the distribution point and admins are going"
      },
      {
        "Time_Start": 908.92,
        "Time_End": 913.76,
        "Text": " to interact with an SMS provider that may or may not be located on the primary site"
      },
      {
        "Time_Start": 913.76,
        "Time_End": 916.8,
        "Text": " server."
      },
      {
        "Time_Start": 916.8,
        "Time_End": 919.28,
        "Text": " Not confusing at all."
      },
      {
        "Time_Start": 920.0,
        "Time_End": 926.4399999999999,
        "Text": " Okay, so as you can tell, there's a lot of things, a lot of moving parts, and SCCM also"
      },
      {
        "Time_Start": 926.4399999999999,
        "Time_End": 932.12,
        "Text": " has a lot of accounts, which makes things even more confusing for admins."
      },
      {
        "Time_Start": 932.12,
        "Time_End": 936.3199999999999,
        "Text": " So in these next couple slides, I'm going to talk about some different types of accounts"
      },
      {
        "Time_Start": 936.3199999999999,
        "Time_End": 943.3199999999999,
        "Text": " that are used commonly and often misconfigured that can lead to like a domain privilege escalation."
      },
      {
        "Time_Start": 944.32,
        "Time_End": 948.8000000000001,
        "Text": " So, the first one is client push installation."
      },
      {
        "Time_Start": 948.8000000000001,
        "Time_End": 953.36,
        "Text": " So client push installation is how that site server is actually installing the client on"
      },
      {
        "Time_Start": 953.36,
        "Time_End": 959.08,
        "Text": " a new computer or a new device in the SCCM site."
      },
      {
        "Time_Start": 959.08,
        "Time_End": 963.2800000000001,
        "Text": " The other is the network access account, so this is the most commonly abused one that"
      },
      {
        "Time_Start": 963.2800000000001,
        "Time_End": 964.84,
        "Text": " we see."
      },
      {
        "Time_Start": 964.84,
        "Time_End": 970.4000000000001,
        "Text": " And I'll get into more detail in the coming slides on these, so don't worry too much."
      },
      {
        "Time_Start": 970.4,
        "Time_End": 973.72,
        "Text": " And then, here I say task sequence."
      },
      {
        "Time_Start": 973.72,
        "Time_End": 980.48,
        "Text": " That's just because a task sequence is basically a sequence of execution steps that can be"
      },
      {
        "Time_Start": 980.48,
        "Time_End": 984.76,
        "Text": " run on clients, and so depending on how they're configured, there can be various different"
      },
      {
        "Time_Start": 984.76,
        "Time_End": 987.4599999999999,
        "Text": " accounts within task sequences."
      },
      {
        "Time_Start": 987.4599999999999,
        "Time_End": 993.4,
        "Text": " So domain joint accounts are one that we see quite a bit, run as accounts, which as the"
      },
      {
        "Time_Start": 993.4,
        "Time_End": 997.68,
        "Text": " name implies, used to run as a different account, collection variables and things like that"
      },
      {
        "Time_Start": 997.6800000000001,
        "Time_End": 1000.8000000000001,
        "Text": " can also store secrets."
      },
      {
        "Time_Start": 1000.8000000000001,
        "Time_End": 1006.2800000000001,
        "Text": " Okay, so first we'll talk about client push installation."
      },
      {
        "Time_Start": 1006.2800000000001,
        "Time_End": 1014.6,
        "Text": " So like I mentioned, this is how the SCCM server is actually installing the client software"
      },
      {
        "Time_Start": 1014.6,
        "Time_End": 1018.0400000000001,
        "Text": " on a computer to enroll it as a client."
      },
      {
        "Time_Start": 1018.0400000000001,
        "Time_End": 1024.48,
        "Text": " So in order to do this, the server will have to copy some installation files over to the"
      },
      {
        "Time_Start": 1024.48,
        "Time_End": 1032.64,
        "Text": " device on the admin share, and then it will execute ccmsetup.exe, and then it will use"
      },
      {
        "Time_Start": 1032.64,
        "Time_End": 1039.0,
        "Text": " a configured client push installation account to execute that, and so as you can imagine,"
      },
      {
        "Time_Start": 1039.0,
        "Time_End": 1044.48,
        "Text": " that client push installation account has to be a local admin on the client, and since"
      },
      {
        "Time_Start": 1044.48,
        "Time_End": 1052.0,
        "Text": " we're doing this on every client or any new computer that joins the site, this account"
      },
      {
        "Time_Start": 1052.0,
        "Time_End": 1055.16,
        "Text": " is going to be local admin on every device."
      },
      {
        "Time_Start": 1055.16,
        "Time_End": 1059.04,
        "Text": " So you see where this is going."
      },
      {
        "Time_Start": 1059.04,
        "Time_End": 1067.16,
        "Text": " Okay, so as an admin, if you're in a large enterprise and there's a lot of computers"
      },
      {
        "Time_Start": 1067.16,
        "Time_End": 1074.32,
        "Text": " and devices joining your network, you probably don't want to manually handle that process"
      },
      {
        "Time_Start": 1074.32,
        "Time_End": 1079.88,
        "Text": " of joining computers or discovering that a new computer needs to become a client."
      },
      {
        "Time_Start": 1079.88,
        "Time_End": 1085.3200000000002,
        "Text": " So SCCM also has this feature called automatic site-wide client push installation, and so"
      },
      {
        "Time_Start": 1085.3200000000002,
        "Time_End": 1092.72,
        "Text": " what happens here is the site server will discover these computers and automatically"
      },
      {
        "Time_Start": 1092.72,
        "Time_End": 1099.44,
        "Text": " reach out to try to install this client software, and so that's interesting."
      },
      {
        "Time_Start": 1099.44,
        "Time_End": 1106.7600000000002,
        "Text": " That's a privileged account authenticating to a potential SCCM client."
      },
      {
        "Time_Start": 1106.76,
        "Time_End": 1112.76,
        "Text": " So we can abuse this by spoofing a new SCCM device."
      },
      {
        "Time_Start": 1112.76,
        "Time_End": 1117.64,
        "Text": " So if we can spoof a device record, which is the message that is sent to the site server"
      },
      {
        "Time_Start": 1117.64,
        "Time_End": 1126.32,
        "Text": " to say, hey, I'm a new device, I want to become a client, if we spoof that, then we can cause"
      },
      {
        "Time_Start": 1126.32,
        "Time_End": 1134.28,
        "Text": " that site server to connect back to us, and we now have that incoming authentication."
      },
      {
        "Time_Start": 1134.28,
        "Time_End": 1142.96,
        "Text": " And so this will be NTLM authentication, so then we could then relay that to something"
      },
      {
        "Time_Start": 1142.96,
        "Time_End": 1148.8799999999999,
        "Text": " else and authenticate as that site server or as that client push installation account,"
      },
      {
        "Time_Start": 1148.8799999999999,
        "Time_End": 1155.52,
        "Text": " which again is local admin on every client in the environment."
      },
      {
        "Time_Start": 1155.52,
        "Time_End": 1160.96,
        "Text": " One thing to add there, you could also potentially crack the password, and multiple client push"
      },
      {
        "Time_Start": 1161.3600000000001,
        "Time_End": 1165.04,
        "Text": " installation accounts may be configured by the administrator, and the site server will"
      },
      {
        "Time_Start": 1165.04,
        "Time_End": 1172.0,
        "Text": " try each one until they all fail, and then it will try its domain computer account."
      },
      {
        "Time_Start": 1172.0,
        "Time_End": 1175.72,
        "Text": " And the client push installation is just one method of installation."
      },
      {
        "Time_Start": 1175.72,
        "Time_End": 1180.64,
        "Text": " There are much more secure methods of installation, like group policy-based or software update-based,"
      },
      {
        "Time_Start": 1180.64,
        "Time_End": 1187.2,
        "Text": " but because it is the easiest to set up, we do see this fairly frequently."
      },
      {
        "Time_Start": 1188.0800000000002,
        "Time_End": 1190.32,
        "Text": " All right."
      },
      {
        "Time_Start": 1190.32,
        "Time_End": 1193.04,
        "Text": " The next account is the network access account."
      },
      {
        "Time_Start": 1193.04,
        "Time_End": 1195.32,
        "Text": " So we asked this earlier."
      },
      {
        "Time_Start": 1195.32,
        "Time_End": 1200.04,
        "Text": " Who is using a network access account in an environment now?"
      },
      {
        "Time_Start": 1200.04,
        "Time_End": 1201.24,
        "Text": " Okay."
      },
      {
        "Time_Start": 1201.24,
        "Time_End": 1204.4,
        "Text": " There were hands earlier."
      },
      {
        "Time_Start": 1204.4,
        "Time_End": 1207.2,
        "Text": " Who has abused a network access account in an environment?"
      },
      {
        "Time_Start": 1207.2,
        "Time_End": 1208.2,
        "Text": " Okay."
      },
      {
        "Time_Start": 1208.2,
        "Time_End": 1209.2,
        "Text": " Now there are some hands."
      },
      {
        "Time_Start": 1209.2,
        "Time_End": 1210.72,
        "Text": " All right."
      },
      {
        "Time_Start": 1210.72,
        "Time_End": 1215.56,
        "Text": " So the network access account is kind of a flawed design."
      },
      {
        "Time_Start": 1215.56,
        "Time_End": 1221.0,
        "Text": " It's a domain account that is configured on the SCCM server, and its sole purpose is"
      },
      {
        "Time_Start": 1221.0,
        "Time_End": 1229.28,
        "Text": " for when a SCCM client is not domain joined, again, remember, it's not tied to Active Directory."
      },
      {
        "Time_Start": 1229.28,
        "Time_End": 1234.24,
        "Text": " So if a client is not domain joined, it can use this network access account to reach back"
      },
      {
        "Time_Start": 1234.24,
        "Time_End": 1239.0,
        "Text": " and authenticate to a distribution point to retrieve software updates."
      },
      {
        "Time_Start": 1239.0,
        "Time_End": 1242.36,
        "Text": " That's basically its whole purpose."
      },
      {
        "Time_Start": 1242.36,
        "Time_End": 1244.48,
        "Text": " So it's actually deprecated."
      },
      {
        "Time_Start": 1244.48,
        "Time_End": 1250.52,
        "Text": " Microsoft does not recommend using it, except for a few specific use cases, which are documented"
      },
      {
        "Time_Start": 1250.52,
        "Time_End": 1252.6,
        "Text": " in our project."
      },
      {
        "Time_Start": 1252.6,
        "Time_End": 1258.52,
        "Text": " So if you don't fall into one of those very niche use cases, we recommend not using a"
      },
      {
        "Time_Start": 1258.52,
        "Time_End": 1259.76,
        "Text": " network access account."
      },
      {
        "Time_Start": 1259.76,
        "Time_End": 1263.28,
        "Text": " It requires very minimal privileges, though, if you are using one."
      },
      {
        "Time_Start": 1263.28,
        "Time_End": 1272.04,
        "Text": " All you need to be able to do is read that network share on the distribution point."
      },
      {
        "Time_Start": 1272.3999999999999,
        "Time_End": 1276.48,
        "Text": " So the network access account is, or I should say, overprivileged network access account"
      },
      {
        "Time_Start": 1276.48,
        "Time_End": 1280.92,
        "Text": " is the most common misconfiguration that we see."
      },
      {
        "Time_Start": 1280.92,
        "Time_End": 1288.0,
        "Text": " Sometimes this is just an easy button to domain admin because of how commonly it is overprivileged"
      },
      {
        "Time_Start": 1288.0,
        "Time_End": 1289.24,
        "Text": " and misconfigured."
      },
      {
        "Time_Start": 1289.24,
        "Time_End": 1293.92,
        "Text": " So when you're setting up an SCCM site and you're setting up all these accounts, it's"
      },
      {
        "Time_Start": 1293.92,
        "Time_End": 1300.56,
        "Text": " really easy to just enter the same domain admin or SCCM full administrator account for"
      },
      {
        "Time_Start": 1300.56,
        "Time_End": 1302.32,
        "Text": " all of these things."
      },
      {
        "Time_Start": 1302.32,
        "Time_End": 1304.76,
        "Text": " And we see that quite often."
      },
      {
        "Time_Start": 1304.76,
        "Time_End": 1309.2,
        "Text": " And so how do we get this network access account in the first place?"
      },
      {
        "Time_Start": 1309.2,
        "Time_End": 1317.56,
        "Text": " Well, it's sent out as a secret in a computer policy that gets sent out to all clients in"
      },
      {
        "Time_Start": 1317.56,
        "Time_End": 1319.72,
        "Text": " the SCCM site."
      },
      {
        "Time_Start": 1319.72,
        "Time_End": 1328.24,
        "Text": " And so if we can do a local priv-esque on a client, we can retrieve this policy and"
      },
      {
        "Time_Start": 1328.6,
        "Time_End": 1333.68,
        "Text": " decrypt the secrets, the network access account credentials."
      },
      {
        "Time_Start": 1333.68,
        "Time_End": 1339.24,
        "Text": " Or if we can spoof a computer account or add a computer account to the domain, we can request"
      },
      {
        "Time_Start": 1339.24,
        "Time_End": 1342.92,
        "Text": " the policy and deobfuscate these secrets."
      },
      {
        "Time_Start": 1342.92,
        "Time_End": 1345.32,
        "Text": " And yes, I said deobfuscate, not decrypt."
      },
      {
        "Time_Start": 1345.32,
        "Time_End": 1353.28,
        "Text": " So when these get sent to the client, they're encrypted via DPAPI."
      },
      {
        "Time_Start": 1353.28,
        "Time_End": 1356.56,
        "Text": " And so they're encrypted with the system DPAPI key."
      },
      {
        "Time_Start": 1356.56,
        "Time_End": 1363.0,
        "Text": " So if you can do a local priv-esque, you can simply grab that key and decrypt it and"
      },
      {
        "Time_Start": 1363.0,
        "Time_End": 1364.0,
        "Text": " you have creds."
      },
      {
        "Time_Start": 1364.0,
        "Time_End": 1370.2,
        "Text": " If they're overprivileged, maybe you're easy button domain admin."
      },
      {
        "Time_Start": 1370.2,
        "Time_End": 1378.34,
        "Text": " Before they get received by the client, they are obfuscated in the actual policy request."
      },
      {
        "Time_Start": 1378.34,
        "Time_End": 1384.6399999999999,
        "Text": " And we can make that request and then just deobfuscate it, which we have a demo for and"
      },
      {
        "Time_Start": 1384.6399999999999,
        "Time_End": 1386.3,
        "Text": " we'll talk about a little bit later."
      },
      {
        "Time_Start": 1386.3,
        "Time_End": 1393.7,
        "Text": " That technique was written about by our colleague Evan McBroom, simultaneously Adam Chester,"
      },
      {
        "Time_Start": 1393.7,
        "Time_End": 1395.8999999999999,
        "Text": " both independently."
      },
      {
        "Time_Start": 1395.8999999999999,
        "Time_End": 1400.2,
        "Text": " But really cool, really cool research that makes it pretty easy if you have the ability"
      },
      {
        "Time_Start": 1400.2,
        "Time_End": 1403.82,
        "Text": " to add a domain computer account, which is a default."
      },
      {
        "Time_Start": 1403.82,
        "Time_End": 1411.72,
        "Text": " All right, so like I mentioned, due to so many different accounts being in SCCM, it's"
      },
      {
        "Time_Start": 1411.72,
        "Time_End": 1418.2,
        "Text": " pretty common to just see the same account used for everything, like a single SCCM account"
      },
      {
        "Time_Start": 1418.2,
        "Time_End": 1420.92,
        "Text": " that is just God mode across the board."
      },
      {
        "Time_Start": 1420.92,
        "Time_End": 1427.4,
        "Text": " So we've seen domain admins configured as network access accounts, the SCCM admin, the"
      },
      {
        "Time_Start": 1427.4,
        "Time_End": 1432.3600000000001,
        "Text": " client push installation also used as the network access account."
      },
      {
        "Time_Start": 1432.3600000000001,
        "Time_End": 1438.72,
        "Text": " We've seen accounts where it's not admin on all workstations, but it's admin on all SCCM"
      },
      {
        "Time_Start": 1438.72,
        "Time_End": 1439.72,
        "Text": " servers."
      },
      {
        "Time_Start": 1439.88,
        "Time_End": 1445.1200000000001,
        "Text": " We'll talk about that a little bit more later in the stories from the field."
      },
      {
        "Time_Start": 1445.1200000000001,
        "Time_End": 1448.88,
        "Text": " But like I said, we find this all the time."
      },
      {
        "Time_Start": 1448.88,
        "Time_End": 1454.8,
        "Text": " Almost every pentest or red team that we've done since we started looking into this, we"
      },
      {
        "Time_Start": 1454.8,
        "Time_End": 1455.88,
        "Text": " find this."
      },
      {
        "Time_Start": 1455.88,
        "Time_End": 1459.08,
        "Text": " So it's out there."
      },
      {
        "Time_Start": 1459.08,
        "Time_End": 1466.64,
        "Text": " I recommend fixing it if you are working in an environment like this, but if you're pentest"
      },
      {
        "Time_Start": 1466.64,
        "Time_End": 1470.24,
        "Text": " or a red team, definitely recommend fixing it for your clients."
      },
      {
        "Time_Start": 1470.24,
        "Time_End": 1474.0,
        "Text": " And then finally, this last bullet, the creds may persist beyond account rotation."
      },
      {
        "Time_Start": 1474.0,
        "Time_End": 1481.24,
        "Text": " So due to the way that the WMI or the SIM repository on Windows works, some of the objects"
      },
      {
        "Time_Start": 1481.24,
        "Time_End": 1485.2,
        "Text": " in that database don't actually get removed when they should."
      },
      {
        "Time_Start": 1485.2,
        "Time_End": 1491.48,
        "Text": " So to query the NAA, we can just do a WMI query."
      },
      {
        "Time_Start": 1491.48,
        "Time_End": 1501.16,
        "Text": " So if that account gets removed from the configuration because those credentials were"
      },
      {
        "Time_Start": 1501.16,
        "Time_End": 1507.16,
        "Text": " stored in the WMI database, they may persist even though it is no longer configured."
      },
      {
        "Time_Start": 1507.16,
        "Time_End": 1512.56,
        "Text": " And so that is something else that we've seen, where maybe a DA account was used as an NAA"
      },
      {
        "Time_Start": 1512.56,
        "Time_End": 1518.34,
        "Text": " and then they fixed that, but then the DA account still persists in this database."
      },
      {
        "Time_Start": 1518.34,
        "Time_End": 1525.4199999999998,
        "Text": " So then even though they fixed the SCCM configuration, that DA account is still on every SCCM client"
      },
      {
        "Time_Start": 1525.4199999999998,
        "Time_End": 1526.4199999999998,
        "Text": " in the environment."
      },
      {
        "Time_Start": 1526.4199999999998,
        "Time_End": 1527.4199999999998,
        "Text": " Okay."
      },
      {
        "Time_Start": 1527.4199999999998,
        "Time_End": 1531.86,
        "Text": " So I'm going to show a demo."
      },
      {
        "Time_Start": 1531.86,
        "Time_End": 1532.86,
        "Text": " Super short."
      },
      {
        "Time_Start": 1532.86,
        "Time_End": 1534.98,
        "Text": " It's just going to show both of the techniques that I talked about."
      },
      {
        "Time_Start": 1534.98,
        "Time_End": 1541.82,
        "Text": " Dumping it locally using WMI and then making the request with the spoofed computer and"
      },
      {
        "Time_Start": 1541.82,
        "Time_End": 1546.6999999999998,
        "Text": " getting that deobfuscating the secrets and the policy."
      },
      {
        "Time_Start": 1546.74,
        "Time_End": 1548.74,
        "Text": " So let's see if I can do this."
      },
      {
        "Time_Start": 1548.74,
        "Time_End": 1549.74,
        "Text": " Okay."
      },
      {
        "Time_Start": 1549.74,
        "Time_End": 1555.5800000000002,
        "Text": " So first you can see we're going to use sharp SCCM with the local secrets-m for method WMI"
      },
      {
        "Time_Start": 1555.5800000000002,
        "Time_End": 1556.5800000000002,
        "Text": " command."
      },
      {
        "Time_Start": 1556.5800000000002,
        "Time_End": 1561.9,
        "Text": " So you could also change that last bit to disk, and it will do that, it will look for"
      },
      {
        "Time_Start": 1561.9,
        "Time_End": 1565.74,
        "Text": " those legacy creds that I was just talking about, the ones that are persisting after"
      },
      {
        "Time_Start": 1565.74,
        "Time_End": 1567.74,
        "Text": " rotation."
      },
      {
        "Time_Start": 1577.06,
        "Time_End": 1578.06,
        "Text": " All right."
      },
      {
        "Time_Start": 1578.06,
        "Time_End": 1579.06,
        "Text": " Here we go."
      },
      {
        "Time_Start": 1579.06,
        "Time_End": 1580.06,
        "Text": " All right."
      },
      {
        "Time_Start": 1580.06,
        "Time_End": 1581.5,
        "Text": " So that was it."
      },
      {
        "Time_Start": 1581.5,
        "Time_End": 1582.5,
        "Text": " Super short."
      },
      {
        "Time_Start": 1582.5,
        "Time_End": 1586.74,
        "Text": " So if you've used sharp DPAPI before, this may look familiar."
      },
      {
        "Time_Start": 1586.74,
        "Time_End": 1590.78,
        "Text": " Full credit to Will Schroeder for the sharp DPAPI project."
      },
      {
        "Time_Start": 1590.78,
        "Time_End": 1595.98,
        "Text": " I totally stole all this code for that."
      },
      {
        "Time_Start": 1595.98,
        "Time_End": 1601.74,
        "Text": " But you can see we're just grabbing the DPAPI system LSA secret, using that to decrypt the"
      },
      {
        "Time_Start": 1602.18,
        "Time_End": 1611.06,
        "Text": " system master keys, and then finally we do a WMI query language or WQL query to grab"
      },
      {
        "Time_Start": 1611.06,
        "Time_End": 1614.54,
        "Text": " the blobs and then decrypt the blobs here."
      },
      {
        "Time_Start": 1614.54,
        "Time_End": 1617.98,
        "Text": " So you can see that we have clear text credentials."
      },
      {
        "Time_Start": 1617.98,
        "Time_End": 1623.54,
        "Text": " It would also look for other credentials as well, because they are also stored via WMI."
      },
      {
        "Time_Start": 1623.54,
        "Time_End": 1634.82,
        "Text": " Just in this example, we only have the NAA configured."
      },
      {
        "Time_Start": 1634.82,
        "Time_End": 1643.34,
        "Text": " And then in this next one, we'll use getting ahead of myself, okay, now we'll use the get"
      },
      {
        "Time_Start": 1643.34,
        "Time_End": 1648.62,
        "Text": " secrets command, and you can see we're specifying a computer account with its password."
      },
      {
        "Time_Start": 1648.7,
        "Time_End": 1653.74,
        "Text": " So for this, we are spoofing a new device saying, hey, I'm a new computer, and I want"
      },
      {
        "Time_Start": 1653.74,
        "Time_End": 1658.66,
        "Text": " to request this computer policy."
      },
      {
        "Time_Start": 1658.66,
        "Time_End": 1667.0200000000002,
        "Text": " And again, in this case, we de-obfuscate these secrets, and this is before they get stored"
      },
      {
        "Time_Start": 1667.0200000000002,
        "Time_End": 1669.7,
        "Text": " on the client, before they're DPAPI protected."
      },
      {
        "Time_Start": 1669.7,
        "Time_End": 1674.42,
        "Text": " So you can do this without being an admin on the client."
      },
      {
        "Time_Start": 1674.42,
        "Time_End": 1677.8200000000002,
        "Text": " You can also, I guess you don't even have to do this from a client."
      },
      {
        "Time_Start": 1677.82,
        "Time_End": 1682.3,
        "Text": " You just have to have the ability to add a domain computer account, or control a domain"
      },
      {
        "Time_Start": 1682.3,
        "Time_End": 1684.1399999999999,
        "Text": " computer account."
      },
      {
        "Time_Start": 1684.1399999999999,
        "Time_End": 1690.1399999999999,
        "Text": " There we go."
      },
      {
        "Time_Start": 1690.1399999999999,
        "Time_End": 1694.1399999999999,
        "Text": " All right."
      },
      {
        "Time_Start": 1694.1399999999999,
        "Time_End": 1705.4199999999998,
        "Text": " The next type of attack that we're going to talk about is taking over the hierarchy."
      },
      {
        "Time_Start": 1705.42,
        "Time_End": 1707.98,
        "Text": " So as attackers, this is pretty obvious."
      },
      {
        "Time_Start": 1707.98,
        "Time_End": 1712.46,
        "Text": " We want the ability to run commands on any system in the environment."
      },
      {
        "Time_Start": 1712.46,
        "Time_End": 1721.78,
        "Text": " We may have privileges within Active Directory, but our objective is to compromise some specific"
      },
      {
        "Time_Start": 1721.78,
        "Time_End": 1726.38,
        "Text": " development group to access proprietary code or something like that."
      },
      {
        "Time_Start": 1726.38,
        "Time_End": 1732.42,
        "Text": " So we need to execute commands on this person's workstation in order to accomplish that objective,"
      },
      {
        "Time_Start": 1732.42,
        "Time_End": 1733.42,
        "Text": " for example."
      },
      {
        "Time_Start": 1733.42,
        "Time_End": 1738.98,
        "Text": " So SCCM supports a lot of different methods to do this."
      },
      {
        "Time_Start": 1738.98,
        "Time_End": 1740.02,
        "Text": " You can run PowerShell."
      },
      {
        "Time_Start": 1740.02,
        "Time_End": 1741.1000000000001,
        "Text": " You can run an application."
      },
      {
        "Time_Start": 1741.1000000000001,
        "Time_End": 1742.1000000000001,
        "Text": " You can deploy a package."
      },
      {
        "Time_Start": 1742.1000000000001,
        "Time_End": 1745.7,
        "Text": " There's a ton of different ways to execute code on machines."
      },
      {
        "Time_Start": 1745.7,
        "Time_End": 1749.98,
        "Text": " There's also a feature called CMPivot that basically lets you read any information on"
      },
      {
        "Time_Start": 1749.98,
        "Time_End": 1758.7,
        "Text": " the device, registry keys, file contents, event logs, all kinds of info without ever"
      },
      {
        "Time_Start": 1758.7,
        "Time_End": 1760.38,
        "Text": " touching the system."
      },
      {
        "Time_Start": 1760.38,
        "Time_End": 1769.88,
        "Text": " It all happens through SCCM, and it flies under the radar very well."
      },
      {
        "Time_Start": 1769.88,
        "Time_End": 1776.0600000000002,
        "Text": " So Tom DeGrief and Kim Appelfenz kind of talked about this in 2019 in their Defending the"
      },
      {
        "Time_Start": 1776.0600000000002,
        "Time_End": 1777.0600000000002,
        "Text": " Castle talk."
      },
      {
        "Time_Start": 1777.0600000000002,
        "Time_End": 1784.46,
        "Text": " They were like, hey, IT admins, at some point, people are going to catch on that there's"
      },
      {
        "Time_Start": 1784.46,
        "Time_End": 1792.22,
        "Text": " some pretty bad design flaws, or I guess design considerations that just over time"
      },
      {
        "Time_Start": 1792.22,
        "Time_End": 1796.0,
        "Text": " attacks evolved that made them security weaknesses."
      },
      {
        "Time_Start": 1796.0,
        "Time_End": 1800.7,
        "Text": " So how do attackers actually take over a hierarchy?"
      },
      {
        "Time_Start": 1800.7,
        "Time_End": 1804.5,
        "Text": " You want to get the full administrator role in any site."
      },
      {
        "Time_Start": 1804.5,
        "Time_End": 1808.26,
        "Text": " There is no security boundary between sites in the same hierarchy, and that's because"
      },
      {
        "Time_Start": 1808.26,
        "Time_End": 1812.22,
        "Text": " the database contents are replicated between every site."
      },
      {
        "Time_Start": 1812.22,
        "Time_End": 1816.9,
        "Text": " If you have a central administration site in the environment and you add an administrator"
      },
      {
        "Time_Start": 1816.9,
        "Time_End": 1821.7,
        "Text": " to primary site one, that change will replicate to the central administration site and then"
      },
      {
        "Time_Start": 1821.7,
        "Time_End": 1824.58,
        "Text": " to primary site two, three, all of them."
      },
      {
        "Time_Start": 1824.58,
        "Time_End": 1828.54,
        "Text": " You'll be admin everywhere."
      },
      {
        "Time_Start": 1828.54,
        "Time_End": 1830.26,
        "Text": " Very quick NTLM relay primer."
      },
      {
        "Time_Start": 1830.26,
        "Time_End": 1835.82,
        "Text": " This subject is huge, but basically it's a person in the middle attack."
      },
      {
        "Time_Start": 1835.82,
        "Time_End": 1841.8600000000001,
        "Text": " So if you are on an attacker-controlled machine and you can get another system's domain"
      },
      {
        "Time_Start": 1841.8600000000001,
        "Time_End": 1846.14,
        "Text": " computer account to authenticate to you, or really any domain account to authenticate"
      },
      {
        "Time_Start": 1846.14,
        "Time_End": 1854.42,
        "Text": " to you over NTLM, you can relay that to another system and access that system with the incoming"
      },
      {
        "Time_Start": 1854.42,
        "Time_End": 1855.42,
        "Text": " account's privileges."
      },
      {
        "Time_Start": 1855.42,
        "Time_End": 1860.44,
        "Text": " So you can do this to launch an agent with those privileges."
      },
      {
        "Time_Start": 1860.44,
        "Time_End": 1865.5800000000002,
        "Text": " You can add a user account, make any change you want after having done this."
      },
      {
        "Time_Start": 1865.58,
        "Time_End": 1874.8999999999999,
        "Text": " And there's a few bugs, sorry, there won't fix issues that you can use to do this."
      },
      {
        "Time_Start": 1874.8999999999999,
        "Time_End": 1881.84,
        "Text": " One of them is Printer Bug by Lee Chagla-Christensen, our colleague, and then the other really popular"
      },
      {
        "Time_Start": 1881.84,
        "Time_End": 1885.74,
        "Text": " one is Petit Patam by Lionel Giles."
      },
      {
        "Time_Start": 1885.74,
        "Time_End": 1893.86,
        "Text": " And these make it extremely easy to just say, hey, remote computer, I'm authenticating to"
      },
      {
        "Time_Start": 1893.8600000000001,
        "Time_End": 1900.0200000000002,
        "Text": " you with any domain user account, please connect to me, and then you can challenge"
      },
      {
        "Time_Start": 1900.0200000000002,
        "Time_End": 1905.0200000000002,
        "Text": " that system with authentication and it will automatically authenticate to you with its"
      },
      {
        "Time_Start": 1905.0200000000002,
        "Time_End": 1907.1000000000001,
        "Text": " domain computer account."
      },
      {
        "Time_Start": 1907.1000000000001,
        "Time_End": 1911.7,
        "Text": " And the reason that is important is because the primary site server's domain computer"
      },
      {
        "Time_Start": 1911.7,
        "Time_End": 1920.42,
        "Text": " account requires local admin on every other site system role in the hierarchy, and is"
      },
      {
        "Time_Start": 1920.42,
        "Time_End": 1923.5800000000002,
        "Text": " a DBA on the site database."
      },
      {
        "Time_Start": 1924.3,
        "Time_End": 1927.82,
        "Text": " So if we can coerce authentication from this account, and basically if we can breach the"
      },
      {
        "Time_Start": 1927.82,
        "Time_End": 1933.78,
        "Text": " system over SMB, we probably can because those won't fix issues, and then we can relay it"
      },
      {
        "Time_Start": 1933.78,
        "Time_End": 1940.3,
        "Text": " to any of those other system roles that are hosted remotely from that system to gain control"
      },
      {
        "Time_Start": 1940.3,
        "Time_End": 1941.3,
        "Text": " of SCCM."
      },
      {
        "Time_Start": 1941.3,
        "Time_End": 1945.74,
        "Text": " And there's a ton of different ways to do this."
      },
      {
        "Time_Start": 1945.74,
        "Time_End": 1953.4199999999998,
        "Text": " So a few examples, we can coerce NTLM from the primary site server over SMB and relay"
      },
      {
        "Time_Start": 1953.42,
        "Time_End": 1958.22,
        "Text": " that to the MS SQL service on a remote site database, grant ourselves a full administrator"
      },
      {
        "Time_Start": 1958.22,
        "Time_End": 1961.54,
        "Text": " role just by executing SQL statements."
      },
      {
        "Time_Start": 1961.54,
        "Time_End": 1966.1000000000001,
        "Text": " We can do the same thing, coerce over SMB from the primary site server, relay to the"
      },
      {
        "Time_Start": 1966.1000000000001,
        "Time_End": 1969.54,
        "Text": " site database server over SMB."
      },
      {
        "Time_Start": 1969.54,
        "Time_End": 1973.18,
        "Text": " That's a local admin, so we'll be able to execute code, we could start a service, whatever"
      },
      {
        "Time_Start": 1973.18,
        "Time_End": 1974.18,
        "Text": " we want."
      },
      {
        "Time_Start": 1974.18,
        "Time_End": 1978.38,
        "Text": " Once we have command line access to that system, we can use something like SQL command native"
      },
      {
        "Time_Start": 1978.38,
        "Time_End": 1980.7,
        "Text": " tools in order to add ourselves to that role."
      },
      {
        "Time_Start": 1980.98,
        "Time_End": 1983.26,
        "Text": " And the list goes on and on."
      },
      {
        "Time_Start": 1983.26,
        "Time_End": 1989.18,
        "Text": " SMS providers also provide the ability to add administrative users, but there are tons"
      },
      {
        "Time_Start": 1989.18,
        "Time_End": 1993.26,
        "Text": " of different combinations of this attack."
      },
      {
        "Time_Start": 1993.26,
        "Time_End": 1997.66,
        "Text": " So I want to quickly walk through one of them."
      },
      {
        "Time_Start": 1997.66,
        "Time_End": 1999.6200000000001,
        "Text": " We just call it takeover one."
      },
      {
        "Time_Start": 1999.6200000000001,
        "Time_End": 2001.54,
        "Text": " It was getting difficult to refer to all of these."
      },
      {
        "Time_Start": 2001.54,
        "Time_End": 2007.54,
        "Text": " I think we found 23 different combinations of hierarchy takeover attacks."
      },
      {
        "Time_Start": 2007.54,
        "Time_End": 2013.7,
        "Text": " So in this example, we have our attacker host in the middle."
      },
      {
        "Time_Start": 2013.7,
        "Time_End": 2018.42,
        "Text": " We have our primary site server on the left, and we have our site database on the right."
      },
      {
        "Time_Start": 2018.42,
        "Time_End": 2023.46,
        "Text": " The first step, we're going to start our relay server on our attacker host, and then we're"
      },
      {
        "Time_Start": 2023.46,
        "Time_End": 2027.86,
        "Text": " going to use something like PetitPetam or a spool sample that abuses the printer bug"
      },
      {
        "Time_Start": 2027.86,
        "Time_End": 2032.78,
        "Text": " to coerce NTLM authentication from the site server."
      },
      {
        "Time_Start": 2032.78,
        "Time_End": 2036.7,
        "Text": " The site server is going to connect to the SMB service on our relay server on the attacker"
      },
      {
        "Time_Start": 2036.74,
        "Time_End": 2042.3,
        "Text": " host, and we're going to connect to the MS SQL service on the site database."
      },
      {
        "Time_Start": 2042.3,
        "Time_End": 2047.06,
        "Text": " The site database is going to send us an NTLM challenge."
      },
      {
        "Time_Start": 2047.06,
        "Time_End": 2052.46,
        "Text": " We're going to forward that challenge to the site server, and the site server is going"
      },
      {
        "Time_Start": 2052.46,
        "Time_End": 2057.58,
        "Text": " to use that challenge and create a challenge response for its domain computer account,"
      },
      {
        "Time_Start": 2057.58,
        "Time_End": 2059.7400000000002,
        "Text": " send it to us."
      },
      {
        "Time_Start": 2059.7400000000002,
        "Time_End": 2064.54,
        "Text": " We're going to forward that challenge response to the SQL database, and then we're going"
      },
      {
        "Time_Start": 2064.54,
        "Time_End": 2068.02,
        "Text": " to execute SQL statements and grant ourselves the full administrator role."
      },
      {
        "Time_Start": 2068.02,
        "Time_End": 2079.58,
        "Text": " This is two commands, and I'm going to show you a quick demo, maybe."
      },
      {
        "Time_Start": 2079.58,
        "Time_End": 2086.34,
        "Text": " All right, so this is the configuration manager console, just demonstrating here that the"
      },
      {
        "Time_Start": 2086.34,
        "Time_End": 2092.18,
        "Text": " only two users with full administrator privileges are the lab admin."
      },
      {
        "Time_Start": 2092.7,
        "Time_End": 2098.62,
        "Text": " Right now, we're going to use Garrett's SCCM Hunter project to generate the SQL statements."
      },
      {
        "Time_Start": 2098.62,
        "Time_End": 2103.3399999999997,
        "Text": " First, we're going to check to see if we have admin privileges, and then we're going to"
      },
      {
        "Time_Start": 2103.3399999999997,
        "Time_End": 2104.98,
        "Text": " generate those SQL statements."
      },
      {
        "Time_Start": 2104.98,
        "Time_End": 2109.3799999999997,
        "Text": " Right now, we're listing members of the SMS admins group who have that full administrator"
      },
      {
        "Time_Start": 2109.3799999999997,
        "Time_End": 2118.54,
        "Text": " role, and we can see that we have access denied as the low-prev user."
      },
      {
        "Time_Start": 2118.54,
        "Time_End": 2122.46,
        "Text": " Now we're going to create the SQL statement in order to add the low-prev user."
      },
      {
        "Time_Start": 2122.46,
        "Time_End": 2127.1,
        "Text": " It's really ugly, but basically what this is doing, it's creating a record in the role-based"
      },
      {
        "Time_Start": 2127.1,
        "Time_End": 2135.38,
        "Text": " RBAC admins table, and then it's adding three permissions that together equal full administrator."
      },
      {
        "Time_Start": 2135.38,
        "Time_End": 2137.3,
        "Text": " We are starting our relay server."
      },
      {
        "Time_Start": 2137.3,
        "Time_End": 2142.66,
        "Text": " We're going to forward incoming SMB NTLM authentication to the MSSQL service, and we're going to execute"
      },
      {
        "Time_Start": 2142.66,
        "Time_End": 2149.3399999999997,
        "Text": " that big, nasty statement."
      },
      {
        "Time_Start": 2149.3399999999997,
        "Time_End": 2152.42,
        "Text": " We've started our relay server."
      },
      {
        "Time_Start": 2152.42,
        "Time_End": 2156.06,
        "Text": " Now we're going to use PetitPetam to coerce NTLM authentication from the primary site"
      },
      {
        "Time_Start": 2156.06,
        "Time_End": 2165.2599999999998,
        "Text": " server's domain computer account."
      },
      {
        "Time_Start": 2165.2599999999998,
        "Time_End": 2171.8199999999997,
        "Text": " If we come back over to our relay server, we see that the NTLM authentication was received."
      },
      {
        "Time_Start": 2171.82,
        "Time_End": 2177.26,
        "Text": " It was forwarded to the site database and succeeded, and then we changed our database"
      },
      {
        "Time_Start": 2177.26,
        "Time_End": 2179.98,
        "Text": " to the primary site database and added ourselves."
      },
      {
        "Time_Start": 2179.98,
        "Time_End": 2191.7000000000003,
        "Text": " If we refresh, we can see that low-prev is now a full administrator."
      },
      {
        "Time_Start": 2191.7000000000003,
        "Time_End": 2198.5,
        "Text": " Real quick before we dive into some stories from the field, in order to prevent this attack,"
      },
      {
        "Time_Start": 2198.5,
        "Time_End": 2206.58,
        "Text": " you can implement NTLM relay protections on the different site system roles."
      },
      {
        "Time_Start": 2206.58,
        "Time_End": 2211.06,
        "Text": " The SQL database supports extended protection for authentication."
      },
      {
        "Time_Start": 2211.06,
        "Time_End": 2217.82,
        "Text": " SMB signing requirements can be enforced on the endpoints where you could relay SMB2 to"
      },
      {
        "Time_Start": 2217.82,
        "Time_End": 2223.5,
        "Text": " take over, and there's a few others that are all in the misconfiguration manager repo that"
      },
      {
        "Time_Start": 2223.5,
        "Time_End": 2230.74,
        "Text": " we'll intro towards the end of this talk."
      },
      {
        "Time_Start": 2230.74,
        "Time_End": 2234.74,
        "Text": " For a couple slides, we're going to just tell some real-world stories, things that we have"
      },
      {
        "Time_Start": 2234.74,
        "Time_End": 2238.06,
        "Text": " seen and abused in real enterprises."
      },
      {
        "Time_Start": 2238.06,
        "Time_End": 2243.74,
        "Text": " The first, again, we're back to the overprivileged network access accounts."
      },
      {
        "Time_Start": 2243.74,
        "Time_End": 2247.58,
        "Text": " Each of these is a different occurrence, something different that we've seen."
      },
      {
        "Time_Start": 2247.58,
        "Time_End": 2251.74,
        "Text": " We also reached out to the community and had some people share stories about things that"
      },
      {
        "Time_Start": 2251.82,
        "Time_End": 2252.82,
        "Text": " they have seen."
      },
      {
        "Time_Start": 2252.82,
        "Time_End": 2255.38,
        "Text": " Again, it's everywhere."
      },
      {
        "Time_Start": 2255.38,
        "Time_End": 2262.42,
        "Text": " The first one that we'll talk about is local admin on every client."
      },
      {
        "Time_Start": 2262.42,
        "Time_End": 2269.6600000000003,
        "Text": " One of our colleagues, Garrett, he was on an assessment, and I think he was kind of"
      },
      {
        "Time_Start": 2269.6600000000003,
        "Time_End": 2273.7000000000003,
        "Text": " stuck somewhere and was doing SharePoint triage."
      },
      {
        "Time_Start": 2273.7000000000003,
        "Time_End": 2275.1800000000003,
        "Text": " Everyone loves doing that."
      },
      {
        "Time_Start": 2275.18,
        "Time_End": 2283.74,
        "Text": " For some reason, that customer had SCCM PXE boot media stored on SharePoint, and we were"
      },
      {
        "Time_Start": 2283.74,
        "Time_End": 2292.54,
        "Text": " able to, or Garrett was able to crack that open and grab the network access account secrets,"
      },
      {
        "Time_Start": 2292.54,
        "Time_End": 2298.06,
        "Text": " which happened to be local admin on every SCCM client in the environment."
      },
      {
        "Time_Start": 2298.06,
        "Time_End": 2304.1,
        "Text": " And then, again, I already mentioned that we see the NAA configured with the client"
      },
      {
        "Time_Start": 2304.1,
        "Time_End": 2310.2999999999997,
        "Text": " push installation account, which is always local admin on every client."
      },
      {
        "Time_Start": 2310.2999999999997,
        "Time_End": 2313.7799999999997,
        "Text": " We've seen domain admin accounts."
      },
      {
        "Time_Start": 2313.7799999999997,
        "Time_End": 2320.8399999999997,
        "Text": " We've seen where it's not necessarily local admin on SCCM clients, but SCCM servers."
      },
      {
        "Time_Start": 2320.8399999999997,
        "Time_End": 2323.62,
        "Text": " So that's nice."
      },
      {
        "Time_Start": 2323.62,
        "Time_End": 2330.74,
        "Text": " And then, again, previous privileged NAAs recovered from the SIEM repository."
      },
      {
        "Time_Start": 2331.5000000000005,
        "Time_End": 2336.0200000000004,
        "Text": " Those ones that were configured before the accounts were rotated."
      },
      {
        "Time_Start": 2336.0200000000004,
        "Time_End": 2343.7000000000003,
        "Text": " And then this one I thought was pretty interesting, shared by RustLA, I'm sorry if I've been butchering"
      },
      {
        "Time_Start": 2343.7000000000003,
        "Time_End": 2346.7000000000003,
        "Text": " the handle, on Twitter."
      },
      {
        "Time_Start": 2346.7000000000003,
        "Time_End": 2353.98,
        "Text": " They found two different, so you can have multiple NAAs configured, and they found that"
      },
      {
        "Time_Start": 2353.98,
        "Time_End": 2359.0200000000004,
        "Text": " two domain admin accounts for different domains were configured, so each domain had domain"
      },
      {
        "Time_Start": 2359.02,
        "Time_End": 2361.02,
        "Text": " admin creds for the other domain."
      },
      {
        "Time_Start": 2361.02,
        "Time_End": 2365.02,
        "Text": " And I'm saying domain, but I actually think they were separate forests."
      },
      {
        "Time_Start": 2365.02,
        "Time_End": 2370.82,
        "Text": " So totally separate SCCM environments, totally separate AD environments."
      },
      {
        "Time_Start": 2370.82,
        "Time_End": 2377.94,
        "Text": " So again, lots of crazy stuff out there."
      },
      {
        "Time_Start": 2377.94,
        "Time_End": 2382.94,
        "Text": " Now this one is something that we see quite a bit, especially with our Bloodhound Enterprise"
      },
      {
        "Time_Start": 2382.94,
        "Time_End": 2385.94,
        "Text": " customers."
      },
      {
        "Time_Start": 2385.94,
        "Time_End": 2391.78,
        "Text": " It kind of just lingers in the domain, and we're just now finding them."
      },
      {
        "Time_Start": 2391.78,
        "Time_End": 2393.58,
        "Text": " And it can be pretty bad."
      },
      {
        "Time_Start": 2393.58,
        "Time_End": 2400.46,
        "Text": " So SCCM can have an account configured called a domain join account."
      },
      {
        "Time_Start": 2400.46,
        "Time_End": 2405.14,
        "Text": " And as the name implies, this is used to join new computers to the domain."
      },
      {
        "Time_Start": 2405.14,
        "Time_End": 2410.78,
        "Text": " So if you configured Pixieboot and you install, do like an operating system deployment, and"
      },
      {
        "Time_Start": 2410.78,
        "Time_End": 2414.42,
        "Text": " you want to join that new computer to the domain, you would use something like a domain"
      },
      {
        "Time_Start": 2414.42,
        "Time_End": 2416.7400000000002,
        "Text": " join account."
      },
      {
        "Time_Start": 2416.7400000000002,
        "Time_End": 2424.98,
        "Text": " And so when a computer is joined to the domain, the account that did the joining has ownership"
      },
      {
        "Time_Start": 2424.98,
        "Time_End": 2426.66,
        "Text": " of that computer."
      },
      {
        "Time_Start": 2426.66,
        "Time_End": 2434.94,
        "Text": " And so fast forward 10 years or something, and that computer is somehow a domain controller,"
      },
      {
        "Time_Start": 2434.94,
        "Time_End": 2441.86,
        "Text": " or maybe a new server was joined and using SCCM and was promoted to domain controller,"
      },
      {
        "Time_Start": 2441.86,
        "Time_End": 2449.02,
        "Text": " you might find that the domain join account has ownership of domain controllers or other"
      },
      {
        "Time_Start": 2449.02,
        "Time_End": 2452.34,
        "Text": " privileged assets in the environment."
      },
      {
        "Time_Start": 2452.34,
        "Time_End": 2460.42,
        "Text": " So depending on how the task sequence is configured, this could be present on the clients."
      },
      {
        "Time_Start": 2460.42,
        "Time_End": 2462.78,
        "Text": " Here this is actually not completely accurate."
      },
      {
        "Time_Start": 2462.78,
        "Time_End": 2465.78,
        "Text": " It says present on all clients."
      },
      {
        "Time_Start": 2465.78,
        "Time_End": 2468.06,
        "Text": " But this could be present on SCCM clients."
      },
      {
        "Time_Start": 2468.06,
        "Time_End": 2470.58,
        "Text": " So the secrets might exist."
      },
      {
        "Time_Start": 2470.58,
        "Time_End": 2476.2999999999997,
        "Text": " So it's definitely worth looking at if you run those sharp SCCM commands that I demoed"
      },
      {
        "Time_Start": 2476.2999999999997,
        "Time_End": 2480.54,
        "Text": " with the get secrets or local secrets commands, you might find these."
      },
      {
        "Time_Start": 2480.54,
        "Time_End": 2484.38,
        "Text": " And it's definitely worth looking at if you do find a domain join account, look at what"
      },
      {
        "Time_Start": 2484.38,
        "Time_End": 2487.8199999999997,
        "Text": " it has ownership of."
      },
      {
        "Time_Start": 2487.8199999999997,
        "Time_End": 2493.98,
        "Text": " And then if you are on the blue side, definitely figure out what your domain join account is"
      },
      {
        "Time_Start": 2493.98,
        "Time_End": 2498.58,
        "Text": " and use Bloodhound or something to look at what it's doing."
      },
      {
        "Time_Start": 2498.58,
        "Time_End": 2503.42,
        "Text": " Look at what it has ownership of, because like I mentioned, we found several instances"
      },
      {
        "Time_Start": 2503.42,
        "Time_End": 2509.34,
        "Text": " where this account has ownership of the entire domain, hundreds of thousands of computers."
      },
      {
        "Time_Start": 2509.34,
        "Time_End": 2516.9,
        "Text": " So it can be really bad."
      },
      {
        "Time_Start": 2516.9,
        "Time_End": 2527.02,
        "Text": " So SCCM clients and domain controllers, you might think that they are different things,"
      },
      {
        "Time_Start": 2527.02,
        "Time_End": 2529.18,
        "Text": " and they're not necessarily different."
      },
      {
        "Time_Start": 2529.18,
        "Time_End": 2535.82,
        "Text": " So it's a non-default setting, but when you set up your SCCM site, you can configure it"
      },
      {
        "Time_Start": 2535.82,
        "Time_End": 2539.02,
        "Text": " to enroll domain controllers as clients."
      },
      {
        "Time_Start": 2539.02,
        "Time_End": 2544.5,
        "Text": " And this is problematic, as you can imagine, because if we control SCCM, we have code execution"
      },
      {
        "Time_Start": 2544.5,
        "Time_End": 2547.08,
        "Text": " over every client in the environment."
      },
      {
        "Time_Start": 2547.08,
        "Time_End": 2555.44,
        "Text": " If this is configured, then we can control domain controllers by compromising SCCM."
      },
      {
        "Time_Start": 2555.44,
        "Time_End": 2560.12,
        "Text": " When we first started looking into SCCM, or at least I thought that this was, I was"
      },
      {
        "Time_Start": 2560.12,
        "Time_End": 2563.64,
        "Text": " like, there's no way that people actually do that."
      },
      {
        "Time_Start": 2563.64,
        "Time_End": 2567.48,
        "Text": " And it turns out, most environments do this."
      },
      {
        "Time_Start": 2567.48,
        "Time_End": 2573.64,
        "Text": " So if you can, again, through the takeover one, which Chris just demonstrated, which"
      },
      {
        "Time_Start": 2573.64,
        "Time_End": 2577.36,
        "Text": " again, very common, you can use that to compromise the site."
      },
      {
        "Time_Start": 2577.36,
        "Time_End": 2582.28,
        "Text": " And then once you've compromised the site, if the DC is a client, you have codecs on"
      },
      {
        "Time_Start": 2582.28,
        "Time_End": 2583.7000000000003,
        "Text": " the DC."
      },
      {
        "Time_Start": 2583.7000000000003,
        "Time_End": 2590.26,
        "Text": " So again, pretty severe."
      },
      {
        "Time_Start": 2590.26,
        "Time_End": 2595.2200000000003,
        "Text": " And we can execute on the client through various different methods."
      },
      {
        "Time_Start": 2595.2200000000003,
        "Time_End": 2599.6600000000003,
        "Text": " So we can do an application deployment, or a script deployment, or a package deployment."
      },
      {
        "Time_Start": 2599.6600000000003,
        "Time_End": 2604.4600000000005,
        "Text": " Script deployment is usually the easiest."
      },
      {
        "Time_Start": 2604.4600000000005,
        "Time_End": 2608.9,
        "Text": " We just recently just added ourselves to the admin group on the DC, just as a proof of"
      },
      {
        "Time_Start": 2608.9,
        "Time_End": 2612.7000000000003,
        "Text": " concept to show that we could do it."
      },
      {
        "Time_Start": 2612.7000000000003,
        "Time_End": 2618.0200000000004,
        "Text": " The possibilities are endless."
      },
      {
        "Time_Start": 2618.0200000000004,
        "Time_End": 2619.94,
        "Text": " Real quick, just want to mention something that I forgot."
      },
      {
        "Time_Start": 2619.94,
        "Time_End": 2626.7400000000002,
        "Text": " So the demo that we did of hierarchy takeover one just now, obviously I was like, not trying"
      },
      {
        "Time_Start": 2626.7400000000002,
        "Time_End": 2632.26,
        "Text": " to hide it, or have any type of OPSEC consciousness."
      },
      {
        "Time_Start": 2632.26,
        "Time_End": 2636.6600000000003,
        "Text": " But I do want to recommend our colleague Nick Power's talk."
      },
      {
        "Time_Start": 2636.6600000000003,
        "Time_End": 2640.38,
        "Text": " Once the videos come out, it's called Relay Your Heart Away Unbinding 4.4.5."
      },
      {
        "Time_Start": 2640.38,
        "Time_End": 2645.26,
        "Text": " It'll teach you exactly how to do this attack over C2 for the red teamers."
      },
      {
        "Time_Start": 2645.26,
        "Time_End": 2648.1,
        "Text": " Going to kind of cruise through these, because I want to make sure we have room for questions."
      },
      {
        "Time_Start": 2648.1,
        "Time_End": 2652.2200000000003,
        "Text": " But this was the origin of takeover one."
      },
      {
        "Time_Start": 2652.2200000000003,
        "Time_End": 2655.82,
        "Text": " It was a problem we were facing."
      },
      {
        "Time_Start": 2655.82,
        "Time_End": 2662.62,
        "Text": " We found a connection string for a database in a network share, and that allowed us to"
      },
      {
        "Time_Start": 2662.62,
        "Time_End": 2665.9,
        "Text": " authenticate to just some random database on the network."
      },
      {
        "Time_Start": 2665.9,
        "Time_End": 2671.02,
        "Text": " We crawled SQL links, and one of the links was DBA in the central administration site"
      },
      {
        "Time_Start": 2671.02,
        "Time_End": 2672.02,
        "Text": " database."
      },
      {
        "Time_Start": 2672.02,
        "Time_End": 2676.96,
        "Text": " So we had database access, but we didn't really know how to turn that into administrative"
      },
      {
        "Time_Start": 2676.96,
        "Time_End": 2678.38,
        "Text": " privileges in SCCM."
      },
      {
        "Time_Start": 2678.38,
        "Time_End": 2683.58,
        "Text": " So we cracked some DBA creds, logged directly into the database, and then figured out a"
      },
      {
        "Time_Start": 2683.58,
        "Time_End": 2691.9,
        "Text": " way to get ourselves into that group in a lab, and then executed that in prod, of course."
      },
      {
        "Time_Start": 2691.9,
        "Time_End": 2699.82,
        "Text": " Another kind of funny story, we were on a client engagement, and we were observing kind"
      },
      {
        "Time_Start": 2699.82,
        "Time_End": 2705.1,
        "Text": " of what the SCCM environment looked like, and we had seen in the logs that the site"
      },
      {
        "Time_Start": 2705.1,
        "Time_End": 2710.46,
        "Text": " server, because automatic client push installation was enabled, had been trying to authenticate"
      },
      {
        "Time_Start": 2710.46,
        "Time_End": 2715.58,
        "Text": " to the CISO's laptop for two years, but the object didn't exist."
      },
      {
        "Time_Start": 2715.58,
        "Time_End": 2716.98,
        "Text": " So we didn't actually execute this attack."
      },
      {
        "Time_Start": 2716.98,
        "Time_End": 2719.3,
        "Text": " It was more of an audit style assessment, unfortunately."
      },
      {
        "Time_Start": 2719.3,
        "Time_End": 2725.78,
        "Text": " But in theory, we could have created a DNS record for that object, pointed at our machine,"
      },
      {
        "Time_Start": 2725.78,
        "Time_End": 2736.46,
        "Text": " and capture a relay, that authentication, to take over whatever machines that that had"
      },
      {
        "Time_Start": 2736.46,
        "Time_End": 2738.02,
        "Text": " administrative privileges on."
      },
      {
        "Time_Start": 2738.02,
        "Time_End": 2739.02,
        "Text": " Which one?"
      },
      {
        "Time_Start": 2739.02,
        "Time_End": 2740.02,
        "Text": " This guy?"
      },
      {
        "Time_Start": 2740.02,
        "Time_End": 2741.02,
        "Text": " Yeah."
      },
      {
        "Time_Start": 2741.02,
        "Time_End": 2742.02,
        "Text": " All right."
      },
      {
        "Time_Start": 2742.02,
        "Time_End": 2743.02,
        "Text": " Crisis averted."
      },
      {
        "Time_Start": 2743.02,
        "Time_End": 2749.5,
        "Text": " OK."
      },
      {
        "Time_Start": 2749.5,
        "Time_End": 2756.58,
        "Text": " So if you're like us, we felt pretty overwhelmed by everything that was happening, everything"
      },
      {
        "Time_Start": 2756.58,
        "Time_End": 2758.74,
        "Text": " that was being discovered."
      },
      {
        "Time_Start": 2758.74,
        "Time_End": 2763.2599999999998,
        "Text": " And there's so many different attack techniques, and so many different ways to defend against"
      },
      {
        "Time_Start": 2763.2599999999998,
        "Time_End": 2766.74,
        "Text": " this stuff, that I couldn't keep up."
      },
      {
        "Time_Start": 2766.74,
        "Time_End": 2768.34,
        "Text": " I don't think any of us could."
      },
      {
        "Time_Start": 2768.34,
        "Time_End": 2775.02,
        "Text": " So we felt it was necessary to document everything in a single place for everyone."
      },
      {
        "Time_Start": 2775.02,
        "Time_End": 2777.7400000000002,
        "Text": " And that is what misconfiguration manager is."
      },
      {
        "Time_Start": 2777.7400000000002,
        "Time_End": 2783.5,
        "Text": " So this was inspired by a couple different people that I'd like to give a shout out to."
      },
      {
        "Time_Start": 2783.5,
        "Time_End": 2789.26,
        "Text": " First of all, our colleagues, Will and Lee, with the certified pre-owned paper."
      },
      {
        "Time_Start": 2789.26,
        "Time_End": 2793.5,
        "Text": " We knew that we had such a vast body of knowledge that we had to share, that we wanted to put"
      },
      {
        "Time_Start": 2793.5,
        "Time_End": 2800.26,
        "Text": " it into some kind of format that was digestible, and had a taxonomy like they did, with their"
      },
      {
        "Time_Start": 2800.26,
        "Time_End": 2804.26,
        "Text": " ESC1 and 2, et cetera."
      },
      {
        "Time_Start": 2804.26,
        "Time_End": 2809.14,
        "Text": " But after talking with them, we learned that maybe a white paper wasn't the right way to"
      },
      {
        "Time_Start": 2809.14,
        "Time_End": 2810.14,
        "Text": " do this."
      },
      {
        "Time_Start": 2810.14,
        "Time_End": 2815.34,
        "Text": " Instead, we created a living knowledge base that we're maintaining on GitHub, that we"
      },
      {
        "Time_Start": 2815.34,
        "Time_End": 2819.5,
        "Text": " hope that will continue to grow over the years."
      },
      {
        "Time_Start": 2819.5,
        "Time_End": 2824.3,
        "Text": " And so misconfiguration manager contains an SCCM primer, basically the stuff that we"
      },
      {
        "Time_Start": 2824.3,
        "Time_End": 2825.98,
        "Text": " talked about here."
      },
      {
        "Time_Start": 2825.98,
        "Time_End": 2833.3,
        "Text": " Also contains offensive techniques, defensive write-ups for how to prevent some of this"
      },
      {
        "Time_Start": 2833.3,
        "Time_End": 2834.3,
        "Text": " stuff."
      },
      {
        "Time_Start": 2834.3,
        "Time_End": 2840.14,
        "Text": " We have detection, and we have one canary idea in there, but there's probably more out"
      },
      {
        "Time_Start": 2840.14,
        "Time_End": 2842.46,
        "Text": " there."
      },
      {
        "Time_Start": 2842.46,
        "Time_End": 2847.38,
        "Text": " And like I said, it introduces a taxonomy, which we'll talk about on the coming slides."
      },
      {
        "Time_Start": 2847.38,
        "Time_End": 2852.2200000000003,
        "Text": " We want to demystify all of this for you, because it is vast, it is complex, and there's"
      },
      {
        "Time_Start": 2852.2200000000003,
        "Time_End": 2853.2200000000003,
        "Text": " just so much."
      },
      {
        "Time_Start": 2853.2200000000003,
        "Time_End": 2854.6600000000003,
        "Text": " And there's a lot more out there."
      },
      {
        "Time_Start": 2854.6600000000003,
        "Time_End": 2859.42,
        "Text": " So we know that something like a white paper would have been a snapshot in time, whereas"
      },
      {
        "Time_Start": 2859.42,
        "Time_End": 2861.78,
        "Text": " this will let us to continue building."
      },
      {
        "Time_Start": 2861.78,
        "Time_End": 2867.46,
        "Text": " And so we build it kind of in the style of MITRE ATT&CK, also inspired by Push Security's"
      },
      {
        "Time_Start": 2867.46,
        "Time_End": 2869.34,
        "Text": " SAS attacks matrix."
      },
      {
        "Time_Start": 2869.34,
        "Time_End": 2873.82,
        "Text": " So if you're not familiar with that project, I recommend checking it out."
      },
      {
        "Time_Start": 2873.82,
        "Time_End": 2877.38,
        "Text": " Kind of the same idea, but for SAS stuff."
      },
      {
        "Time_Start": 2877.38,
        "Time_End": 2882.86,
        "Text": " And so this is just an example of what is in there now, broken out into a MITRE ATT&CK"
      },
      {
        "Time_Start": 2882.86,
        "Time_End": 2884.6000000000004,
        "Text": " style matrix."
      },
      {
        "Time_Start": 2884.6000000000004,
        "Time_End": 2890.34,
        "Text": " So I'm not going to go through all of this, but these are some of the attacks that we"
      },
      {
        "Time_Start": 2890.34,
        "Time_End": 2895.78,
        "Text": " have documented already."
      },
      {
        "Time_Start": 2895.78,
        "Time_End": 2901.42,
        "Text": " And then I mentioned that we created a taxonomy for this, because we wanted to organize this"
      },
      {
        "Time_Start": 2901.42,
        "Time_End": 2903.28,
        "Text": " stuff, and we know there's more."
      },
      {
        "Time_Start": 2903.28,
        "Time_End": 2910.32,
        "Text": " So first we have the cred technique, so these are related to credential access, as the name"
      },
      {
        "Time_Start": 2910.32,
        "Time_End": 2912.32,
        "Text": " would imply."
      },
      {
        "Time_Start": 2912.32,
        "Time_End": 2916.48,
        "Text": " There is currently five, but I think we have maybe one or two other ideas that we have"
      },
      {
        "Time_Start": 2916.48,
        "Time_End": 2918.5400000000004,
        "Text": " not written about yet."
      },
      {
        "Time_Start": 2918.5400000000004,
        "Time_End": 2925.7200000000003,
        "Text": " We have elevate, which is used to do a privilege escalation named elevate instead of escalate,"
      },
      {
        "Time_Start": 2925.7200000000003,
        "Time_End": 2930.1200000000003,
        "Text": " just to not confuse people that are familiar with certified pre-owned."
      },
      {
        "Time_Start": 2930.12,
        "Time_End": 2935.4,
        "Text": " ATT&CK is code execution on a client."
      },
      {
        "Time_Start": 2935.4,
        "Time_End": 2937.52,
        "Text": " And then we have recon as well."
      },
      {
        "Time_Start": 2937.52,
        "Time_End": 2944.7999999999997,
        "Text": " So recon kind of encompasses how to find the SCCM servers, but also how to use SCCM to"
      },
      {
        "Time_Start": 2944.7999999999997,
        "Time_End": 2946.7599999999998,
        "Text": " do recon."
      },
      {
        "Time_Start": 2946.7599999999998,
        "Time_End": 2953.6,
        "Text": " And then maybe the most interesting one is takeover."
      },
      {
        "Time_Start": 2953.6,
        "Time_End": 2957.48,
        "Text": " So these are all the takeover methods that rely on NTLM Relay."
      },
      {
        "Time_Start": 2957.52,
        "Time_End": 2961.92,
        "Text": " I'm not going to read them all to you, but if you want to check out exactly how to execute"
      },
      {
        "Time_Start": 2961.92,
        "Time_End": 2966.68,
        "Text": " each of these, you can check out the repo, as well as if you're a defender, to mitigate"
      },
      {
        "Time_Start": 2966.68,
        "Time_End": 2968.44,
        "Text": " and detect some of these."
      },
      {
        "Time_Start": 2968.44,
        "Time_End": 2974.28,
        "Text": " Detection ultimately boils down to if a computer is authenticating from a system that is not"
      },
      {
        "Time_Start": 2974.28,
        "Time_End": 2982.96,
        "Text": " that computer, then that's a pretty high-fidelity alert."
      },
      {
        "Time_Start": 2982.96,
        "Time_End": 2988.8,
        "Text": " For the defensive techniques, we have prevent category, detect, and canary."
      },
      {
        "Time_Start": 2988.8,
        "Time_End": 2994.4,
        "Text": " So each of the offensive techniques correlates to one or more of each of these, except for"
      },
      {
        "Time_Start": 2994.4,
        "Time_End": 2996.68,
        "Text": " canary, and vice versa."
      },
      {
        "Time_Start": 2996.68,
        "Time_End": 3003.48,
        "Text": " So both ATT&CK techniques and defensive techniques kind of tie into one another in the repo."
      },
      {
        "Time_Start": 3003.48,
        "Time_End": 3009.2,
        "Text": " I'm going to quickly show you kind of what it looks like, how it's organized on the left."
      },
      {
        "Time_Start": 3009.2000000000003,
        "Time_End": 3014.6000000000004,
        "Text": " Each of the offensive techniques contains a description, what ATT&CK TTPs they tie back"
      },
      {
        "Time_Start": 3014.6000000000004,
        "Time_End": 3017.5200000000004,
        "Text": " to, the requirements."
      },
      {
        "Time_Start": 3017.5200000000004,
        "Time_End": 3021.6800000000003,
        "Text": " Most of these are default in a lot of cases for coercion and relay."
      },
      {
        "Time_Start": 3021.6800000000003,
        "Time_End": 3029.0800000000004,
        "Text": " Basically if you don't have NTLM Relay protection explicitly enabled, it's probably possible."
      },
      {
        "Time_Start": 3029.0800000000004,
        "Time_End": 3035.5200000000004,
        "Text": " And then on the defensive, or sorry, the description of the impact, the defensive IDs that the"
      },
      {
        "Time_Start": 3035.52,
        "Time_End": 3037.96,
        "Text": " offensive technique relates to."
      },
      {
        "Time_Start": 3037.96,
        "Time_End": 3044.28,
        "Text": " Sub-techniques, like I mentioned before, there's eight takeovers there, but there are 23 total"
      },
      {
        "Time_Start": 3044.28,
        "Time_End": 3048.52,
        "Text": " sub-techniques, depending on what system you coerce from."
      },
      {
        "Time_Start": 3048.52,
        "Time_End": 3052.36,
        "Text": " Because the different types of systems have different privileges in the database or on"
      },
      {
        "Time_Start": 3052.36,
        "Time_End": 3056.72,
        "Text": " SMS providers in order to add ourselves to that full administrator group."
      },
      {
        "Time_Start": 3056.72,
        "Time_End": 3058.24,
        "Text": " So all that's detailed there."
      },
      {
        "Time_Start": 3058.24,
        "Time_End": 3062.88,
        "Text": " And then the actual execution instructions, and then some references to additional information"
      },
      {
        "Time_Start": 3063.04,
        "Time_End": 3068.12,
        "Text": " or the research where these things originated."
      },
      {
        "Time_Start": 3068.12,
        "Time_End": 3071.92,
        "Text": " On the defensive side, prevention looks like this."
      },
      {
        "Time_Start": 3071.92,
        "Time_End": 3080.88,
        "Text": " A summary of what to do and why, and the offensive IDs that they link to, and other defensive"
      },
      {
        "Time_Start": 3080.88,
        "Time_End": 3086.28,
        "Text": " IDs that are additional layers of defense that are related to this prevention measure,"
      },
      {
        "Time_Start": 3086.28,
        "Time_End": 3090.28,
        "Text": " as well as the references where these came from."
      },
      {
        "Time_Start": 3090.28,
        "Time_End": 3096.6800000000003,
        "Text": " And we wrote an audit script in order to help organizations find these things."
      },
      {
        "Time_Start": 3096.6800000000003,
        "Time_End": 3100.76,
        "Text": " We released misconfiguration managers, and admins were like, I don't want to read this"
      },
      {
        "Time_Start": 3100.76,
        "Time_End": 3102.6800000000003,
        "Text": " whole thing."
      },
      {
        "Time_Start": 3102.6800000000003,
        "Time_End": 3106.44,
        "Text": " So we wrote this to kind of try and help identify some of these."
      },
      {
        "Time_Start": 3106.44,
        "Time_End": 3110.28,
        "Text": " It's not going to catch every single thing, but it should help identify the low-hanging"
      },
      {
        "Time_Start": 3110.28,
        "Time_End": 3116.92,
        "Text": " fruit, particularly which takeovers are possible and which elevations are possible."
      },
      {
        "Time_Start": 3116.92,
        "Time_End": 3122.08,
        "Text": " It requires read-only analyst privileges in SCCM, but it will be a lot more accurate"
      },
      {
        "Time_Start": 3122.08,
        "Time_End": 3126.4,
        "Text": " if you also run it with local administrator privileges on all of the site system roles"
      },
      {
        "Time_Start": 3126.4,
        "Time_End": 3131.52,
        "Text": " so that it can connect to them and read the registry to determine if relay to that system"
      },
      {
        "Time_Start": 3131.52,
        "Time_End": 3133.52,
        "Text": " is possible."
      },
      {
        "Time_Start": 3133.52,
        "Time_End": 3138.64,
        "Text": " But let me demo this for you very, very quickly."
      },
      {
        "Time_Start": 3138.64,
        "Time_End": 3141.84,
        "Text": " When we run it, it will connect to each system."
      },
      {
        "Time_Start": 3141.84,
        "Time_End": 3148.0,
        "Text": " It will query for whether SMB signing is required or EPA."
      },
      {
        "Time_Start": 3148.0,
        "Time_End": 3150.76,
        "Text": " It will look to see if automatic client push installation is enabled."
      },
      {
        "Time_Start": 3150.76,
        "Time_End": 3156.28,
        "Text": " If we scroll back up, it will tell us takeover two and one are likely in this environment"
      },
      {
        "Time_Start": 3156.28,
        "Time_End": 3157.28,
        "Text": " as we go."
      },
      {
        "Time_Start": 3157.28,
        "Time_End": 3164.08,
        "Text": " And it will also spit out kind of like a site hierarchy tree at the bottom here."
      },
      {
        "Time_Start": 3164.08,
        "Time_End": 3171.2400000000002,
        "Text": " Once it's done running, it will do a final analysis and provide this tree view of the"
      },
      {
        "Time_Start": 3171.2400000000002,
        "Time_End": 3176.0400000000004,
        "Text": " hierarchy and, again, tell you what possible issues you have in the takeover and elevate"
      },
      {
        "Time_Start": 3176.0400000000004,
        "Time_End": 3180.6000000000004,
        "Text": " categories."
      },
      {
        "Time_Start": 3180.6000000000004,
        "Time_End": 3185.48,
        "Text": " So we've talked a little bit to the folks at Microsoft, the configuration manager team,"
      },
      {
        "Time_Start": 3185.48,
        "Time_End": 3194.0000000000005,
        "Text": " a lot of IT admins who are interested in security, and they do seem to be taking this very seriously."
      },
      {
        "Time_Start": 3194.0,
        "Time_End": 3201.04,
        "Text": " They have started work on enabling organizations to fix these things."
      },
      {
        "Time_Start": 3201.04,
        "Time_End": 3206.92,
        "Text": " So for example, we weren't really sure if recommending extended protection for authentication"
      },
      {
        "Time_Start": 3206.92,
        "Time_End": 3210.68,
        "Text": " was going to have performance impact on the site database."
      },
      {
        "Time_Start": 3210.68,
        "Time_End": 3215.78,
        "Text": " I think three or four weeks ago, they just announced that EPA is officially supported"
      },
      {
        "Time_Start": 3215.78,
        "Time_End": 3221.52,
        "Text": " to help organizations fix things like hierarchy takeover one."
      },
      {
        "Time_Start": 3222.04,
        "Time_End": 3224.0,
        "Text": " So we really want to collaborate with everyone."
      },
      {
        "Time_Start": 3224.0,
        "Time_End": 3230.08,
        "Text": " If you're interested in contributing to misconfiguration manager or want to just chat with us, we hang"
      },
      {
        "Time_Start": 3230.08,
        "Time_End": 3234.48,
        "Text": " out in the SCCM channel, the Bloodhound Gang Slack."
      },
      {
        "Time_Start": 3234.48,
        "Time_End": 3237.16,
        "Text": " And that's it."
      },
      {
        "Time_Start": 3237.16,
        "Time_End": 3244.36,
        "Text": " Thank you guys for joining us."
      },
      {
        "Time_Start": 3244.36,
        "Time_End": 3251.28,
        "Text": " Thank you."
      },
      {
        "Time_Start": 3251.28,
        "Time_End": 3253.28,
        "Text": " Any questions?"
      },
      {
        "Time_Start": 3253.28,
        "Time_End": 3258.48,
        "Text": " Hello, guys."
      },
      {
        "Time_Start": 3258.48,
        "Time_End": 3260.52,
        "Text": " Thank you for your talk."
      },
      {
        "Time_Start": 3260.52,
        "Time_End": 3269.0,
        "Text": " Are you seeing different SCCM server dedicated for each tiering part, like SCCM server for"
      },
      {
        "Time_Start": 3269.0,
        "Time_End": 3280.84,
        "Text": " T0 servers like domain controllers or IDConnect, and also SCCM for T1 and T2 machines?"
      },
      {
        "Time_Start": 3280.84,
        "Time_End": 3284.72,
        "Text": " That's a great question."
      },
      {
        "Time_Start": 3284.72,
        "Time_End": 3292.14,
        "Text": " I have not actually seen anyone doing it, but we have been recommending that organizations"
      },
      {
        "Time_Start": 3292.14,
        "Time_End": 3300.06,
        "Text": " at least treat SCCM as Tier 0 or, like you said, use a Tier 1 SCCM for Tier 1 assets,"
      },
      {
        "Time_Start": 3300.06,
        "Time_End": 3301.06,
        "Text": " etc."
      },
      {
        "Time_Start": 3301.06,
        "Time_End": 3302.66,
        "Text": " I have not actually seen it."
      },
      {
        "Time_Start": 3302.66,
        "Time_End": 3306.54,
        "Text": " We haven't really seen it be implemented in that way."
      },
      {
        "Time_Start": 3306.54,
        "Time_End": 3313.3399999999997,
        "Text": " But yeah, we do recommend that trying not to cross forest boundaries by placing accounts"
      },
      {
        "Time_Start": 3313.3399999999997,
        "Time_End": 3317.98,
        "Text": " for multiple forests into SCCM, because if you compromise the domain, you can likely"
      },
      {
        "Time_Start": 3317.98,
        "Time_End": 3322.54,
        "Text": " become SCCM administrator, and then you have access to the other domain or forest."
      },
      {
        "Time_Start": 3322.54,
        "Time_End": 3328.82,
        "Text": " But we have yet to see that implemented in practice."
      },
      {
        "Time_Start": 3328.82,
        "Time_End": 3337.7400000000002,
        "Text": " Anybody else?"
      },
      {
        "Time_Start": 3337.7400000000002,
        "Time_End": 3346.46,
        "Text": " We do have swag, so if you ask a question, we'll give you a T-shirt."
      },
      {
        "Time_Start": 3346.46,
        "Time_End": 3347.46,
        "Text": " I was curious."
      },
      {
        "Time_Start": 3347.46,
        "Time_End": 3351.78,
        "Text": " There's obviously a diverse selection of takeover and escalation primitives."
      },
      {
        "Time_Start": 3351.78,
        "Time_End": 3358.46,
        "Text": " What do you see as the next thing to look into or interesting items for future research?"
      },
      {
        "Time_Start": 3358.46,
        "Time_End": 3364.7,
        "Text": " I'll defer to Chris for that one."
      },
      {
        "Time_Start": 3364.7,
        "Time_End": 3367.66,
        "Text": " For me, it's Intune."
      },
      {
        "Time_Start": 3367.66,
        "Time_End": 3372.1,
        "Text": " Another ubiquitous Microsoft product used for endpoint management."
      },
      {
        "Time_Start": 3372.1,
        "Time_End": 3379.06,
        "Text": " They're really pushing for organizations to move their workstation workflows into Intune,"
      },
      {
        "Time_Start": 3379.06,
        "Time_End": 3382.2999999999997,
        "Text": " and I expect there are going to be a lot of similar challenges."
      },
      {
        "Time_Start": 3382.2999999999997,
        "Time_End": 3387.1,
        "Text": " Hopefully more secure defaults, but also more attack surface."
      },
      {
        "Time_Start": 3387.1,
        "Time_End": 3395.42,
        "Text": " Good question."
      },
      {
        "Time_Start": 3395.42,
        "Time_End": 3401.06,
        "Text": " How much information from the overall hierarchy can you query from the ..."
      },
      {
        "Time_Start": 3401.06,
        "Time_End": 3409.66,
        "Text": " The client."
      },
      {
        "Time_Start": 3409.66,
        "Time_End": 3413.22,
        "Text": " What type of recon can you do if you're just on a client?"
      },
      {
        "Time_Start": 3413.22,
        "Time_End": 3414.42,
        "Text": " You can query LDAP."
      },
      {
        "Time_Start": 3414.42,
        "Time_End": 3419.46,
        "Text": " There's a few different site system roles that have their own attributes when the schema"
      },
      {
        "Time_Start": 3419.46,
        "Time_End": 3422.2599999999998,
        "Text": " is extended to support SCCM."
      },
      {
        "Time_Start": 3422.2599999999998,
        "Time_End": 3423.82,
        "Text": " You can use SMB."
      },
      {
        "Time_Start": 3423.82,
        "Time_End": 3429.22,
        "Text": " A lot of the site system roles will host shares that are named a certain thing."
      },
      {
        "Time_Start": 3429.2200000000003,
        "Time_End": 3432.5000000000005,
        "Text": " That can be used to profile systems like that."
      },
      {
        "Time_Start": 3432.5000000000005,
        "Time_End": 3438.0600000000004,
        "Text": " Some of them have HTTP services where different endpoints will return different status codes."
      },
      {
        "Time_Start": 3438.0600000000004,
        "Time_End": 3441.7000000000003,
        "Text": " All of that, I would recommend looking into SCCM Hunter by our coworker, Garrett."
      },
      {
        "Time_Start": 3441.7000000000003,
        "Time_End": 3446.0200000000004,
        "Text": " He's done a ton of research into that and has done a really good job trying to identify"
      },
      {
        "Time_Start": 3446.0200000000004,
        "Time_End": 3447.76,
        "Text": " those site systems remotely."
      },
      {
        "Time_Start": 3447.76,
        "Time_End": 3454.82,
        "Text": " The one that has been really evasive for us is identifying the site database because clients"
      },
      {
        "Time_Start": 3454.82,
        "Time_End": 3456.9,
        "Text": " don't have any insight into that directly."
      },
      {
        "Time_Start": 3456.98,
        "Time_End": 3462.42,
        "Text": " We can only see directly management points, distribution points, roles that clients talk"
      },
      {
        "Time_Start": 3462.42,
        "Time_End": 3466.6600000000003,
        "Text": " to, or things that are published or directly accessible."
      },
      {
        "Time_Start": 3466.6600000000003,
        "Time_End": 3471.6,
        "Text": " The site database tends to be a tough one, so we usually just look for similarly named"
      },
      {
        "Time_Start": 3471.6,
        "Time_End": 3484.1,
        "Text": " systems or try and identify it in the client's documentation."
      },
      {
        "Time_Start": 3484.1,
        "Time_End": 3491.7,
        "Text": " If you had a look at the HTTPS part of SCCM, because there was a time where you could integrate"
      },
      {
        "Time_Start": 3491.7,
        "Time_End": 3498.9,
        "Text": " it with AD certificate services, and the talk from yesterday didn't suggest that it's a"
      },
      {
        "Time_Start": 3498.9,
        "Time_End": 3505.2999999999997,
        "Text": " good idea or opens a lot of vulnerabilities."
      },
      {
        "Time_Start": 3505.2999999999997,
        "Time_End": 3507.8199999999997,
        "Text": " Yes."
      },
      {
        "Time_Start": 3507.8199999999997,
        "Time_End": 3512.42,
        "Text": " The network access account, if you're not using that, the workaround is to use enhanced"
      },
      {
        "Time_Start": 3512.42,
        "Time_End": 3517.1,
        "Text": " HTTP, which is basically a self-signed certificate."
      },
      {
        "Time_Start": 3517.1,
        "Time_End": 3522.26,
        "Text": " You can think of it as poor man's HTTPS."
      },
      {
        "Time_Start": 3522.26,
        "Time_End": 3526.02,
        "Text": " If you're using PKI, then that would be the ideal situation."
      },
      {
        "Time_Start": 3526.02,
        "Time_End": 3532.2200000000003,
        "Text": " Again, I don't think we see it very much, but in the repo, we do recommend that people"
      },
      {
        "Time_Start": 3532.2200000000003,
        "Time_End": 3534.2200000000003,
        "Text": " do that."
      },
      {
        "Time_Start": 3534.2200000000003,
        "Time_End": 3542.34,
        "Text": " PKI will prevent that spoofing attack, so you won't be able to register a fake client"
      },
      {
        "Time_Start": 3542.34,
        "Time_End": 3545.1800000000003,
        "Text": " because it's expecting that certificate."
      },
      {
        "Time_Start": 3545.1800000000003,
        "Time_End": 3556.46,
        "Text": " But the other attacks, it wouldn't really have an effect on the hierarchy takeovers."
      },
      {
        "Time_Start": 3556.46,
        "Time_End": 3563.2200000000003,
        "Text": " You said that the network access accounts are pushed to the clients and used by the"
      },
      {
        "Time_Start": 3563.2200000000003,
        "Time_End": 3569.46,
        "Text": " clients, then are there any other circumstances or any other account types which are pushed"
      },
      {
        "Time_Start": 3569.46,
        "Time_End": 3574.9,
        "Text": " to the client in clear text and then used by the client?"
      },
      {
        "Time_Start": 3574.9,
        "Time_End": 3576.6600000000003,
        "Text": " Yes."
      },
      {
        "Time_Start": 3576.6600000000003,
        "Time_End": 3589.26,
        "Text": " All of those accounts that I talked about are sent to the client in the same manner,"
      },
      {
        "Time_Start": 3589.26,
        "Time_End": 3590.26,
        "Text": " stored in the same way."
      },
      {
        "Time_Start": 3590.3,
        "Time_End": 3593.5,
        "Text": " They're all in the computer policy."
      },
      {
        "Time_Start": 3593.5,
        "Time_End": 3597.3,
        "Text": " The only exception would be things like the task sequence accounts, which would depend"
      },
      {
        "Time_Start": 3597.3,
        "Time_End": 3602.94,
        "Text": " on the SCCM collection where that task sequence applies."
      },
      {
        "Time_Start": 3602.94,
        "Time_End": 3608.6200000000003,
        "Text": " But if you are on a client in a specific collection and there's a task sequence applied to that"
      },
      {
        "Time_Start": 3608.62,
        "Time_End": 3622.8599999999997,
        "Text": " collection, then those accounts would exist in the same manner."
      },
      {
        "Time_Start": 3622.8599999999997,
        "Time_End": 3630.62,
        "Text": " Have you had a look at the cloud management gateway and if it adds additional attack surface?"
      },
      {
        "Time_Start": 3630.62,
        "Time_End": 3631.62,
        "Text": " That's a great question."
      },
      {
        "Time_Start": 3631.62,
        "Time_End": 3632.8599999999997,
        "Text": " It's one of my favorite questions."
      },
      {
        "Time_Start": 3632.86,
        "Time_End": 3640.78,
        "Text": " I started looking at it because I was trying to see if maybe I could actually deploy my"
      },
      {
        "Time_Start": 3640.78,
        "Time_End": 3645.98,
        "Text": " own instance in the cloud and use it for C2 on a real engagement because I thought it"
      },
      {
        "Time_Start": 3645.98,
        "Time_End": 3646.98,
        "Text": " would be funny."
      },
      {
        "Time_Start": 3646.98,
        "Time_End": 3651.98,
        "Text": " CMG was just incredibly complex, so I just stood up a management point in the cloud and"
      },
      {
        "Time_Start": 3651.98,
        "Time_End": 3652.98,
        "Text": " that seemed to work."
      },
      {
        "Time_Start": 3652.98,
        "Time_End": 3658.1,
        "Text": " I haven't quite finished that research, but haven't dug into cloud management gateway"
      },
      {
        "Time_Start": 3658.1,
        "Time_End": 3659.1,
        "Text": " much beyond that."
      },
      {
        "Time_Start": 3659.1,
        "Time_End": 3665.1,
        "Text": " Our coworker Garrett started looking into it, doing profiling for it specifically, and"
      },
      {
        "Time_Start": 3665.1,
        "Time_End": 3671.74,
        "Text": " identified some interesting files that exist on that system that can inform other attacks."
      },
      {
        "Time_Start": 3671.74,
        "Time_End": 3674.54,
        "Text": " But beyond that, we haven't dug too much into it yet."
      },
      {
        "Time_Start": 3674.54,
        "Time_End": 3675.54,
        "Text": " Okay."
      },
      {
        "Time_Start": 3675.54,
        "Time_End": 3676.54,
        "Text": " Thanks, guys."
      },
      {
        "Time_Start": 3676.54,
        "Time_End": 3677.54,
        "Text": " Thank you."
      },
      {
        "Time_Start": 3678.54,
        "Time_End": 3679.54,
        "Text": " Okay."
      },
      {
        "Time_Start": 3679.54,
        "Time_End": 3680.54,
        "Text": " Thanks, guys."
      },
      {
        "Time_Start": 3680.54,
        "Time_End": 3681.54,
        "Text": " Thank you."
      },
      {
        "Time_Start": 3681.54,
        "Time_End": 3682.04,
        "Text": " Thank you."
      }
    ]
  }
}