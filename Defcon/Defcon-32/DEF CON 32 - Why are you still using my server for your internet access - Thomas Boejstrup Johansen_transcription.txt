{
  "webpage_url": "https://www.youtube.com/watch?v=uwsykPWa5Lc",
  "title": "DEF CON 32 - Why are you still using my server for your internet access - Thomas Boejstrup Johansen",
  "description": "Pawning countries at top level domain by just buying one specific domain name \u2018wpad.tld\u2019, come hear about this more the 25+ years old issue and the research from running eight different wpad.tld domains for more than one year that turn into more the 1+ billion DNS request and more then 600+GB of Apache log data with leaked information from the clients.\n\nThis is the story about how easy it is to just buying one domain and then many hundreds of thousands of Internet clients will get auto pwned without knowing it and start sending traffic to this man-in-the-middle setup there is bypassing encryption and can change content with the ability to get the clients to download harmful content and execute it.\n\nThe talk will explain the technical behind this issue and showcase why and how clients will be trick into this Man-in-the-middle trap.",
  "channel_url": "https://www.youtube.com/channel/UC6Om9kAkl32dWlDSNlDS9Iw",
  "duration": 2349,
  "channel": "DEFCONConference",
  "uploader": "DEFCONConference",
  "upload_date": "20241016"
}

1.97s - 3.97s | This text was transcribed using whisper model: large-v2

 Yeah, my name is Thomas and
5.13s - 9.87s |  My daily work is incident response and forensics. I had done some red team
10.97s - 14.35s |  So in red team engagements, I often use
14.87s - 21.35s |  Responder where there's a function to set up a rogue proxy server with the WPAT function
22.71s - 24.23s |  so
24.23s - 27.71s |  monitoring the network to see the traffic seeing that
28.71s - 31.27s |  Clients is asking for the WPAT domain
31.79s - 36.59s |  In the company, but it is also sometimes asking for WPAT
36.99s - 38.87s |  TLD
38.87s - 45.39s |  So who is having this domain? Is it in use? Is it free? Can I buy it? What are they using it for?
45.91s - 53.55s |  So at the time I looked at this I looked up and discovered it was a German guy that had this Danish domain
54.67s - 56.67s |  Don't know what he was using it for
57.11s - 63.35s |  Two years later. I looked again discovered as a someone in Israel having the Danish domain and
64.55s - 65.79s |  in
65.79s - 69.23s |  2020 the Danish register for DK DK domains
69.99s - 72.95s |  Added a function where you can sign up for a waiting list
72.95s - 77.39s |  So I signed up for a waiting list and paid small fee every year
77.91s - 80.76s |  so
80.76s - 84.92s |  how it's working the basic is that a client goes to
85.56s - 86.56s |  For
86.56s - 87.56s |  requesting a web page
87.56s - 92.96s |  it's going to the DNS server finding the IP address then go to the web server and and
93.52s - 98.96s |  Getting the content back very basic if we are adding a proxy server into the mix
99.72s - 102.84s |  Then the proxy server will do all the heavy lifting
103.44s - 104.44s |  so
104.44s - 107.92s |  the client is asking the proxy server the proxy server is is
108.24s - 112.20s |  doing the name resolving and getting the web page and returning the content to the
112.80s - 114.36s |  in client
114.36s - 117.32s |  so
117.32s - 118.84s |  back in
118.84s - 120.84s |  1996 Netscape
121.12s - 127.24s |  decided that there must be a easier function for when you're adding a machine to a network to
128.40s - 131.36s |  Automatically conflict in the machine. So they come up with this
132.00s - 138.16s |  WP pad function to automatically ask for the machine where the configuration file is stored
138.48s - 140.48s |  And
140.56s - 146.36s |  They sit down a consortium to try to make a FC stand out for it, but it never
147.24s - 149.36s |  eclipses it expired in
149.96s - 151.28s |  1999
151.28s - 153.28s |  So it's 25 years
154.00s - 157.97s |  anniversary now
157.97s - 163.85s |  According to Wikipedia the way it works is that you have the name where the client is
164.33s - 170.45s |  Part of the domain it will add V part in the front and slowly test until it finds a
171.13s - 175.21s |  Name where it matches and get a response and can download the configuration file
176.01s - 180.85s |  But in some implementations it will go down to the pad
181.29s - 187.89s |  TLD and then download the configuration file from there. And as you can see on the Wikipedia page here is this
189.05s - 190.41s |  incorrect
190.41s - 193.97s |  Solution and it shouldn't be used that way. So that's a
194.69s - 196.25s |  security issue
196.25s - 204.01s |  So the way we had is that we have a client that's called client dot a dot company dot com
204.65s - 207.85s |  Then it will search for VPAT when the browser is opened
208.29s - 216.21s |  It will then remove the client name and then try to add VPAT dot a dot company dot com and try to resolve that
216.21s - 220.61s |  If that's not working it removes one name. So it's VPAT company
221.33s - 228.73s |  Dot-com and in this example, it's resolving the IP address and then it goes to a web server trying to download a file
228.73s - 230.73s |  called VPAT dot that and
231.13s - 233.57s |  That's the configuration file for the client
234.41s - 239.01s |  It can also be conflict with other solutions like DHCP bins and so on
240.25s - 247.77s |  So that that file it downloads is actually a small Java script that the client execute on the client machine
248.33s - 249.61s |  with
249.61s - 256.13s |  Called find proxy for URL. It's input what URL it's trying to go to and the name and then you can
256.89s - 263.73s |  modify this script to say that the clients should go direct if it's company name addresses or it should go to a
263.97s - 271.49s |  Proxy server if it's all anything else on the internet like this proxy dot company dot TLD dot 880
272.05s - 277.94s |  so here we have example of where to try and go to DEFCON dot org and
278.54s - 284.78s |  It's not matching in of the if statements and then go to the proxy as the last return statement
285.58s - 291.38s |  There's a website dedicated for all the functions that can be used in this limited very limited
292.06s - 294.94s |  Java script language you cannot use all functions
296.66s - 299.02s |  Here you can see the top part of the functions
299.26s - 305.86s |  There's DNS domains resolve is it in net and so on but there's also some other functions does work
306.10s - 308.78s |  Like I have found here the stable functions
308.78s - 315.30s |  I call them with I can get user agent host name time zone and so on in the past
315.30s - 317.74s |  I could also from some clients get
318.46s - 322.66s |  Screen resolution and color depth and so on from each client
322.66s - 328.86s |  But that's very unstable and many of the clients that crashes the Java script when trying to ask for that
328.94s - 330.94s |  So I've removed that
331.30s - 332.98s |  so
332.98s - 334.98s |  when
335.30s - 340.90s |  VPAT is implemented Ella is not implemented in a company and someone gets the top-level domain
340.90s - 345.10s |  Then what happened is that the client is asking for the VPAT in the company?
345.58s - 347.90s |  It doesn't get any results
347.90s - 355.14s |  It tries again by removing one name and tries again by removing one name and ending on VPAT DK
356.54s - 357.78s |  so
357.78s - 361.34s |  It goes to an external VPAT in a web server
361.90s - 368.26s |  Downloading a configuration file for the client's how it should use proxy settings and trust that server
368.62s - 371.30s |  Even as it's not inside the company in
375.75s - 381.71s |  1999 when it expired and Microsoft was part of this consortium the same month
382.47s - 384.35s |  Microsoft was informed that
384.35s - 390.67s |  There's a security issue if someone buys this top-level domain in TL with any TLD
390.71s - 393.07s |  You can basically own a complete country
393.67s - 401.53s |  So there has been talks about this before in 2007 on Kiwi con there was some guy
402.41s - 405.09s |  Having a eight-year anniversary for this issue
406.01s - 411.25s |  Looking at the things and had a very good talk. Unfortunately, it's not public anymore and
412.17s - 417.29s |  then a smooth come same year another guy had to look into this and
417.93s - 418.97s |  And
418.97s - 424.77s |  Then Microsoft got busy again trying to make a new patch trying to fix whatever that was found in
425.45s - 426.69s |  2007
426.69s - 428.69s |  So now it's fixed, right?
428.85s - 430.49s |  It should be
430.49s - 435.24s |  So for me, the waiting time is over in
436.00s - 436.92s |  2023 in March
436.92s - 444.48s |  I got a mail from the Danish registered eco host master saying that the VPAT DK domain was now mine and
444.80s - 447.52s |  I could register it and assign it to a server
447.80s - 454.76s |  So I found a cheap paper tilt and added to a web server there just because I think I want to see if there's any
454.76s - 456.36s |  traffic at all
456.36s - 458.36s |  Just money to the locks and so on
459.00s - 466.20s |  At the same time. I looked at who has owned this domain in the past and I could see that from the talks in
466.76s - 468.76s |  2007 there was someone in Denmark
469.52s - 472.68s |  Deciding it was a good idea to have this domain for some years
472.80s - 475.36s |  But then he sold it and one
475.96s - 482.54s |  Guy in Belgium got the domain and one in Germany and then one in Israel and then I got it here last year
483.04s - 490.45s |  So this is the locks from the first day. I assigned the VPAT to a VIP hotel
490.45s - 497.05s |  I was a bit surprised to get more than 80,000 requests of this VPAT dot that file on
497.61s - 504.65s |  The first day basically the spike in the graph. I think that's the rollover time from I started at
505.17s - 507.17s |  24 hours, that's why it's not linear
507.81s - 515.17s |  So basically 80,000 requests on the first day without doing anything other than buying a VIP hotel and adding the domain
516.93s - 520.41s |  So that's not fun because I don't have access to all the log files
520.53s - 523.41s |  So the way was that I set up a VPS server
524.13s - 528.55s |  Installed DNS server on it become my own name server on the Internet
528.99s - 535.83s |  Registered and DNS sec and all the things and added a web server on top out of that that way I could add the domains
535.83s - 542.07s |  I got into this server and capture all the traffic all the locks in the way. I like to have them and
544.03s - 546.47s |  Every good website should have a webpage, right?
546.47s - 554.55s |  so I took my best skills and open notepad and crafted a webpage where I added some crap about you shouldn't use this page and
555.19s - 557.19s |  This is for research and so on
557.59s - 567.46s |  So when the client is downloading this VPAT that file the Java script and executing it on the
567.80s - 574.60s |  Internal client machine it cannot see the public IP that is coming out on when it's going on to the Internet
574.76s - 579.68s |  so the way I fixed that was that I added on my web server at a
580.04s - 583.72s |  Dynamic webpage that builds the JavaScript for the client
584.12s - 590.20s |  Dynamically so I asked the client's public IP into the scripts before each client get the script
590.20s - 594.24s |  So they're getting a dedicated script for each client. So I have the public IP
594.60s - 599.56s |  Even the client doesn't know it in the in by themselves on the internal network
600.12s - 605.54s |  So when a client one two, three want to go to
606.58s - 608.22s |  the net
608.22s - 612.70s |  This is a simplified version of my scripts. But what is basically doing?
612.86s - 617.62s |  I'm building a string in the DNS name with the information
617.62s - 623.26s |  I take from the client like the time zone internal IP external IP and so on
623.54s - 626.66s |  So it I can leak data to my DNS server
627.26s - 629.26s |  about the internal client
630.14s - 637.22s |  So in this example, you can see the client is told to go to Defcon.org and the D is the time zone
637.22s - 642.34s |  I and then internal IP W is the world IP public IP
642.86s - 646.26s |  And then it goes to p.vpad.dk as my server
646.26s - 651.22s |  And of course I use port 80 because I want all the traffic to me unencrypted
651.54s - 655.30s |  So just come as normal HTTP unencrypted
656.90s - 657.94s |  So
657.94s - 662.62s |  The then the client for every request they make on the machine all URLs
662.70s - 668.78s |  They will pass it through this web proxy scripts and then it will go to this address that built
669.34s - 675.58s |  Automatically in a dynamically for each request they're doing so I get in my log files
676.58s - 683.70s |  Listing of what traffic they are trying to resolve and then I tell them to all the requests go to this web server
683.70s - 686.50s |  there's my web server on the same host and
688.65s - 696.73s |  Then the client is asking my server for some webpage and I read and I'm so kind so I return arrows for everything
697.05s - 702.09s |  Because I don't want to run a proxy server on the internet that is opened and be man-in-the-middle
702.09s - 704.09s |  So I just return arrows for everything
704.89s - 706.89s |  and yes, I
707.45s - 714.97s |  Get the see the inside with HTTP clear text, but they think I'm asking on the outside at HTTPS
715.65s - 721.91s |  So for every request every client is making are returning this error page
724.99s - 729.51s |  And to be nice to the users I have included a input form
729.51s - 735.59s |  so if they don't like what they're seeing they can tell me what the hell is wrong and what I should do better and
736.03s - 741.95s |  there's also a checkbox for whitelisting the client so they can input the client the host name and
742.35s - 750.23s |  At the click the whitelist checkbox, but I haven't implemented that function. So this is first step on the form, right?
750.51s - 752.51s |  Mm-hmm
752.55s - 757.11s |  Yeah, and just a disclaimer, I'm not intercepting any traffic
757.11s - 761.43s |  I'm just looking at log files and so on from request as coming in
761.43s - 764.99s |  I haven't told any clients anywhere to contact my server
764.99s - 770.83s |  I've only just bought one domain name set up a web server and all the clients is coming to my server
772.31s - 775.95s |  So this is example of information I'm getting from one client
775.95s - 782.99s |  I can see the clients public IP what name server used what internal IP address it has the time zone and
782.99s - 785.23s |  Then from of course from the web server log
785.23s - 792.51s |  I can see what they're asking for and thereby also which user agent strength they have what application are they using and
793.19s - 795.19s |  operating system and so on
795.99s - 800.35s |  So this was fun that come get a lot of traffic into the server
801.47s - 805.79s |  More than I expected so why not look for buying some more domains
806.79s - 808.79s |  sadly
808.83s - 810.83s |  The three domains here they are
811.59s - 816.11s |  Riggs elevator protected so you cannot register them. There's a limit on that
816.11s - 822.07s |  They have already set that up, but I got ID and site and built just for fun
823.15s - 830.63s |  And why not looking at the list there was press and porn so we can try see which one of them is the most
830.63s - 832.63s |  popular one and
833.71s - 835.71s |  Because we are here dot Vegas
836.11s - 839.42s |  And then I found that
839.62s - 841.34s |  VPAT dot EU
841.34s - 847.78s |  Was apparently registered, but there was someone trying to sell the domain, but I'm not buying it at that price
848.22s - 851.62s |  So I could see that also rented domain
851.62s - 856.54s |  So if you ask them can I rent this domain for one year and is there any?
857.02s - 861.90s |  Limits of rules for what I can use the domain for and they say no you can there's no rules
861.90s - 868.30s |  You can rent it for one year and I paid three and a half euro per month for renting the domain and then up
868.86s - 871.02s |  Politely return it when I was done with it
873.18s - 877.06s |  So this is my list of domains for this research and
878.82s - 884.66s |  For one year from April to April I get 1.1 billion DNS requests
884.66s - 889.58s |  We're solving in 200 gigabyte 6 log files. This is for the DNS server alone
890.34s - 891.26s |  And
891.26s - 894.30s |  If you look down on the I don't know how big it is
894.30s - 899.58s |  but there's a client asking for CNN calm and you can then see the
899.86s - 903.54s |  The internal IP and public IP and so on of the clients
904.02s - 911.81s |  So here I have seen on which we patch domain
912.33s - 915.53s |  where are the clients coming from in the world and
916.05s - 921.97s |  For the Danish domain DK does awfully see a lot of traffic from Denmark
922.53s - 928.81s |  but to my surprise why is there so much traffic from Russia and Ukraine to the Danish domain and
929.37s - 931.89s |  Then there's a big jump down to Germany
932.33s - 938.05s |  so it's a bit odd there's so much traffic for the for that on the DK domain and
939.61s - 942.01s |  Dot Vegas domain on the right
942.73s - 949.85s |  Yeah, of course United States would be there but all the other domains it's a mixed order of why they have the dot Vegas
950.61s - 956.73s |  So when Windows machines today is connected to a network
956.85s - 960.81s |  It will in the lower right corner and shoes tray have a nice icon
961.21s - 965.01s |  Indicating it has internet access and and is working
965.33s - 972.05s |  But in because I'm a proxy server that doesn't return anything and doesn't work by design
972.41s - 975.61s |  The clients of course will show that they don't have internet access
976.05s - 981.93s |  So I found that for this list of six Microsoft domains if I return the string
982.25s - 987.33s |  Okay for every request the client will indicate this has good internet access
987.93s - 993.69s |  So I just added a rule to the proxy web server function saying if you see this domain
994.05s - 997.09s |  Respond with okay, and all the clients then suddenly
997.81s - 1007.97s |  Indicated they have good internet access again. So what type of traffic do I see? Here's the types of requests I see and
1008.97s - 1012.33s |  Again, of course, I will see a lot of get requests
1012.69s - 1015.53s |  But I also see a lot of post requests
1015.53s - 1022.69s |  So that's client sending data up to the service and then I got all the connects request. That's the proxy traffic
1022.93s - 1025.97s |  there's 1.1 billion request for
1026.73s - 1032.21s |  Asking the proxy server to collect something. So that's actually clients that has downloaded the ever
1033.05s - 1038.17s |  Proxy pack scripts and executed and on a machine and then coming and asking for a web page
1038.73s - 1042.97s |  But also we see on the list as ripped out as Apple there's
1043.49s - 1048.69s |  It's Microsoft SSM client. There's Microsoft VPN and
1049.21s - 1051.53s |  There's many more. I have not included in this
1052.37s - 1056.13s |  so there's a lot of different traffic in the in this and
1057.01s - 1061.93s |  That is based on the Apache log files. You can see in the lower corner about
1063.09s - 1066.01s |  470 gigabytes Apache log files
1066.69s - 1073.61s |  With 1.5 billion requests in them, so it takes some times to grab through them and find the data
1075.29s - 1078.18s |  So
1078.18s - 1085.26s |  Because I am a proxy server the client trusts and I have given them a configuration scripts
1085.26s - 1089.22s |  I have told them to send every data to my server
1090.02s - 1094.42s |  Including local traffic. So if you look here, you can see an internal client as
1095.14s - 1102.26s |  1.5 it should actually talk to the same computer on the same network next to it 1.1
1102.58s - 1106.66s |  But because I've given it a script saying no you should ask the proxy server
1106.70s - 1110.14s |  It's sending the traffic up to me and asking me as a proxy server
1110.90s - 1112.90s |  even that they are on the same network and
1115.54s - 1121.98s |  Post requests. This is client sending data. They're just posting data against a web server
1122.62s - 1123.66s |  Um
1123.66s - 1128.66s |  37 million requests as I don't have the data. I only have the logs
1128.66s - 1129.98s |  I don't know what it is
1129.98s - 1136.58s |  But it everything clients sends to serve us so they could be confidential data, whatever documents files
1137.06s - 1139.06s |  content, whatever
1139.50s - 1140.98s |  And
1140.98s - 1144.42s |  Again, because I'm controlling everything with my proxy scripts
1144.42s - 1149.50s |  So every dot local traffic I have in the domain Ella from the clients
1149.50s - 1153.66s |  It should never go to the internet because it's not resolvable on the internet
1154.14s - 1158.26s |  That's designed to be handled to be used for internal network
1158.74s - 1164.98s |  so here we see some funny domains like Citrix and file print and vCenter and
1165.46s - 1170.66s |  Yeah, where the client is coming up to my proxy server and asking for me to get that traffic
1171.50s - 1175.82s |  Because it's local I can of course not get the traffic but I can see what they are asking for
1176.22s - 1180.36s |  And then some years back
1180.36s - 1186.16s |  There started to be a new smart function in the browsers because they want to protect the DNS traffic
1186.40s - 1189.92s |  Saying we want now to send the DNS traffic over HTTPS
1190.24s - 1195.68s |  Because then rogue guys man in the middle couldn't happen and they better couldn't control it
1195.88s - 1201.32s |  But because I'm now a man in the middle proxy server. I'm also controlling the
1201.96s - 1208.12s |  DNS over HTTP and it's basically just as you can see here a client asking for Baidu.com
1208.68s - 1212.76s |  And then it returns a JSON blob. So my proxy could return
1213.76s - 1218.80s |  Whatever I want a JSON blob directing the client to go to another location or whatever
1220.44s - 1228.22s |  So passing through the log files and looking for all the file extensions as downloaded
1228.90s - 1231.70s |  This is some of them. There's the highlighted one
1232.54s - 1236.30s |  it's a bit scary to see all the credentials and certificates and
1237.02s - 1239.94s |  There's the executables there's database files
1240.18s - 1246.30s |  There's scripts so I could replace a script and if the client is executing the script on the machine, it's
1246.86s - 1248.86s |  Not a good thing for the client
1251.13s - 1253.13s |  here's example of
1253.29s - 1260.53s |  Executable files the clients try to download so there's some Windows update Microsoft installer. There's antivirus updates
1261.13s - 1267.65s |  Microsoft SCCM client and real player and didn't know real player still was a thing but okay
1268.21s - 1270.21s |  So there's a lot of different
1271.45s - 1275.37s |  Requests here and I get a lot of them. This is just a small sample list
1277.17s - 1284.41s |  But the list of file names I found with the extensions is not fully true because I also found that there was some
1284.57s - 1289.33s |  Bad guys trapped in my setup trying to scan other servers
1289.41s - 1295.93s |  So they were trying to enumerate four different files likes PFX files and other files so you can see here
1295.93s - 1302.09s |  There's a long list where they try to access a web server asking for different files and hoping that I find something
1302.77s - 1309.54s |  So credentials in the URL
1310.42s - 1317.94s |  there's a lot of them get 200,000 URL requests with where the username and password is part of the URL and
1318.58s - 1322.06s |  I don't know if you can see the size of the screenshot there
1322.22s - 1329.46s |  But it's apparently a Indian guy that has a lot of friends. He's using a web service to send SMS
1330.70s - 1336.46s |  Messages to all his friends. He apparently have a lot of friends. There was many many log lines here
1336.86s - 1339.94s |  So they all start with beer something
1341.30s - 1349.80s |  Yeah, I don't know what he is trying to do. So credentials. Here's some of the
1350.32s - 1352.24s |  clear text
1352.24s - 1359.84s |  Non-encrypted credentials. I just get to the server and I have some of them is so ridiculous like admin admin
1360.08s - 1365.84s |  Accountants cannot censor that away. It you should see it and there's changed me changed me
1365.84s - 1368.00s |  I think that's a good idea to change that one
1369.20s - 1377.44s |  And security party. Yeah, we are Defcon security is a party. So yeah, that's very crappy credentials
1378.20s - 1380.20s |  and
1380.20s - 1381.52s |  ntlm
1381.52s - 1389.00s |  Version 1 shouldn't be used for the last 20 years as Microsoft has tried to tell us change to ntlm version 2
1389.84s - 1395.88s |  so administrator root security accounts and so on with ntlm version 1 and
1399.62s - 1401.98s |  Then there's ntlm version 2. I
1402.54s - 1409.10s |  Also got many many clients sending the credentials and there's some good usernames here admin
1409.54s - 1410.78s |  administrator
1410.78s - 1412.10s |  doctor
1412.10s - 1416.14s |  Hotel manager and then a laser that sounds fun to play with
1416.94s - 1422.10s |  And it's a that's normally a system administrator account on SQL servers and likes
1422.78s - 1425.90s |  So many good credentials if you're malicious
1426.74s - 1431.79s |  So what is the client talking to this server?
1432.31s - 1436.99s |  When I started this project and my my thinking was this is just Microsoft crap
1437.87s - 1442.75s |  They should patch the things but if you look at the list, you can see it's basically everything
1443.51s - 1448.99s |  Every application it's VPN clients. It's antivirus applications. It's
1449.55s - 1451.07s |  Yeah
1451.07s - 1455.91s |  The list is very long. This is just some of them. There's cobalt strike and
1457.23s - 1463.35s |  You can see in the lower right left corner. There's even some guy having trouble with his internet access
1463.35s - 1465.79s |  So he's using wireshark to debug his
1466.59s - 1470.87s |  Network is not working because he's apparently using a proxy that doesn't return anything
1471.35s - 1476.19s |  So he's debugging that and I didn't get his update check from wireshark
1476.99s - 1478.55s |  Yeah
1478.55s - 1483.11s |  So the list is long there's potentially pin and many clients
1483.83s - 1485.83s |  In fact, I got
1486.79s - 1488.87s |  27,000 different user agent strings
1489.91s - 1493.43s |  with Linux Mac iPhone Android
1494.07s - 1496.07s |  Whatever all platforms
1496.19s - 1502.75s |  So now I cannot say which client it is that has the issue and which application that has the issue
1503.23s - 1505.23s |  Because it seems to be everything
1512.94s - 1519.02s |  Yeah, so when you're running on a proxy server that doesn't return anything and you have clients behind it
1519.46s - 1523.70s |  There was some of the clients was not able to download some
1524.98s - 1526.46s |  updated
1526.46s - 1529.82s |  Background screen that the crowd strike provided to Windows machines
1530.46s - 1532.46s |  So I have actually protected
1533.30s - 1535.78s |  226 machines from cross like and
1542.83s - 1544.51s |  What about detection?
1544.55s - 1551.43s |  The only place I have seen any detection is when clients is behind a Palo Alto setup
1551.71s - 1557.23s |  the Palo Alto setup will monitor the URLs the clients is asking for and then try to
1557.63s - 1563.31s |  Categorize them and check them for malicious thing and so on like many other proxy servers is also doing
1563.79s - 1566.75s |  It's the only one I have seen in the traffic does
1567.07s - 1573.43s |  Interacting with the traffic and in the way it's doing it is replaying the same request that the user tried to do
1573.43s - 1579.43s |  But it as in adding this user agent string this long string you see here. That's the complete string
1579.47s - 1586.03s |  so it's a pretty long user agent string where it says it's Palo Alto monitoring device and so on and it's
1586.39s - 1589.27s |  Suggesting I can send a mail to them to get whitelisted
1589.71s - 1596.03s |  But again, I'm a proxy server and I'm not the destination. So it will pretty many mails
1596.03s - 1600.67s |  I have to send to them to get a whitelisted for everything. So I haven't tried that
1601.47s - 1605.90s |  And then Cisco
1605.94s - 1607.90s |  apparently has some kind of
1607.90s - 1613.82s |  Endpoint clients you can install on computers and I it's my understanding
1613.82s - 1618.70s |  It is designed to protect the client from rogue DNS servers and rogue proxy servers
1620.86s - 1622.86s |  It's not working so well
1625.48s - 1631.30s |  Because what happened is because I'm returning error pages to everything and rejecting all traffic
1631.78s - 1639.30s |  The client in and the client machine the application seems to get angry and just making brute force against my machine
1639.46s - 1644.10s |  Trying to loop and getting the crazy request again and again again again and trying
1644.50s - 1648.22s |  So the only way was I had to make a black hole for the domain
1648.22s - 1652.82s |  so I just discarded everything with open DNS that come into to a
1652.98s - 1658.10s |  No, and didn't reply on it. And then the Cisco client stopped he tossing my server
1658.10s - 1660.10s |  Yeah
1661.10s - 1666.01s |  So I have also found what I think is malicious
1667.13s - 1675.29s |  This is a for the domain's engineer exchange exposed software and so on. There's a VPAT script and it seems to be
1676.77s - 1682.77s |  Running a proxy for HTTP and FTP traffic with the fail option
1682.77s - 1684.77s |  So if it doesn't work, it will go direct
1685.21s - 1691.25s |  But it's also collecting data and sending it over an extra channel with some communication
1691.25s - 1696.49s |  so this looks like someone is monitoring traffic for this for domains here and
1700.24s - 1703.12s |  There's this one. It's a bit weird one
1705.00s - 1709.64s |  It's a I think it's either it's a guy that really really like ads or
1710.48s - 1716.92s |  It's it's just some testing going on because on VPAT trade. There's a proxy script
1717.24s - 1723.80s |  There's looking with a lot of if statements if there's including some kind of ad word in the request
1723.80s - 1729.72s |  It will send the request through a proxy server if there's not a word then it will go direct
1730.00s - 1733.24s |  So it seems that someone is trying to collect all the ads
1734.68s - 1738.00s |  The reason for this I think can maybe be that he is
1738.52s - 1742.56s |  replacing the ad IDs in the traffic to his own and by this
1742.76s - 1749.84s |  Earning money on capturing the traffic and then getting paid for it because he's directing all the clients to his ad ID
1750.36s - 1752.64s |  Maybe or it's a test for something
1753.44s - 1755.44s |  Or he's just like ads. I
1756.36s - 1766.08s |  Don't know. So here's another one also a bit weird and the name the TLDs
1766.32s - 1767.92s |  That doesn't
1767.92s - 1771.00s |  Mr. Cooking storage surf. There's no
1771.76s - 1773.60s |  no
1773.64s - 1775.64s |  Continuous line in them
1776.04s - 1779.40s |  It claims to be some sort of security project
1779.40s - 1785.92s |  I haven't been able to found it'll find any place where they are talking about this project and anything
1785.92s - 1788.76s |  So it's only a claim inside this configuration file
1789.60s - 1792.60s |  It's it's a bit weird in it's only
1793.16s - 1798.30s |  Sending the traffic to a proxy server for what is not result of domains
1798.74s - 1805.26s |  So up all the things that fails it sends to the proxy server anything else it goes to direct
1805.90s - 1810.30s |  So it's maybe something that tries to look for all the odd things that's hidden on the net. I
1810.98s - 1812.98s |  Don't know what the function is
1815.80s - 1817.04s |  Yeah
1817.04s - 1819.04s |  So we have a winner
1819.20s - 1824.80s |  Apparently press is more interesting than porn. I wouldn't have guessed otherwise
1825.36s - 1828.72s |  But this is the score for the vpad.dat file
1828.96s - 1834.68s |  How many times it downloaded and they have been running at the same server same time for the same?
1835.24s - 1838.36s |  so
1838.36s - 1841.64s |  From the client from the forms I get with the users. I
1842.56s - 1844.96s |  Got 40 users that click they wanted
1845.80s - 1847.80s |  whitelisting from this error
1848.32s - 1851.92s |  even I haven't implemented any function to whitelist anything and
1852.32s - 1855.52s |  Just returning errors to them and they insert some
1856.04s - 1860.60s |  Computer names it doesn't look like DNS names, but it's computer names
1861.24s - 1862.28s |  so
1862.28s - 1868.39s |  Yeah, maybe a day. I will add a whitelist function and here we have some
1869.19s - 1871.19s |  feedback from the users
1872.31s - 1874.31s |  Apparently they are not all happy
1874.59s - 1881.11s |  Some users say I've got this error message when trying to get to my net bank or I click this link in the mail
1881.11s - 1883.11s |  and got this error or
1883.15s - 1885.15s |  t-shirt or whatever
1885.35s - 1887.35s |  So not all users are happy
1888.03s - 1893.02s |  so
1893.02s - 1895.02s |  When I saw that I was getting
1896.30s - 1903.38s |  Feedback from the users. So thinking why not set up a survey asking the user how much they like my
1904.30s - 1910.58s |  Non-working proxy server that only returned errors to all the clients. So I added this
1911.22s - 1913.78s |  three normal steps that could ask and
1914.38s - 1916.38s |  to my surprise I
1916.62s - 1922.58s |  Have a higher leaning on they really like my service and would recommend it to their friends
1922.70s - 1933.88s |  so this is for a non-working proxy, but there was only four responses, so
1935.44s - 1941.44s |  Yeah, and there was no one submitting email email address so the hundred dollars are going to Danish cancer front I
1943.69s - 1948.13s |  Added on the on the web page. I added a feedback form
1948.49s - 1954.05s |  Maybe getting some good suggestions and so on to what I can improve on my non-working proxy
1954.33s - 1960.13s |  But I only got more than 3,000 spam messages saying that they will
1960.65s - 1961.69s |  Isaeo
1961.69s - 1968.09s |  Optimize my website so more will find it. I don't know if I should sign up for that. I have many clients already
1969.05s - 1971.69s |  and zero feedback from anyone
1972.37s - 1975.90s |  so
1975.90s - 1979.22s |  For the period of this one year. I'm honest with
1979.98s - 1986.34s |  By Google if anyone anywhere was writing about this domain I had on my list to see if they was
1986.78s - 1988.78s |  Talking about it in some forum
1989.34s - 1991.66s |  Talking about disabling VPAT and so on
1992.18s - 1997.70s |  I haven't found anyone for one year talking about anything about the domains
1997.82s - 2003.94s |  So it has been to my knowledge completely silent for one year without any detection anywhere
2004.46s - 2008.70s |  so my question is
2009.30s - 2012.54s |  Why can a dude like me even buy this domain
2012.94s - 2018.86s |  Why should this crap that's 25 years old not be just disabled. Why do we have this? It's not
2019.50s - 2021.62s |  It's not modern security model
2021.62s - 2028.02s |  We just download a prior a park script with a Java script run it on the client and then the client just since all the
2028.02s - 2031.30s |  Traffic to a proxy server. It's not very secure
2031.94s - 2036.70s |  So, I don't know if I can stand here in 25 years or in a wheelchair
2037.22s - 2041.62s |  Talking about the same thing once again saying that nothing have changed. I
2043.02s - 2045.02s |  Don't know
2045.18s - 2047.18s |  But it is this 25 year anniversary
2051.26s - 2053.82s |  Yeah, I can see I have still some time
2053.82s - 2061.92s |  So first of all a big shout out to my friend kill Norman for a lot of help with the research and an information
2062.58s - 2066.38s |  And I have some bonus slides because I have some extra time
2066.94s - 2070.41s |  So I posted this
2070.93s - 2074.81s |  like this talk was on the schedule pace on DEF CON and
2075.81s - 2079.99s |  Shortly after that time I was contacted by a guy. That's called Teton
2080.57s - 2081.85s |  saying that
2081.85s - 2087.37s |  He was for the last half year basically doing the same research into some other domain names
2087.37s - 2091.97s |  And we could look and share some data. That could be fun if we had the time
2093.33s - 2095.33s |  but also he's had
2095.53s - 2098.53s |  Paid up for some domains in the dot 80 and
2100.41s - 2104.81s |  From what I've I heard there should be a coming a really really good talk
2104.81s - 2108.85s |  I look forward to hear how many a active directories does
2109.97s - 2111.97s |  Coming in the same way
2112.33s - 2113.93s |  Okay
2113.93s - 2117.14s |  so
2117.14s - 2119.14s |  after running this for
2119.86s - 2121.06s |  basically
2121.06s - 2123.06s |  two months I
2123.42s - 2129.02s |  Got contacted in Denmark Denmark is not a very big place about five six million people
2129.94s - 2132.86s |  So the security community is not that big. I
2133.70s - 2136.10s |  Got contacted from someone saying
2136.82s - 2141.50s |  Thomas is you're running some kind of research project for the VPAT?
2142.02s - 2143.38s |  Yeah
2143.38s - 2151.42s |  Okay, this big company apparently got a lot of machine trapped in the VPAT file and all the traffic was going to
2151.42s - 2153.34s |  my server so
2153.34s - 2159.70s |  They they just wanted to know and the way they found it was because one of the domains I had on my list
2159.70s - 2161.70s |  It was not fully
2162.06s - 2169.34s |  Anonymized so they could see the name Thomas and then say are Thomas from Denmark and we try to call him
2172.22s - 2174.22s |  That's good research
2175.96s - 2177.40s |  Yeah
2177.40s - 2180.32s |  so if we are looking back on
2180.76s - 2182.76s |  27
2182.92s - 2185.56s |  Thousand different user agent strings on
2186.24s - 2192.84s |  Basically all platforms. I would like to present one slide saying this is Microsoft crap
2192.84s - 2197.88s |  Here's the three settings you want to sit on a Microsoft machine and you're protected
2197.88s - 2203.12s |  But this seems to be all platforms all applications that has the issue
2204.24s - 2208.00s |  Otherwise, I wouldn't have got so much traffic as I've seen in my data
2208.68s - 2213.72s |  So my best advice is to add into the host file on the machine
2215.00s - 2219.40s |  The VPAT domains and saying that is it loop back to itself
2219.44s - 2224.28s |  So it will never send any traffic to the Internet and then you have to look up
2224.84s - 2226.64s |  each OS
2226.64s - 2233.08s |  See which way you can disable the function on there and also add the VPAT to your company domain
2233.36s - 2237.40s |  So if a client is asking on that domain it will not
2238.96s - 2241.48s |  Resolve other than 127 a
2242.68s - 2249.64s |  Thing also to note here that I skipped over is that when a client download my VPAT configuration config file
2249.88s - 2251.88s |  It caches the fire
2252.04s - 2254.48s |  So when people are working from home
2254.64s - 2259.88s |  They may be on a network where they can download the file in a in a DK domain
2259.96s - 2267.44s |  They download the file start using the proxy get into the workplace keep doing using the proxy because they're caching the fire
2267.44s - 2272.96s |  I am told them to use this file for 14 days or something. So they will keep using it
2274.56s - 2281.56s |  Yeah, and it's best to disable this VPAT function at system level otherwise it
2282.12s - 2287.24s |  You will if you only disable in that browser all the services you have on your machine
2287.40s - 2291.60s |  They're running a system. They are also talking like antivirus application
2291.60s - 2296.40s |  They are talking to the Internet that will not inherit and configuration from the client settings
2296.68s - 2302.52s |  So it is best to set it on machine level. So it's everything on the machine and disable its function and
2303.36s - 2310.10s |  As you can see, there's a Windows service called HTTP Windows proxy automatic discovery service
2310.56s - 2312.56s |  It's on all machines
2312.60s - 2315.48s |  No one know what it is. But now you knew know what it is
2316.00s - 2320.44s |  It can be difficult to disable because it has dependency to other things
2322.32s - 2331.21s |  Yeah, so basically read the fucking manual to find out how to disable it on all applications and OS's
2332.29s - 2336.01s |  Because it's not easy to for me to make one slide to fix it at all
2337.89s - 2343.13s |  Yeah, so this is the slides again, thank you to kill